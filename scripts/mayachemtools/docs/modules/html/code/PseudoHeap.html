<html>
<head>
<title>MayaChemTools:Code:PseudoHeap.pm</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<link rel="stylesheet" type="text/css" href="../../../css/MayaChemToolsCode.css">
</head>
<body leftmargin="20" rightmargin="20" topmargin="10" bottommargin="10">
<br/>
<center>
<a href="http://www.mayachemtools.org" title="MayaChemTools Home"><img src="../../../images/MayaChemToolsLogo.gif" border="0" alt="MayaChemTools"></a>
</center>
<br/>
<pre>
<a name="package-PseudoHeap-"></a>   1 <span class="k">package </span><span class="i">PseudoHeap</span><span class="sc">;</span>
   2 <span class="c">#</span>
   3 <span class="c"># File: PseudoHeap.pm</span>
   4 <span class="c"># Author: Manish Sud &lt;msud@san.rr.com&gt;</span>
   5 <span class="c">#</span>
   6 <span class="c"># Copyright (C) 2018 Manish Sud. All rights reserved.</span>
   7 <span class="c">#</span>
   8 <span class="c"># This file is part of MayaChemTools.</span>
   9 <span class="c">#</span>
  10 <span class="c"># MayaChemTools is free software; you can redistribute it and/or modify it under</span>
  11 <span class="c"># the terms of the GNU Lesser General Public License as published by the Free</span>
  12 <span class="c"># Software Foundation; either version 3 of the License, or (at your option) any</span>
  13 <span class="c"># later version.</span>
  14 <span class="c">#</span>
  15 <span class="c"># MayaChemTools is distributed in the hope that it will be useful, but without</span>
  16 <span class="c"># any warranty; without even the implied warranty of merchantability of fitness</span>
  17 <span class="c"># for a particular purpose.  See the GNU Lesser General Public License for more</span>
  18 <span class="c"># details.</span>
  19 <span class="c">#</span>
  20 <span class="c"># You should have received a copy of the GNU Lesser General Public License</span>
  21 <span class="c"># along with MayaChemTools; if not, see &lt;http://www.gnu.org/licenses/&gt; or</span>
  22 <span class="c"># write to the Free Software Foundation Inc., 59 Temple Place, Suite 330,</span>
  23 <span class="c"># Boston, MA, 02111-1307, USA.</span>
  24 <span class="c">#</span>
  25 
  26 <span class="k">use</span> <span class="w">strict</span><span class="sc">;</span>
  27 <span class="k">use</span> <span class="w">Carp</span><span class="sc">;</span>
  28 <span class="k">use</span> <span class="w">Exporter</span><span class="sc">;</span>
  29 <span class="k">use</span> <span class="w">TextUtil</span> <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  30 
  31 <span class="k">use</span> <span class="w">vars</span> <span class="q">qw(@ISA @EXPORT @EXPORT_OK %EXPORT_TAGS)</span><span class="sc">;</span>
  32 
  33 <span class="i">@ISA</span> = <span class="q">qw(Exporter)</span><span class="sc">;</span>
  34 <span class="i">@EXPORT</span> = <span class="q">qw()</span><span class="sc">;</span>
  35 <span class="i">@EXPORT_OK</span> = <span class="q">qw()</span><span class="sc">;</span>
  36 
  37 <span class="i">%EXPORT_TAGS</span> = <span class="s">(</span>
  38                 <span class="w">all</span>  <span class="cm">=&gt;</span> <span class="s">[</span><span class="i">@EXPORT</span><span class="cm">,</span> <span class="i">@EXPORT_OK</span><span class="s">]</span>
  39                <span class="s">)</span><span class="sc">;</span>
  40 
  41 <span class="c"># Setup class variables...</span>
  42 <span class="k">my</span><span class="s">(</span><span class="i">$ClassName</span><span class="s">)</span><span class="sc">;</span>
  43 <span class="i">_InitializeClass</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  44 
  45 <span class="k">use</span> <span class="w">overload</span> <span class="q">&#39;&quot;&quot;&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;StringifyPseudoHeap&#39;</span><span class="sc">;</span>
  46 
  47 <span class="c"># PseudoHeap is designed to support tracking of a specific number of largest or smallest key/value</span>
  48 <span class="c"># pairs with numeric or alphanumeric keys along with corresponding scalar or reference values.</span>
  49 <span class="c">#</span>
  50 <span class="c"># Although PseudoHeap is similar to a heap, it lacks number of key properties of a traditional heap data</span>
  51 <span class="c"># structure: no concept of root, parent and child nodes; no ordering of keys in any particular order; no</span>
  52 <span class="c"># specific localtion greatest or smallest key.</span>
  53 <span class="c">#</span>
  54 <span class="c"># The keys are simply stored in a hash with each key poining to an array containing specified values.</span>
  55 <span class="c"># The min/max keys are updated during addition and deletion of key/value pairs; these can be retrieved</span>
  56 <span class="c"># by accessing corresponding hash.</span>
  57 <span class="c">#</span>
  58 <span class="c"># Addition and deletion of key/value is also straightforward using hashes. However, min/max keys</span>
  59 <span class="c"># need to be identified which is done using Perl sort on the keys.</span>
  60 <span class="c">#</span>
  61 <span class="c">#</span>
  62 <span class="c"># Class constructor...</span>
  63 <span class="c">#</span>
<a name="new-"></a>  64 <span class="k">sub </span><span class="m">new</span> <span class="s">{</span>
  65   <span class="k">my</span><span class="s">(</span><span class="i">$Class</span><span class="cm">,</span> <span class="i">%NamesAndValues</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  66 
  67   <span class="c"># Initialize object...</span>
  68   <span class="k">my</span> <span class="i">$This</span> = <span class="s">{</span><span class="s">}</span><span class="sc">;</span>
  69   <span class="k">bless</span> <span class="i">$This</span><span class="cm">,</span> <span class="k">ref</span><span class="s">(</span><span class="i">$Class</span><span class="s">)</span> || <span class="i">$Class</span><span class="sc">;</span>
  70   <span class="i">$This</span><span class="i">-&gt;_InitializePseudoHeap</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  71 
  72   <span class="i">$This</span><span class="i">-&gt;_InitializePseudoHeapProperties</span><span class="s">(</span><span class="i">%NamesAndValues</span><span class="s">)</span><span class="sc">;</span>
  73 
  74   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
  75 <span class="s">}</span>
  76 
  77 <span class="c"># Initialize object data...</span>
  78 <span class="c">#</span>
<a name="_InitializePseudoHeap-"></a>  79 <span class="k">sub </span><span class="m">_InitializePseudoHeap</span> <span class="s">{</span>
  80   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  81 
  82   <span class="c"># Type of pseudo heap:</span>
  83   <span class="c">#</span>
  84   <span class="c"># KeepTopN - Keep track of a specified number largest of key/value pairs</span>
  85   <span class="c"># KeepBottomN - Keep track of a specified number smallest of key/value pairs</span>
  86   <span class="c">#</span>
  87   <span class="i">$This</span>-&gt;{<span class="w">Type</span>} = <span class="k">undef</span><span class="sc">;</span>
  88 
  89   <span class="c"># Type of keys: Numeric or Alphanumeric</span>
  90   <span class="c">#</span>
  91   <span class="c"># The value of KeyType determines comparison function used to sort and</span>
  92   <span class="c"># and compare keys for a specific heap type as shown below:</span>
  93   <span class="c">#</span>
  94   <span class="c"># Type             KeyType       Comp  Sorting</span>
  95   <span class="c">#</span>
  96   <span class="c"># KeepTopN      Numeric       &lt;     Descending</span>
  97   <span class="c"># KeepTopN      AlphaNumeric  lt    Descending</span>
  98   <span class="c"># KeepBottomN  Numeric        &gt;     Ascending</span>
  99   <span class="c"># KeepBottomN  AlphaNumeric   gt    Ascending</span>
 100   <span class="c">#</span>
 101   <span class="i">$This</span>-&gt;{<span class="w">KeyType</span>} = <span class="k">undef</span><span class="sc">;</span>
 102 
 103   <span class="c"># Maximum number of largest or smallest key/value pairs to keep...</span>
 104   <span class="c">#</span>
 105   <span class="i">$This</span>-&gt;{<span class="w">MaxSize</span>} = <span class="n">10</span><span class="sc">;</span>
 106 
 107   <span class="c"># Keys and values associated with each key as an array...</span>
 108   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">Keys</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 109 
 110   <span class="c"># Min and max keys...</span>
 111   <span class="i">$This</span>-&gt;{<span class="w">MinKey</span>} = <span class="k">undef</span><span class="sc">;</span>
 112   <span class="i">$This</span>-&gt;{<span class="w">MaxKey</span>} = <span class="k">undef</span><span class="sc">;</span>
 113 
 114   <span class="c"># Number of key/valur pairs currently present...</span>
 115   <span class="i">$This</span>-&gt;{<span class="w">CurrentSize</span>} = <span class="n">0</span><span class="sc">;</span>
 116 
 117   <span class="c"># Number of keys currently present where each key correspond to multiple values...</span>
 118   <span class="i">$This</span>-&gt;{<span class="w">KeysCount</span>} = <span class="n">0</span><span class="sc">;</span>
 119 <span class="s">}</span>
 120 
 121 <span class="c"># Initialize class ...</span>
<a name="_InitializeClass-"></a> 122 <span class="k">sub </span><span class="m">_InitializeClass</span> <span class="s">{</span>
 123   <span class="c">#Class name...</span>
 124   <span class="i">$ClassName</span> = <span class="w">__PACKAGE__</span><span class="sc">;</span>
 125 
 126 <span class="s">}</span>
 127 
 128 <span class="c"># Initialize object properties....</span>
 129 <span class="c">#</span>
<a name="_InitializePseudoHeapProperties-"></a> 130 <span class="k">sub </span><span class="m">_InitializePseudoHeapProperties</span> <span class="s">{</span>
 131   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">%NamesAndValues</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 132   <span class="k">my</span><span class="s">(</span><span class="i">$Name</span><span class="cm">,</span> <span class="i">$Value</span><span class="cm">,</span> <span class="i">$MethodName</span><span class="s">)</span><span class="sc">;</span>
 133 
 134   <span class="k">while</span> <span class="s">(</span><span class="s">(</span><span class="i">$Name</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="k">each</span>  <span class="i">%NamesAndValues</span><span class="s">)</span> <span class="s">{</span>
 135     <span class="i">$MethodName</span> = <span class="q">&quot;Set${Name}&quot;</span><span class="sc">;</span>
 136     <span class="i">$This</span><span class="i">-&gt;$MethodName</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span><span class="sc">;</span>
 137   <span class="s">}</span>
 138 
 139   <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$NamesAndValues</span>{<span class="w">Type</span>}<span class="s">)</span> <span class="s">{</span>
 140     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;New: Object can&#39;t be instantiated without specifying Type...&quot;</span><span class="sc">;</span>
 141   <span class="s">}</span>
 142 
 143   <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$NamesAndValues</span>{<span class="w">KeyType</span>}<span class="s">)</span> <span class="s">{</span>
 144     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;New: Object can&#39;t be instantiated without specifying KeyType...&quot;</span><span class="sc">;</span>
 145   <span class="s">}</span>
 146 <span class="s">}</span>
 147 
 148 <span class="c"># Set heap type...</span>
 149 <span class="c">#</span>
<a name="SetType-"></a> 150 <span class="k">sub </span><span class="m">SetType</span> <span class="s">{</span>
 151   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Type</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 152 
 153   <span class="k">if</span> <span class="s">(</span><span class="k">defined</span> <span class="i">$This</span>-&gt;{<span class="w">Type</span>}<span class="s">)</span> <span class="s">{</span>
 154     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetType: Can&#39;t change Type...&quot;</span><span class="sc">;</span>
 155   <span class="s">}</span>
 156 
 157   <span class="k">if</span> <span class="s">(</span><span class="i">$Type</span> !~ <span class="q">/^(KeepTopN|KeepBottomN)$/i</span><span class="s">)</span> <span class="s">{</span>
 158     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetType: Unknown PseudoHeap type: $Type; Supported types: KeepTopN or KeepBottomN...&quot;</span><span class="sc">;</span>
 159   <span class="s">}</span>
 160   <span class="i">$This</span>-&gt;{<span class="w">Type</span>} = <span class="i">$Type</span><span class="sc">;</span>
 161 
 162   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 163 <span class="s">}</span>
 164 
 165 <span class="c"># Get heap type..</span>
 166 <span class="c">#</span>
<a name="GetType-"></a> 167 <span class="k">sub </span><span class="m">GetType</span> <span class="s">{</span>
 168   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 169 
 170   <span class="k">return</span> <span class="k">defined</span> <span class="i">$This</span>-&gt;{<span class="w">Type</span>} ? <span class="i">$This</span>-&gt;{<span class="w">Type</span>} <span class="co">:</span> <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 171 <span class="s">}</span>
 172 
 173 <span class="c"># Set key type...</span>
 174 <span class="c">#</span>
<a name="SetKeyType-"></a> 175 <span class="k">sub </span><span class="m">SetKeyType</span> <span class="s">{</span>
 176   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$KeyType</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 177 
 178   <span class="k">if</span> <span class="s">(</span><span class="k">defined</span> <span class="i">$This</span>-&gt;{<span class="w">KeyType</span>}<span class="s">)</span> <span class="s">{</span>
 179     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetType: Can&#39;t change KeyType...&quot;</span><span class="sc">;</span>
 180   <span class="s">}</span>
 181 
 182   <span class="k">if</span> <span class="s">(</span><span class="i">$KeyType</span> !~ <span class="q">/^(Numeric|Alphanumeric)$/i</span><span class="s">)</span> <span class="s">{</span>
 183     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetType: Unknown PseudoHeap key type: $KeyType; Supported key types: Numeric or Alphanumeric...&quot;</span><span class="sc">;</span>
 184   <span class="s">}</span>
 185   <span class="i">$This</span>-&gt;{<span class="w">KeyType</span>} = <span class="i">$KeyType</span><span class="sc">;</span>
 186 
 187   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 188 <span class="s">}</span>
 189 
 190 <span class="c"># Get key type..</span>
 191 <span class="c">#</span>
<a name="GetKeyType-"></a> 192 <span class="k">sub </span><span class="m">GetKeyType</span> <span class="s">{</span>
 193   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 194 
 195   <span class="k">return</span> <span class="k">defined</span> <span class="i">$This</span>-&gt;{<span class="w">KeyType</span>} ? <span class="i">$This</span>-&gt;{<span class="w">KeyType</span>} <span class="co">:</span> <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 196 <span class="s">}</span>
 197 
 198 <span class="c"># Add a key/value pair...</span>
 199 <span class="c">#</span>
<a name="AddKeyValuePair-"></a> 200 <span class="k">sub </span><span class="m">AddKeyValuePair</span> <span class="s">{</span>
 201   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Key</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 202 
 203   <span class="k">if</span> <span class="s">(</span>!<span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$Key</span><span class="s">)</span> &amp;&amp; <span class="k">defined</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 204     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;AddKeyValuePair: No key added: Both key and value must be defined...&quot;</span><span class="sc">;</span>
 205     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 206   <span class="s">}</span>
 207 
 208   <span class="i">$This</span><span class="i">-&gt;_AddKeyValuePair</span><span class="s">(</span><span class="i">$Key</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span><span class="sc">;</span>
 209 
 210   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 211 <span class="s">}</span>
 212 
 213 <span class="c"># Add multiple key/value pairs...</span>
 214 <span class="c">#</span>
<a name="AddKeyValuePairs-"></a> 215 <span class="k">sub </span><span class="m">AddKeyValuePairs</span> <span class="s">{</span>
 216   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@KeyValuePairs</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 217 
 218   <span class="k">if</span> <span class="s">(</span>!<span class="i">@KeyValuePairs</span><span class="s">)</span> <span class="s">{</span>
 219     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;AddKeyValuePairs: No keys added: Key/Value pairs list is empty...&quot;</span><span class="sc">;</span>
 220     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 221   <span class="s">}</span>
 222   <span class="k">if</span> <span class="s">(</span><span class="i">@KeyValuePairs</span> % <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
 223     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;AddKeyValuePairs: No keys pairs added: Invalid key/value pairs data: Input list must contain even number of values...&quot;</span><span class="sc">;</span>
 224     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 225   <span class="s">}</span>
 226 
 227   <span class="k">my</span><span class="s">(</span><span class="i">$Key</span><span class="cm">,</span> <span class="i">$Value</span><span class="cm">,</span> <span class="i">$Index</span><span class="s">)</span><span class="sc">;</span>
 228   <span class="k">for</span> <span class="s">(</span><span class="i">$Index</span> = <span class="n">0</span><span class="sc">;</span> <span class="i">$Index</span> &lt; <span class="i">$#KeyValuePairs</span><span class="sc">;</span> <span class="i">$Index</span> += <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
 229     <span class="i">$Key</span> = <span class="i">$KeyValuePairs</span>[<span class="i">$Index</span>]<span class="sc">;</span> <span class="i">$Value</span> = <span class="i">$KeyValuePairs</span>[<span class="i">$Index</span> + <span class="n">1</span>]<span class="sc">;</span>
 230     <span class="i">$This</span><span class="i">-&gt;AddKeyValuePair</span><span class="s">(</span><span class="i">$Key</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span><span class="sc">;</span>
 231   <span class="s">}</span>
 232 
 233   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 234 <span class="s">}</span>
 235 
 236 <span class="c"># Delete specified keys along with all associated values for each key...</span>
 237 <span class="c">#</span>
<a name="DeleteKeys-"></a> 238 <span class="k">sub </span><span class="m">DeleteKeys</span> <span class="s">{</span>
 239   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@Keys</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 240 
 241   <span class="k">if</span> <span class="s">(</span>!<span class="i">@Keys</span><span class="s">)</span> <span class="s">{</span>
 242     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;DeleteKeys: No keys deleted: Keys list is empty...&quot;</span><span class="sc">;</span>
 243     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 244   <span class="s">}</span>
 245   <span class="k">my</span><span class="s">(</span><span class="i">$Key</span><span class="s">)</span><span class="sc">;</span>
 246   <span class="k">for</span> <span class="i">$Key</span> <span class="s">(</span><span class="i">@Keys</span><span class="s">)</span> <span class="s">{</span>
 247     <span class="i">$This</span><span class="i">-&gt;DeleteKey</span><span class="s">(</span><span class="i">$Key</span><span class="s">)</span><span class="sc">;</span>
 248   <span class="s">}</span>
 249 
 250   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 251 <span class="s">}</span>
 252 
 253 <span class="c"># Delete a sepcified key along with all of its associated values...</span>
 254 <span class="c">#</span>
<a name="DeleteKey-"></a> 255 <span class="k">sub </span><span class="m">DeleteKey</span> <span class="s">{</span>
 256   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Key</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 257 
 258   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$Key</span> <span class="s">)</span> <span class="s">{</span>
 259     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;DeleteKey: No key deleted: Key must be specified...&quot;</span><span class="sc">;</span>
 260     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 261   <span class="s">}</span>
 262 
 263   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_DeleteKey</span><span class="s">(</span><span class="i">$Key</span><span class="s">)</span><span class="sc">;</span>
 264 <span class="s">}</span>
 265 
 266 <span class="c"># Delete min key along with all of its associated values...</span>
 267 <span class="c">#</span>
<a name="DeleteMinKey-"></a> 268 <span class="k">sub </span><span class="m">DeleteMinKey</span> <span class="s">{</span>
 269   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 270 
 271   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;DeleteKey</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">MinKey</span>}<span class="s">)</span><span class="sc">;</span>
 272 <span class="s">}</span>
 273 
 274 <span class="c"># Delete max key along with all of its associated values...</span>
 275 <span class="c">#</span>
<a name="DeleteMaxKey-"></a> 276 <span class="k">sub </span><span class="m">DeleteMaxKey</span> <span class="s">{</span>
 277   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 278 
 279   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;DeleteKey</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">MaxKey</span>}<span class="s">)</span><span class="sc">;</span>
 280 <span class="s">}</span>
 281 
 282 <span class="c"># Set max size...</span>
 283 <span class="c">#</span>
<a name="SetMaxSize-"></a> 284 <span class="k">sub </span><span class="m">SetMaxSize</span> <span class="s">{</span>
 285   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Size</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 286 
 287   <span class="k">if</span> <span class="s">(</span>!<span class="i">TextUtil::IsPositiveInteger</span><span class="s">(</span><span class="i">$Size</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 288     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetMaxSize: Max size value, $Size, is not valid: It must be a positive  integer...&quot;</span><span class="sc">;</span>
 289   <span class="s">}</span>
 290 
 291   <span class="k">if</span> <span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">MinKey</span>}<span class="s">)</span> || <span class="k">defined</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">MaxKey</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 292     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetMaxSize: Can&#39;t change max size: Keys are already present...&quot;</span><span class="sc">;</span>
 293   <span class="s">}</span>
 294 
 295   <span class="i">$This</span>-&gt;{<span class="w">MaxSize</span>} = <span class="i">$Size</span><span class="sc">;</span>
 296 
 297   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 298 <span class="s">}</span>
 299 
 300 <span class="c"># Get max size...</span>
 301 <span class="c">#</span>
<a name="GetMaxSize-"></a> 302 <span class="k">sub </span><span class="m">GetMaxSize</span> <span class="s">{</span>
 303   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 304 
 305   <span class="k">return</span> <span class="i">$This</span>-&gt;{<span class="w">MaxMaxSize</span>}<span class="sc">;</span>
 306 <span class="s">}</span>
 307 
 308 <span class="c"># Get current size...</span>
 309 <span class="c">#</span>
<a name="GetCurrentSize-"></a> 310 <span class="k">sub </span><span class="m">GetCurrentSize</span> <span class="s">{</span>
 311   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 312 
 313   <span class="k">return</span> <span class="i">$This</span>-&gt;{<span class="w">CurrentSize</span>}<span class="sc">;</span>
 314 <span class="s">}</span>
 315 
 316 <span class="c"># Get min key...</span>
 317 <span class="c">#</span>
<a name="GetMinKey-"></a> 318 <span class="k">sub </span><span class="m">GetMinKey</span> <span class="s">{</span>
 319   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 320 
 321   <span class="k">return</span> <span class="k">defined</span> <span class="i">$This</span>-&gt;{<span class="w">MinKey</span>} ? <span class="i">$This</span>-&gt;{<span class="w">MinKey</span>} <span class="co">:</span> <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 322 <span class="s">}</span>
 323 
 324 <span class="c"># Get max key...</span>
 325 <span class="c">#</span>
<a name="GetMaxKey-"></a> 326 <span class="k">sub </span><span class="m">GetMaxKey</span> <span class="s">{</span>
 327   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 328 
 329   <span class="k">return</span> <span class="k">defined</span> <span class="i">$This</span>-&gt;{<span class="w">MaxKey</span>} ? <span class="i">$This</span>-&gt;{<span class="w">MaxKey</span>} <span class="co">:</span> <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 330 <span class="s">}</span>
 331 
 332 <span class="c"># Get keys...</span>
 333 <span class="c">#</span>
<a name="GetKeys-"></a> 334 <span class="k">sub </span><span class="m">GetKeys</span> <span class="s">{</span>
 335   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 336 
 337   <span class="k">return</span> <span class="k">wantarray</span> ? <span class="k">keys</span> <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">Keys</span>}} <span class="co">:</span> <span class="k">scalar</span> <span class="k">keys</span> <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">Keys</span>}}<span class="sc">;</span>
 338 <span class="s">}</span>
 339 
 340 <span class="c"># Get sorted keys...</span>
 341 <span class="c">#</span>
<a name="GetSortedKeys-"></a> 342 <span class="k">sub </span><span class="m">GetSortedKeys</span> <span class="s">{</span>
 343   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 344   <span class="k">my</span><span class="s">(</span><span class="i">@SortedKeys</span><span class="s">)</span><span class="sc">;</span>
 345 
 346   <span class="i">@SortedKeys</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 347   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">Type</span>} =~ <span class="q">/^KeepTopN$/i</span><span class="s">)</span> <span class="s">{</span>
 348     <span class="i">@SortedKeys</span> = <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">KeyType</span>} =~ <span class="q">/^Numeric$/i</span><span class="s">)</span> ? <span class="s">(</span><span class="k">sort</span> <span class="s">{</span> <span class="i">$b</span> &lt;=&gt; <span class="i">$a</span> <span class="s">}</span> <span class="k">keys</span> <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">Keys</span>}}<span class="s">)</span> <span class="co">:</span> <span class="s">(</span><span class="k">sort</span> <span class="s">{</span> <span class="i">$b</span> <span class="k">cmp</span> <span class="i">$a</span> <span class="s">}</span> <span class="k">keys</span> <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">Keys</span>}}<span class="s">)</span><span class="sc">;</span>
 349   <span class="s">}</span>
 350   <span class="k">elsif</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">Type</span>} =~ <span class="q">/^KeepBottomN$/i</span><span class="s">)</span> <span class="s">{</span>
 351     <span class="i">@SortedKeys</span> = <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">KeyType</span>} =~ <span class="q">/^Numeric$/i</span><span class="s">)</span> ? <span class="s">(</span><span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> &lt;=&gt; <span class="i">$b</span> <span class="s">}</span> <span class="k">keys</span> <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">Keys</span>}}<span class="s">)</span> <span class="co">:</span> <span class="s">(</span><span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> <span class="k">cmp</span> <span class="i">$b</span> <span class="s">}</span> <span class="k">keys</span> <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">Keys</span>}}<span class="s">)</span><span class="sc">;</span>
 352   <span class="s">}</span>
 353 
 354   <span class="k">return</span> <span class="k">wantarray</span> ? <span class="i">@SortedKeys</span> <span class="co">:</span> <span class="k">scalar</span> <span class="i">@SortedKeys</span><span class="sc">;</span>
 355 <span class="s">}</span>
 356 
 357 <span class="c"># Get values associated with a specified key...</span>
<a name="GetKeyValues-"></a> 358 <span class="k">sub </span><span class="m">GetKeyValues</span> <span class="s">{</span>
 359   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Key</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 360   <span class="k">my</span><span class="s">(</span><span class="i">@KeyValues</span><span class="s">)</span><span class="sc">;</span>
 361 
 362   <span class="i">@KeyValues</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 363   <span class="k">if</span> <span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$Key</span><span class="s">)</span> &amp;&amp; <span class="k">exists</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">Keys</span>}{<span class="i">$Key</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 364     <span class="i">@KeyValues</span> = <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Keys</span>}{<span class="i">$Key</span>}}<span class="sc">;</span>
 365   <span class="s">}</span>
 366   <span class="k">return</span> <span class="k">wantarray</span> ? <span class="i">@KeyValues</span> <span class="co">:</span> <span class="k">scalar</span> <span class="i">@KeyValues</span><span class="sc">;</span>
 367 <span class="s">}</span>
 368 
 369 <span class="c">#  Add key/value pair...</span>
 370 <span class="c">#</span>
<a name="_AddKeyValuePair-"></a> 371 <span class="k">sub </span><span class="m">_AddKeyValuePair</span><span class="s">{</span>
 372   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Key</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 373 
 374   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">CurrentSize</span>} &lt; <span class="i">$This</span>-&gt;{<span class="w">MaxSize</span>}<span class="s">)</span> <span class="s">{</span>
 375     <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_AppendKeyValuePair</span><span class="s">(</span><span class="i">$Key</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span><span class="sc">;</span>
 376   <span class="s">}</span>
 377   <span class="k">else</span> <span class="s">{</span>
 378     <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_InsertKeyValuePair</span><span class="s">(</span><span class="i">$Key</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span><span class="sc">;</span>
 379   <span class="s">}</span>
 380 <span class="s">}</span>
 381 
 382 <span class="c"># Append key/value pair...</span>
 383 <span class="c">#</span>
<a name="_AppendKeyValuePair-"></a> 384 <span class="k">sub </span><span class="m">_AppendKeyValuePair</span> <span class="s">{</span>
 385   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Key</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 386 
 387   <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$This</span>-&gt;{<span class="w">Keys</span>}{<span class="i">$Key</span>}<span class="s">)</span> <span class="s">{</span>
 388     <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Keys</span>}{<span class="i">$Key</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 389     <span class="i">$This</span>-&gt;{<span class="w">KeysCount</span>} += <span class="n">1</span><span class="sc">;</span>
 390 
 391     <span class="i">$This</span><span class="i">-&gt;_CompareAndSetMinKey</span><span class="s">(</span><span class="i">$Key</span><span class="s">)</span><span class="sc">;</span>
 392     <span class="i">$This</span><span class="i">-&gt;_CompareAndSetMaxKey</span><span class="s">(</span><span class="i">$Key</span><span class="s">)</span><span class="sc">;</span>
 393   <span class="s">}</span>
 394 
 395   <span class="k">push</span> <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Keys</span>}{<span class="i">$Key</span>}}<span class="cm">,</span> <span class="i">$Value</span><span class="sc">;</span>
 396   <span class="i">$This</span>-&gt;{<span class="w">CurrentSize</span>} += <span class="n">1</span><span class="sc">;</span>
 397 
 398   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 399 <span class="s">}</span>
 400 
 401 <span class="c"># Insert key/value pair...</span>
 402 <span class="c">#</span>
<a name="_InsertKeyValuePair-"></a> 403 <span class="k">sub </span><span class="m">_InsertKeyValuePair</span> <span class="s">{</span>
 404   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Key</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 405 
 406   <span class="c"># Is this key need to be inserted?</span>
 407   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;_IsKeyNeedToBeInserted</span><span class="s">(</span><span class="i">$Key</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 408     <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 409   <span class="s">}</span>
 410 
 411   <span class="c"># Insert key/value pair...</span>
 412   <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$This</span>-&gt;{<span class="w">Keys</span>}{<span class="i">$Key</span>}<span class="s">)</span> <span class="s">{</span>
 413     <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Keys</span>}{<span class="i">$Key</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 414     <span class="i">$This</span>-&gt;{<span class="w">KeysCount</span>} += <span class="n">1</span><span class="sc">;</span>
 415   <span class="s">}</span>
 416   <span class="k">push</span> <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Keys</span>}{<span class="i">$Key</span>}}<span class="cm">,</span> <span class="i">$Value</span><span class="sc">;</span>
 417   <span class="i">$This</span>-&gt;{<span class="w">CurrentSize</span>} += <span class="n">1</span><span class="sc">;</span>
 418 
 419   <span class="c"># Remove min or max key/value pair along with its update...</span>
 420   <span class="k">my</span><span class="s">(</span><span class="i">$KeyToDetele</span><span class="s">)</span><span class="sc">;</span>
 421 
 422   <span class="i">$KeyToDetele</span> = <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">Type</span>} =~ <span class="q">/^KeepTopN$/i</span><span class="s">)</span> ? <span class="i">$This</span>-&gt;{<span class="w">MinKey</span>} <span class="co">:</span> <span class="i">$This</span>-&gt;{<span class="w">MaxKey</span>}<span class="sc">;</span>
 423   <span class="i">$This</span><span class="i">-&gt;_DeleteKeyValuePair</span><span class="s">(</span><span class="i">$KeyToDetele</span><span class="s">)</span><span class="sc">;</span>
 424 
 425   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 426 <span class="s">}</span>
 427 
 428 <span class="c"># Check whether it makes sense to insert specified key...</span>
 429 <span class="c">#</span>
<a name="_IsKeyNeedToBeInserted-"></a> 430 <span class="k">sub </span><span class="m">_IsKeyNeedToBeInserted</span> <span class="s">{</span>
 431   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Key</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 432 
 433   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">Type</span>} =~ <span class="q">/^KeepTopN$/i</span><span class="s">)</span> <span class="s">{</span>
 434     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">KeyType</span>} =~ <span class="q">/^Numeric$/i</span><span class="s">)</span> <span class="s">{</span>
 435       <span class="k">return</span> <span class="s">(</span><span class="i">$Key</span> &lt; <span class="i">$This</span>-&gt;{<span class="w">MinKey</span>}<span class="s">)</span> ? <span class="n">0</span> <span class="co">:</span> <span class="s">(</span><span class="s">(</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">KeysCount</span>} == <span class="n">1</span><span class="s">)</span> &amp;&amp; <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">MinKey</span>} == <span class="i">$Key</span><span class="s">)</span><span class="s">)</span> ? <span class="n">0</span> <span class="co">:</span> <span class="n">1</span><span class="s">)</span><span class="sc">;</span>
 436     <span class="s">}</span>
 437     <span class="k">else</span> <span class="s">{</span>
 438       <span class="k">return</span> <span class="s">(</span><span class="i">$Key</span> <span class="k">lt</span> <span class="i">$This</span>-&gt;{<span class="w">MinKey</span>}<span class="s">)</span> ? <span class="n">0</span> <span class="co">:</span> <span class="s">(</span><span class="s">(</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">KeysCount</span>} == <span class="n">1</span><span class="s">)</span> &amp;&amp; <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">MinKey</span>} <span class="k">eq</span> <span class="i">$Key</span><span class="s">)</span><span class="s">)</span> ? <span class="n">0</span> <span class="co">:</span> <span class="n">1</span><span class="s">)</span><span class="sc">;</span>
 439     <span class="s">}</span>
 440   <span class="s">}</span>
 441   <span class="k">elsif</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">Type</span>} =~ <span class="q">/^KeepBottomN$/i</span><span class="s">)</span> <span class="s">{</span>
 442     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">KeyType</span>} =~ <span class="q">/^Numeric$/i</span><span class="s">)</span> <span class="s">{</span>
 443       <span class="k">return</span> <span class="s">(</span><span class="i">$Key</span> &gt; <span class="i">$This</span>-&gt;{<span class="w">MaxKey</span>}<span class="s">)</span> ? <span class="n">0</span> <span class="co">:</span> <span class="s">(</span><span class="s">(</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">KeysCount</span>} == <span class="n">1</span><span class="s">)</span> &amp;&amp; <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">MaxKey</span>} == <span class="i">$Key</span><span class="s">)</span><span class="s">)</span> ? <span class="n">0</span> <span class="co">:</span> <span class="n">1</span><span class="s">)</span><span class="sc">;</span>
 444     <span class="s">}</span>
 445     <span class="k">else</span> <span class="s">{</span>
 446       <span class="k">return</span> <span class="s">(</span><span class="i">$Key</span> <span class="k">gt</span> <span class="i">$This</span>-&gt;{<span class="w">MaxKey</span>}<span class="s">)</span> ? <span class="n">0</span> <span class="co">:</span> <span class="s">(</span><span class="s">(</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">KeysCount</span>} == <span class="n">1</span><span class="s">)</span> &amp;&amp; <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">MaxKey</span>} <span class="k">eq</span> <span class="i">$Key</span><span class="s">)</span><span class="s">)</span> ? <span class="n">0</span> <span class="co">:</span> <span class="n">1</span><span class="s">)</span><span class="sc">;</span>
 447     <span class="s">}</span>
 448   <span class="s">}</span>
 449 
 450   <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
 451 <span class="s">}</span>
 452 
 453 <span class="c"># Set min key...</span>
 454 <span class="c">#</span>
<a name="_CompareAndSetMinKey-"></a> 455 <span class="k">sub </span><span class="m">_CompareAndSetMinKey</span> <span class="s">{</span>
 456   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Key</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 457 
 458   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$This</span>-&gt;{<span class="w">MinKey</span>}<span class="s">)</span> <span class="s">{</span>
 459     <span class="i">$This</span>-&gt;{<span class="w">MinKey</span>} = <span class="i">$Key</span><span class="sc">;</span>
 460     <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 461   <span class="s">}</span>
 462 
 463   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">KeyType</span>} =~ <span class="q">/^Numeric$/i</span><span class="s">)</span> <span class="s">{</span>
 464     <span class="k">if</span> <span class="s">(</span><span class="i">$Key</span> &lt; <span class="i">$This</span>-&gt;{<span class="w">MinKey</span>}<span class="s">)</span> <span class="s">{</span>
 465       <span class="i">$This</span>-&gt;{<span class="w">MinKey</span>} = <span class="i">$Key</span><span class="sc">;</span>
 466     <span class="s">}</span>
 467   <span class="s">}</span>
 468   <span class="k">else</span> <span class="s">{</span>
 469     <span class="k">if</span> <span class="s">(</span><span class="i">$Key</span> <span class="k">lt</span> <span class="i">$This</span>-&gt;{<span class="w">MinKey</span>}<span class="s">)</span> <span class="s">{</span>
 470       <span class="i">$This</span>-&gt;{<span class="w">MinKey</span>} = <span class="i">$Key</span><span class="sc">;</span>
 471     <span class="s">}</span>
 472   <span class="s">}</span>
 473 
 474   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 475 <span class="s">}</span>
 476 
 477 <span class="c"># Set max key...</span>
 478 <span class="c">#</span>
<a name="_CompareAndSetMaxKey-"></a> 479 <span class="k">sub </span><span class="m">_CompareAndSetMaxKey</span> <span class="s">{</span>
 480   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Key</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 481 
 482   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$This</span>-&gt;{<span class="w">MaxKey</span>}<span class="s">)</span> <span class="s">{</span>
 483     <span class="i">$This</span>-&gt;{<span class="w">MaxKey</span>} = <span class="i">$Key</span><span class="sc">;</span>
 484     <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 485   <span class="s">}</span>
 486 
 487   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">KeyType</span>} =~ <span class="q">/^Numeric$/i</span><span class="s">)</span> <span class="s">{</span>
 488     <span class="k">if</span> <span class="s">(</span><span class="i">$Key</span> &gt; <span class="i">$This</span>-&gt;{<span class="w">MaxKey</span>}<span class="s">)</span> <span class="s">{</span>
 489       <span class="i">$This</span>-&gt;{<span class="w">MaxKey</span>} = <span class="i">$Key</span><span class="sc">;</span>
 490     <span class="s">}</span>
 491   <span class="s">}</span>
 492   <span class="k">else</span> <span class="s">{</span>
 493     <span class="k">if</span> <span class="s">(</span><span class="i">$Key</span> <span class="k">gt</span> <span class="i">$This</span>-&gt;{<span class="w">MaxKey</span>}<span class="s">)</span> <span class="s">{</span>
 494       <span class="i">$This</span>-&gt;{<span class="w">MaxKey</span>} = <span class="i">$Key</span><span class="sc">;</span>
 495     <span class="s">}</span>
 496   <span class="s">}</span>
 497 
 498   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 499 <span class="s">}</span>
 500 
 501 <span class="c"># Delete a sepcified key along with all of its values added to the list...</span>
 502 <span class="c">#</span>
<a name="_DeleteKey-"></a> 503 <span class="k">sub </span><span class="m">_DeleteKey</span> <span class="s">{</span>
 504   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Key</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 505   <span class="k">my</span><span class="s">(</span><span class="i">$NumOfValues</span><span class="s">)</span><span class="sc">;</span>
 506 
 507   <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$This</span>-&gt;{<span class="w">Keys</span>}{<span class="i">$Key</span>}<span class="s">)</span> <span class="s">{</span>
 508     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 509   <span class="s">}</span>
 510 
 511   <span class="c"># Delete all key values...</span>
 512   <span class="i">$NumOfValues</span> = <span class="k">scalar</span> <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Keys</span>}{<span class="i">$Key</span>}}<span class="sc">;</span>
 513   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Keys</span>}{<span class="i">$Key</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 514   <span class="i">$This</span>-&gt;{<span class="w">CurrentSize</span>} -= <span class="i">$NumOfValues</span><span class="sc">;</span>
 515 
 516   <span class="c"># Delete key...</span>
 517   <span class="k">delete</span> <span class="i">$This</span>-&gt;{<span class="w">Keys</span>}{<span class="i">$Key</span>}<span class="sc">;</span>
 518   <span class="i">$This</span>-&gt;{<span class="w">KeysCount</span>} -= <span class="n">1</span><span class="sc">;</span>
 519 
 520   <span class="c"># Set min and max keys...</span>
 521   <span class="i">$This</span><span class="i">-&gt;_FindAndSetMinAndMaxKeys</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 522 
 523   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 524 <span class="s">}</span>
 525 
 526 <span class="c"># Delete a sepcified key along with its most recent value added to the list...</span>
 527 <span class="c">#</span>
<a name="_DeleteKeyValuePair-"></a> 528 <span class="k">sub </span><span class="m">_DeleteKeyValuePair</span> <span class="s">{</span>
 529   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Key</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 530 
 531   <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$This</span>-&gt;{<span class="w">Keys</span>}{<span class="i">$Key</span>}<span class="s">)</span> <span class="s">{</span>
 532     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 533   <span class="s">}</span>
 534 
 535   <span class="c"># Delete value...</span>
 536   <span class="k">pop</span> <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Keys</span>}{<span class="i">$Key</span>}}<span class="sc">;</span>
 537   <span class="i">$This</span>-&gt;{<span class="w">CurrentSize</span>} -= <span class="n">1</span><span class="sc">;</span>
 538 
 539   <span class="c"># Delete key...</span>
 540   <span class="k">if</span> <span class="s">(</span>!<span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Keys</span>}{<span class="i">$Key</span>}}<span class="s">)</span> <span class="s">{</span>
 541     <span class="k">delete</span> <span class="i">$This</span>-&gt;{<span class="w">Keys</span>}{<span class="i">$Key</span>}<span class="sc">;</span>
 542     <span class="i">$This</span>-&gt;{<span class="w">KeysCount</span>} -= <span class="n">1</span><span class="sc">;</span>
 543   <span class="s">}</span>
 544 
 545   <span class="c"># Set min and max keys...</span>
 546   <span class="i">$This</span><span class="i">-&gt;_FindAndSetMinAndMaxKeys</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 547 
 548   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 549 <span class="s">}</span>
 550 
 551 <span class="c"># Set min and max key...</span>
 552 <span class="c">#</span>
<a name="_FindAndSetMinAndMaxKeys-"></a> 553 <span class="k">sub </span><span class="m">_FindAndSetMinAndMaxKeys</span> <span class="s">{</span>
 554   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 555   <span class="k">my</span><span class="s">(</span><span class="i">@SortedKeys</span><span class="s">)</span><span class="sc">;</span>
 556 
 557   <span class="i">@SortedKeys</span> = <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">KeyType</span>} =~ <span class="q">/^Numeric$/i</span><span class="s">)</span> ? <span class="s">(</span><span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> &lt;=&gt; <span class="i">$b</span> <span class="s">}</span> <span class="k">keys</span> <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">Keys</span>}}<span class="s">)</span> <span class="co">:</span> <span class="s">(</span><span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> <span class="k">cmp</span> <span class="i">$b</span> <span class="s">}</span> <span class="k">keys</span> <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">Keys</span>}}<span class="s">)</span><span class="sc">;</span>
 558 
 559   <span class="k">if</span> <span class="s">(</span><span class="i">@SortedKeys</span><span class="s">)</span> <span class="s">{</span>
 560     <span class="i">$This</span>-&gt;{<span class="w">MinKey</span>} = <span class="i">$SortedKeys</span>[<span class="n">0</span>]<span class="sc">;</span>
 561     <span class="i">$This</span>-&gt;{<span class="w">MaxKey</span>} = <span class="i">$SortedKeys</span>[<span class="i">$#SortedKeys</span>]<span class="sc">;</span>
 562   <span class="s">}</span>
 563   <span class="k">else</span> <span class="s">{</span>
 564     <span class="i">$This</span>-&gt;{<span class="w">MinKey</span>} = <span class="k">undef</span><span class="sc">;</span>
 565     <span class="i">$This</span>-&gt;{<span class="w">MaxKey</span>} = <span class="k">undef</span><span class="sc">;</span>
 566   <span class="s">}</span>
 567 
 568   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 569 <span class="s">}</span>
 570 
 571 <span class="c"># Return a string containing vector values...</span>
<a name="StringifyPseudoHeap-"></a> 572 <span class="k">sub </span><span class="m">StringifyPseudoHeap</span> <span class="s">{</span>
 573   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 574   <span class="k">my</span><span class="s">(</span><span class="i">$PseudoHeapString</span><span class="cm">,</span> <span class="i">$Key</span><span class="cm">,</span> <span class="i">$Value</span><span class="cm">,</span> <span class="i">$KeyValuesString</span><span class="cm">,</span> <span class="i">@KeysAndValues</span><span class="s">)</span><span class="sc">;</span>
 575 
 576   <span class="i">$PseudoHeapString</span> = <span class="q">&quot;PseudoHeap: Type: &quot;</span> . <span class="i">$This</span><span class="i">-&gt;GetType</span><span class="s">(</span><span class="s">)</span> . <span class="q">&quot;; KeyType: &quot;</span> . <span class="i">$This</span><span class="i">-&gt;GetKeyType</span><span class="s">(</span><span class="s">)</span> . <span class="q">&quot;; MaxSize: $This-&gt;{MaxSize}; CurrentSize: $This-&gt;{CurrentSize}; MinKey: &quot;</span> . <span class="i">$This</span><span class="i">-&gt;GetMinKey</span><span class="s">(</span><span class="s">)</span> .  <span class="q">&quot;; MaxKey: &quot;</span> . <span class="i">$This</span><span class="i">-&gt;GetMaxKey</span><span class="s">(</span><span class="s">)</span> . <span class="q">&quot;; NumOfUniqueKeys: $This-&gt;{KeysCount}&quot;</span><span class="sc">;</span>
 577 
 578   <span class="i">@KeysAndValues</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 579   <span class="k">for</span> <span class="i">$Key</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetSortedKeys</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 580     <span class="k">for</span> <span class="i">$Value</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetKeyValues</span><span class="s">(</span><span class="i">$Key</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 581       <span class="k">push</span> <span class="i">@KeysAndValues</span><span class="cm">,</span> <span class="q">&quot;$Key - $Value&quot;</span><span class="sc">;</span>
 582     <span class="s">}</span>
 583   <span class="s">}</span>
 584   <span class="k">if</span> <span class="s">(</span><span class="i">@KeysAndValues</span><span class="s">)</span> <span class="s">{</span>
 585     <span class="i">$KeyValuesString</span> = <span class="i">TextUtil::JoinWords</span><span class="s">(</span>\<span class="i">@KeysAndValues</span><span class="cm">,</span> <span class="q">&quot;; &quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span><span class="sc">;</span>
 586   <span class="s">}</span>
 587   <span class="k">else</span> <span class="s">{</span>
 588     <span class="i">$KeyValuesString</span> = <span class="q">&quot;None&quot;</span><span class="sc">;</span>
 589   <span class="s">}</span>
 590 
 591   <span class="i">$PseudoHeapString</span> .= <span class="q">&quot;; Sorted Key - Value pairs: [$KeyValuesString]&quot;</span><span class="sc">;</span>
 592 
 593   <span class="k">return</span> <span class="i">$PseudoHeapString</span><span class="sc">;</span>
 594 <span class="s">}</span>
 595 
<a name="EOF-"></a></pre>
<p>&nbsp;</p>
<br />
<center>
<img src="../../../images/h2o2.png">
</center>
</body>
</html>
