<html>
<head>
<title>MayaChemTools:Code:AtomTypes/MMFF94AtomTypes.pm</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<link rel="stylesheet" type="text/css" href="../../../css/MayaChemToolsCode.css">
</head>
<body leftmargin="20" rightmargin="20" topmargin="10" bottommargin="10">
<br/>
<center>
<a href="http://www.mayachemtools.org" title="MayaChemTools Home"><img src="../../../images/MayaChemToolsLogo.gif" border="0" alt="MayaChemTools"></a>
</center>
<br/>
<pre>
<a name="package-AtomTypes::MMFF94AtomTypes-"></a>   1 <span class="k">package </span><span class="i">AtomTypes::MMFF94AtomTypes</span><span class="sc">;</span>
   2 <span class="c">#</span>
   3 <span class="c"># File: MMFF94AtomTypes.pm</span>
   4 <span class="c"># Author: Manish Sud &lt;msud@san.rr.com&gt;</span>
   5 <span class="c">#</span>
   6 <span class="c"># Copyright (C) 2018 Manish Sud. All rights reserved.</span>
   7 <span class="c">#</span>
   8 <span class="c"># This file is part of MayaChemTools.</span>
   9 <span class="c">#</span>
  10 <span class="c"># MayaChemTools is free software; you can redistribute it and/or modify it under</span>
  11 <span class="c"># the terms of the GNU Lesser General Public License as published by the Free</span>
  12 <span class="c"># Software Foundation; either version 3 of the License, or (at your option) any</span>
  13 <span class="c"># later version.</span>
  14 <span class="c">#</span>
  15 <span class="c"># MayaChemTools is distributed in the hope that it will be useful, but without</span>
  16 <span class="c"># any warranty; without even the implied warranty of merchantability of fitness</span>
  17 <span class="c"># for a particular purpose.  See the GNU Lesser General Public License for more</span>
  18 <span class="c"># details.</span>
  19 <span class="c">#</span>
  20 <span class="c"># You should have received a copy of the GNU Lesser General Public License</span>
  21 <span class="c"># along with MayaChemTools; if not, see &lt;http://www.gnu.org/licenses/&gt; or</span>
  22 <span class="c"># write to the Free Software Foundation Inc., 59 Temple Place, Suite 330,</span>
  23 <span class="c"># Boston, MA, 02111-1307, USA.</span>
  24 <span class="c">#</span>
  25 
  26 <span class="k">use</span> <span class="w">strict</span><span class="sc">;</span>
  27 <span class="k">use</span> <span class="w">Carp</span><span class="sc">;</span>
  28 <span class="k">use</span> <span class="w">Exporter</span><span class="sc">;</span>
  29 <span class="k">use</span> <span class="w">Scalar::Util</span> <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  30 <span class="k">use</span> <span class="w">Text::ParseWords</span><span class="sc">;</span>
  31 <span class="k">use</span> <span class="w">AtomTypes::AtomTypes</span><span class="sc">;</span>
  32 <span class="k">use</span> <span class="w">Molecule</span><span class="sc">;</span>
  33 
  34 <span class="k">use</span> <span class="w">vars</span> <span class="q">qw(@ISA @EXPORT @EXPORT_OK %EXPORT_TAGS)</span><span class="sc">;</span>
  35 
  36 <span class="i">@ISA</span> = <span class="q">qw(AtomTypes::AtomTypes Exporter)</span><span class="sc">;</span>
  37 <span class="i">@EXPORT</span> = <span class="q">qw(GetMMFF94AtomTypesData GetAllPossibleMMFF94AtomTypes GetAllPossibleMMFF94NonHydrogenAtomTypes)</span><span class="sc">;</span>
  38 <span class="i">@EXPORT_OK</span> = <span class="q">qw()</span><span class="sc">;</span>
  39 
  40 <span class="i">%EXPORT_TAGS</span> = <span class="s">(</span><span class="w">all</span>  <span class="cm">=&gt;</span> <span class="s">[</span><span class="i">@EXPORT</span><span class="cm">,</span> <span class="i">@EXPORT_OK</span><span class="s">]</span><span class="s">)</span><span class="sc">;</span>
  41 
  42 <span class="c"># Setup class variables...</span>
  43 <span class="k">my</span><span class="s">(</span><span class="i">$ClassName</span><span class="cm">,</span> <span class="i">%MMFF94AtomTypesDataMap</span><span class="s">)</span><span class="sc">;</span>
  44 <span class="i">_InitializeClass</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  45 
  46 <span class="c"># Overload Perl functions...</span>
  47 <span class="k">use</span> <span class="w">overload</span> <span class="q">&#39;&quot;&quot;&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;StringifyMMFF94AtomTypes&#39;</span><span class="sc">;</span>
  48 
  49 <span class="c"># Class constructor...</span>
<a name="new-"></a>  50 <span class="k">sub </span><span class="m">new</span> <span class="s">{</span>
  51   <span class="k">my</span><span class="s">(</span><span class="i">$Class</span><span class="cm">,</span> <span class="i">%NamesAndValues</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  52 
  53   <span class="c"># Initialize object...</span>
  54   <span class="k">my</span> <span class="i">$This</span> = <span class="i">$Class</span><span class="i">-&gt;SUPER::new</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  55   <span class="k">bless</span> <span class="i">$This</span><span class="cm">,</span> <span class="k">ref</span><span class="s">(</span><span class="i">$Class</span><span class="s">)</span> || <span class="i">$Class</span><span class="sc">;</span>
  56   <span class="i">$This</span><span class="i">-&gt;_InitializeMMFF94AtomTypes</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  57 
  58   <span class="i">$This</span><span class="i">-&gt;_InitializeMMFF94AtomTypesProperties</span><span class="s">(</span><span class="i">%NamesAndValues</span><span class="s">)</span><span class="sc">;</span>
  59 
  60   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
  61 <span class="s">}</span>
  62 
  63 <span class="c"># Initialize class ...</span>
<a name="_InitializeClass-"></a>  64 <span class="k">sub </span><span class="m">_InitializeClass</span> <span class="s">{</span>
  65   <span class="c">#Class name...</span>
  66   <span class="i">$ClassName</span> = <span class="w">__PACKAGE__</span><span class="sc">;</span>
  67 
  68   <span class="c"># Initialize the data hash. It&#39;ll be loaded on demand later...</span>
  69   <span class="i">%MMFF94AtomTypesDataMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  70 <span class="s">}</span>
  71 
  72 
  73 <span class="c"># Initialize object data...</span>
  74 <span class="c">#</span>
<a name="_InitializeMMFF94AtomTypes-"></a>  75 <span class="k">sub </span><span class="m">_InitializeMMFF94AtomTypes</span> <span class="s">{</span>
  76   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  77 
  78   <span class="c"># Type of AtomTypes...</span>
  79   <span class="i">$This</span>-&gt;{<span class="w">Type</span>} = <span class="q">&#39;MMFF94&#39;</span><span class="sc">;</span>
  80 
  81   <span class="c"># By default, MMFF94 atom types are also assigned to hydrogens...</span>
  82   <span class="i">$This</span>-&gt;{<span class="w">IgnoreHydrogens</span>} = <span class="n">0</span><span class="sc">;</span>
  83 
  84   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
  85 <span class="s">}</span>
  86 
  87 <span class="c"># Initialize object properties...</span>
  88 <span class="c">#</span>
<a name="_InitializeMMFF94AtomTypesProperties-"></a>  89 <span class="k">sub </span><span class="m">_InitializeMMFF94AtomTypesProperties</span> <span class="s">{</span>
  90   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">%NamesAndValues</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  91 
  92   <span class="k">my</span><span class="s">(</span><span class="i">$Name</span><span class="cm">,</span> <span class="i">$Value</span><span class="cm">,</span> <span class="i">$MethodName</span><span class="s">)</span><span class="sc">;</span>
  93   <span class="k">while</span> <span class="s">(</span><span class="s">(</span><span class="i">$Name</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="k">each</span>  <span class="i">%NamesAndValues</span><span class="s">)</span> <span class="s">{</span>
  94     <span class="i">$MethodName</span> = <span class="q">&quot;Set${Name}&quot;</span><span class="sc">;</span>
  95     <span class="i">$This</span><span class="i">-&gt;$MethodName</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span><span class="sc">;</span>
  96   <span class="s">}</span>
  97 
  98   <span class="c"># Make sure molecule object was specified...</span>
  99   <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$NamesAndValues</span>{<span class="w">Molecule</span>}<span class="s">)</span> <span class="s">{</span>
 100     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;New: Object can&#39;t be instantiated without specifying molecule...&quot;</span><span class="sc">;</span>
 101   <span class="s">}</span>
 102 
 103   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 104 <span class="s">}</span>
 105 
 106 <span class="c"># Get MMFF94 atom types and associated data loaded from MMFF94 data file as</span>
 107 <span class="c"># a reference to hash with the following hash data format:</span>
 108 <span class="c">#</span>
 109 <span class="c"># @{$MMFF94AtomTypesDataMap{AtomTypes}} - Array of all possible atom types for all atoms</span>
 110 <span class="c"># @{$MMFF94AtomTypesDataMap{NonHydrogenAtomTypes}} - Array of all possible atom types for non-hydrogen atoms</span>
 111 <span class="c"># @{$MMFF94AtomTypesDataMap-&gt;{ColLabels}} - Array of column labels</span>
 112 <span class="c"># %{$MMFF94AtomTypesDataMap-&gt;{DataCol&lt;Num&gt;}} - Hash keys pair: &lt;DataCol&lt;Num&gt;, AtomType&gt;</span>
 113 <span class="c">#</span>
 114 <span class="c"># This functionality can be either invoked as a class function or an</span>
 115 <span class="c"># object method.</span>
 116 <span class="c">#</span>
<a name="GetMMFF94AtomTypesData-"></a> 117 <span class="k">sub </span><span class="m">GetMMFF94AtomTypesData</span> <span class="s">{</span>
 118 
 119   <span class="c"># Make sure data is loaded...</span>
 120   <span class="i">_CheckAndLoadMMFF94AtomTypesData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 121 
 122   <span class="k">return</span> \<span class="i">%MMFF94AtomTypesDataMap</span><span class="sc">;</span>
 123 <span class="s">}</span>
 124 
 125 <span class="c"># Get all possible MMFF94 atom types corresponding to hydrogen and non-hydrogen</span>
 126 <span class="c"># atoms as an array reference...</span>
 127 <span class="c">#</span>
 128 <span class="c"># This functionality can be either invoked as a class function or an</span>
 129 <span class="c"># object method.</span>
 130 <span class="c">#</span>
<a name="GetAllPossibleMMFF94AtomTypes-"></a> 131 <span class="k">sub </span><span class="m">GetAllPossibleMMFF94AtomTypes</span> <span class="s">{</span>
 132   <span class="k">return</span> <span class="i">_GetAllPossibleMMFF94AtomTypes</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 133 <span class="s">}</span>
 134 
 135 <span class="c"># Get all possible MMFF94 atom types corresponding to non-hydrogen atoms</span>
 136 <span class="c"># as an array reference...</span>
 137 <span class="c">#</span>
 138 <span class="c"># This functionality can be either invoked as a class function or an</span>
 139 <span class="c"># object method.</span>
 140 <span class="c">#</span>
<a name="GetAllPossibleMMFF94NonHydrogenAtomTypes-"></a> 141 <span class="k">sub </span><span class="m">GetAllPossibleMMFF94NonHydrogenAtomTypes</span> <span class="s">{</span>
 142   <span class="k">my</span><span class="s">(</span><span class="i">$NonHydrogensOnly</span><span class="s">)</span><span class="sc">;</span>
 143 
 144   <span class="i">$NonHydrogensOnly</span> = <span class="n">1</span><span class="sc">;</span>
 145   <span class="k">return</span> <span class="i">_GetAllPossibleMMFF94AtomTypes</span><span class="s">(</span><span class="i">$NonHydrogensOnly</span><span class="s">)</span><span class="sc">;</span>
 146 <span class="s">}</span>
 147 
 148 <span class="c"># Get all possible MMFF94 atom types as an array reference...</span>
 149 <span class="c">#</span>
<a name="_GetAllPossibleMMFF94AtomTypes-"></a> 150 <span class="k">sub </span><span class="m">_GetAllPossibleMMFF94AtomTypes</span> <span class="s">{</span>
 151   <span class="k">my</span><span class="s">(</span><span class="i">$NonHydrogensOnly</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 152   <span class="k">my</span><span class="s">(</span><span class="i">$MMFF94AtomTypesDataRef</span><span class="s">)</span><span class="sc">;</span>
 153 
 154   <span class="i">$NonHydrogensOnly</span> = <span class="k">defined</span> <span class="i">$NonHydrogensOnly</span> ? <span class="i">$NonHydrogensOnly</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 155 
 156   <span class="i">$MMFF94AtomTypesDataRef</span> = <span class="i">GetMMFF94AtomTypesData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 157 
 158   <span class="k">return</span> <span class="i">$NonHydrogensOnly</span> ? \<span class="i">@</span>{<span class="i">$MMFF94AtomTypesDataRef</span>-&gt;{<span class="w">NonHydrogenAtomTypes</span>}}<span class="co">:</span> \<span class="i">@</span>{<span class="i">$MMFF94AtomTypesDataRef</span>-&gt;{<span class="w">AtomTypes</span>}}<span class="sc">;</span>
 159 <span class="s">}</span>
 160 
 161 <span class="c"># Assign MMFF94 [ Ref 83-87 ] atom types to all atoms...</span>
 162 <span class="c">#</span>
 163 <span class="c"># Notes:</span>
 164 <span class="c">#     o 212 MMFF94 atom type symbols are listed</span>
 165 <span class="c">#     o 95 MMFF94 atom type numbers are listed</span>
 166 <span class="c">#     o Atom type numbers from 83 to 86 are not used</span>
 167 <span class="c">#     o Number of atom type symbols for:</span>
 168 <span class="c">#         o C: 34</span>
 169 <span class="c">#         o N: 47</span>
 170 <span class="c">#         o O: 45</span>
 171 <span class="c">#         o P: 7</span>
 172 <span class="c">#         o S: 18</span>
 173 <span class="c">#         o F, Br: 2</span>
 174 <span class="c">#         o Cl: 3</span>
 175 <span class="c">#         o I: 1</span>
 176 <span class="c">#         o H: 41</span>
 177 <span class="c">#         o Fe,Cu, Zn: 2</span>
 178 <span class="c">#         o Li, Na, L, K, Mg, Si, : 1</span>
 179 <span class="c">#</span>
<a name="AssignAtomTypes-"></a> 180 <span class="k">sub </span><span class="m">AssignAtomTypes</span> <span class="s">{</span>
 181   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 182 
 183   <span class="i">$This</span><span class="i">-&gt;_AssignAtomTypesToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 184 
 185   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span>-&gt;{<span class="w">IgnoreHydrogens</span>}<span class="s">)</span> <span class="s">{</span>
 186     <span class="i">$This</span><span class="i">-&gt;_AssignAtomTypesToHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 187   <span class="s">}</span>
 188 
 189   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 190 <span class="s">}</span>
 191 
 192 <span class="c"># Assign atom types to all non-Hydrogen atoms..</span>
 193 <span class="c">#</span>
<a name="_AssignAtomTypesToNonHydrogenAtoms-"></a> 194 <span class="k">sub </span><span class="m">_AssignAtomTypesToNonHydrogenAtoms</span> <span class="s">{</span>
 195   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 196   <span class="k">my</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 197 
 198   <span class="j">ATOM:</span> <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetMolecule</span><span class="s">(</span><span class="s">)</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 199     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsHydrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 200       <span class="k">next</span> <span class="j">ATOM</span><span class="sc">;</span>
 201     <span class="s">}</span>
 202     <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomType</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 203     <span class="i">$This</span><span class="i">-&gt;SetAtomType</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 204   <span class="s">}</span>
 205   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 206 <span class="s">}</span>
 207 
 208 <span class="c"># Assign atom types to Hydrogen atoms..</span>
 209 <span class="c">#</span>
<a name="_AssignAtomTypesToHydrogenAtoms-"></a> 210 <span class="k">sub </span><span class="m">_AssignAtomTypesToHydrogenAtoms</span> <span class="s">{</span>
 211   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 212   <span class="k">my</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 213 
 214   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">IgnoreHydrogens</span>}<span class="s">)</span> <span class="s">{</span>
 215     <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 216   <span class="s">}</span>
 217 
 218   <span class="j">ATOM:</span> <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetMolecule</span><span class="s">(</span><span class="s">)</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 219     <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;IsHydrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 220       <span class="k">next</span> <span class="j">ATOM</span><span class="sc">;</span>
 221     <span class="s">}</span>
 222     <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForHydrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 223     <span class="i">$This</span><span class="i">-&gt;SetAtomType</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 224   <span class="s">}</span>
 225   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 226 <span class="s">}</span>
 227 
 228 <span class="c"># Get MMFF94 atom type for atom...</span>
 229 <span class="c">#</span>
<a name="_GetAtomType-"></a> 230 <span class="k">sub </span><span class="m">_GetAtomType</span> <span class="s">{</span>
 231   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 232   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 233 
 234   <span class="i">$AtomType</span> = <span class="q">&#39;&#39;</span><span class="sc">;</span>
 235 
 236   <span class="j">ATOM:</span> <span class="s">{</span>
 237     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsCarbon</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 238       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 239       <span class="k">last</span> <span class="j">ATOM</span><span class="sc">;</span>
 240     <span class="s">}</span>
 241     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsNitrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 242       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 243       <span class="k">last</span> <span class="j">ATOM</span><span class="sc">;</span>
 244     <span class="s">}</span>
 245     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsOxygen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 246       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 247       <span class="k">last</span> <span class="j">ATOM</span><span class="sc">;</span>
 248     <span class="s">}</span>
 249     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsPhosphorus</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 250       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForPhosphorus</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 251       <span class="k">last</span> <span class="j">ATOM</span><span class="sc">;</span>
 252     <span class="s">}</span>
 253     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsSulfur</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 254       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 255       <span class="k">last</span> <span class="j">ATOM</span><span class="sc">;</span>
 256     <span class="s">}</span>
 257     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsHydrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 258       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForHydrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 259       <span class="k">last</span> <span class="j">ATOM</span><span class="sc">;</span>
 260     <span class="s">}</span>
 261     <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForOtherAtoms</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 262   <span class="s">}</span>
 263 
 264   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 265 <span class="s">}</span>
 266 
 267 <span class="c"># Get MMFF94 atom type for Carbon atom...</span>
 268 <span class="c">#</span>
 269 <span class="c"># 34 AtomTypeSymbols for element C:</span>
 270 <span class="c">#</span>
 271 <span class="c"># AtomTypeSymbol   AtomTypeNum   AtomTypeDefinition</span>
 272 <span class="c">#   CR       1     ALKYL CARBON, SP3</span>
 273 <span class="c">#   C=C      2     VINYLIC CARBON, SP2</span>
 274 <span class="c">#   CSP2     2     GENERIC SP2 CARBON</span>
 275 <span class="c">#   C=O      3     GENERAL CARBONYL CARBON</span>
 276 <span class="c">#   C=N      3     SP2 CARBON IN C=N</span>
 277 <span class="c">#   CGD      3     GUANIDINE CARBON, DOUBLY BONDED TO N</span>
 278 <span class="c">#   C=OR     3     KETONE OR ALDEHYDE CARBONYL CARBON</span>
 279 <span class="c">#   C=ON     3     AMIDE CARBONYL CARBON</span>
 280 <span class="c">#   CONN     3     UREA CARBONYL CARBON</span>
 281 <span class="c">#   COO      3     CARBOXYLIC ACID OR ESTER CARBONYL CARBON</span>
 282 <span class="c">#   COON     3     CARBAMATE CARBONYL CARBON</span>
 283 <span class="c">#   COOO     3     CARBONIC ACID OR ESTER CARBONYL CARBON</span>
 284 <span class="c">#   C=OS     3     THIOESTER CARBONYL CARBON, DOUBLE BONDED TO O</span>
 285 <span class="c">#   C=S      3     THIOESTER CARBON, DOUBLY BONDED TO S</span>
 286 <span class="c">#   C=SN     3     THIOAMIDE, CARBON, DOUBLY BONDED TO S</span>
 287 <span class="c">#   CSO2     3     CARBON IN &gt;C=SO2</span>
 288 <span class="c">#   CS=O     3     CARBON IN &gt;C=S=O (SULFINYL GROUP)</span>
 289 <span class="c">#   CSS      3     THIOCARBOXYLIC ACID OR ESTER CARBONYL CARBON</span>
 290 <span class="c">#   C=P      3     CARBON DOUBLE BONDED TO PHOSPHOROUS</span>
 291 <span class="c">#   CSP      4     ACETYLENIC CARBON</span>
 292 <span class="c">#   =C=      4     ALLENIC CARBON</span>
 293 <span class="c">#   CR4R     20    CARBON IN 4-MEMBERED RINGS</span>
 294 <span class="c">#   CR3R     22    CARBON IN A 3-MEMBERED RING</span>
 295 <span class="c">#   CE4R     30    OLEFINIC CARBON IN 4-MEMBERED RINGS</span>
 296 <span class="c">#   CB       37    CARBON AS IN BENZENE, PYRROLE</span>
 297 <span class="c">#   CO2M     41    CARBOXYLATE ANION CARBON</span>
 298 <span class="c">#   CS2M     41    CARBON IN THIOCARBOXYLATE ANION</span>
 299 <span class="c">#   CGD+     57    GUANIDINIUM CARBON</span>
 300 <span class="c">#   CNN+     57    C IN +N=C-N RESONANCE STRUCTURES</span>
 301 <span class="c">#   C%       60    ISONITRILE CARBON</span>
 302 <span class="c">#   C5A      63    ALPHA CARBON IN 5-MEMBERED HETEROAROMATIC RING</span>
 303 <span class="c">#   C5B      64    BETA CARBON IN 5-MEMBERED HETEROAROMATIC RING</span>
 304 <span class="c">#   C5       78    GENERAL CARBON IN 5-MEMBERED HETEROAROMATIC RING</span>
 305 <span class="c">#   CIM+     80    C IN N-C-N IN IMIDAZOLIUM ION</span>
 306 <span class="c">#</span>
 307 <span class="c"># Notes:</span>
 308 <span class="c">#     . During atom type assignments, matches are performed starting from specific to generic.</span>
 309 <span class="c">#</span>
<a name="_GetAtomTypeForCarbon-"></a> 310 <span class="k">sub </span><span class="m">_GetAtomTypeForCarbon</span> <span class="s">{</span>
 311   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 312   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="cm">,</span> <span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="s">)</span><span class="sc">;</span>
 313 
 314   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 315 
 316   <span class="s">(</span><span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="s">)</span> = <span class="s">(</span><span class="q">&#39;0&#39;</span><span class="s">)</span> x <span class="n">2</span><span class="sc">;</span>
 317 
 318   <span class="s">(</span><span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="s">)</span> = <span class="i">$Atom</span><span class="i">-&gt;GetNumOfSigmaAndPiBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 319   <span class="i">$NumOfSigmaBonds</span> += <span class="i">$Atom</span><span class="i">-&gt;GetAtomicInvariantValue</span><span class="s">(</span><span class="q">&#39;H&#39;</span><span class="s">)</span><span class="sc">;</span>
 320 
 321   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
 322 
 323     <span class="c"># Only single bonds...</span>
 324     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfPiBonds</span> == <span class="n">0</span><span class="s">)</span> <span class="s">{</span>
 325       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForCarbonWithOnlySigmaBonds</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 326       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 327     <span class="s">}</span>
 328 
 329     <span class="c"># One double bond...</span>
 330     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfPiBonds</span> == <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
 331       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForCarbonWithOnePiBond</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 332       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 333     <span class="s">}</span>
 334 
 335     <span class="c"># One triple bond or two double bonds...</span>
 336     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfPiBonds</span> == <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
 337       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForCarbonWithTwoPiBonds</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 338       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 339     <span class="s">}</span>
 340 
 341     <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 342     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomTypeForCarbon: MMFF94 atom type for Carbon cann&#39;t be assigned...&quot;</span><span class="sc">;</span>
 343   <span class="s">}</span>
 344   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 345 <span class="s">}</span>
 346 
 347 <span class="c"># Get MMFF94 atom type for Nitrogen atom...</span>
 348 <span class="c">#</span>
 349 <span class="c"># 47 AtomTypeSymbols for element N:</span>
 350 <span class="c">#</span>
 351 <span class="c"># AtomTypeSymbol   AtomTypeNum   AtomTypeDefinition</span>
 352 <span class="c">#   NR       8     NITROGEN IN ALIPHATIC AMINES</span>
 353 <span class="c">#   N=C      9     NITROGEN IN IMINES</span>
 354 <span class="c">#   N=N      9     NITROGEN IN AZO COMPOUNDS</span>
 355 <span class="c">#   NC=O     10    NITROGEN IN AMIDES</span>
 356 <span class="c">#   NC=S     10    NITROGEN IN N-C=S, THIOAMIDE</span>
 357 <span class="c">#   NN=C     10    NITROGEN IN N-N=C</span>
 358 <span class="c">#   NN=N     10    NITROGEN IN N-N=N</span>
 359 <span class="c">#   NR+      34    QUATERNARY NITROGEN, SP3, POSITIVELY CHARGED</span>
 360 <span class="c">#   NPYD     38    NITROGEN, AS IN PYRIDINE</span>
 361 <span class="c">#   NPYL     39    NITROGEN, AS IN PYRROLE</span>
 362 <span class="c">#   NC=C     40    NITROGEN ON N-C=C</span>
 363 <span class="c">#   NC=N     40    NITROGEN IN N-C=N</span>
 364 <span class="c">#   NC=P     40    NITROGEN IN N-C=P</span>
 365 <span class="c">#   NC%C     40    NITROGEN ATTACHED TO C-C TRIPLE BOND</span>
 366 <span class="c">#   NSP      42    NITROGEN, TRIPLE BONDED</span>
 367 <span class="c">#   NSO2     43    NITROGEN IN SULFONAMIDES</span>
 368 <span class="c">#   NSO3     43    NITROGEN IN SULFONAMIDES, THREE Os ON S</span>
 369 <span class="c">#   NPO2     43    NITROGEN IN PHOSPHONAMIDES</span>
 370 <span class="c">#   NPO3     43    NITROGEN IN PHOSPHONAMIDES, THREE Os ON P</span>
 371 <span class="c">#   NC%N     43    NITROGEN ATTACHED TO CYANO GROUP</span>
 372 <span class="c">#   NO2      45    NITRO GROUP NITROGEN</span>
 373 <span class="c">#   NO3      45    NITRATE GROUP NITROGEN</span>
 374 <span class="c">#   N=O      46    NITROSO NITROGEN</span>
 375 <span class="c">#   NAZT     47    TERMINAL NITROGEN IN AZIDO OR DIAZO GROUP</span>
 376 <span class="c">#   NSO      48    DIVALENT NITROGEN REPLACING MONOVALENT O IN SO2 GROUP</span>
 377 <span class="c">#   =N=      53    NITROGEN IN C=N=N OR -N=N=N</span>
 378 <span class="c">#   N+=C     54    POSITIVELY CHARGED IMINIUM NITROGEN</span>
 379 <span class="c">#   N+=N     54    POSITIVELY CHARGED NITROGEN DOUBLE-BONDED TO N</span>
 380 <span class="c">#   NCN+     55    N IN +N=C-N RESONANCE STRUCTURES - FORMAL CHARGE=1/2</span>
 381 <span class="c">#   NGD+     56    GUANIDINIUM-TYPE NITROGEN - FORMAL CHARGE=1/3</span>
 382 <span class="c">#   NPD+     58    PYRIDINIUM-TYPE NITROGEN - FORMAL CHARGE=1</span>
 383 <span class="c">#   NR%      61    ISONITRILE NITROGEN [FC = 0] OR DIAZO NITROGEN [FC = 1]</span>
 384 <span class="c">#   NM       62    DEPROTONATED SULFONAMIDE N-; FORMAL CHARGE=-1</span>
 385 <span class="c">#   N5A      65    ALPHA AROM HETEROCYCLIC 5-RING  NITROGEN</span>
 386 <span class="c">#   N5B      66    BETA AROM HETEROCYCLIC 5-RING  NITROGEN</span>
 387 <span class="c">#   N2OX     67    SP2-HYDRIDIZED N-OXIDE NITROGEN</span>
 388 <span class="c">#   N3OX     68    SP3-HYDRIDIZED N-OXIDE NITROGEN</span>
 389 <span class="c">#   NPOX     69    PYRIDINE N-OXIDE NITROGEN</span>
 390 <span class="c">#   N5M      76    NEGATIVELY CHARGED N IN, E.G, TRI- OR TETRAZOLE ANION</span>
 391 <span class="c">#   N5       79    GENERAL NITROGEN IN 5-MEMBERED HETEROCYCLIC RING</span>
 392 <span class="c">#   NIM+     81    IMIDAZOLIUM-TYPE NITROGEN - FORMAL CHARGE=1/2</span>
 393 <span class="c">#   N5A+     81    POSITIVE N5A NITROGEN - FORMAL CHARGE=1</span>
 394 <span class="c">#   N5B+     81    POSITIVE N5B NITROGEN - FORMAL CHARGE=1</span>
 395 <span class="c">#   N5+      81    POSITIVE N5 NITROGEN - FORMAL CHARGE=1</span>
 396 <span class="c">#   N5AX     82    N-OXIDE NITROGEN IN 5-RING ALPHA POSITION</span>
 397 <span class="c">#   N5BX     82    N-OXIDE NITROGEN IN 5-RING BETA POSITION</span>
 398 <span class="c">#   N5OX     82    N-OXIDE NITROGEN IN GENERAL 5-RING POSITION</span>
 399 <span class="c">#</span>
 400 <span class="c"># Notes:</span>
 401 <span class="c">#   . The current release of MayaChemTools assigns &quot;None&quot; to Oxygens in the following environment</span>
 402 <span class="c">#     as no generic or specific MMFF94 atom types exists to handle them:</span>
 403 <span class="c">#</span>
 404 <span class="c">#      . Terminal Nitrogens attched to Sulfur in &gt;S=N</span>
 405 <span class="c">#</span>
<a name="_GetAtomTypeForNitrogen-"></a> 406 <span class="k">sub </span><span class="m">_GetAtomTypeForNitrogen</span> <span class="s">{</span>
 407   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 408   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="cm">,</span> <span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="s">)</span><span class="sc">;</span>
 409 
 410   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 411 
 412   <span class="s">(</span><span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="s">)</span> = <span class="s">(</span><span class="q">&#39;0&#39;</span><span class="s">)</span> x <span class="n">2</span><span class="sc">;</span>
 413 
 414   <span class="s">(</span><span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="s">)</span> = <span class="i">$Atom</span><span class="i">-&gt;GetNumOfSigmaAndPiBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 415   <span class="i">$NumOfSigmaBonds</span> += <span class="i">$Atom</span><span class="i">-&gt;GetAtomicInvariantValue</span><span class="s">(</span><span class="q">&#39;H&#39;</span><span class="s">)</span><span class="sc">;</span>
 416 
 417   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
 418 
 419     <span class="c"># Nitrogens in five membered rings...</span>
 420     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsInRingOfSize</span><span class="s">(</span><span class="n">5</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 421       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForFiveMemberedRingNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 422       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 423     <span class="s">}</span>
 424 
 425     <span class="c"># -N(-)-, -N+(-)(-)-, -(N-1)(-)</span>
 426     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfPiBonds</span> == <span class="n">0</span><span class="s">)</span> <span class="s">{</span>
 427       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForNitrogenWithOnlySigmaBonds</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 428       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 429     <span class="s">}</span>
 430 
 431     <span class="c"># -N=, and -N+(=)-</span>
 432     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfPiBonds</span> == <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
 433       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForNitrogenWithOnePiBond</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 434       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 435     <span class="s">}</span>
 436 
 437     <span class="c"># #N, #N+-, and =N+=</span>
 438     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfPiBonds</span> == <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
 439       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForNitrogenWithTwoPiBonds</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 440       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 441     <span class="s">}</span>
 442 
 443     <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 444     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomTypeForNitrogen: MMFF94 atom type for Nitrogen cann&#39;t be assigned...&quot;</span><span class="sc">;</span>
 445   <span class="s">}</span>
 446   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 447 <span class="s">}</span>
 448 
 449 <span class="c"># Get MMFF94 atom type for Oxygen atom...</span>
 450 <span class="c">#</span>
 451 <span class="c"># 45 AtomTypeSymbols for element O:</span>
 452 <span class="c">#</span>
 453 <span class="c"># AtomTypeSymbol   AtomTypeNum   AtomTypeDefinition</span>
 454 <span class="c">#   OR       6     ALCOHOL OR ETHER OXYGEN</span>
 455 <span class="c">#   OC=O     6     ESTER OR CARBOXYLIC ACID -O-</span>
 456 <span class="c">#   OC=C     6     ENOLIC OR PHENOLIC OXYGEN</span>
 457 <span class="c">#   OC=N     6     DIVALENT OXYGEN</span>
 458 <span class="c">#   OC=S     6     THIOESTER OR THIOACID -O-</span>
 459 <span class="c">#   ONO2     6     DIVALENT NITRATE ETHER OXYGEN</span>
 460 <span class="c">#   ON=O     6     DIVALENT NITRITE ETHER OXYGEN</span>
 461 <span class="c">#   OSO3     6     DIVALENT OXYGEN ATTACHED TO SULFUR</span>
 462 <span class="c">#   OSO2     6     DIVALENT OXYGEN ATTACHED TO SULFUR</span>
 463 <span class="c">#   OSO      6     DIVALENT OXYGEN ATTACHED TO SULFUR</span>
 464 <span class="c">#   OS=O     6     DIVALENT OXYGEN ATTACHED TO SULFOXIDE SULFUR</span>
 465 <span class="c">#   -OS      6     GENERAL DIVALENT OXYGEN ATTACHED TO S</span>
 466 <span class="c">#   OPO3     6     DIVALENT OXYGEN ATTACHED TO PHOSPHOROUS</span>
 467 <span class="c">#   OPO2     6     DIVALENT OXYGEN ATTACHED TO PHOSPHOROUS</span>
 468 <span class="c">#   OPO      6     DIVALENT OXYGEN ATTACHED TO PHOSPHOROUS</span>
 469 <span class="c">#   -OP      6     DIVALENT OXYGEN ATTACHED TO PHOSPHOROUS</span>
 470 <span class="c">#   -O-      6     GENERAL DIVALENT O</span>
 471 <span class="c">#   O=C      7     GENERAL C=O</span>
 472 <span class="c">#   O=CN     7     CARBONYL OXYGEN, AMIDES</span>
 473 <span class="c">#   O=CR     7     CARBONYL OXYGEN, ALDEHYDES AND KETONES</span>
 474 <span class="c">#   O=CO     7     CARBONYL OXYGEN, CARBOXYLIC ACIDS AND ESTERS</span>
 475 <span class="c">#   O=N      7     NITROSO OXYGEN</span>
 476 <span class="c">#   O=S      7     O=S IN SULFOXIDES</span>
 477 <span class="c">#   O=S=     7     O=S ON SULFUR DOUBLY BONDED TO, E.G., CARBON</span>
 478 <span class="c">#   O2CM     32    OXYGEN IN CARBOXYLATE ANION</span>
 479 <span class="c">#   OXN      32    N-OXIDE OXYGEN</span>
 480 <span class="c">#   O2N      32    NITRO OXYGEN</span>
 481 <span class="c">#   O2NO     32    NITRO-GROUP OXYGEN IN NITRATE</span>
 482 <span class="c">#   O3N      32    NITRATE ANION OXYGEN</span>
 483 <span class="c">#   O-S      32    SINGLE TERMINAL OXYGEN ON TETRACOORD SULFUR</span>
 484 <span class="c">#   O2S      32    TERMINAL O-S IN SULFONES AND SULFONAMIDES</span>
 485 <span class="c">#   O3S      32    TERMINAL O IN SULFONATES</span>
 486 <span class="c">#   O4S      32    TERMINAL O IN SO4(-3)</span>
 487 <span class="c">#   OSMS     32    TERM O IN THIOSULFINATE ANION - FORMAL CHARGE=-0.5</span>
 488 <span class="c">#   OP       32    TERMINAL O IN PHOSPHOXIDES</span>
 489 <span class="c">#   O2P      32    TERMINAL O IN PHOSPHINATES</span>
 490 <span class="c">#   O3P      32    TERMINAL OXYGEN IN PHOSPHONATES</span>
 491 <span class="c">#   O4P      32    TERMINAL OXYGEN IN PHOSPHATES AND PHOSPHODIESTERS</span>
 492 <span class="c">#   O4CL     32    OXYGEN IN CLO4(-) ANION - FORMAL CHARGE=-0.25</span>
 493 <span class="c">#   OM       35    ALKOXIDE OXYGEN, NEGATIVELY CHARGED</span>
 494 <span class="c">#   OM2      35    OXIDE OXYGEN ON SP2 CARBON, NEGATIVELY CHARGED</span>
 495 <span class="c">#   O+       49    POSITIVELY CHARGED OXONIUM (TRICOORDINATE) OXYGEN</span>
 496 <span class="c">#   O=+      51    POSITIVELY CHARGED OXENIUM (DICOORDINATE) OXYGEN</span>
 497 <span class="c">#   OFUR     59    AROMATIC OXYGEN AS IN FURAN</span>
 498 <span class="c">#   OH2      70    OXYGEN ON WATER</span>
 499 <span class="c">#</span>
 500 <span class="c"># Notes:</span>
 501 <span class="c">#   . The current release of MayaChemTools assigns &quot;None&quot; to Oxygens in the following environment</span>
 502 <span class="c">#     as no generic or specific MMFF94 atom types exists to handle them:</span>
 503 <span class="c">#</span>
 504 <span class="c">#      . Terminal anion Oxygen corresponding to divalent Oxygen attached to Sulfoxide Sulfur in</span>
 505 <span class="c">#        OS=O and divalent Oxygen attached to Sulfur in -OS</span>
 506 <span class="c">#      . Terminal Oxygens attched to Sulfur in =SO2</span>
 507 <span class="c">#      . Terminal anion Oxygen attched to Sulfur in SO2M which is same as OS=O</span>
 508 <span class="c">#</span>
<a name="_GetAtomTypeForOxygen-"></a> 509 <span class="k">sub </span><span class="m">_GetAtomTypeForOxygen</span> <span class="s">{</span>
 510   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 511   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="cm">,</span> <span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="cm">,</span> <span class="i">$OxygenAttachedToSulfur</span><span class="cm">,</span> <span class="i">$OxygenAttachedToPhosphorus</span><span class="s">)</span><span class="sc">;</span>
 512 
 513   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 514 
 515   <span class="s">(</span><span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="s">)</span> = <span class="s">(</span><span class="q">&#39;0&#39;</span><span class="s">)</span> x <span class="n">2</span><span class="sc">;</span>
 516 
 517   <span class="s">(</span><span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="s">)</span> = <span class="i">$Atom</span><span class="i">-&gt;GetNumOfSigmaAndPiBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 518   <span class="i">$NumOfSigmaBonds</span> += <span class="i">$Atom</span><span class="i">-&gt;GetAtomicInvariantValue</span><span class="s">(</span><span class="q">&#39;H&#39;</span><span class="s">)</span><span class="sc">;</span>
 519 
 520   <span class="i">$OxygenAttachedToSulfur</span> = <span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S&#39;</span><span class="s">)</span><span class="sc">;</span>
 521   <span class="i">$OxygenAttachedToPhosphorus</span> = <span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;P&#39;</span><span class="s">)</span><span class="sc">;</span>
 522 
 523   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
 524 
 525    <span class="c"># Divalent or terminal Oxygen attached to Sulfur...</span>
 526     <span class="k">if</span> <span class="s">(</span><span class="i">$OxygenAttachedToSulfur</span><span class="s">)</span> <span class="s">{</span>
 527       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForOxygenAttachedToSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 528       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 529     <span class="s">}</span>
 530 
 531    <span class="c"># Divalent or terminal Oxygen attached to Phosphorous...</span>
 532     <span class="k">if</span> <span class="s">(</span><span class="i">$OxygenAttachedToPhosphorus</span><span class="s">)</span> <span class="s">{</span>
 533       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForOxygenAttachedToPhosphorus</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 534       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 535     <span class="s">}</span>
 536 
 537     <span class="c"># Only single bonds...</span>
 538     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfPiBonds</span> == <span class="n">0</span><span class="s">)</span> <span class="s">{</span>
 539       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForOxygenWithOnlySigmaBonds</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 540       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 541     <span class="s">}</span>
 542 
 543     <span class="c"># One double bond...</span>
 544     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfPiBonds</span> == <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
 545       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForOxygenWithOnePiBond</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 546       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 547     <span class="s">}</span>
 548 
 549     <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 550     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomTypeForOxygen: MMFF94 atom type for Oxygen cann&#39;t be assigned...&quot;</span><span class="sc">;</span>
 551   <span class="s">}</span>
 552   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 553 <span class="s">}</span>
 554 
 555 <span class="c"># Get MMFF94 atom type for Phosphorus atom...</span>
 556 <span class="c">#</span>
 557 <span class="c"># 7 AtomTypeSymbols for element P:</span>
 558 <span class="c">#</span>
 559 <span class="c"># AtomTypeSymbol   AtomTypeNum   AtomTypeDefinition</span>
 560 <span class="c">#   PO4      25    PHOSPHOROUS IN PHOSPHATES AND PHOSPHODIESTERS</span>
 561 <span class="c">#   PO3      25    TETRACOORDINATE P WITH THREE ATTACHED OXYGENS</span>
 562 <span class="c">#   PO2      25    TETRACOORDINATE P WITH TWO ATTACHED OXYGENS</span>
 563 <span class="c">#   PO       25    TETRACOORDINATE P WITH ONE ATTACHED OXYGEN</span>
 564 <span class="c">#   PTET     25    GENERAL TETRACOORDINATE PHOSPHORUS</span>
 565 <span class="c">#   P        26    TRICOORDINATE P, AS IN PHOSPHINES</span>
 566 <span class="c">#   -P=C     75    PHOSPHOROUS DOUBLY BONDED TO CARBON</span>
 567 <span class="c">#</span>
<a name="_GetAtomTypeForPhosphorus-"></a> 568 <span class="k">sub </span><span class="m">_GetAtomTypeForPhosphorus</span> <span class="s">{</span>
 569   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 570   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 571 
 572   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 573 
 574   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
 575 
 576     <span class="c"># PO4 : PHOSPHOROUS IN PHOSPHATES AND PHOSPHODIESTERS</span>
 577     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPhosphateOrPhosphodiesterPhosphorus</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 578       <span class="i">$AtomType</span> = <span class="q">&#39;PO4&#39;</span><span class="sc">;</span>
 579       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 580     <span class="s">}</span>
 581 
 582     <span class="c"># PO3 : TETRACOORDINATE P WITH THREE ATTACHED OXYGENS</span>
 583     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPhosphonatePhosphorus</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 584       <span class="i">$AtomType</span> = <span class="q">&#39;PO3&#39;</span><span class="sc">;</span>
 585       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 586     <span class="s">}</span>
 587 
 588     <span class="c"># PO2 : TETRACOORDINATE P WITH TWO ATTACHED OXYGENS</span>
 589     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPhosphinatePhosphorus</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 590       <span class="i">$AtomType</span> = <span class="q">&#39;PO2&#39;</span><span class="sc">;</span>
 591       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 592     <span class="s">}</span>
 593 
 594     <span class="c"># PO : TETRACOORDINATE P WITH ONE ATTACHED OXYGEN</span>
 595     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPhosphoxidePhosphorus</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 596       <span class="i">$AtomType</span> = <span class="q">&#39;PO&#39;</span><span class="sc">;</span>
 597       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 598     <span class="s">}</span>
 599 
 600     <span class="c"># -P=C : PHOSPHOROUS DOUBLY BONDED TO CARBON</span>
 601     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsDoublyBondedToCarbonPhosphorous</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 602       <span class="i">$AtomType</span> = <span class="q">&#39;-P=C&#39;</span><span class="sc">;</span>
 603       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 604     <span class="s">}</span>
 605 
 606     <span class="c"># PTET : GENERAL TETRACOORDINATE PHOSPHORUS</span>
 607     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsTetraCoordinatedPhosphorus</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 608       <span class="i">$AtomType</span> = <span class="q">&#39;PTET&#39;</span><span class="sc">;</span>
 609       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 610     <span class="s">}</span>
 611 
 612     <span class="c"># P : TRICOORDINATE P, AS IN PHOSPHINES</span>
 613     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsTriCoordinatedPhosphorus</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 614       <span class="i">$AtomType</span> = <span class="q">&#39;P&#39;</span><span class="sc">;</span>
 615       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 616     <span class="s">}</span>
 617 
 618     <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 619     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomTypeForPhosphorus: MMFF94 atom type for Phosphorous cann&#39;t be assigned...&quot;</span><span class="sc">;</span>
 620   <span class="s">}</span>
 621 
 622   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 623 <span class="s">}</span>
 624 
 625 <span class="c"># Get MMFF94 atom type for Sulfur atom...</span>
 626 <span class="c">#</span>
 627 <span class="c"># 18 AtomTypeSymbols for element S:</span>
 628 <span class="c">#</span>
 629 <span class="c"># AtomTypeSymbol   AtomTypeNum   AtomTypeDefinition</span>
 630 <span class="c">#   S        15    SULFUR IN THIOETHERS AND MERCAPTANS</span>
 631 <span class="c">#   S=C      16    TERMINAL SULFUR DOUBLY BONDED TO CARBON</span>
 632 <span class="c">#   S=O      17    SULFUR IN SULFOXIDES</span>
 633 <span class="c">#   &gt;S=N     17    SULFUR, TRICOORD, DOUBLY BONDED TO N</span>
 634 <span class="c">#   SO2      18    SULFUR IN SULFONES</span>
 635 <span class="c">#   SO2N     18    SULFUR IN SULFONAMIDES</span>
 636 <span class="c">#   SO3      18    SULFONATE SULFUR</span>
 637 <span class="c">#   SO4      18    SULFATE SULFUR</span>
 638 <span class="c">#   =SO2     18    SULFONE SULPHER DOUBLY BONDED TO CARBON</span>
 639 <span class="c">#   SNO      18    SULFUR IN NITROGEN ANALOG OF A SULFONE</span>
 640 <span class="c">#   STHI     44    SULFUR AS IN THIOPHENE</span>
 641 <span class="c">#   S-P      72    TERMINAL SULFUR BONDED TO PHOSPHORUS</span>
 642 <span class="c">#   S2CM     72    TERMINAL SULFUR IN THIOCARBOXYLATE ANION</span>
 643 <span class="c">#   SM       72    TERMINAL SULFUR - FORMAL CHARGE=-1</span>
 644 <span class="c">#   SSMO     72    TERMINAL SULFUR IN THIOSULFINATE GROUP</span>
 645 <span class="c">#   SO2M     73    SULFUR IN NEGATIVELY CHARGED SULFINATE GROUP</span>
 646 <span class="c">#   SSOM     73    TRICOORD SULFUR IN THIOSULFINATE GROUP</span>
 647 <span class="c">#   =S=O     74    SULFINYL SULFUR, EG. IN C=S=O</span>
 648 <span class="c">#</span>
<a name="_GetAtomTypeForSulfur-"></a> 649 <span class="k">sub </span><span class="m">_GetAtomTypeForSulfur</span> <span class="s">{</span>
 650   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 651   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 652 
 653   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 654 
 655   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
 656 
 657     <span class="c"># SO4 : SULFATE SULFUR</span>
 658     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfateSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 659       <span class="i">$AtomType</span> = <span class="q">&#39;SO4&#39;</span><span class="sc">;</span>
 660       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 661     <span class="s">}</span>
 662 
 663     <span class="c"># SO3 : SULFONATE SULFUR</span>
 664     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfonateSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 665       <span class="i">$AtomType</span> = <span class="q">&#39;SO3&#39;</span><span class="sc">;</span>
 666       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 667     <span class="s">}</span>
 668 
 669     <span class="c"># SO2N : SULFUR IN SULFONAMIDES</span>
 670     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfonamideSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 671       <span class="i">$AtomType</span> = <span class="q">&#39;SO2N&#39;</span><span class="sc">;</span>
 672       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 673     <span class="s">}</span>
 674 
 675     <span class="c"># SO2 : SULFUR IN SULFONES</span>
 676     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfoneSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 677       <span class="i">$AtomType</span> = <span class="q">&#39;SO2&#39;</span><span class="sc">;</span>
 678       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 679     <span class="s">}</span>
 680 
 681     <span class="c">#  =SO2: SULFONE SULPHER DOUBLY BONDED TO CARBON</span>
 682     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsDoublyBondedToCarbonSulfoneSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 683       <span class="i">$AtomType</span> = <span class="q">&#39;=SO2&#39;</span><span class="sc">;</span>
 684       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 685     <span class="s">}</span>
 686 
 687     <span class="c"># SO2M: SULFUR IN NEGATIVELY CHARGED SULFINATE GROUP</span>
 688     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNegativelyChargedSulfinateSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 689       <span class="i">$AtomType</span> = <span class="q">&#39;SO2M&#39;</span><span class="sc">;</span>
 690       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 691     <span class="s">}</span>
 692 
 693     <span class="c"># SNO : SULFUR IN NITROGEN ANALOG OF A SULFONE</span>
 694     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNitrogenAnalogOfSulfoneSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 695       <span class="i">$AtomType</span> = <span class="q">&#39;SNO&#39;</span><span class="sc">;</span>
 696       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 697     <span class="s">}</span>
 698 
 699     <span class="c"># S=O : SULFUR IN SULFOXIDES</span>
 700     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfoxideSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 701       <span class="i">$AtomType</span> = <span class="q">&#39;S=O&#39;</span><span class="sc">;</span>
 702       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 703     <span class="s">}</span>
 704 
 705     <span class="c"># &gt;S=N : SULFUR, TRICOORD, DOUBLY BONDED TO N</span>
 706     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSNTricoordinatedSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 707       <span class="i">$AtomType</span> = <span class="q">&#39;&gt;S=N&#39;</span><span class="sc">;</span>
 708       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 709     <span class="s">}</span>
 710 
 711     <span class="c"># STHI : SULFUR AS IN THIOPHENE</span>
 712     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSTHISulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 713       <span class="i">$AtomType</span> = <span class="q">&#39;STHI&#39;</span><span class="sc">;</span>
 714       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 715     <span class="s">}</span>
 716 
 717     <span class="c"># S2CM : TERMINAL SULFUR IN THIOCARBOXYLATE ANION</span>
 718     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioCarboxylateAnionTerminalSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 719       <span class="i">$AtomType</span> = <span class="q">&#39;S2CM&#39;</span><span class="sc">;</span>
 720       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 721     <span class="s">}</span>
 722 
 723     <span class="c"># SSMO : TERMINAL SULFUR IN THIOSULFINATE GROUP</span>
 724     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioSulfinateTerminalSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 725       <span class="i">$AtomType</span> = <span class="q">&#39;SSMO&#39;</span><span class="sc">;</span>
 726       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 727     <span class="s">}</span>
 728 
 729     <span class="c"># SSOM : TRICOORD SULFUR IN THIOSULFINATE GROUP</span>
 730     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsTriCoordinatedThioSulfinateSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 731       <span class="i">$AtomType</span> = <span class="q">&#39;SSOM&#39;</span><span class="sc">;</span>
 732       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 733     <span class="s">}</span>
 734 
 735     <span class="c">#   =S=O:  SULFINYL SULFUR, EG. IN C=S=O</span>
 736     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfinylSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 737       <span class="i">$AtomType</span> = <span class="q">&#39;=S=O&#39;</span><span class="sc">;</span>
 738       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 739     <span class="s">}</span>
 740 
 741     <span class="c"># S-P : TERMINAL SULFUR BONDED TO PHOSPHORUS</span>
 742     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSPTerminalSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 743       <span class="i">$AtomType</span> = <span class="q">&#39;S-P&#39;</span><span class="sc">;</span>
 744       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 745     <span class="s">}</span>
 746 
 747     <span class="c"># S=C : TERMINAL SULFUR DOUBLY BONDED TO CARBON</span>
 748     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSCTerminalSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 749       <span class="i">$AtomType</span> = <span class="q">&#39;S=C&#39;</span><span class="sc">;</span>
 750       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 751     <span class="s">}</span>
 752 
 753     <span class="c"># SM : TERMINAL SULFUR - FORMAL CHARGE=-1</span>
 754     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNegativelyChargedTerminalSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 755       <span class="i">$AtomType</span> = <span class="q">&#39;SM&#39;</span><span class="sc">;</span>
 756       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 757     <span class="s">}</span>
 758 
 759     <span class="c"># S : SULFUR IN THIOETHERS AND MERCAPTANS</span>
 760     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioEthersOrMercaptansSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 761       <span class="i">$AtomType</span> = <span class="q">&#39;S&#39;</span><span class="sc">;</span>
 762       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 763     <span class="s">}</span>
 764 
 765     <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 766     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomTypeForSulfur: MMFF94 atom type for Sulfur cann&#39;t be assigned...&quot;</span><span class="sc">;</span>
 767   <span class="s">}</span>
 768   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 769 <span class="s">}</span>
 770 
 771 <span class="c"># Get MMFF94 atom type for Hydrogen atom...</span>
 772 <span class="c">#</span>
 773 <span class="c"># 41 AtomTypeSymbols for element H:</span>
 774 <span class="c">#</span>
 775 <span class="c"># AtomTypeSymbol   AtomTypeNum   AtomTypeDefinition</span>
 776 <span class="c">#   HC       5     H  ATTACHED TO C</span>
 777 <span class="c">#   HSI      5     H ATTACHED TO SI</span>
 778 <span class="c">#   HOR      21    HYDROGEN IN ALCOHOLS</span>
 779 <span class="c">#   HO       21    GENERAL H ON OXYGEN</span>
 780 <span class="c">#   HOM      21    HYDROGEN IN HYDROXIDE ANION</span>
 781 <span class="c">#   HNR      23    H-N(SP3)</span>
 782 <span class="c">#   H3N      23    H-N(SP3), AMMONIA</span>
 783 <span class="c">#   HPYL     23    H-N IN PYRROLE</span>
 784 <span class="c">#   HNOX     23    H-N IN IN A N-OXIDE</span>
 785 <span class="c">#   HNM      23    H ON DICOORD, NEGATIVELY CHARGED NITROGEN</span>
 786 <span class="c">#   HN       23    GENERAL H ON NITROGEN</span>
 787 <span class="c">#   HOCO     24    H-O IN CARBOXYLIC ACIDS</span>
 788 <span class="c">#   HOP      24    HYDROGEN ON OXYGEN ATTACHED TO PHOSPHOROUS</span>
 789 <span class="c">#   HN=N     27    AZO HYDROGEN</span>
 790 <span class="c">#   HN=C     27    IMINE HYDROGEN</span>
 791 <span class="c">#   HNCO     28    AMIDE HYDROGEN</span>
 792 <span class="c">#   HNCS     28    THIOAMIDE HYDROGEN</span>
 793 <span class="c">#   HNCC     28    H-N IN ENAMINES</span>
 794 <span class="c">#   HNCN     28    H-N IN H-N-C=N</span>
 795 <span class="c">#   HNNC     28    H-N IN H-N-N=C</span>
 796 <span class="c">#   HNNN     28    H-N IN H-N-N=N</span>
 797 <span class="c">#   HNSO     28    H-N IN SULFONAMIDE</span>
 798 <span class="c">#   HNPO     28    H-N IN PHOSPHONAMIDE</span>
 799 <span class="c">#   HNC%     28    HYDROGEN ON N ATTACHED TO TRIPLY BONDED CARBON</span>
 800 <span class="c">#   HSP2     28    GENERAL H ON SP2 NITROGEN</span>
 801 <span class="c">#   HOCC     29    H-O IN ENOLS AND PHENOLS</span>
 802 <span class="c">#   HOCN     29    H-O IN HO-C=N</span>
 803 <span class="c">#   HOH      31    HYDROGEN IN H2O</span>
 804 <span class="c">#   HOS      33    H ON OXYGEN ATTACHED TO SULFUR</span>
 805 <span class="c">#   HNR+     36    H ON QUATERNARY NITROGEN</span>
 806 <span class="c">#   HIM+     36    H ON IMIDAZOLIUM-TYPE NITROGEN</span>
 807 <span class="c">#   HPD+     36    H ON PROTONATED PYRIDINE NITROGEN</span>
 808 <span class="c">#   HNN+     36    H ON AMIDINIUM-TYPE NITROGEN</span>
 809 <span class="c">#   HNC+     36    H ON PROTONATED IMINE NITROGEN</span>
 810 <span class="c">#   HGD+     36    H ON GUANIDINIUM-TYPE NITROGEN</span>
 811 <span class="c">#   HN5+     36    H ON N5+, N5A+ OR N5B+</span>
 812 <span class="c">#   HO+      50    HYDROGEN ON O+ OXYGEN</span>
 813 <span class="c">#   HO=+     52    HYDROGEN ON OXENIUM OXYGEN</span>
 814 <span class="c">#   HS       71    H ATTACHED TO DIVALENT, DICOORDINATE S</span>
 815 <span class="c">#   HS=N     71    H ATTACHED TO TETRAVALENT, TRICOODR S DBL BONDED TO N</span>
 816 <span class="c">#   HP       71    H ATTACHED TO TRI- OR TETRACOORDINATE PHOSPHORUS</span>
 817 <span class="c">#</span>
<a name="_GetAtomTypeForHydrogen-"></a> 818 <span class="k">sub </span><span class="m">_GetAtomTypeForHydrogen</span> <span class="s">{</span>
 819   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 820   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="cm">,</span> <span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
 821 
 822   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 823 
 824   <span class="c"># Get non-hydrogen atom neighbor...</span>
 825   <span class="i">$AtomNeighbor</span> = <span class="i">$Atom</span><span class="i">-&gt;GetNonHydrogenNeighborOfHydrogenAtom</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 826   <span class="k">if</span> <span class="s">(</span>!<span class="i">$AtomNeighbor</span><span class="s">)</span> <span class="s">{</span>
 827     <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 828   <span class="s">}</span>
 829 
 830   <span class="j">ATOMNEIGHBOR:</span> <span class="s">{</span>
 831     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;IsCarbon</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 832       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForHydrogenAttachedToCarbon</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
 833       <span class="k">last</span> <span class="j">ATOMNEIGHBOR</span><span class="sc">;</span>
 834     <span class="s">}</span>
 835     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;IsNitrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 836       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForHydrogenAttachedToNitrogen</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
 837       <span class="k">last</span> <span class="j">ATOMNEIGHBOR</span><span class="sc">;</span>
 838     <span class="s">}</span>
 839     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;IsOxygen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 840       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForHydrogenAttachedToOxygen</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
 841       <span class="k">last</span> <span class="j">ATOMNEIGHBOR</span><span class="sc">;</span>
 842     <span class="s">}</span>
 843     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;IsPhosphorus</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 844       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForHydrogenAttachedToPhosphorus</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
 845       <span class="k">last</span> <span class="j">ATOMNEIGHBOR</span><span class="sc">;</span>
 846     <span class="s">}</span>
 847     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;IsSulfur</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 848       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForHydrogenAttachedToSulfur</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
 849       <span class="k">last</span> <span class="j">ATOMNEIGHBOR</span><span class="sc">;</span>
 850     <span class="s">}</span>
 851     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;IsSilicon</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 852       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForHydrogenAttachedToSilicon</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
 853       <span class="k">last</span> <span class="j">ATOMNEIGHBOR</span><span class="sc">;</span>
 854     <span class="s">}</span>
 855     <span class="i">$AtomType</span> = <span class="q">&quot;None&quot;</span><span class="sc">;</span>
 856     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomTypeForHydrogen: MMFF94 atom type for Hydrogen cann&#39;t be assigned...&quot;</span><span class="sc">;</span>
 857   <span class="s">}</span>
 858   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 859 <span class="s">}</span>
 860 
 861 <span class="c"># Get MMFF94 atom type for atoms other than Carbon, Nitrogen, Oxygen, Phosporus,</span>
 862 <span class="c"># Sulfur and Hydrogen...</span>
 863 <span class="c">#</span>
 864 <span class="c"># AtomTypeSymbol   AtomTypeNum   AtomTypeDefinition</span>
 865 <span class="c">#   LI+      92    LITHIUM CATION</span>
 866 <span class="c">#   F        11    FLUORINE</span>
 867 <span class="c">#   F-       89    FLUORIDE ANION</span>
 868 <span class="c">#   NA+      93    SODIUM CATION</span>
 869 <span class="c">#   MG+2     99    DIPOSITIVE MAGNESIUM CATION</span>
 870 <span class="c">#   SI       19    SILICON</span>
 871 <span class="c">#   CL       12    CHLORINE</span>
 872 <span class="c">#   CLO4     77    CHLORINE IN PERCHLORATE ANION, CLO4(-)</span>
 873 <span class="c">#   CL-      90    CHLORIDE ANION</span>
 874 <span class="c">#   K+       94    POTASSIUM CATION</span>
 875 <span class="c">#   CA+2     96    DIPOSITIVE CALCIUM</span>
 876 <span class="c">#   FE+2     87    IRON +2 CATION</span>
 877 <span class="c">#   FE+3     88    IROM +3 CATION</span>
 878 <span class="c">#   CU+1     97    MONOPOSITIVE COPPER</span>
 879 <span class="c">#   CU+2     98    DIPOSITIVE COPPER</span>
 880 <span class="c">#   ZINC     95    DIPOSITIVE ZINC</span>
 881 <span class="c">#   ZN+2     95    DIPOSITIVE ZINC</span>
 882 <span class="c">#   BR       13    BROMINE</span>
 883 <span class="c">#   BR-      91    BROMIDE ANION</span>
 884 <span class="c">#   I        14    IODINE</span>
 885 <span class="c">#</span>
 886 <span class="c">#</span>
<a name="_GetAtomTypeForOtherAtoms-"></a> 887 <span class="k">sub </span><span class="m">_GetAtomTypeForOtherAtoms</span> <span class="s">{</span>
 888   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 889   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="cm">,</span> <span class="i">$AtomSymbol</span><span class="cm">,</span> <span class="i">$FormalCharge</span><span class="cm">,</span> <span class="i">$CallingMethod</span><span class="cm">,</span> <span class="i">@AllowedFormalCharges</span><span class="s">)</span><span class="sc">;</span>
 890 
 891   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 892 
 893   <span class="i">$AtomSymbol</span> = <span class="i">$Atom</span><span class="i">-&gt;GetAtomSymbol</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 894   <span class="i">$FormalCharge</span> = <span class="i">$Atom</span><span class="i">-&gt;GetFormalCharge</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 895 
 896   <span class="i">$CallingMethod</span> = <span class="q">&quot;_GetAtomTypeForOtherAtoms&quot;</span><span class="sc">;</span>
 897   <span class="i">@AllowedFormalCharges</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 898 
 899   <span class="j">ATOMSYMBOL:</span> <span class="s">{</span>
 900     <span class="c"># FLUORINE</span>
 901     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomSymbol</span> =~ <span class="q">/^F$/i</span><span class="s">)</span> <span class="s">{</span>
 902       <span class="c">#  F : FLUORINE;  F- :  FLUORIDE ANION</span>
 903       <span class="i">$AtomType</span> = <span class="s">(</span><span class="i">$FormalCharge</span> == <span class="n">-1</span><span class="s">)</span> ? <span class="q">&#39;F-&#39;</span> <span class="co">:</span> <span class="q">&#39;F&#39;</span><span class="sc">;</span>
 904       <span class="i">@AllowedFormalCharges</span> = <span class="s">(</span><span class="q">&#39;0&#39;</span><span class="cm">,</span> <span class="q">&#39;-1&#39;</span><span class="s">)</span><span class="sc">;</span>
 905       <span class="k">last</span> <span class="j">ATOMSYMBOL</span><span class="sc">;</span>
 906     <span class="s">}</span>
 907     <span class="c"># CHLORINE</span>
 908     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomSymbol</span> =~ <span class="q">/^Cl$/i</span><span class="s">)</span> <span class="s">{</span>
 909       <span class="c"># CL : CHLORINE; CLO4 : CHLORINE IN PERCHLORATE ANION, CLO4(-);</span>
 910       <span class="c"># CL- : CHLORIDE ANION</span>
 911       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_IsPerChlorateAnionChlorine</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span> ? <span class="q">&#39;CLO4&#39;</span> <span class="co">:</span> <span class="s">(</span><span class="s">(</span><span class="i">$FormalCharge</span> == <span class="n">-1</span><span class="s">)</span> ? <span class="q">&#39;CL-&#39;</span> <span class="co">:</span> <span class="q">&#39;CL&#39;</span><span class="s">)</span><span class="sc">;</span>
 912       <span class="i">@AllowedFormalCharges</span> = <span class="s">(</span><span class="q">&#39;0&#39;</span><span class="cm">,</span> <span class="q">&#39;-1&#39;</span><span class="s">)</span><span class="sc">;</span>
 913       <span class="k">last</span> <span class="j">ATOMSYMBOL</span><span class="sc">;</span>
 914     <span class="s">}</span>
 915     <span class="c"># BROMINE</span>
 916     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomSymbol</span> =~ <span class="q">/^Br$/i</span><span class="s">)</span> <span class="s">{</span>
 917       <span class="c"># BR : BROMINE; BR- : BROMIDE ANION</span>
 918       <span class="i">$AtomType</span> = <span class="s">(</span><span class="i">$FormalCharge</span> == <span class="n">-1</span><span class="s">)</span> ? <span class="q">&#39;BR-&#39;</span> <span class="co">:</span> <span class="q">&#39;BR&#39;</span><span class="sc">;</span>
 919       <span class="i">@AllowedFormalCharges</span> = <span class="s">(</span><span class="q">&#39;0&#39;</span><span class="cm">,</span> <span class="q">&#39;-1&#39;</span><span class="s">)</span><span class="sc">;</span>
 920       <span class="k">last</span> <span class="j">ATOMSYMBOL</span><span class="sc">;</span>
 921     <span class="s">}</span>
 922     <span class="c"># IODINE</span>
 923     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomSymbol</span> =~ <span class="q">/^I$/i</span><span class="s">)</span> <span class="s">{</span>
 924       <span class="i">$AtomType</span> = <span class="q">&#39;I&#39;</span><span class="sc">;</span>
 925       <span class="i">@AllowedFormalCharges</span> = <span class="s">(</span><span class="q">&#39;0&#39;</span><span class="s">)</span><span class="sc">;</span>
 926       <span class="k">last</span> <span class="j">ATOMSYMBOL</span><span class="sc">;</span>
 927     <span class="s">}</span>
 928     <span class="c"># LI+ : LITHIUM CATION</span>
 929     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomSymbol</span> =~ <span class="q">/^Li$/i</span><span class="s">)</span> <span class="s">{</span>
 930       <span class="i">$AtomType</span> = <span class="q">&#39;LI+&#39;</span><span class="sc">;</span>
 931       <span class="i">@AllowedFormalCharges</span> = <span class="s">(</span><span class="q">&#39;+1&#39;</span><span class="s">)</span><span class="sc">;</span>
 932       <span class="k">last</span> <span class="j">ATOMSYMBOL</span><span class="sc">;</span>
 933     <span class="s">}</span>
 934     <span class="c"># NA+ : SODIUM CATION</span>
 935     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomSymbol</span> =~ <span class="q">/^Na$/i</span><span class="s">)</span> <span class="s">{</span>
 936       <span class="i">$AtomType</span> = <span class="q">&#39;NA+&#39;</span><span class="sc">;</span>
 937       <span class="i">@AllowedFormalCharges</span> = <span class="s">(</span><span class="q">&#39;+1&#39;</span><span class="s">)</span><span class="sc">;</span>
 938       <span class="k">last</span> <span class="j">ATOMSYMBOL</span><span class="sc">;</span>
 939     <span class="s">}</span>
 940     <span class="c"># MG+2 : DIPOSITIVE MAGNESIUM CATION</span>
 941     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomSymbol</span> =~ <span class="q">/^Mg$/i</span><span class="s">)</span> <span class="s">{</span>
 942       <span class="i">$AtomType</span> = <span class="q">&#39;MG+2&#39;</span><span class="sc">;</span>
 943       <span class="i">@AllowedFormalCharges</span> = <span class="s">(</span><span class="q">&#39;+2&#39;</span><span class="s">)</span><span class="sc">;</span>
 944       <span class="k">last</span> <span class="j">ATOMSYMBOL</span><span class="sc">;</span>
 945     <span class="s">}</span>
 946     <span class="c"># SI : SILICON</span>
 947     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomSymbol</span> =~ <span class="q">/^Si$/i</span><span class="s">)</span> <span class="s">{</span>
 948       <span class="i">$AtomType</span> = <span class="q">&#39;SI&#39;</span><span class="sc">;</span>
 949       <span class="i">@AllowedFormalCharges</span> = <span class="s">(</span><span class="q">&#39;0&#39;</span><span class="s">)</span><span class="sc">;</span>
 950       <span class="k">last</span> <span class="j">ATOMSYMBOL</span><span class="sc">;</span>
 951     <span class="s">}</span>
 952     <span class="c"># K+ : POTASSIUM CATION</span>
 953     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomSymbol</span> =~ <span class="q">/^K$/i</span><span class="s">)</span> <span class="s">{</span>
 954       <span class="i">$AtomType</span> = <span class="q">&#39;K+&#39;</span><span class="sc">;</span>
 955       <span class="i">@AllowedFormalCharges</span> = <span class="s">(</span><span class="q">&#39;+1&#39;</span><span class="s">)</span><span class="sc">;</span>
 956       <span class="k">last</span> <span class="j">ATOMSYMBOL</span><span class="sc">;</span>
 957     <span class="s">}</span>
 958     <span class="c"># CA+2 : DIPOSITIVE CALCIUM</span>
 959     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomSymbol</span> =~ <span class="q">/^Ca$/i</span><span class="s">)</span> <span class="s">{</span>
 960       <span class="i">$AtomType</span> = <span class="q">&#39;CA+2&#39;</span><span class="sc">;</span>
 961       <span class="i">@AllowedFormalCharges</span> = <span class="s">(</span><span class="q">&#39;+2&#39;</span><span class="s">)</span><span class="sc">;</span>
 962       <span class="k">last</span> <span class="j">ATOMSYMBOL</span><span class="sc">;</span>
 963     <span class="s">}</span>
 964     <span class="c"># IRON</span>
 965     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomSymbol</span> =~ <span class="q">/^Fe$/i</span><span class="s">)</span> <span class="s">{</span>
 966       <span class="c"># FE+2 : IRON +2 CATION; FE+3 : IROM +3 CATION</span>
 967       <span class="i">$AtomType</span> = <span class="s">(</span><span class="i">$FormalCharge</span> == <span class="n">3</span><span class="s">)</span> ? <span class="q">&#39;FE+3&#39;</span> <span class="co">:</span> <span class="q">&#39;FE+2&#39;</span><span class="sc">;</span>
 968       <span class="i">@AllowedFormalCharges</span> = <span class="s">(</span><span class="q">&#39;+2&#39;</span><span class="cm">,</span> <span class="q">&#39;+3&#39;</span><span class="s">)</span><span class="sc">;</span>
 969       <span class="k">last</span> <span class="j">ATOMSYMBOL</span><span class="sc">;</span>
 970     <span class="s">}</span>
 971     <span class="c"># COPPER</span>
 972     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomSymbol</span> =~ <span class="q">/^Cu$/i</span><span class="s">)</span> <span class="s">{</span>
 973       <span class="c"># CU+1 : MONOPOSITIVE COPPER; CU+2 : DIPOSITIVE COPPER</span>
 974       <span class="i">$AtomType</span> = <span class="s">(</span><span class="i">$FormalCharge</span> == <span class="n">1</span><span class="s">)</span> ? <span class="q">&#39;CU+1&#39;</span> <span class="co">:</span> <span class="q">&#39;CU+2&#39;</span><span class="sc">;</span>
 975       <span class="i">@AllowedFormalCharges</span> = <span class="s">(</span><span class="q">&#39;+1&#39;</span><span class="cm">,</span> <span class="q">&#39;+2&#39;</span><span class="s">)</span><span class="sc">;</span>
 976       <span class="k">last</span> <span class="j">ATOMSYMBOL</span><span class="sc">;</span>
 977     <span class="s">}</span>
 978     <span class="c"># ZINC</span>
 979     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomSymbol</span> =~ <span class="q">/^Zn$/i</span><span class="s">)</span> <span class="s">{</span>
 980       <span class="c"># ZN+2 : DIPOSITIVE ZINC</span>
 981       <span class="i">$AtomType</span> = <span class="q">&#39;Zn+2&#39;</span><span class="sc">;</span>
 982       <span class="i">@AllowedFormalCharges</span> = <span class="s">(</span><span class="q">&#39;+2&#39;</span><span class="s">)</span><span class="sc">;</span>
 983       <span class="k">last</span> <span class="j">ATOMSYMBOL</span><span class="sc">;</span>
 984     <span class="s">}</span>
 985     <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 986     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomTypeForOtherAtoms: MMFF94 atom type for $AtomSymbol cann&#39;t be assigned...&quot;</span><span class="sc">;</span>
 987   <span class="s">}</span>
 988   <span class="k">if</span> <span class="s">(</span><span class="i">@AllowedFormalCharges</span><span class="s">)</span> <span class="s">{</span>
 989     <span class="i">$This</span><span class="i">-&gt;_CheckFormalChargeMismatch</span><span class="s">(</span><span class="i">$CallingMethod</span><span class="cm">,</span> <span class="i">$AtomSymbol</span><span class="cm">,</span> <span class="i">$AtomType</span><span class="cm">,</span> <span class="i">$FormalCharge</span><span class="cm">,</span> \<span class="i">@AllowedFormalCharges</span><span class="s">)</span><span class="sc">;</span>
 990   <span class="s">}</span>
 991   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 992 <span class="s">}</span>
 993 
 994 <span class="c"># Check any formal charge mismatches...</span>
 995 <span class="c">#</span>
<a name="_CheckFormalChargeMismatch-"></a> 996 <span class="k">sub </span><span class="m">_CheckFormalChargeMismatch</span> <span class="s">{</span>
 997   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$CallingMethod</span><span class="cm">,</span> <span class="i">$AtomSymbol</span><span class="cm">,</span> <span class="i">$AssignedAtomType</span><span class="cm">,</span> <span class="i">$FormalCharge</span><span class="cm">,</span> <span class="i">$AllowedFormalChargesRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 998   <span class="k">my</span><span class="s">(</span><span class="i">$AllowedFormalCharge</span><span class="cm">,</span> <span class="i">$FormalChargeMismatch</span><span class="s">)</span><span class="sc">;</span>
 999 
1000   <span class="i">$FormalChargeMismatch</span> = <span class="n">1</span><span class="sc">;</span>
1001 
1002   <span class="j">FORMALCHARGE:</span> <span class="k">for</span> <span class="i">$AllowedFormalCharge</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$AllowedFormalChargesRef</span>}<span class="s">)</span> <span class="s">{</span>
1003     <span class="k">if</span> <span class="s">(</span><span class="i">$AllowedFormalCharge</span> == <span class="i">$FormalCharge</span><span class="s">)</span> <span class="s">{</span>
1004       <span class="i">$FormalChargeMismatch</span> = <span class="n">0</span><span class="sc">;</span>
1005       <span class="k">last</span> <span class="j">FORMALCHARGE</span><span class="sc">;</span>
1006     <span class="s">}</span>
1007   <span class="s">}</span>
1008   <span class="k">if</span> <span class="s">(</span><span class="i">$FormalChargeMismatch</span><span class="s">)</span> <span class="s">{</span>
1009     <span class="k">my</span><span class="s">(</span><span class="i">$AllowedFormalCharges</span><span class="s">)</span><span class="sc">;</span>
1010     <span class="i">$AllowedFormalCharges</span> = <span class="i">TextUtil::JoinWords</span><span class="s">(</span><span class="i">$AllowedFormalChargesRef</span><span class="cm">,</span> <span class="q">&quot;,&quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span><span class="sc">;</span>
1011 
1012     <span class="w">carp</span> <span class="q">&quot;\nWarning: ${ClassName}-&gt;${CallingMethod}:_CheckFormalChargeMismatch: MMFF94 atom for $AtomSymbol with formal charge, $FormalCharge, cann&#39;t be assigned: Formal charge, $FormalCharge, is different from allowed formal charge(s): $AllowedFormalCharges. Default UFF atom type, $AssignedAtomType, has been assigned...&quot;</span><span class="sc">;</span>
1013   <span class="s">}</span>
1014 
1015   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1016 <span class="s">}</span>
1017 
1018 <span class="c"># Get MMFF94 atom type for Carbon with only sigma bonds...</span>
1019 <span class="c">#</span>
<a name="_GetAtomTypeForCarbonWithOnlySigmaBonds-"></a>1020 <span class="k">sub </span><span class="m">_GetAtomTypeForCarbonWithOnlySigmaBonds</span> <span class="s">{</span>
1021   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1022   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
1023 
1024   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
1025 
1026   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
1027     <span class="c"># CR4R : CARBON IN 4-MEMBERED RINGS</span>
1028     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsFourMemberedRingCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1029       <span class="i">$AtomType</span> = <span class="q">&#39;CR4R&#39;</span><span class="sc">;</span>
1030       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1031     <span class="s">}</span>
1032 
1033     <span class="c"># CR3R : CARBON IN A 3-MEMBERED RING</span>
1034     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThreeMemberedRingCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1035       <span class="i">$AtomType</span> = <span class="q">&#39;CR3R&#39;</span><span class="sc">;</span>
1036       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1037     <span class="s">}</span>
1038 
1039     <span class="c">#  CR : ALKYL CARBON, SP3</span>
1040     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAlkylCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1041       <span class="i">$AtomType</span> = <span class="q">&#39;CR&#39;</span><span class="sc">;</span>
1042       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1043     <span class="s">}</span>
1044 
1045     <span class="c"># As far as I can tell, MMFF94 doesn&#39;t have a generic atom type for SP3 carbon. So the current</span>
1046     <span class="c"># release of MayaChemTools package used CR as defaul SP3 carbon.</span>
1047     <span class="c">#</span>
1048     <span class="i">$AtomType</span> = <span class="q">&#39;CR&#39;</span><span class="sc">;</span>
1049   <span class="s">}</span>
1050 
1051   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
1052 <span class="s">}</span>
1053 
1054 <span class="c"># Get MMFF94 atom type for Carbon with one pi bond...</span>
1055 <span class="c">#</span>
<a name="_GetAtomTypeForCarbonWithOnePiBond-"></a>1056 <span class="k">sub </span><span class="m">_GetAtomTypeForCarbonWithOnePiBond</span> <span class="s">{</span>
1057   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1058   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
1059 
1060   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
1061 
1062   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
1063     <span class="c"># CR3R :  CARBON IN 3-MEMBERED RINGS</span>
1064     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThreeMemberedRingOlefinicCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1065       <span class="i">$AtomType</span> = <span class="q">&#39;CR3R&#39;</span><span class="sc">;</span>
1066       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1067     <span class="s">}</span>
1068 
1069     <span class="c"># CE4R :  OLEFINIC CARBON IN 4-MEMBERED RINGS</span>
1070     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsFourMemberedRingOlefinicCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1071       <span class="i">$AtomType</span> = <span class="q">&#39;CE4R&#39;</span><span class="sc">;</span>
1072       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1073     <span class="s">}</span>
1074 
1075     <span class="c"># CIM+ : C IN N-C-N IN IMIDAZOLIUM ION</span>
1076     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsImidazoliumCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1077       <span class="i">$AtomType</span> = <span class="q">&#39;CIM+&#39;</span><span class="sc">;</span>
1078       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1079     <span class="s">}</span>
1080 
1081     <span class="c"># C5A : ALPHA CARBON IN 5-MEMBERED HETEROAROMATIC RING</span>
1082     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsFiveMemberedHeteroAromaticRingAlphaCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1083       <span class="i">$AtomType</span> = <span class="q">&#39;C5A&#39;</span><span class="sc">;</span>
1084       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1085     <span class="s">}</span>
1086 
1087     <span class="c"># C5B : BETA CARBON IN 5-MEMBERED HETEROAROMATIC RING</span>
1088     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsFiveMemberedHeteroAromaticRingBetaCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1089       <span class="i">$AtomType</span> = <span class="q">&#39;C5B&#39;</span><span class="sc">;</span>
1090       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1091     <span class="s">}</span>
1092 
1093     <span class="c"># C5 : GENERAL CARBON IN 5-MEMBERED HETEROAROMATIC RING</span>
1094     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsFiveMemberedHeteroAromaticRingCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1095       <span class="i">$AtomType</span> = <span class="q">&#39;C5&#39;</span><span class="sc">;</span>
1096       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1097     <span class="s">}</span>
1098 
1099     <span class="c"># CB : CARBON AS IN BENZENE, PYRROLE</span>
1100     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsRingAromaticCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1101       <span class="i">$AtomType</span> = <span class="q">&#39;CB&#39;</span><span class="sc">;</span>
1102       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1103     <span class="s">}</span>
1104 
1105     <span class="c"># C=C : VINYLIC CARBON, SP2</span>
1106     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsVinylicCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1107       <span class="i">$AtomType</span> = <span class="q">&#39;C=C&#39;</span><span class="sc">;</span>
1108       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1109     <span class="s">}</span>
1110 
1111     <span class="c"># C=OR : KETONE OR ALDEHYDE CARBONYL CARBON</span>
1112     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsKetoneOrAldehydeCarbonylCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1113       <span class="i">$AtomType</span> = <span class="q">&#39;C=OR&#39;</span><span class="sc">;</span>
1114       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1115     <span class="s">}</span>
1116 
1117     <span class="c"># C=ON : AMIDE CARBONYL CARBON</span>
1118     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAmideCarbonylCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1119       <span class="i">$AtomType</span> = <span class="q">&#39;C=ON&#39;</span><span class="sc">;</span>
1120       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1121     <span class="s">}</span>
1122 
1123     <span class="c"># CONN : UREA CARBONYL CARBON</span>
1124     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsUreaCarbonylCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1125       <span class="i">$AtomType</span> = <span class="q">&#39;CONN&#39;</span><span class="sc">;</span>
1126       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1127     <span class="s">}</span>
1128 
1129     <span class="c"># COO : CARBOXYLIC ACID OR ESTER CARBONYL CARBON</span>
1130     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsCarboxylicAcidOrEsterCarbonylCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1131       <span class="i">$AtomType</span> = <span class="q">&#39;COO&#39;</span><span class="sc">;</span>
1132       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1133     <span class="s">}</span>
1134 
1135     <span class="c"># CO2M : CARBOXYLATE ANION CARBON</span>
1136     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsCarboxylateAnionCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1137       <span class="i">$AtomType</span> = <span class="q">&#39;CO2M&#39;</span><span class="sc">;</span>
1138       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1139     <span class="s">}</span>
1140 
1141     <span class="c"># COON: CARBAMATE CARBONYL CARBON</span>
1142     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsCarbamateCarbonylCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1143       <span class="i">$AtomType</span> = <span class="q">&#39;COON&#39;</span><span class="sc">;</span>
1144       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1145     <span class="s">}</span>
1146 
1147     <span class="c"># COOO: CARBONIC ACID OR ESTER CARBONYL CARBON</span>
1148     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsCarbonicAcidOrEsterCarbonylCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1149       <span class="i">$AtomType</span> = <span class="q">&#39;COOO&#39;</span><span class="sc">;</span>
1150       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1151     <span class="s">}</span>
1152 
1153     <span class="c"># C=OS : THIOESTER CARBONYL CARBON, DOUBLE BONDED TO O</span>
1154     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioEsterCarbonylCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1155       <span class="i">$AtomType</span> = <span class="q">&#39;C=OS&#39;</span><span class="sc">;</span>
1156       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1157     <span class="s">}</span>
1158 
1159     <span class="c"># C=O : GENERAL CARBONYL CARBON</span>
1160     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsGeneralCarbonylCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1161       <span class="i">$AtomType</span> = <span class="q">&#39;C=O&#39;</span><span class="sc">;</span>
1162       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1163     <span class="s">}</span>
1164 
1165     <span class="c"># C=SN : THIOAMIDE, CARBON, DOUBLY BONDED TO S</span>
1166     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioAmideCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1167       <span class="i">$AtomType</span> = <span class="q">&#39;C=SN&#39;</span><span class="sc">;</span>
1168       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1169     <span class="s">}</span>
1170 
1171     <span class="c"># CSO2 : CARBON IN &gt;C=SO2</span>
1172     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfonylCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1173       <span class="i">$AtomType</span> = <span class="q">&#39;CSO2&#39;</span><span class="sc">;</span>
1174       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1175     <span class="s">}</span>
1176 
1177     <span class="c"># CS=O :  CARBON IN &gt;C=S=O (SULFINYL GROUP)</span>
1178     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfinylCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1179       <span class="i">$AtomType</span> = <span class="q">&#39;CS=O&#39;</span><span class="sc">;</span>
1180       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1181     <span class="s">}</span>
1182 
1183     <span class="c"># CSS : THIOCARBOXYLIC ACID OR ESTER CARBONYL CARBON</span>
1184     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioCarboxylicAcidOrEsterCarbonylCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1185       <span class="i">$AtomType</span> = <span class="q">&#39;CSS&#39;</span><span class="sc">;</span>
1186       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1187     <span class="s">}</span>
1188 
1189     <span class="c"># CS2M : CARBON IN THIOCARBOXYLATE ANION</span>
1190     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioCarboxylateAnionCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1191       <span class="i">$AtomType</span> = <span class="q">&#39;CS2M&#39;</span><span class="sc">;</span>
1192       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1193     <span class="s">}</span>
1194 
1195     <span class="c"># C=S : THIOESTER CARBON, DOUBLY BONDED TO S</span>
1196     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioEsterCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1197       <span class="i">$AtomType</span> = <span class="q">&#39;C=S&#39;</span><span class="sc">;</span>
1198       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1199     <span class="s">}</span>
1200 
1201     <span class="c"># C=P : CARBON DOUBLE BONDED TO PHOSPHOROUS</span>
1202     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsDoublyBondedToPhosphorousCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1203       <span class="i">$AtomType</span> = <span class="q">&#39;C=P&#39;</span><span class="sc">;</span>
1204       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1205     <span class="s">}</span>
1206 
1207     <span class="c"># CGD : GUANIDINE CARBON, DOUBLY BONDED TO N</span>
1208     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsGuandineCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1209       <span class="i">$AtomType</span> = <span class="q">&#39;CGD&#39;</span><span class="sc">;</span>
1210       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1211     <span class="s">}</span>
1212 
1213     <span class="c"># CGD+ : GUANIDINIUM CARBON</span>
1214     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsGuandiniumCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1215       <span class="i">$AtomType</span> = <span class="q">&#39;CGD+&#39;</span><span class="sc">;</span>
1216       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1217     <span class="s">}</span>
1218 
1219     <span class="c">#CNN+ : C IN +N=C-N RESONANCE STRUCTURES</span>
1220     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNCNResonaceStructuresCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1221       <span class="i">$AtomType</span> = <span class="q">&#39;CNN+&#39;</span><span class="sc">;</span>
1222       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1223     <span class="s">}</span>
1224 
1225     <span class="c"># C=N : SP2 CARBON IN C=N</span>
1226     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsDoublyBondedToNitrogenSP2Carbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1227       <span class="i">$AtomType</span> = <span class="q">&#39;C=N&#39;</span><span class="sc">;</span>
1228       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1229     <span class="s">}</span>
1230 
1231     <span class="c"># CSP2 : GENERIC SP2 CARBON</span>
1232     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsGenericSP2Carbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1233       <span class="i">$AtomType</span> = <span class="q">&#39;CSP2&#39;</span><span class="sc">;</span>
1234       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1235     <span class="s">}</span>
1236 
1237     <span class="i">$AtomType</span> = <span class="q">&#39;CSP2&#39;</span><span class="sc">;</span>
1238     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomTypeForCarbonWithOnePiBond: MMFF94 atom type for Carbon cann&#39;t be assigned; Default MMFF94 atom type, $AtomType, has been assigned...\n&quot;</span><span class="sc">;</span>
1239   <span class="s">}</span>
1240 
1241   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
1242 <span class="s">}</span>
1243 
1244 <span class="c"># Get MMFF94 atom type for Carbon with two pi bonds...</span>
1245 <span class="c">#</span>
<a name="_GetAtomTypeForCarbonWithTwoPiBonds-"></a>1246 <span class="k">sub </span><span class="m">_GetAtomTypeForCarbonWithTwoPiBonds</span> <span class="s">{</span>
1247   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1248   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
1249 
1250   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
1251 
1252   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
1253     <span class="c"># =C= : ALLENIC CARBON</span>
1254     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAllenicCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1255       <span class="i">$AtomType</span> = <span class="q">&#39;=C=&#39;</span><span class="sc">;</span>
1256       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1257     <span class="s">}</span>
1258 
1259     <span class="c"># C% : ISONITRILE CARBON ( R-N+#C- )</span>
1260     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsIsoNitrileCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1261       <span class="i">$AtomType</span> = <span class="q">&#39;C%&#39;</span><span class="sc">;</span>
1262       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1263     <span class="s">}</span>
1264 
1265     <span class="c"># CSP : ACETYLENIC CARBON</span>
1266     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAcetylenicCarbon</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1267       <span class="i">$AtomType</span> = <span class="q">&#39;CSP&#39;</span><span class="sc">;</span>
1268       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1269     <span class="s">}</span>
1270 
1271     <span class="i">$AtomType</span> = <span class="q">&#39;CSP&#39;</span><span class="sc">;</span>
1272     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomTypeForCarbonWithTwoPiBonds: MMFF94 atom type for Carbon cann&#39;t be assigned; Default MMFF94 atom type, $AtomType, has been assigned...\n&quot;</span><span class="sc">;</span>
1273   <span class="s">}</span>
1274 
1275   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
1276 <span class="s">}</span>
1277 
1278 
1279 <span class="c"># CR4R : CARBON IN 4-MEMBERED RINGS</span>
1280 <span class="c">#</span>
<a name="_IsFourMemberedRingCarbon-"></a>1281 <span class="k">sub </span><span class="m">_IsFourMemberedRingCarbon</span> <span class="s">{</span>
1282   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1283 
1284   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.RA4.T4.TSB4&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1285 <span class="s">}</span>
1286 
1287 <span class="c"># CR4R : CARBON IN 3-MEMBERED RINGS</span>
1288 <span class="c">#</span>
<a name="_IsThreeMemberedRingCarbon-"></a>1289 <span class="k">sub </span><span class="m">_IsThreeMemberedRingCarbon</span> <span class="s">{</span>
1290   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1291 
1292   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.RA3.T4.TSB4&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1293 <span class="s">}</span>
1294 
1295 <span class="c">#  CR : ALKYL CARBON, SP3</span>
1296 <span class="c">#</span>
<a name="_IsAlkylCarbon-"></a>1297 <span class="k">sub </span><span class="m">_IsAlkylCarbon</span> <span class="s">{</span>
1298   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1299 
1300   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T4.TSB4&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1301 <span class="s">}</span>
1302 
1303 <span class="c"># C5A : ALPHA CARBON IN 5-MEMBERED HETEROAROMATIC RING</span>
1304 <span class="c">#</span>
<a name="_IsFiveMemberedHeteroAromaticRingAlphaCarbon-"></a>1305 <span class="k">sub </span><span class="m">_IsFiveMemberedHeteroAromaticRingAlphaCarbon</span> <span class="s">{</span>
1306   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1307 
1308   <span class="c"># Is it an aromatic atom in a five membered ring?</span>
1309   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.Ar.RA5&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1310     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1311   <span class="s">}</span>
1312 
1313   <span class="c"># Is it part of a five membered ring containing hetero atom at alpha position?</span>
1314   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
1315 
1316   <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetRingsWithSize</span><span class="s">(</span><span class="n">5</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1317     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAtomPositionAlphaInHeteroAromaticRing</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1318       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
1319     <span class="s">}</span>
1320   <span class="s">}</span>
1321   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1322 <span class="s">}</span>
1323 
1324 <span class="c"># C5B : BETA CARBON IN 5-MEMBERED HETEROAROMATIC RING</span>
1325 <span class="c">#</span>
<a name="_IsFiveMemberedHeteroAromaticRingBetaCarbon-"></a>1326 <span class="k">sub </span><span class="m">_IsFiveMemberedHeteroAromaticRingBetaCarbon</span> <span class="s">{</span>
1327   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1328 
1329   <span class="c"># Is it an aromatic atom in a five membered ring?</span>
1330   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.Ar.RA5&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1331     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1332   <span class="s">}</span>
1333 
1334   <span class="c"># Is it part of five membered rings containing hetero atom at beta position?</span>
1335   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
1336 
1337   <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetRingsWithSize</span><span class="s">(</span><span class="n">5</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1338     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAtomPositionBetaInHeteroAromaticRing</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1339       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
1340     <span class="s">}</span>
1341   <span class="s">}</span>
1342   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1343 <span class="s">}</span>
1344 
1345 
1346 <span class="c"># C5 : GENERAL CARBON IN 5-MEMBERED HETEROAROMATIC RING</span>
1347 <span class="c">#</span>
<a name="_IsFiveMemberedHeteroAromaticRingCarbon-"></a>1348 <span class="k">sub </span><span class="m">_IsFiveMemberedHeteroAromaticRingCarbon</span> <span class="s">{</span>
1349   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1350 
1351   <span class="c"># Is it an aromatic atom in a five membered ring?</span>
1352   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.Ar.RA5&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1353     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1354   <span class="s">}</span>
1355 
1356   <span class="c"># Is it part of five membered rings containing at least one hetero atom?</span>
1357   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="cm">,</span> <span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="s">)</span><span class="sc">;</span>
1358   <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetRingsWithSize</span><span class="s">(</span><span class="n">5</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1359     <span class="s">(</span><span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;_GetHeteroAtomsInformationInRing</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
1360     <span class="k">if</span> <span class="s">(</span><span class="i">$RingIsAromatic</span> &amp;&amp; <span class="i">$NumOfHeteroAtoms</span> &gt;= <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
1361       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
1362     <span class="s">}</span>
1363   <span class="s">}</span>
1364   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1365 <span class="s">}</span>
1366 
1367 <span class="c"># CR3R :  OLEFINIC CARBON IN 3-MEMBERED RINGS</span>
1368 <span class="c">#</span>
1369 <span class="c"># Notes:</span>
1370 <span class="c">#    . MMFF94 atom type for olefinic Carbon in 3-membered rings is same as SP3 Carbon.</span>
1371 <span class="c">#</span>
<a name="_IsThreeMemberedRingOlefinicCarbon-"></a>1372 <span class="k">sub </span><span class="m">_IsThreeMemberedRingOlefinicCarbon</span> <span class="s">{</span>
1373   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1374 
1375   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.RA3.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1376 <span class="s">}</span>
1377 
1378 <span class="c"># CE4R :  OLEFINIC CARBON IN 4-MEMBERED RINGS</span>
1379 <span class="c">#</span>
<a name="_IsFourMemberedRingOlefinicCarbon-"></a>1380 <span class="k">sub </span><span class="m">_IsFourMemberedRingOlefinicCarbon</span> <span class="s">{</span>
1381   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1382 
1383   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.RA4.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1384 <span class="s">}</span>
1385 
1386 <span class="c"># CB : CARBON AS IN BENZENE, PYRROLE</span>
1387 <span class="c">#</span>
1388 <span class="c"># Notes:</span>
1389 <span class="c">#    . MayaChemTools assigns all aromatic carbons, other than five membered</span>
1390 <span class="c">#      hetero aromatic ring Carbons, as CB.</span>
1391 <span class="c">#</span>
<a name="_IsRingAromaticCarbon-"></a>1392 <span class="k">sub </span><span class="m">_IsRingAromaticCarbon</span> <span class="s">{</span>
1393   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1394 
1395   <span class="k">return</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.Ar.RA&#39;</span><span class="s">)</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1396 <span class="s">}</span>
1397 
1398 <span class="c"># C=C : VINYLIC CARBON, SP2</span>
1399 <span class="c">#</span>
<a name="_IsVinylicCarbon-"></a>1400 <span class="k">sub </span><span class="m">_IsVinylicCarbon</span> <span class="s">{</span>
1401   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1402 
1403   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1404 <span class="s">}</span>
1405 
1406 <span class="c"># C=OR : KETONE OR ALDEHYDE CARBONYL CARBON</span>
1407 <span class="c">#</span>
<a name="_IsKetoneOrAldehydeCarbonylCarbon-"></a>1408 <span class="k">sub </span><span class="m">_IsKetoneOrAldehydeCarbonylCarbon</span> <span class="s">{</span>
1409   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1410 
1411   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1412 <span class="s">}</span>
1413 
1414 <span class="c"># C=ON : AMIDE CARBONYL CARBON</span>
1415 <span class="c">#</span>
<a name="_IsAmideCarbonylCarbon-"></a>1416 <span class="k">sub </span><span class="m">_IsAmideCarbonylCarbon</span> <span class="s">{</span>
1417   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1418 
1419   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1420 <span class="s">}</span>
1421 
1422 <span class="c"># CONN : UREA CARBONYL CARBON : R-(R&#39;-)N-C(=O)-N(-R&quot;)-R&#39;&#39;&#39;</span>
1423 <span class="c">#</span>
<a name="_IsUreaCarbonylCarbon-"></a>1424 <span class="k">sub </span><span class="m">_IsUreaCarbonylCarbon</span> <span class="s">{</span>
1425   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1426 
1427   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.X3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;N&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1428 <span class="s">}</span>
1429 
1430 <span class="c"># COO : CARBOXYLIC ACID OR ESTER CARBONYL CARBON</span>
1431 <span class="c">#</span>
<a name="_IsCarboxylicAcidOrEsterCarbonylCarbon-"></a>1432 <span class="k">sub </span><span class="m">_IsCarboxylicAcidOrEsterCarbonylCarbon</span> <span class="s">{</span>
1433   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1434 
1435   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O.X1.FC0,O.X2&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1436 <span class="s">}</span>
1437 
1438 <span class="c"># CO2M : CARBOXYLATE ANION CARBON</span>
1439 <span class="c">#</span>
<a name="_IsCarboxylateAnionCarbon-"></a>1440 <span class="k">sub </span><span class="m">_IsCarboxylateAnionCarbon</span> <span class="s">{</span>
1441   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1442 
1443   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O.X1.FC-1&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1444 <span class="s">}</span>
1445 
1446 <span class="c"># COON: CARBAMATE CARBONYL CARBON : R-O-C(=O)-N(-R&#39;)-R&quot;</span>
1447 <span class="c">#</span>
<a name="_IsCarbamateCarbonylCarbon-"></a>1448 <span class="k">sub </span><span class="m">_IsCarbamateCarbonylCarbon</span> <span class="s">{</span>
1449   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1450 
1451   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.X3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;N&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1452 <span class="s">}</span>
1453 
1454 <span class="c"># COOO: CARBONIC ACID OR ESTER CARBONYL CARBON:  R-O-C(=O)-O-R&#39;</span>
1455 <span class="c">#</span>
<a name="_IsCarbonicAcidOrEsterCarbonylCarbon-"></a>1456 <span class="k">sub </span><span class="m">_IsCarbonicAcidOrEsterCarbonylCarbon</span> <span class="s">{</span>
1457   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1458 
1459   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.X3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1460 <span class="s">}</span>
1461 
1462 <span class="c"># C=OS : THIOESTER CARBONYL CARBON, DOUBLE BONDED TO O</span>
1463 <span class="c">#</span>
<a name="_IsThioEsterCarbonylCarbon-"></a>1464 <span class="k">sub </span><span class="m">_IsThioEsterCarbonylCarbon</span> <span class="s">{</span>
1465   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1466 
1467   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;S&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1468 <span class="s">}</span>
1469 
1470 <span class="c"># C=O : GENERAL CARBONYL CARBON</span>
1471 <span class="c">#</span>
<a name="_IsGeneralCarbonylCarbon-"></a>1472 <span class="k">sub </span><span class="m">_IsGeneralCarbonylCarbon</span> <span class="s">{</span>
1473   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1474 
1475   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1476 <span class="s">}</span>
1477 
1478 <span class="c"># C=SN : THIOAMIDE, CARBON, DOUBLY BONDED TO S</span>
1479 <span class="c">#</span>
<a name="_IsThioAmideCarbon-"></a>1480 <span class="k">sub </span><span class="m">_IsThioAmideCarbon</span> <span class="s">{</span>
1481   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1482 
1483   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S&#39;</span><span class="cm">,</span> <span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1484 <span class="s">}</span>
1485 
1486 <span class="c"># CSO2 : CARBON IN &gt;C=SO2</span>
1487 <span class="c">#</span>
<a name="_IsSulfonylCarbon-"></a>1488 <span class="k">sub </span><span class="m">_IsSulfonylCarbon</span> <span class="s">{</span>
1489   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1490   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
1491 
1492   <span class="c"># Is it connected to a sulfone Sulfur?</span>
1493   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1494     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsDoublyBondedToCarbonSulfoneSulfur</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1495       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
1496     <span class="s">}</span>
1497   <span class="s">}</span>
1498   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1499 <span class="s">}</span>
1500 
1501 
1502 <span class="c"># CS=O :  CARBON IN &gt;C=S=O (SULFINYL GROUP)</span>
1503 <span class="c">#</span>
<a name="_IsSulfinylCarbon-"></a>1504 <span class="k">sub </span><span class="m">_IsSulfinylCarbon</span> <span class="s">{</span>
1505   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1506   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
1507 
1508   <span class="c"># Is it connected to a sulfinyl Sulfur?</span>
1509   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1510     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfinylSulfur</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1511       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
1512     <span class="s">}</span>
1513   <span class="s">}</span>
1514   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1515 <span class="s">}</span>
1516 
1517 <span class="c"># CSS : THIOCARBOXYLIC ACID OR ESTER CARBONYL CARBON</span>
1518 <span class="c">#</span>
<a name="_IsThioCarboxylicAcidOrEsterCarbonylCarbon-"></a>1519 <span class="k">sub </span><span class="m">_IsThioCarboxylicAcidOrEsterCarbonylCarbon</span> <span class="s">{</span>
1520   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1521 
1522   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S&#39;</span><span class="cm">,</span> <span class="q">&#39;S.X1.FC0,S.X2&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1523 <span class="s">}</span>
1524 
1525 <span class="c"># CS2M : CARBON IN THIOCARBOXYLATE ANION</span>
1526 <span class="c">#</span>
<a name="_IsThioCarboxylateAnionCarbon-"></a>1527 <span class="k">sub </span><span class="m">_IsThioCarboxylateAnionCarbon</span> <span class="s">{</span>
1528   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1529 
1530   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S&#39;</span><span class="cm">,</span> <span class="q">&#39;S.X1.FC-1&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1531 <span class="s">}</span>
1532 
1533 <span class="c"># C=S : THIOESTER CARBON, DOUBLY BONDED TO S</span>
1534 <span class="c">#</span>
<a name="_IsThioEsterCarbon-"></a>1535 <span class="k">sub </span><span class="m">_IsThioEsterCarbon</span> <span class="s">{</span>
1536   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1537 
1538   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S.X1&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1539 <span class="s">}</span>
1540 
1541 <span class="c"># C=P : CARBON DOUBLE BONDED TO PHOSPHOROUS</span>
1542 <span class="c">#</span>
<a name="_IsDoublyBondedToPhosphorousCarbon-"></a>1543 <span class="k">sub </span><span class="m">_IsDoublyBondedToPhosphorousCarbon</span> <span class="s">{</span>
1544   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1545 
1546   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;P.X1&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1547 <span class="s">}</span>
1548 
1549 <span class="c"># CIM+ : C IN N-C-N IN IMIDAZOLIUM ION</span>
1550 <span class="c">#</span>
1551 <span class="c"># Notes:</span>
1552 <span class="c">#    . Imidazole is five membered ring contain  C*=C-N-C=N* (* - Ring bond)</span>
1553 <span class="c">#    . Imidazolium ion is where N in C=N has a formal charge of +1 and has an extra substituent</span>
1554 <span class="c">#</span>
<a name="_IsImidazoliumCarbon-"></a>1555 <span class="k">sub </span><span class="m">_IsImidazoliumCarbon</span> <span class="s">{</span>
1556   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1557 
1558   <span class="c"># Is it in a 5 membered aromatic ring surrounded by two aromatic Nitrogens?</span>
1559   <span class="c">#</span>
1560   <span class="k">if</span> <span class="s">(</span>!<span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.Ar.RA5.TR1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N.Ar.RA5.TR1.FC0&#39;</span><span class="cm">,</span> <span class="q">&#39;N.Ar.RA5.TR1.FC+1&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span> ||
1561        <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.Ar.RA5.TR1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N.Ar.RA5.TR1.!FC0&#39;</span><span class="cm">,</span> <span class="q">&#39;N.Ar.RA5.TR1.!FC0&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1562     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1563   <span class="s">}</span>
1564 
1565   <span class="c"># Check to make sure ring contains only two Nitrogen hetero atom...</span>
1566   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="cm">,</span> <span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="cm">,</span> <span class="i">$HeteroAtomSymbolsRef</span><span class="s">)</span><span class="sc">;</span>
1567 
1568   <span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span> = <span class="i">$Atom</span><span class="i">-&gt;GetRingsWithSize</span><span class="s">(</span><span class="n">5</span><span class="s">)</span><span class="sc">;</span>
1569   <span class="s">(</span><span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="cm">,</span> <span class="i">$HeteroAtomSymbolsRef</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;_GetHeteroAtomsInformationInRing</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
1570 
1571   <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfHeteroAtoms</span> != <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
1572     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1573   <span class="s">}</span>
1574 
1575   <span class="k">return</span> <span class="s">(</span><span class="k">exists</span><span class="s">(</span><span class="i">$HeteroAtomSymbolsRef</span>-&gt;{<span class="w">N</span>}<span class="s">)</span> &amp;&amp; <span class="s">(</span><span class="i">$HeteroAtomSymbolsRef</span>-&gt;{<span class="w">N</span>} == <span class="n">2</span><span class="s">)</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1576 <span class="s">}</span>
1577 
1578 <span class="c"># CNN+ : C IN +N=C-N RESONANCE STRUCTURES</span>
1579 <span class="c">#</span>
<a name="_IsNCNResonaceStructuresCarbon-"></a>1580 <span class="k">sub </span><span class="m">_IsNCNResonaceStructuresCarbon</span> <span class="s">{</span>
1581   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1582 
1583   <span class="c"># Match +1 formal charge on Nitrogen...</span>
1584   <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N.FC+1&#39;</span><span class="cm">,</span> <span class="q">&#39;N.FC0&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1585     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
1586   <span class="s">}</span>
1587 
1588   <span class="c"># Match non-zero (+1/2) formal charge on Nitrogen with single, double or resonnace bonds...</span>
1589   <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N.!FC0&#39;</span><span class="cm">,</span> <span class="q">&#39;N.!FC0&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-,=,:&#39;</span><span class="cm">,</span> <span class="q">&#39;-,=,:&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1590     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
1591   <span class="s">}</span>
1592 
1593   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1594 <span class="s">}</span>
1595 
1596 <span class="c"># CGD : GUANIDINE CARBON, DOUBLY BONDED TO N</span>
1597 <span class="c">#</span>
<a name="_IsGuandineCarbon-"></a>1598 <span class="k">sub </span><span class="m">_IsGuandineCarbon</span> <span class="s">{</span>
1599   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1600 
1601   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.X3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N.FC0&#39;</span><span class="cm">,</span> <span class="q">&#39;N.FC0&#39;</span><span class="cm">,</span> <span class="q">&#39;N.FC0&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1602 <span class="s">}</span>
1603 
1604 <span class="c"># CGD+ : GUANIDINIUM CARBON</span>
1605 <span class="c">#</span>
<a name="_IsGuandiniumCarbon-"></a>1606 <span class="k">sub </span><span class="m">_IsGuandiniumCarbon</span> <span class="s">{</span>
1607   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1608 
1609   <span class="c"># Match +1 formal charge on a Nitrogen with explicitly single and double bonds...</span>
1610   <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.X3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N.FC+1&#39;</span><span class="cm">,</span> <span class="q">&#39;N.FC0&#39;</span><span class="cm">,</span> <span class="q">&#39;N.FC0&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1611     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
1612   <span class="s">}</span>
1613 
1614   <span class="c"># Match +1/3 formal charge on each Nitrogen with single, double or resonance bonds...</span>
1615   <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.X3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N.!FC0&#39;</span><span class="cm">,</span> <span class="q">&#39;N.!FC0&#39;</span><span class="cm">,</span> <span class="q">&#39;N.!FC0&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-,=,:&#39;</span><span class="cm">,</span> <span class="q">&#39;-,=,:&#39;</span><span class="cm">,</span> <span class="q">&#39;-,=,:&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1616     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
1617   <span class="s">}</span>
1618 
1619   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1620 <span class="s">}</span>
1621 
1622 <span class="c"># C=N : SP2 CARBON IN C=N</span>
1623 <span class="c">#</span>
<a name="_IsDoublyBondedToNitrogenSP2Carbon-"></a>1624 <span class="k">sub </span><span class="m">_IsDoublyBondedToNitrogenSP2Carbon</span> <span class="s">{</span>
1625   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1626 
1627   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1628 <span class="s">}</span>
1629 
1630 <span class="c"># CSP2 : GENERIC SP2 CARBON</span>
1631 <span class="c">#</span>
<a name="_IsGenericSP2Carbon-"></a>1632 <span class="k">sub </span><span class="m">_IsGenericSP2Carbon</span> <span class="s">{</span>
1633   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1634 
1635   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1636 <span class="s">}</span>
1637 
1638 <span class="c"># =C= : ALLENIC CARBON</span>
1639 <span class="c">#</span>
<a name="_IsAllenicCarbon-"></a>1640 <span class="k">sub </span><span class="m">_IsAllenicCarbon</span> <span class="s">{</span>
1641   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1642 
1643   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.X2.DB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1644 <span class="s">}</span>
1645 
1646 <span class="c"># C% : ISONITRILE CARBON ( R-N+#C- )</span>
1647 <span class="c">#</span>
<a name="_IsIsoNitrileCarbon-"></a>1648 <span class="k">sub </span><span class="m">_IsIsoNitrileCarbon</span> <span class="s">{</span>
1649   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1650 
1651   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.X1.TB1.FC-1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N.T2.TB1.FC+1&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;#&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1652 <span class="s">}</span>
1653 
1654 <span class="c"># CSP : ACETYLENIC CARBON</span>
1655 <span class="c">#</span>
<a name="_IsAcetylenicCarbon-"></a>1656 <span class="k">sub </span><span class="m">_IsAcetylenicCarbon</span> <span class="s">{</span>
1657   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1658 
1659   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T2.TB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;#&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1660 <span class="s">}</span>
1661 
1662 <span class="c"># Get MMFF94 atom type Nitrogen in five membered ring...</span>
1663 <span class="c">#</span>
1664 <span class="c"># Note:</span>
1665 <span class="c">#    . The method handles both SP3 and SP2 five membered ring Nitrogens.</span>
1666 <span class="c">#</span>
<a name="_GetAtomTypeForFiveMemberedRingNitrogen-"></a>1667 <span class="k">sub </span><span class="m">_GetAtomTypeForFiveMemberedRingNitrogen</span> <span class="s">{</span>
1668   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1669   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
1670 
1671   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
1672 
1673   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
1674 
1675     <span class="c"># NIM+ : IMIDAZOLIUM-TYPE NITROGEN - FORMAL CHARGE=1/2</span>
1676     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsImidazoliumNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1677       <span class="i">$AtomType</span> = <span class="q">&#39;NIM+&#39;</span><span class="sc">;</span>
1678       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1679     <span class="s">}</span>
1680 
1681     <span class="c"># N5A+ : POSITIVE N5A NITROGEN - FORMAL CHARGE=1</span>
1682     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPositivelyChargedFiveMemberedHeteroAromaticRingAlphaNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1683       <span class="i">$AtomType</span> = <span class="q">&#39;N5A+&#39;</span><span class="sc">;</span>
1684       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1685     <span class="s">}</span>
1686 
1687     <span class="c"># N5A : ALPHA AROM HETEROCYCLIC 5-RING  NITROGEN</span>
1688     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsFiveMemberedHeteroAromaticRingAlphaNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1689       <span class="i">$AtomType</span> = <span class="q">&#39;N5A&#39;</span><span class="sc">;</span>
1690       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1691     <span class="s">}</span>
1692 
1693     <span class="c"># N5B+ : POSITIVE N5B NITROGEN - FORMAL CHARGE=1</span>
1694     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPositivelyChargedFiveMemberedHeteroAromaticRingBetaNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1695       <span class="i">$AtomType</span> = <span class="q">&#39;N5B+&#39;</span><span class="sc">;</span>
1696       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1697     <span class="s">}</span>
1698 
1699     <span class="c"># N5B : BETA AROM HETEROCYCLIC 5-RING  NITROGEN</span>
1700     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsFiveMemberedHeteroAromaticRingBetaNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1701       <span class="i">$AtomType</span> = <span class="q">&#39;N5B&#39;</span><span class="sc">;</span>
1702       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1703     <span class="s">}</span>
1704 
1705     <span class="c"># N5AX : N-OXIDE NITROGEN IN 5-RING ALPHA POSITION</span>
1706     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNOxideFiveMemberedHeteroCyclicRingAlphaNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1707       <span class="i">$AtomType</span> = <span class="q">&#39;N5AX&#39;</span><span class="sc">;</span>
1708       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1709     <span class="s">}</span>
1710 
1711     <span class="c"># N5BX : N-OXIDE NITROGEN IN 5-RING BETA POSITION</span>
1712     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNOxideFiveMemberedHeteroCyclicRingBetaNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1713       <span class="i">$AtomType</span> = <span class="q">&#39;N5BX&#39;</span><span class="sc">;</span>
1714       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1715     <span class="s">}</span>
1716 
1717     <span class="c"># N5OX : N-OXIDE NITROGEN IN GENERAL 5-RING POSITION</span>
1718     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNOxideFiveMemberedHeteroCyclicRingNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1719       <span class="i">$AtomType</span> = <span class="q">&#39;N5OX&#39;</span><span class="sc">;</span>
1720       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1721     <span class="s">}</span>
1722 
1723     <span class="c"># N5M : NEGATIVELY CHARGED N IN, E.G, TRI- OR TETRAZOLE ANION</span>
1724     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNegativelyChargedFiveMemberedHeteroCyclicRingNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1725       <span class="i">$AtomType</span> = <span class="q">&#39;N5M&#39;</span><span class="sc">;</span>
1726       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1727     <span class="s">}</span>
1728 
1729     <span class="c"># N5+ : POSITIVE N5 NITROGEN - FORMAL CHARGE=1</span>
1730     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPositivelyChargedFiveMemberedHeteroCyclicRingNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1731       <span class="i">$AtomType</span> = <span class="q">&#39;N5+&#39;</span><span class="sc">;</span>
1732       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1733     <span class="s">}</span>
1734 
1735     <span class="c"># N5 : GENERAL NITROGEN IN 5-MEMBERED HETEROCYCLIC RING</span>
1736     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsFiveMemberedHeteroCyclicRingNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1737       <span class="i">$AtomType</span> = <span class="q">&#39;N5&#39;</span><span class="sc">;</span>
1738       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1739     <span class="s">}</span>
1740 
1741     <span class="i">$AtomType</span> = <span class="q">&#39;N5&#39;</span><span class="sc">;</span>
1742   <span class="s">}</span>
1743 
1744   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
1745 <span class="s">}</span>
1746 
1747 <span class="c"># Get MMFF94 atom type for Nitrogen with only sigma bonds...</span>
1748 <span class="c">#</span>
<a name="_GetAtomTypeForNitrogenWithOnlySigmaBonds-"></a>1749 <span class="k">sub </span><span class="m">_GetAtomTypeForNitrogenWithOnlySigmaBonds</span> <span class="s">{</span>
1750   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1751   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
1752 
1753   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
1754 
1755   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
1756 
1757     <span class="c"># NPYL : NITROGEN, AS IN PYRROLE</span>
1758     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPyrroleNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1759       <span class="i">$AtomType</span> = <span class="q">&#39;NPYL&#39;</span><span class="sc">;</span>
1760       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1761     <span class="s">}</span>
1762 
1763     <span class="c"># NC=O : NITROGEN IN AMIDES</span>
1764     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAmideNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1765       <span class="i">$AtomType</span> = <span class="q">&#39;NC=O&#39;</span><span class="sc">;</span>
1766       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1767     <span class="s">}</span>
1768 
1769     <span class="c"># NC=S : NITROGEN IN N-C=S, THIOAMIDE</span>
1770     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioAmideNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1771       <span class="i">$AtomType</span> = <span class="q">&#39;NC=S&#39;</span><span class="sc">;</span>
1772       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1773     <span class="s">}</span>
1774 
1775     <span class="c"># NN=C : NITROGEN IN N-N=C</span>
1776     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNNCNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1777       <span class="i">$AtomType</span> = <span class="q">&#39;NN=C&#39;</span><span class="sc">;</span>
1778       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1779     <span class="s">}</span>
1780 
1781     <span class="c"># NGD+ : GUANIDINIUM-TYPE NITROGEN - FORMAL CHARGE=1/3</span>
1782     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsGuanidiniumNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1783       <span class="i">$AtomType</span> = <span class="q">&#39;NGD+&#39;</span><span class="sc">;</span>
1784       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1785     <span class="s">}</span>
1786 
1787     <span class="c"># NCN+ :  N IN +N=C-N RESONANCE STRUCTURES - FORMAL CHARGE=1/2</span>
1788     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNCNResonaceStructuresNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1789       <span class="i">$AtomType</span> = <span class="q">&#39;NCN+&#39;</span><span class="sc">;</span>
1790       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1791     <span class="s">}</span>
1792 
1793     <span class="c"># NN=N : NITROGEN IN N-N=N</span>
1794     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNNNNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1795       <span class="i">$AtomType</span> = <span class="q">&#39;NN=N&#39;</span><span class="sc">;</span>
1796       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1797     <span class="s">}</span>
1798 
1799     <span class="c">#  NC=C : NITROGEN ON N-C=C</span>
1800     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNCCNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1801       <span class="i">$AtomType</span> = <span class="q">&#39;NC=C&#39;</span><span class="sc">;</span>
1802       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1803     <span class="s">}</span>
1804 
1805     <span class="c"># NC=N : NITROGEN IN N-C=N</span>
1806     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNCNNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1807       <span class="i">$AtomType</span> = <span class="q">&#39;NC=N&#39;</span><span class="sc">;</span>
1808       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1809     <span class="s">}</span>
1810 
1811     <span class="c"># NC=P : NITROGEN IN N-C=P</span>
1812     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNCPNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1813       <span class="i">$AtomType</span> = <span class="q">&#39;NC=P&#39;</span><span class="sc">;</span>
1814       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1815     <span class="s">}</span>
1816 
1817     <span class="c"># NM : DEPROTONATED SULFONAMIDE N-; FORMAL CHARGE=-1</span>
1818     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsDeprotonatedSulfonamideNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1819       <span class="i">$AtomType</span> = <span class="q">&#39;NM&#39;</span><span class="sc">;</span>
1820       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1821     <span class="s">}</span>
1822 
1823     <span class="c"># NSO2 : NITROGEN IN SULFONAMIDES</span>
1824     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNSO2SulfonamideNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1825       <span class="i">$AtomType</span> = <span class="q">&#39;NSO2&#39;</span><span class="sc">;</span>
1826       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1827     <span class="s">}</span>
1828 
1829     <span class="c"># NSO3 : NITROGEN IN SULFONAMIDES, THREE Os ON S</span>
1830     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNSO3SulfonamideNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1831       <span class="i">$AtomType</span> = <span class="q">&#39;NSO3&#39;</span><span class="sc">;</span>
1832       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1833     <span class="s">}</span>
1834 
1835     <span class="c"># NPO2 : NITROGEN IN PHOSPHONAMIDES</span>
1836     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNPO2PhosphonamideNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1837       <span class="i">$AtomType</span> = <span class="q">&#39;NPO2&#39;</span><span class="sc">;</span>
1838       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1839     <span class="s">}</span>
1840 
1841     <span class="c"># NPO3 : NITROGEN IN PHOSPHONAMIDES, THREE Os ON P</span>
1842     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNPO3PhosphonamideNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1843       <span class="i">$AtomType</span> = <span class="q">&#39;NPO3&#39;</span><span class="sc">;</span>
1844       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1845     <span class="s">}</span>
1846 
1847     <span class="c">#  NC%N : NITROGEN ATTACHED TO CYANO GROUP</span>
1848     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAttachedToCyanoNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1849       <span class="i">$AtomType</span> = <span class="q">&#39;NC%N&#39;</span><span class="sc">;</span>
1850       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1851     <span class="s">}</span>
1852 
1853     <span class="c"># N3OX : SP3-HYDRIDIZED N-OXIDE NITROGEN</span>
1854     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSP3NOxideNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1855       <span class="i">$AtomType</span> = <span class="q">&#39;N3OX&#39;</span><span class="sc">;</span>
1856       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1857     <span class="s">}</span>
1858 
1859     <span class="c">#  NC%C : NITROGEN ATTACHED TO C-C TRIPLE BOND</span>
1860     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAttchedToCCTripleBondNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1861       <span class="i">$AtomType</span> = <span class="q">&#39;NC%C&#39;</span><span class="sc">;</span>
1862       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1863     <span class="s">}</span>
1864 
1865     <span class="c"># NR : NITROGEN IN ALIPHATIC AMINES</span>
1866     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAliphaticAmineNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1867       <span class="i">$AtomType</span> = <span class="q">&#39;NR&#39;</span><span class="sc">;</span>
1868       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1869     <span class="s">}</span>
1870 
1871     <span class="c"># NR+ : QUATERNARY NITROGEN, SP3, POSITIVELY CHARGED</span>
1872     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAliphaticAmineQuaternaryNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1873       <span class="i">$AtomType</span> = <span class="q">&#39;NR+&#39;</span><span class="sc">;</span>
1874       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1875     <span class="s">}</span>
1876 
1877     <span class="i">$AtomType</span> = <span class="q">&#39;NR&#39;</span><span class="sc">;</span>
1878   <span class="s">}</span>
1879 
1880   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
1881 <span class="s">}</span>
1882 
1883 <span class="c"># Get MMFF94 atom type for Nitrogen with one pi bond...</span>
1884 <span class="c">#</span>
<a name="_GetAtomTypeForNitrogenWithOnePiBond-"></a>1885 <span class="k">sub </span><span class="m">_GetAtomTypeForNitrogenWithOnePiBond</span> <span class="s">{</span>
1886   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1887   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
1888 
1889   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
1890 
1891   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
1892 
1893     <span class="c"># NPOX : PYRIDINE N-OXIDE NITROGEN</span>
1894     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPyridineNOxideNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1895       <span class="i">$AtomType</span> = <span class="q">&#39;NPOX&#39;</span><span class="sc">;</span>
1896       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1897     <span class="s">}</span>
1898 
1899     <span class="c"># NPD+ : PYRIDINIUM-TYPE NITROGEN - FORMAL CHARGE=1</span>
1900     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPyridiniumNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1901       <span class="i">$AtomType</span> = <span class="q">&#39;NPD+&#39;</span><span class="sc">;</span>
1902       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1903     <span class="s">}</span>
1904 
1905     <span class="c"># NPYD : NITROGEN, AS IN PYRIDINE</span>
1906     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPyridineNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1907       <span class="i">$AtomType</span> = <span class="q">&#39;NPYD&#39;</span><span class="sc">;</span>
1908       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1909     <span class="s">}</span>
1910 
1911     <span class="c"># N2OX : SP2-HYDRIDIZED N-OXIDE NITROGEN</span>
1912     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSP2NOxideNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1913       <span class="i">$AtomType</span> = <span class="q">&#39;N2OX&#39;</span><span class="sc">;</span>
1914       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1915     <span class="s">}</span>
1916 
1917     <span class="c"># NAZT : TERMINAL NITROGEN IN AZIDO OR DIAZO GROUP</span>
1918     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNAZTNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1919       <span class="i">$AtomType</span> = <span class="q">&#39;NAZT&#39;</span><span class="sc">;</span>
1920       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1921     <span class="s">}</span>
1922 
1923     <span class="c"># NR% :  ISONITRILE NITROGEN [FC = 0] OR DIAZO NITROGEN [FC = 1]</span>
1924     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsIsoNitrileOrDiAzoNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1925       <span class="i">$AtomType</span> = <span class="q">&#39;NR%&#39;</span><span class="sc">;</span>
1926       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1927     <span class="s">}</span>
1928 
1929     <span class="c"># NGD+ : GUANIDINIUM-TYPE NITROGEN - FORMAL CHARGE=1/3</span>
1930     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsGuanidiniumNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1931       <span class="i">$AtomType</span> = <span class="q">&#39;NGD+&#39;</span><span class="sc">;</span>
1932       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1933     <span class="s">}</span>
1934 
1935     <span class="c"># NCN+ :  N IN +N=C-N RESONANCE STRUCTURES - FORMAL CHARGE=1/2</span>
1936     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNCNResonaceStructuresNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1937       <span class="i">$AtomType</span> = <span class="q">&#39;NCN+&#39;</span><span class="sc">;</span>
1938       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1939     <span class="s">}</span>
1940 
1941     <span class="c"># N=C : NITROGEN IN IMINES</span>
1942     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsImineNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1943       <span class="i">$AtomType</span> = <span class="q">&#39;N=C&#39;</span><span class="sc">;</span>
1944       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1945     <span class="s">}</span>
1946 
1947     <span class="c"># N+=C : POSITIVELY CHARGED IMINIUM NITROGEN</span>
1948     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPositivelyChargedIminiumNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1949       <span class="i">$AtomType</span> = <span class="q">&#39;N+=C&#39;</span><span class="sc">;</span>
1950       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1951     <span class="s">}</span>
1952 
1953     <span class="c"># N=N :  NITROGEN IN AZO COMPOUNDS</span>
1954     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAzoNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1955       <span class="i">$AtomType</span> = <span class="q">&#39;N=N&#39;</span><span class="sc">;</span>
1956       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1957     <span class="s">}</span>
1958 
1959     <span class="c"># N+=N : POSITIVELY CHARGED NITROGEN DOUBLE-BONDED TO N</span>
1960     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPositivelyChargedAzoNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1961       <span class="i">$AtomType</span> = <span class="q">&#39;N+=N&#39;</span><span class="sc">;</span>
1962       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1963     <span class="s">}</span>
1964 
1965     <span class="c"># NO2 : NITRO GROUP NITROGEN</span>
1966     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNitroNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1967       <span class="i">$AtomType</span> = <span class="q">&#39;NO2&#39;</span><span class="sc">;</span>
1968       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1969     <span class="s">}</span>
1970 
1971     <span class="c"># NO3 : NITRATE GROUP NITROGEN</span>
1972     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNitrateNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1973       <span class="i">$AtomType</span> = <span class="q">&#39;NO3&#39;</span><span class="sc">;</span>
1974       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1975     <span class="s">}</span>
1976 
1977     <span class="c"># N=O : NITROSO NITROGEN</span>
1978     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNitrosoNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1979       <span class="i">$AtomType</span> = <span class="q">&#39;N=O&#39;</span><span class="sc">;</span>
1980       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1981     <span class="s">}</span>
1982 
1983     <span class="c"># NSO : DIVALENT NITROGEN REPLACING MONOVALENT O IN SO2 GROUP</span>
1984     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNSONitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1985       <span class="i">$AtomType</span> = <span class="q">&#39;NSO&#39;</span><span class="sc">;</span>
1986       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
1987     <span class="s">}</span>
1988 
1989     <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
1990     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomTypeForNitrogenWithOnePiBond: MMFF94 atom type for Nitrogen cann&#39;t be assigned; Default MMFF94 atom type, $AtomType, has been assigned...\n&quot;</span><span class="sc">;</span>
1991   <span class="s">}</span>
1992 
1993   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
1994 <span class="s">}</span>
1995 
1996 <span class="c"># Get MMFF94 atom type for Nitrogen with two pi bonds...</span>
1997 <span class="c">#</span>
<a name="_GetAtomTypeForNitrogenWithTwoPiBonds-"></a>1998 <span class="k">sub </span><span class="m">_GetAtomTypeForNitrogenWithTwoPiBonds</span> <span class="s">{</span>
1999   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2000   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
2001 
2002   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
2003 
2004   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
2005 
2006     <span class="c"># NAZT : TERMINAL NITROGEN IN AZIDO OR DIAZO GROUP</span>
2007     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNAZTNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2008       <span class="i">$AtomType</span> = <span class="q">&#39;NAZT&#39;</span><span class="sc">;</span>
2009       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2010     <span class="s">}</span>
2011 
2012     <span class="c"># NR% :  ISONITRILE NITROGEN [FC = 0] OR DIAZO NITROGEN [FC = 1]</span>
2013     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsIsoNitrileOrDiAzoNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2014       <span class="i">$AtomType</span> = <span class="q">&#39;NR%&#39;</span><span class="sc">;</span>
2015       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2016     <span class="s">}</span>
2017 
2018     <span class="c">#  =N= : NITROGEN IN C=N=N OR -N=N=N</span>
2019     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsTwoDoublyBondedNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2020       <span class="i">$AtomType</span> = <span class="q">&#39;=N=&#39;</span><span class="sc">;</span>
2021       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2022     <span class="s">}</span>
2023 
2024     <span class="c"># NSP : NITROGEN, TRIPLE BONDED</span>
2025     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsTriplyBondedSPNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2026       <span class="i">$AtomType</span> = <span class="q">&#39;NSP&#39;</span><span class="sc">;</span>
2027       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2028     <span class="s">}</span>
2029 
2030     <span class="i">$AtomType</span> = <span class="q">&#39;NSP&#39;</span><span class="sc">;</span>
2031   <span class="s">}</span>
2032 
2033   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
2034 <span class="s">}</span>
2035 
2036 <span class="c"># NR : NITROGEN IN ALIPHATIC AMINES</span>
2037 <span class="c">#</span>
<a name="_IsAliphaticAmineNitrogen-"></a>2038 <span class="k">sub </span><span class="m">_IsAliphaticAmineNitrogen</span> <span class="s">{</span>
2039   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2040 
2041   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span><span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2042 <span class="s">}</span>
2043 
2044 <span class="c"># NR+ : QUATERNARY NITROGEN, SP3, POSITIVELY CHARGED</span>
2045 <span class="c">#</span>
<a name="_IsAliphaticAmineQuaternaryNitrogen-"></a>2046 <span class="k">sub </span><span class="m">_IsAliphaticAmineQuaternaryNitrogen</span> <span class="s">{</span>
2047   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2048 
2049   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T4.FC+1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span><span class="q">&#39;-&#39;</span><span class="cm">,</span><span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2050 <span class="s">}</span>
2051 
2052 <span class="c"># NC=O : NITROGEN IN AMIDES</span>
2053 <span class="c">#</span>
<a name="_IsAmideNitrogen-"></a>2054 <span class="k">sub </span><span class="m">_IsAmideNitrogen</span> <span class="s">{</span>
2055   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2056   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2057 
2058   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.TSB3&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2059     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2060   <span class="s">}</span>
2061 
2062   <span class="c"># Is it attached to amide carbonyl Carbon?</span>
2063   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2064     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAmideCarbonylCarbon</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2065       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2066     <span class="s">}</span>
2067   <span class="s">}</span>
2068   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2069 <span class="s">}</span>
2070 
2071 <span class="c"># NC=S : NITROGEN IN N-C=S, THIOAMIDE</span>
2072 <span class="c">#</span>
<a name="_IsThioAmideNitrogen-"></a>2073 <span class="k">sub </span><span class="m">_IsThioAmideNitrogen</span> <span class="s">{</span>
2074   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2075   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2076 
2077   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.TSB3&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2078     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2079   <span class="s">}</span>
2080 
2081   <span class="c"># Is it attached to thioamide Carbon?</span>
2082   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2083     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioAmideCarbon</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2084       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2085     <span class="s">}</span>
2086   <span class="s">}</span>
2087   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2088 <span class="s">}</span>
2089 
2090 <span class="c"># NN=C : NITROGEN IN N-N=C</span>
2091 <span class="c">#</span>
<a name="_IsNNCNitrogen-"></a>2092 <span class="k">sub </span><span class="m">_IsNNCNitrogen</span> <span class="s">{</span>
2093   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2094   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2095 
2096   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.TSB3&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2097     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2098   <span class="s">}</span>
2099 
2100   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;N.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2101     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T2.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C.T3&#39;</span><span class="cm">,</span> <span class="q">&#39;N.T3&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2102       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2103     <span class="s">}</span>
2104   <span class="s">}</span>
2105   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2106 <span class="s">}</span>
2107 
2108 <span class="c"># NN=N : NITROGEN IN N-N=N</span>
2109 <span class="c">#</span>
<a name="_IsNNNNitrogen-"></a>2110 <span class="k">sub </span><span class="m">_IsNNNNitrogen</span> <span class="s">{</span>
2111   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2112   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2113 
2114   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.TSB3&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2115     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2116   <span class="s">}</span>
2117 
2118   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;N.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2119     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T2.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N.T2&#39;</span><span class="cm">,</span> <span class="q">&#39;N.T3&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2120       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2121     <span class="s">}</span>
2122   <span class="s">}</span>
2123   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2124 <span class="s">}</span>
2125 
2126 <span class="c"># NPYD : NITROGEN, AS IN PYRIDINE</span>
2127 <span class="c">#</span>
<a name="_IsPyridineNitrogen-"></a>2128 <span class="k">sub </span><span class="m">_IsPyridineNitrogen</span> <span class="s">{</span>
2129   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2130 
2131   <span class="c"># Is it an aromatic Nitrogen in only one six membered ring?</span>
2132   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.Ar.RA6.TR1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2133     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2134   <span class="s">}</span>
2135 
2136   <span class="c"># Is it part of six membered ring containing only one hetero atom?</span>
2137   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="cm">,</span> <span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="s">)</span><span class="sc">;</span>
2138   <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetRingsWithSize</span><span class="s">(</span><span class="n">6</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2139     <span class="s">(</span><span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;_GetHeteroAtomsInformationInRing</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
2140     <span class="k">if</span> <span class="s">(</span><span class="i">$RingIsAromatic</span> &amp;&amp; <span class="i">$NumOfHeteroAtoms</span> == <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
2141       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2142     <span class="s">}</span>
2143   <span class="s">}</span>
2144   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2145 <span class="s">}</span>
2146 
2147 <span class="c"># NPYL : NITROGEN, AS IN PYRROLE</span>
2148 <span class="c">#</span>
<a name="_IsPyrroleNitrogen-"></a>2149 <span class="k">sub </span><span class="m">_IsPyrroleNitrogen</span> <span class="s">{</span>
2150   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2151 
2152   <span class="c"># Is it an aromatic Nitrogen in only one five membered ring?</span>
2153   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.Ar.RA5.TR1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2154     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2155   <span class="s">}</span>
2156 
2157   <span class="c"># Is it part of five membered ring containing only one hetero atom?</span>
2158   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="cm">,</span> <span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="s">)</span><span class="sc">;</span>
2159   <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetRingsWithSize</span><span class="s">(</span><span class="n">5</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2160     <span class="s">(</span><span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;_GetHeteroAtomsInformationInRing</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
2161     <span class="k">if</span> <span class="s">(</span><span class="i">$RingIsAromatic</span> &amp;&amp; <span class="i">$NumOfHeteroAtoms</span> == <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
2162       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2163     <span class="s">}</span>
2164   <span class="s">}</span>
2165   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2166 <span class="s">}</span>
2167 
2168 <span class="c">#  NC=C : NITROGEN ON N-C=C</span>
2169 <span class="c">#</span>
<a name="_IsNCCNitrogen-"></a>2170 <span class="k">sub </span><span class="m">_IsNCCNitrogen</span> <span class="s">{</span>
2171   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2172   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2173 
2174   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.TSB3&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2175     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2176   <span class="s">}</span>
2177 
2178   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2179     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C.T3&#39;</span><span class="cm">,</span> <span class="q">&#39;N.T3&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span><span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2180       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2181     <span class="s">}</span>
2182   <span class="s">}</span>
2183   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2184 <span class="s">}</span>
2185 
2186 <span class="c"># NC=N : NITROGEN IN N-C=N</span>
2187 <span class="c">#</span>
<a name="_IsNCNNitrogen-"></a>2188 <span class="k">sub </span><span class="m">_IsNCNNitrogen</span> <span class="s">{</span>
2189   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2190   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2191 
2192   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.TSB3&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2193     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2194   <span class="s">}</span>
2195 
2196   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2197     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N.T2&#39;</span><span class="cm">,</span> <span class="q">&#39;N.T3&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span><span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2198       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2199     <span class="s">}</span>
2200   <span class="s">}</span>
2201   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2202 <span class="s">}</span>
2203 
2204 <span class="c"># NC=P : NITROGEN IN N-C=P</span>
2205 <span class="c">#</span>
<a name="_IsNCPNitrogen-"></a>2206 <span class="k">sub </span><span class="m">_IsNCPNitrogen</span> <span class="s">{</span>
2207   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2208   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2209 
2210   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.TSB3&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2211     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2212   <span class="s">}</span>
2213 
2214   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2215     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;P.X1&#39;</span><span class="cm">,</span> <span class="q">&#39;N.T3&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2216       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2217     <span class="s">}</span>
2218   <span class="s">}</span>
2219   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2220 <span class="s">}</span>
2221 
2222 <span class="c">#  NC%C : NITROGEN ATTACHED TO C-C TRIPLE BOND</span>
2223 <span class="c">#</span>
<a name="_IsAttchedToCCTripleBondNitrogen-"></a>2224 <span class="k">sub </span><span class="m">_IsAttchedToCCTripleBondNitrogen</span> <span class="s">{</span>
2225   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2226   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2227 
2228   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.TSB3&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2229     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2230   <span class="s">}</span>
2231 
2232   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.TB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2233     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.X2.TB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C.T2&#39;</span><span class="cm">,</span> <span class="q">&#39;N.T3&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;#&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2234       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2235     <span class="s">}</span>
2236   <span class="s">}</span>
2237   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2238 <span class="s">}</span>
2239 
2240 <span class="c"># NSO2 : NITROGEN IN SULFONAMIDES</span>
2241 <span class="c">#</span>
<a name="_IsNSO2SulfonamideNitrogen-"></a>2242 <span class="k">sub </span><span class="m">_IsNSO2SulfonamideNitrogen</span> <span class="s">{</span>
2243   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2244   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2245 
2246   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.TSB3&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2247     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2248   <span class="s">}</span>
2249 
2250   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.T4.DB2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2251     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.T4.DB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2252       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2253     <span class="s">}</span>
2254   <span class="s">}</span>
2255   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2256 <span class="s">}</span>
2257 
2258 <span class="c"># NSO3 : NITROGEN IN SULFONAMIDES, THREE Os ON S</span>
2259 <span class="c">#</span>
<a name="_IsNSO3SulfonamideNitrogen-"></a>2260 <span class="k">sub </span><span class="m">_IsNSO3SulfonamideNitrogen</span> <span class="s">{</span>
2261   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2262   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2263 
2264   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.TSB3&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2265     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2266   <span class="s">}</span>
2267 
2268   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.T4.DB2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2269     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.X4.DB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2270       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2271     <span class="s">}</span>
2272   <span class="s">}</span>
2273   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2274 <span class="s">}</span>
2275 
2276 <span class="c"># NPO2 : NITROGEN IN PHOSPHONAMIDES</span>
2277 <span class="c">#</span>
<a name="_IsNPO2PhosphonamideNitrogen-"></a>2278 <span class="k">sub </span><span class="m">_IsNPO2PhosphonamideNitrogen</span> <span class="s">{</span>
2279   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2280   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2281 
2282   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.TSB3&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2283     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2284   <span class="s">}</span>
2285 
2286   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;P.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2287     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;P.T4.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2288       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2289     <span class="s">}</span>
2290   <span class="s">}</span>
2291   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2292 <span class="s">}</span>
2293 
2294 <span class="c"># NPO3 : NITROGEN IN PHOSPHONAMIDES, THREE Os ON P</span>
2295 <span class="c">#</span>
<a name="_IsNPO3PhosphonamideNitrogen-"></a>2296 <span class="k">sub </span><span class="m">_IsNPO3PhosphonamideNitrogen</span> <span class="s">{</span>
2297   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2298   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2299 
2300   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.TSB3&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2301     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2302   <span class="s">}</span>
2303 
2304   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;P.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2305     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;P.X4.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2306       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2307     <span class="s">}</span>
2308   <span class="s">}</span>
2309   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2310 <span class="s">}</span>
2311 
2312 <span class="c">#  NC%N : NITROGEN ATTACHED TO CYANO GROUP</span>
2313 <span class="c">#</span>
<a name="_IsAttachedToCyanoNitrogen-"></a>2314 <span class="k">sub </span><span class="m">_IsAttachedToCyanoNitrogen</span> <span class="s">{</span>
2315   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2316   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2317 
2318   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.TSB3&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2319     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2320   <span class="s">}</span>
2321 
2322   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.TB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2323     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T2.TB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;N&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;#&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2324       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2325     <span class="s">}</span>
2326   <span class="s">}</span>
2327   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2328 <span class="s">}</span>
2329 
2330 <span class="c"># NM : DEPROTONATED SULFONAMIDE N-; FORMAL CHARGE=-1</span>
2331 <span class="c">#</span>
<a name="_IsDeprotonatedSulfonamideNitrogen-"></a>2332 <span class="k">sub </span><span class="m">_IsDeprotonatedSulfonamideNitrogen</span> <span class="s">{</span>
2333   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2334   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2335 
2336   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T2.FC-1.TSB2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2337     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2338   <span class="s">}</span>
2339 
2340   <span class="c"># Is it attached to sulfonamide Sulfur?</span>
2341   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.T4.DB2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2342     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfonamideSulfur</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2343       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2344     <span class="s">}</span>
2345   <span class="s">}</span>
2346   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2347 <span class="s">}</span>
2348 
2349 <span class="c"># N=C : NITROGEN IN IMINES</span>
2350 <span class="c">#</span>
<a name="_IsImineNitrogen-"></a>2351 <span class="k">sub </span><span class="m">_IsImineNitrogen</span> <span class="s">{</span>
2352   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2353 
2354   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T2.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2355 <span class="s">}</span>
2356 
2357 <span class="c"># N+=C : POSITIVELY CHARGED IMINIUM NITROGEN</span>
2358 <span class="c">#</span>
<a name="_IsPositivelyChargedIminiumNitrogen-"></a>2359 <span class="k">sub </span><span class="m">_IsPositivelyChargedIminiumNitrogen</span> <span class="s">{</span>
2360   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2361 
2362   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.DB1.FC+1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2363 <span class="s">}</span>
2364 
2365 <span class="c"># N=N :  NITROGEN IN AZO COMPOUNDS</span>
2366 <span class="c">#</span>
<a name="_IsAzoNitrogen-"></a>2367 <span class="k">sub </span><span class="m">_IsAzoNitrogen</span> <span class="s">{</span>
2368   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2369 
2370   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T2.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2371 <span class="s">}</span>
2372 
2373 <span class="c"># N+=N : POSITIVELY CHARGED NITROGEN DOUBLE-BONDED TO N</span>
2374 <span class="c">#</span>
<a name="_IsPositivelyChargedAzoNitrogen-"></a>2375 <span class="k">sub </span><span class="m">_IsPositivelyChargedAzoNitrogen</span> <span class="s">{</span>
2376   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2377 
2378   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.DB1.FC+1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2379 <span class="s">}</span>
2380 
2381 <span class="c"># NO2 : NITRO GROUP NITROGEN</span>
2382 <span class="c">#</span>
<a name="_IsNitroNitrogen-"></a>2383 <span class="k">sub </span><span class="m">_IsNitroNitrogen</span> <span class="s">{</span>
2384   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2385 
2386   <span class="c"># R-N+(=O)-(O-)</span>
2387   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.DB1.FC+1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O.FC-1&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2388 <span class="s">}</span>
2389 
2390 <span class="c"># NO3 : NITRATE GROUP NITROGEN</span>
2391 <span class="c">#</span>
<a name="_IsNitrateNitrogen-"></a>2392 <span class="k">sub </span><span class="m">_IsNitrateNitrogen</span> <span class="s">{</span>
2393   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2394 
2395   <span class="c"># (O-)-N+(=O)-(O-) or R-O-N+(=O)-(O-)</span>
2396   <span class="c">#</span>
2397   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.DB1.FC+1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O.FC-1&#39;</span><span class="cm">,</span> <span class="q">&#39;O.T2.FC0&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2398 <span class="s">}</span>
2399 
2400 <span class="c"># N=O : NITROSO NITROGEN</span>
2401 <span class="c">#</span>
<a name="_IsNitrosoNitrogen-"></a>2402 <span class="k">sub </span><span class="m">_IsNitrosoNitrogen</span> <span class="s">{</span>
2403   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2404 
2405   <span class="c"># R-N=O</span>
2406   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T2.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2407 <span class="s">}</span>
2408 
2409 <span class="c"># NAZT : TERMINAL NITROGEN IN AZIDO OR DIAZO GROUP</span>
2410 <span class="c">#</span>
<a name="_IsNAZTNitrogen-"></a>2411 <span class="k">sub </span><span class="m">_IsNAZTNitrogen</span> <span class="s">{</span>
2412   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2413 
2414   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAzidoTerminalNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span> || <span class="i">$This</span><span class="i">-&gt;_IsDiazoTerminalNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2415 <span class="s">}</span>
2416 
2417 <span class="c"># TERMINAL NITROGEN IN AZIDO GROUP</span>
2418 <span class="c">#</span>
<a name="_IsAzidoTerminalNitrogen-"></a>2419 <span class="k">sub </span><span class="m">_IsAzidoTerminalNitrogen</span> <span class="s">{</span>
2420   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2421   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2422 
2423   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X1.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2424     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2425   <span class="s">}</span>
2426 
2427   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;N.DB2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2428     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAzidoGroupMiddleNitrogen</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2429       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2430     <span class="s">}</span>
2431   <span class="s">}</span>
2432   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2433 <span class="s">}</span>
2434 
2435 <span class="c"># TERMINAL NITROGEN IN  DIAZO GROUP</span>
2436 <span class="c">#</span>
<a name="_IsDiazoTerminalNitrogen-"></a>2437 <span class="k">sub </span><span class="m">_IsDiazoTerminalNitrogen</span> <span class="s">{</span>
2438   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2439   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2440 
2441   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X1.TB1,N.X1.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2442     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2443   <span class="s">}</span>
2444 
2445   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;N.DB2,N.TB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2446     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsDiazoGroupMiddleNitrogen</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2447       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2448     <span class="s">}</span>
2449   <span class="s">}</span>
2450   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2451 <span class="s">}</span>
2452 
2453 <span class="c"># Azido group: R-N=N+=N-</span>
2454 <span class="c">#</span>
<a name="_IsAzidoGroupMiddleNitrogen-"></a>2455 <span class="k">sub </span><span class="m">_IsAzidoGroupMiddleNitrogen</span> <span class="s">{</span>
2456   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2457 
2458   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X2.DB2.FC+1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N.X1.FC-1&#39;</span><span class="cm">,</span> <span class="q">&#39;N.T2.FC0&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2459 <span class="s">}</span>
2460 
2461 <span class="c"># Diazo group: R&#39;-(C-)(-R&quot;)-(N+)#N or R&#39;-C(-R&quot;)=(N+)=(N-)</span>
2462 <span class="c">#</span>
<a name="_IsDiazoGroupMiddleNitrogen-"></a>2463 <span class="k">sub </span><span class="m">_IsDiazoGroupMiddleNitrogen</span> <span class="s">{</span>
2464   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2465 
2466   <span class="c"># Diazo group: R&#39;-C(-R&quot;)=(N+)=(N-)</span>
2467   <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X2.DB2.FC+1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C.T3.FC0&#39;</span><span class="cm">,</span> <span class="q">&#39;N.X1.FC-1&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2468     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2469   <span class="s">}</span>
2470 
2471   <span class="c"># Diazo group: R&#39;-(C-)(-R&quot;)-(N+)#N</span>
2472   <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X2.TB1.FC+1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C.T3.FC-1&#39;</span><span class="cm">,</span> <span class="q">&#39;N.X1.FC0&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;#&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2473     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2474   <span class="s">}</span>
2475 
2476   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2477 <span class="s">}</span>
2478 
2479 <span class="c"># NSO : DIVALENT NITROGEN REPLACING MONOVALENT O IN SO2 GROUP</span>
2480 <span class="c">#</span>
<a name="_IsNSONitrogen-"></a>2481 <span class="k">sub </span><span class="m">_IsNSONitrogen</span> <span class="s">{</span>
2482   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2483   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2484 
2485   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T2.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2486     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2487   <span class="s">}</span>
2488 
2489   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.DB2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2490     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.DB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2491       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2492     <span class="s">}</span>
2493   <span class="s">}</span>
2494   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2495 <span class="s">}</span>
2496 
2497 <span class="c"># NCN+ :  N IN +N=C-N RESONANCE STRUCTURES - FORMAL CHARGE=1/2</span>
2498 <span class="c">#</span>
2499 <span class="c"># Notes:</span>
2500 <span class="c">#    . This method is called invoked for both SP and SP2 Nitrogens to check and assign</span>
2501 <span class="c">#      NCN+ to both Nitrogens.</span>
2502 <span class="c">#</span>
<a name="_IsNCNResonaceStructuresNitrogen-"></a>2503 <span class="k">sub </span><span class="m">_IsNCNResonaceStructuresNitrogen</span> <span class="s">{</span>
2504   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2505   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2506 
2507   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2508     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2509   <span class="s">}</span>
2510 
2511   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2512     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNCNResonaceStructuresCarbon</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2513       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2514     <span class="s">}</span>
2515   <span class="s">}</span>
2516   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2517 <span class="s">}</span>
2518 
2519 <span class="c"># NGD+ : GUANIDINIUM-TYPE NITROGEN - FORMAL CHARGE=1/3</span>
2520 <span class="c">#</span>
2521 <span class="c"># Notes:</span>
2522 <span class="c">#    . This method is called invoked for both SP and SP2 Nitrogens to check and assign</span>
2523 <span class="c">#      NGD+ to all three Guanidinium Nitrogens.</span>
2524 <span class="c">#</span>
<a name="_IsGuanidiniumNitrogen-"></a>2525 <span class="k">sub </span><span class="m">_IsGuanidiniumNitrogen</span> <span class="s">{</span>
2526   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2527   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2528 
2529   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2530     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2531   <span class="s">}</span>
2532 
2533   <span class="c"># Is it attached to Guandinium Carbon?</span>
2534   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2535     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsGuandiniumCarbon</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2536       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2537     <span class="s">}</span>
2538   <span class="s">}</span>
2539   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2540 <span class="s">}</span>
2541 
2542 <span class="c"># NPD+ : PYRIDINIUM-TYPE NITROGEN - FORMAL CHARGE=1</span>
2543 <span class="c">#</span>
<a name="_IsPyridiniumNitrogen-"></a>2544 <span class="k">sub </span><span class="m">_IsPyridiniumNitrogen</span> <span class="s">{</span>
2545   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2546 
2547   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPyridineNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span> &amp;&amp; <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.FC+1&#39;</span><span class="s">)</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2548 <span class="s">}</span>
2549 
2550 <span class="c"># NR% :  ISONITRILE NITROGEN [FC = 0] OR DIAZO NITROGEN [FC = 1]</span>
2551 <span class="c">#</span>
2552 <span class="c"># Notes:</span>
2553 <span class="c">#    . This method is called invoked for both SP and SP2 Nitrogens to check and assign</span>
2554 <span class="c">#      NR%.</span>
2555 <span class="c">#</span>
<a name="_IsIsoNitrileOrDiAzoNitrogen-"></a>2556 <span class="k">sub </span><span class="m">_IsIsoNitrileOrDiAzoNitrogen</span> <span class="s">{</span>
2557   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2558 
2559   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsIsoNitrileNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span> || <span class="i">$This</span><span class="i">-&gt;_IsDiAzoNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2560 <span class="s">}</span>
2561 
2562 <span class="c"># Isonitrile nitrogen: R-N+#C-</span>
2563 <span class="c">#</span>
2564 <span class="c"># Notes:</span>
2565 <span class="c">#    . MayaChemTools assumes isonitrile Nitrogen to have a formal charge of +1; otherwise</span>
2566 <span class="c">#      it won&#39;t be an isonitrile group. It&#39;s not clear why it would be zero as indicated in</span>
2567 <span class="c">#      MMFF documentation.</span>
2568 <span class="c">#</span>
<a name="_IsIsoNitrileNitrogen-"></a>2569 <span class="k">sub </span><span class="m">_IsIsoNitrileNitrogen</span> <span class="s">{</span>
2570   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2571   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2572 
2573   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.FC+1.TB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2574     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2575   <span class="s">}</span>
2576 
2577   <span class="c"># Is it attached to isonitrile Carbon?</span>
2578   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.TB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2579     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsIsoNitrileCarbon</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2580       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2581     <span class="s">}</span>
2582   <span class="s">}</span>
2583   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2584 <span class="s">}</span>
2585 
2586 <span class="c"># Diazo group: R1-(C-)(-R2)-(N+)#N or R1-C(-R2)=(N+)=(N-)</span>
2587 <span class="c">#</span>
<a name="_IsDiAzoNitrogen-"></a>2588 <span class="k">sub </span><span class="m">_IsDiAzoNitrogen</span> <span class="s">{</span>
2589   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2590   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2591 
2592   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsDiazoGroupMiddleNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2593 <span class="s">}</span>
2594 
2595 <span class="c"># N5A : ALPHA AROM HETEROCYCLIC 5-RING  NITROGEN</span>
2596 <span class="c">#</span>
<a name="_IsFiveMemberedHeteroAromaticRingAlphaNitrogen-"></a>2597 <span class="k">sub </span><span class="m">_IsFiveMemberedHeteroAromaticRingAlphaNitrogen</span> <span class="s">{</span>
2598   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2599 
2600   <span class="c"># Is it an aromatic atom in a five membered ring?</span>
2601   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.Ar.RA5.FC0&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2602     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2603   <span class="s">}</span>
2604 
2605   <span class="c"># Is it part of five membered rings containing hetero atom at alpha position?</span>
2606   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
2607 
2608   <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetRingsWithSize</span><span class="s">(</span><span class="n">5</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2609     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAtomPositionAlphaInHeteroAromaticRing</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2610       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2611     <span class="s">}</span>
2612   <span class="s">}</span>
2613   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2614 <span class="s">}</span>
2615 
2616 <span class="c"># N5B : BETA AROM HETEROCYCLIC 5-RING  NITROGEN</span>
2617 <span class="c">#</span>
<a name="_IsFiveMemberedHeteroAromaticRingBetaNitrogen-"></a>2618 <span class="k">sub </span><span class="m">_IsFiveMemberedHeteroAromaticRingBetaNitrogen</span> <span class="s">{</span>
2619   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2620 
2621   <span class="c"># Is it an aromatic atom in a five membered ring?</span>
2622   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.Ar.RA5.FC0&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2623     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2624   <span class="s">}</span>
2625 
2626   <span class="c"># Is it part of five membered rings containing hetero atom at beta position?</span>
2627   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
2628 
2629   <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetRingsWithSize</span><span class="s">(</span><span class="n">5</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2630     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAtomPositionBetaInHeteroAromaticRing</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2631       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2632     <span class="s">}</span>
2633   <span class="s">}</span>
2634   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2635 <span class="s">}</span>
2636 
2637 <span class="c"># N5A+ : POSITIVE N5A NITROGEN - FORMAL CHARGE=1</span>
2638 <span class="c">#</span>
<a name="_IsPositivelyChargedFiveMemberedHeteroAromaticRingAlphaNitrogen-"></a>2639 <span class="k">sub </span><span class="m">_IsPositivelyChargedFiveMemberedHeteroAromaticRingAlphaNitrogen</span> <span class="s">{</span>
2640   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2641 
2642   <span class="c"># Is it an aromatic atom in a five membered ring?</span>
2643   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.Ar.RA5.FC+1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2644     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2645   <span class="s">}</span>
2646 
2647   <span class="c"># Is it part of five membered rings containing hetero atom at alpha position?</span>
2648   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
2649 
2650   <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetRingsWithSize</span><span class="s">(</span><span class="n">5</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2651     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAtomPositionAlphaInHeteroAromaticRing</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2652       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2653     <span class="s">}</span>
2654   <span class="s">}</span>
2655   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2656 <span class="s">}</span>
2657 
2658 <span class="c"># N5B+ : POSITIVE N5B NITROGEN - FORMAL CHARGE=1</span>
2659 <span class="c">#</span>
<a name="_IsPositivelyChargedFiveMemberedHeteroAromaticRingBetaNitrogen-"></a>2660 <span class="k">sub </span><span class="m">_IsPositivelyChargedFiveMemberedHeteroAromaticRingBetaNitrogen</span> <span class="s">{</span>
2661   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2662 
2663   <span class="c"># Is it an aromatic atom in a five membered ring?</span>
2664   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.Ar.RA5.FC+1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2665     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2666   <span class="s">}</span>
2667 
2668   <span class="c"># Is it part of five membered rings containing hetero atom at beta position?</span>
2669   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
2670 
2671   <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetRingsWithSize</span><span class="s">(</span><span class="n">5</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2672     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAtomPositionBetaInHeteroAromaticRing</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2673       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2674     <span class="s">}</span>
2675   <span class="s">}</span>
2676   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2677 <span class="s">}</span>
2678 
2679 <span class="c"># N2OX : SP2-HYDRIDIZED N-OXIDE NITROGEN</span>
2680 <span class="c">#</span>
<a name="_IsSP2NOxideNitrogen-"></a>2681 <span class="k">sub </span><span class="m">_IsSP2NOxideNitrogen</span> <span class="s">{</span>
2682   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2683 
2684   <span class="c"># R=(R&#39;-)(N+)-(O-)</span>
2685   <span class="c">#</span>
2686   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.FC+1.DB1.T3&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O.X1.FC-1&#39;</span><span class="cm">,</span> <span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2687 <span class="s">}</span>
2688 
2689 <span class="c"># N3OX : SP3-HYDRIDIZED N-OXIDE NITROGEN</span>
2690 <span class="c">#</span>
<a name="_IsSP3NOxideNitrogen-"></a>2691 <span class="k">sub </span><span class="m">_IsSP3NOxideNitrogen</span> <span class="s">{</span>
2692   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2693 
2694   <span class="c"># R-(R&#39;-)(R&quot;-)(N+)-(O-)</span>
2695   <span class="c">#</span>
2696   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.FC+1.T4&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O.X1.FC-1&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2697 <span class="s">}</span>
2698 
2699 <span class="c"># NPOX : PYRIDINE N-OXIDE NITROGEN</span>
2700 <span class="c">#</span>
<a name="_IsPyridineNOxideNitrogen-"></a>2701 <span class="k">sub </span><span class="m">_IsPyridineNOxideNitrogen</span> <span class="s">{</span>
2702   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2703 
2704   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPyridineNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span> &amp;&amp; <span class="i">$This</span><span class="i">-&gt;_IsSP2NOxideNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2705 <span class="s">}</span>
2706 
2707 <span class="c"># N5M : NEGATIVELY CHARGED N IN, E.G, TRI- OR TETRAZOLE ANION</span>
2708 <span class="c">#</span>
<a name="_IsNegativelyChargedFiveMemberedHeteroCyclicRingNitrogen-"></a>2709 <span class="k">sub </span><span class="m">_IsNegativelyChargedFiveMemberedHeteroCyclicRingNitrogen</span> <span class="s">{</span>
2710   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2711 
2712   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.RA5.FC-1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2713 <span class="s">}</span>
2714 
2715 <span class="c"># N5 : GENERAL NITROGEN IN 5-MEMBERED HETEROCYCLIC RING</span>
2716 <span class="c">#</span>
<a name="_IsFiveMemberedHeteroCyclicRingNitrogen-"></a>2717 <span class="k">sub </span><span class="m">_IsFiveMemberedHeteroCyclicRingNitrogen</span> <span class="s">{</span>
2718   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2719 
2720   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.RA5&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2721 <span class="s">}</span>
2722 
2723 <span class="c"># N5+ : POSITIVE N5 NITROGEN - FORMAL CHARGE=1</span>
2724 <span class="c">#</span>
<a name="_IsPositivelyChargedFiveMemberedHeteroCyclicRingNitrogen-"></a>2725 <span class="k">sub </span><span class="m">_IsPositivelyChargedFiveMemberedHeteroCyclicRingNitrogen</span> <span class="s">{</span>
2726   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2727 
2728   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.RA5.FC+1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2729 <span class="s">}</span>
2730 
2731 <span class="c"># N5AX : N-OXIDE NITROGEN IN 5-RING ALPHA POSITION</span>
2732 <span class="c">#</span>
<a name="_IsNOxideFiveMemberedHeteroCyclicRingAlphaNitrogen-"></a>2733 <span class="k">sub </span><span class="m">_IsNOxideFiveMemberedHeteroCyclicRingAlphaNitrogen</span> <span class="s">{</span>
2734   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2735 
2736   <span class="c"># Is it a N-oxide Nitrogen atom in a five membered ring?</span>
2737   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.RA5.FC+1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O.X1.FC-1.!RA&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2738     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2739   <span class="s">}</span>
2740 
2741   <span class="c"># Is it part of five membered rings containing hetero atom at alpha position?</span>
2742   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
2743 
2744   <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetRingsWithSize</span><span class="s">(</span><span class="n">5</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2745     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAtomPositionAlphaInHeteroRing</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2746       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2747     <span class="s">}</span>
2748   <span class="s">}</span>
2749   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2750 <span class="s">}</span>
2751 
2752 <span class="c"># N5BX : N-OXIDE NITROGEN IN 5-RING BETA POSITION</span>
2753 <span class="c">#</span>
<a name="_IsNOxideFiveMemberedHeteroCyclicRingBetaNitrogen-"></a>2754 <span class="k">sub </span><span class="m">_IsNOxideFiveMemberedHeteroCyclicRingBetaNitrogen</span> <span class="s">{</span>
2755   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2756 
2757   <span class="c"># Is it a N-oxide Nitrogen atom in a five membered ring?</span>
2758   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.RA5.FC+1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O.X1.FC-1.!RA&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2759     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2760   <span class="s">}</span>
2761 
2762   <span class="c"># Is it part of five membered rings containing hetero atom at alpha position?</span>
2763   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
2764 
2765   <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetRingsWithSize</span><span class="s">(</span><span class="n">5</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2766     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAtomPositionBetaInHeteroRing</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2767       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2768     <span class="s">}</span>
2769   <span class="s">}</span>
2770   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2771 <span class="s">}</span>
2772 
2773 <span class="c"># N5OX : N-OXIDE NITROGEN IN GENERAL 5-RING POSITION</span>
2774 <span class="c">#</span>
<a name="_IsNOxideFiveMemberedHeteroCyclicRingNitrogen-"></a>2775 <span class="k">sub </span><span class="m">_IsNOxideFiveMemberedHeteroCyclicRingNitrogen</span> <span class="s">{</span>
2776   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2777 
2778   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.FC+1.RA5&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O.X1.FC-1.!RA&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2779 <span class="s">}</span>
2780 
2781 <span class="c"># NIM+ : IMIDAZOLIUM-TYPE NITROGEN - FORMAL CHARGE=1/2</span>
2782 <span class="c">#</span>
2783 <span class="c"># Notes:</span>
2784 <span class="c">#    . MayaChemTools assigns NIM+ to both the Nitrogens around Imidazolium Carbon.</span>
2785 <span class="c">#</span>
<a name="_IsImidazoliumNitrogen-"></a>2786 <span class="k">sub </span><span class="m">_IsImidazoliumNitrogen</span> <span class="s">{</span>
2787   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2788   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2789 
2790   <span class="c"># Is it an aromatic Nitrogen in only one five membered ring?</span>
2791   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.Ar.RA5.TR1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2792     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2793   <span class="s">}</span>
2794 
2795   <span class="c"># Is it attached to Imidazolium Carbon?</span>
2796   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.RA5&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2797     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsImidazoliumCarbon</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2798       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2799     <span class="s">}</span>
2800   <span class="s">}</span>
2801   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2802 <span class="s">}</span>
2803 
2804 <span class="c"># =N= : NITROGEN IN C=N=N OR -N=N=N</span>
2805 <span class="c">#</span>
2806 <span class="c"># Notes:</span>
2807 <span class="c">#    . MayaChemTools assign =N= to all doubly bonded Nitrogen atoms</span>
2808 <span class="c">#      irrespective of whether it has explcit formal charge of +1.</span>
2809 <span class="c">#</span>
<a name="_IsTwoDoublyBondedNitrogen-"></a>2810 <span class="k">sub </span><span class="m">_IsTwoDoublyBondedNitrogen</span> <span class="s">{</span>
2811   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2812 
2813   <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.DB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;N&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2814     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2815   <span class="s">}</span>
2816   <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.DB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;N&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2817     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2818   <span class="s">}</span>
2819   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2820 <span class="s">}</span>
2821 
2822 <span class="c"># NSP : NITROGEN, TRIPLE BONDED</span>
2823 <span class="c">#</span>
<a name="_IsTriplyBondedSPNitrogen-"></a>2824 <span class="k">sub </span><span class="m">_IsTriplyBondedSPNitrogen</span> <span class="s">{</span>
2825   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2826 
2827   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.TB1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2828 <span class="s">}</span>
2829 
2830 
2831 <span class="c"># Get MMFF94 atom type for divalent or terminal Oxygen attached to Sulfur...</span>
2832 <span class="c">#</span>
<a name="_GetAtomTypeForOxygenAttachedToSulfur-"></a>2833 <span class="k">sub </span><span class="m">_GetAtomTypeForOxygenAttachedToSulfur</span> <span class="s">{</span>
2834   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2835   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
2836 
2837   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
2838 
2839   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
2840 
2841     <span class="c"># OSMS : TERM O IN THIOSULFINATE ANION - FORMAL CHARGE=-0.5</span>
2842     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioSulfinateTerminalOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2843       <span class="i">$AtomType</span> = <span class="q">&#39;OSMS&#39;</span><span class="sc">;</span>
2844       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2845     <span class="s">}</span>
2846 
2847     <span class="c"># OSO3 : DIVALENT OXYGEN ATTACHED TO SULFUR</span>
2848     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsOSO3DivalentOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2849       <span class="i">$AtomType</span> = <span class="q">&#39;OSO3&#39;</span><span class="sc">;</span>
2850       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2851     <span class="s">}</span>
2852 
2853     <span class="c"># OSO2 : DIVALENT OXYGEN ATTACHED TO SULFUR</span>
2854     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsOSO2DivalentOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2855       <span class="i">$AtomType</span> = <span class="q">&#39;OSO2&#39;</span><span class="sc">;</span>
2856       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2857     <span class="s">}</span>
2858 
2859     <span class="c"># OSO : DIVALENT OXYGEN ATTACHED TO SULFUR</span>
2860     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsOSODivalentOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2861       <span class="i">$AtomType</span> = <span class="q">&#39;OSO&#39;</span><span class="sc">;</span>
2862       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2863     <span class="s">}</span>
2864 
2865     <span class="c"># OS=O : DIVALENT OXYGEN ATTACHED TO SULFOXIDE SULFUR</span>
2866     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfoxideDivalentOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2867       <span class="i">$AtomType</span> = <span class="q">&#39;OS=O&#39;</span><span class="sc">;</span>
2868       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2869     <span class="s">}</span>
2870 
2871     <span class="c"># -OS : GENERAL DIVALENT OXYGEN ATTACHED TO S</span>
2872     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsOSDivalentOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2873       <span class="i">$AtomType</span> = <span class="q">&#39; -OS&#39;</span><span class="sc">;</span>
2874       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2875     <span class="s">}</span>
2876 
2877     <span class="c"># O4S : TERMINAL O IN SO4(-3)</span>
2878     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfateTerminalOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2879       <span class="i">$AtomType</span> = <span class="q">&#39;O4S&#39;</span><span class="sc">;</span>
2880       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2881     <span class="s">}</span>
2882 
2883     <span class="c"># O3S : TERMINAL O IN SULFONATES</span>
2884     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfonateTerminalOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2885       <span class="i">$AtomType</span> = <span class="q">&#39;O3S&#39;</span><span class="sc">;</span>
2886       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2887     <span class="s">}</span>
2888 
2889     <span class="c"># O2S : TERMINAL O-S IN SULFONES AND SULFONAMIDES</span>
2890     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfoneOrSulfonamideTerminalOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2891       <span class="i">$AtomType</span> = <span class="q">&#39;O2S&#39;</span><span class="sc">;</span>
2892       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2893     <span class="s">}</span>
2894 
2895     <span class="c"># O=S : O=S IN SULFOXIDES</span>
2896     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfoxideOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2897       <span class="i">$AtomType</span> = <span class="q">&#39;O=S&#39;</span><span class="sc">;</span>
2898       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2899     <span class="s">}</span>
2900 
2901     <span class="c"># O=S= :  O=S ON SULFUR DOUBLY BONDED TO, E.G., CARBON</span>
2902     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsDoublyBondedOSOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2903       <span class="i">$AtomType</span> = <span class="q">&#39;O=S=&#39;</span><span class="sc">;</span>
2904       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2905     <span class="s">}</span>
2906 
2907     <span class="c"># O-S : SINGLE TERMINAL OXYGEN ON TETRACOORD SULFUR</span>
2908     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsOSTerminalOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2909       <span class="i">$AtomType</span> = <span class="q">&#39;O-S&#39;</span><span class="sc">;</span>
2910       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2911     <span class="s">}</span>
2912 
2913     <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
2914     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomTypeForOxygenAttachedToSulfur: MMFF94 atom type for Oxygen cann&#39;t be assigned...&quot;</span><span class="sc">;</span>
2915   <span class="s">}</span>
2916 
2917   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
2918 <span class="s">}</span>
2919 
2920 <span class="c"># Get MMFF94 atom type for divalent or terminal Oxygen attached to Phosphorus...</span>
2921 <span class="c">#</span>
<a name="_GetAtomTypeForOxygenAttachedToPhosphorus-"></a>2922 <span class="k">sub </span><span class="m">_GetAtomTypeForOxygenAttachedToPhosphorus</span> <span class="s">{</span>
2923   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2924   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
2925 
2926   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
2927 
2928   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
2929 
2930     <span class="c"># OPO3 : DIVALENT OXYGEN ATTACHED TO PHOSPHOROUS</span>
2931     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsOPO3DivalentOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2932       <span class="i">$AtomType</span> = <span class="q">&#39;OPO3&#39;</span><span class="sc">;</span>
2933       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2934     <span class="s">}</span>
2935 
2936     <span class="c"># OPO2 : DIVALENT OXYGEN ATTACHED TO PHOSPHOROUS</span>
2937     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsOPO2DivalentOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2938       <span class="i">$AtomType</span> = <span class="q">&#39;OPO2&#39;</span><span class="sc">;</span>
2939       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2940     <span class="s">}</span>
2941 
2942     <span class="c"># OPO : DIVALENT OXYGEN ATTACHED TO PHOSPHOROUS</span>
2943     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsOPODivalentOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2944       <span class="i">$AtomType</span> = <span class="q">&#39;OPO&#39;</span><span class="sc">;</span>
2945       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2946     <span class="s">}</span>
2947 
2948     <span class="c"># -OP : DIVALENT OXYGEN ATTACHED TO PHOSPHOROUS</span>
2949     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsOPDivalentOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2950       <span class="i">$AtomType</span> = <span class="q">&#39;-OP&#39;</span><span class="sc">;</span>
2951       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2952     <span class="s">}</span>
2953 
2954     <span class="c"># O4P : TERMINAL OXYGEN IN PHOSPHATES AND PHOSPHODIESTERS</span>
2955     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPhosphateOrPhosphodiesterTerminalOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2956       <span class="i">$AtomType</span> = <span class="q">&#39;O4P&#39;</span><span class="sc">;</span>
2957       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2958     <span class="s">}</span>
2959 
2960     <span class="c"># O3P : TERMINAL OXYGEN IN PHOSPHONATES</span>
2961     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPhosphonateTerminalOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2962       <span class="i">$AtomType</span> = <span class="q">&#39;O3P&#39;</span><span class="sc">;</span>
2963       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2964     <span class="s">}</span>
2965 
2966     <span class="c"># O2P : TERMINAL O IN PHOSPHINATES</span>
2967     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPhosphinateTerminalOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2968       <span class="i">$AtomType</span> = <span class="q">&#39;O2P&#39;</span><span class="sc">;</span>
2969       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2970     <span class="s">}</span>
2971 
2972     <span class="c"># OP : TERMINAL O IN PHOSPHOXIDES</span>
2973     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPhosphoxideTerminalOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2974       <span class="i">$AtomType</span> = <span class="q">&#39;OP&#39;</span><span class="sc">;</span>
2975       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2976     <span class="s">}</span>
2977 
2978     <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
2979     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomTypeForOxygenAttachedToPhosphorus: MMFF94 atom type for Oxygen cann&#39;t be assigned...&quot;</span><span class="sc">;</span>
2980   <span class="s">}</span>
2981 
2982   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
2983 <span class="s">}</span>
2984 
2985 <span class="c"># Get MMFF94 atom type for Oxygen with only sigma bonds...</span>
2986 <span class="c">#</span>
<a name="_GetAtomTypeForOxygenWithOnlySigmaBonds-"></a>2987 <span class="k">sub </span><span class="m">_GetAtomTypeForOxygenWithOnlySigmaBonds</span> <span class="s">{</span>
2988   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2989   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
2990 
2991   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
2992 
2993   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
2994 
2995     <span class="c"># OFUR : AROMATIC OXYGEN AS IN FURAN</span>
2996     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAromaticOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2997       <span class="i">$AtomType</span> = <span class="q">&#39;OFUR&#39;</span><span class="sc">;</span>
2998       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
2999     <span class="s">}</span>
3000 
3001     <span class="c"># OC=O : ESTER OR CARBOXYLIC ACID -O-</span>
3002     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsEsterOrCarboxylicAcidOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3003       <span class="i">$AtomType</span> = <span class="q">&#39;OC=O&#39;</span><span class="sc">;</span>
3004       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3005     <span class="s">}</span>
3006 
3007     <span class="c"># O2CM : OXYGEN IN CARBOXYLATE ANION</span>
3008     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsCarboxylateAnionOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3009       <span class="i">$AtomType</span> = <span class="q">&#39;O2CM&#39;</span><span class="sc">;</span>
3010       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3011     <span class="s">}</span>
3012 
3013     <span class="c"># OC=C : ENOLIC OR PHENOLIC OXYGEN</span>
3014     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsEnolicOrPhenolicOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3015       <span class="i">$AtomType</span> = <span class="q">&#39;OC=C &#39;</span><span class="sc">;</span>
3016       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3017     <span class="s">}</span>
3018 
3019     <span class="c"># OC=N : DIVALENT OXYGEN</span>
3020     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsOCNDivalentOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3021       <span class="i">$AtomType</span> = <span class="q">&#39;OC=N&#39;</span><span class="sc">;</span>
3022       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3023     <span class="s">}</span>
3024 
3025     <span class="c"># OC=S : THIOESTER OR THIOACID -O-</span>
3026     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioEsterOrThioAcidOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3027       <span class="i">$AtomType</span> = <span class="q">&#39;OC=S&#39;</span><span class="sc">;</span>
3028       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3029     <span class="s">}</span>
3030 
3031     <span class="c"># ON=O : DIVALENT NITRITE ETHER OXYGEN</span>
3032     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsDivalentNitriteEtherOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3033       <span class="i">$AtomType</span> = <span class="q">&#39;ON=O&#39;</span><span class="sc">;</span>
3034       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3035     <span class="s">}</span>
3036 
3037     <span class="c"># ONO2 : DIVALENT NITRATE ETHER OXYGEN</span>
3038     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsDivalentNitrateEtherOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3039       <span class="i">$AtomType</span> = <span class="q">&#39;ONO2&#39;</span><span class="sc">;</span>
3040       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3041     <span class="s">}</span>
3042 
3043     <span class="c"># O3N : NITRATE ANION OXYGEN</span>
3044     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNitrateAnionOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3045       <span class="i">$AtomType</span> = <span class="q">&#39;O3N&#39;</span><span class="sc">;</span>
3046       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3047     <span class="s">}</span>
3048 
3049     <span class="c"># O2N : NITRO OXYGEN</span>
3050     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNitroOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3051       <span class="i">$AtomType</span> = <span class="q">&#39;O2N&#39;</span><span class="sc">;</span>
3052       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3053     <span class="s">}</span>
3054 
3055     <span class="c"># OXN : N-OXIDE OXYGEN</span>
3056     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNOxideOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3057       <span class="i">$AtomType</span> = <span class="q">&#39;OXN&#39;</span><span class="sc">;</span>
3058       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3059     <span class="s">}</span>
3060 
3061     <span class="c"># OM2 : OXIDE OXYGEN ON SP2 CARBON, NEGATIVELY CHARGED</span>
3062     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNegativelyChargedSP2OxideOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3063       <span class="i">$AtomType</span> = <span class="q">&#39;OM2&#39;</span><span class="sc">;</span>
3064       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3065     <span class="s">}</span>
3066 
3067     <span class="c"># OM : ALKOXIDE OXYGEN, NEGATIVELY CHARGED</span>
3068     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNegativelyChargedAlkoxideOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3069       <span class="i">$AtomType</span> = <span class="q">&#39;OM&#39;</span><span class="sc">;</span>
3070       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3071     <span class="s">}</span>
3072 
3073     <span class="c"># O4CL : OXYGEN IN CLO4(-) ANION - FORMAL CHARGE=-0.25</span>
3074     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPerChlorateAnionOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3075       <span class="i">$AtomType</span> = <span class="q">&#39;O4CL&#39;</span><span class="sc">;</span>
3076       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3077     <span class="s">}</span>
3078 
3079     <span class="c"># O+ : POSITIVELY CHARGED OXONIUM (TRICOORDINATE) OXYGEN</span>
3080     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPositivelyChargedOxoniumOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3081       <span class="i">$AtomType</span> = <span class="q">&#39;O+&#39;</span><span class="sc">;</span>
3082       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3083     <span class="s">}</span>
3084 
3085     <span class="c"># OH2 : OXYGEN ON WATER</span>
3086     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsWaterOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3087       <span class="i">$AtomType</span> = <span class="q">&#39;OH2&#39;</span><span class="sc">;</span>
3088       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3089     <span class="s">}</span>
3090 
3091     <span class="c"># OR : ALCOHOL OR ETHER OXYGEN</span>
3092     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAlcoholOrEtherOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3093       <span class="i">$AtomType</span> = <span class="q">&#39;OR&#39;</span><span class="sc">;</span>
3094       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3095     <span class="s">}</span>
3096 
3097     <span class="c"># GENERAL DIVALENT O</span>
3098     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsDivalentOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3099       <span class="i">$AtomType</span> = <span class="q">&#39;-O-&#39;</span><span class="sc">;</span>
3100       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3101     <span class="s">}</span>
3102 
3103     <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
3104     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomTypeForOxygenWithOnlySigmaBonds: MMFF94 atom type for Oxygen cann&#39;t be assigned...&quot;</span><span class="sc">;</span>
3105   <span class="s">}</span>
3106 
3107   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
3108 <span class="s">}</span>
3109 
3110 <span class="c"># Get MMFF94 atom type for Oxygen with only sigma bonds...</span>
3111 <span class="c">#</span>
<a name="_GetAtomTypeForOxygenWithOnePiBond-"></a>3112 <span class="k">sub </span><span class="m">_GetAtomTypeForOxygenWithOnePiBond</span> <span class="s">{</span>
3113   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3114   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
3115 
3116   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
3117 
3118   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
3119 
3120     <span class="c"># OFUR : AROMATIC OXYGEN AS IN FURAN</span>
3121     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAromaticOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3122       <span class="i">$AtomType</span> = <span class="q">&#39;OFUR&#39;</span><span class="sc">;</span>
3123       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3124     <span class="s">}</span>
3125 
3126     <span class="c"># O=+ : POSITIVELY CHARGED OXENIUM (DICOORDINATE) OXYGEN</span>
3127     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPositivelyChargedOxeniumOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3128       <span class="i">$AtomType</span> = <span class="q">&#39;O=+&#39;</span><span class="sc">;</span>
3129       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3130     <span class="s">}</span>
3131 
3132     <span class="c"># O=CN : CARBONYL OXYGEN, AMIDES</span>
3133     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAmideCarbonylOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3134       <span class="i">$AtomType</span> = <span class="q">&#39;O=CN&#39;</span><span class="sc">;</span>
3135       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3136     <span class="s">}</span>
3137 
3138     <span class="c"># O=CO : CARBONYL OXYGEN, CARBOXYLIC ACIDS AND ESTERS</span>
3139     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsCarbobylCarboxylicAcidsOrEstersOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3140       <span class="i">$AtomType</span> = <span class="q">&#39;O=CO&#39;</span><span class="sc">;</span>
3141       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3142     <span class="s">}</span>
3143 
3144     <span class="c"># O=CR : CARBONYL OXYGEN, ALDEHYDES AND KETONES</span>
3145     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsCarbonylAldehydeOrKetoneOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3146       <span class="i">$AtomType</span> = <span class="q">&#39;O=CR&#39;</span><span class="sc">;</span>
3147       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3148     <span class="s">}</span>
3149 
3150     <span class="c"># O=C : GENERAL C=O</span>
3151     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsCarbonylOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3152       <span class="i">$AtomType</span> = <span class="q">&#39;O=C&#39;</span><span class="sc">;</span>
3153       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3154     <span class="s">}</span>
3155 
3156     <span class="c"># O2NO : NITRO-GROUP OXYGEN IN NITRATE</span>
3157     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNitroGroupNitrateOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3158       <span class="i">$AtomType</span> = <span class="q">&#39;O2NO&#39;</span><span class="sc">;</span>
3159       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3160     <span class="s">}</span>
3161 
3162     <span class="c"># O2N : NITRO OXYGEN</span>
3163     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNitroOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3164       <span class="i">$AtomType</span> = <span class="q">&#39;O2N&#39;</span><span class="sc">;</span>
3165       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3166     <span class="s">}</span>
3167 
3168     <span class="c"># O=N : NITROSO OXYGEN</span>
3169     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNitrosoOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3170       <span class="i">$AtomType</span> = <span class="q">&#39;O=N&#39;</span><span class="sc">;</span>
3171       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3172     <span class="s">}</span>
3173 
3174     <span class="c"># O4CL : OXYGEN IN CLO4(-) ANION - FORMAL CHARGE=-0.25</span>
3175     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPerChlorateAnionOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3176       <span class="i">$AtomType</span> = <span class="q">&#39;O4CL&#39;</span><span class="sc">;</span>
3177       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
3178     <span class="s">}</span>
3179 
3180     <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
3181     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomTypeForOxygenWithOnePiBond: MMFF94 atom type for Oxygen cann&#39;t be assigned...&quot;</span><span class="sc">;</span>
3182   <span class="s">}</span>
3183 
3184   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
3185 <span class="s">}</span>
3186 
3187 <span class="c"># OR : ALCOHOL OR ETHER OXYGEN</span>
3188 <span class="c">#</span>
<a name="_IsAlcoholOrEtherOxygen-"></a>3189 <span class="k">sub </span><span class="m">_IsAlcoholOrEtherOxygen</span> <span class="s">{</span>
3190   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3191 
3192   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAlcoholOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span> || <span class="i">$This</span><span class="i">-&gt;_IsEtherOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3193 <span class="s">}</span>
3194 
3195 <span class="c"># Alcohol Oxygen..</span>
3196 <span class="c">#</span>
<a name="_IsAlcoholOxygen-"></a>3197 <span class="k">sub </span><span class="m">_IsAlcoholOxygen</span> <span class="s">{</span>
3198   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3199 
3200   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3201 <span class="s">}</span>
3202 
3203 <span class="c"># Ether Oxygen..</span>
3204 <span class="c">#</span>
<a name="_IsEtherOxygen-"></a>3205 <span class="k">sub </span><span class="m">_IsEtherOxygen</span> <span class="s">{</span>
3206   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3207 
3208   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;C&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3209 <span class="s">}</span>
3210 
3211 
3212 <span class="c"># OC=O : ESTER OR CARBOXYLIC ACID -O-</span>
3213 <span class="c">#</span>
3214 <span class="c"># Notes:</span>
3215 <span class="c">#    . Carboxylate anion Oxygen is matched using O2CM atom type.</span>
3216 <span class="c">#</span>
<a name="_IsEsterOrCarboxylicAcidOxygen-"></a>3217 <span class="k">sub </span><span class="m">_IsEsterOrCarboxylicAcidOxygen</span> <span class="s">{</span>
3218   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3219   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3220 
3221   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3222     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3223   <span class="s">}</span>
3224 
3225   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3226     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsCarboxylicAcidOrEsterCarbonylCarbon</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3227       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3228     <span class="s">}</span>
3229   <span class="s">}</span>
3230   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3231 <span class="s">}</span>
3232 
3233 <span class="c"># OC=C : ENOLIC OR PHENOLIC OXYGEN</span>
3234 <span class="c">#</span>
<a name="_IsEnolicOrPhenolicOxygen-"></a>3235 <span class="k">sub </span><span class="m">_IsEnolicOrPhenolicOxygen</span> <span class="s">{</span>
3236   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3237   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3238 
3239   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3240     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3241   <span class="s">}</span>
3242 
3243   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3244     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3245       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3246     <span class="s">}</span>
3247   <span class="s">}</span>
3248   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3249 <span class="s">}</span>
3250 
3251 <span class="c"># OC=N : DIVALENT OXYGEN</span>
3252 <span class="c">#</span>
<a name="_IsOCNDivalentOxygen-"></a>3253 <span class="k">sub </span><span class="m">_IsOCNDivalentOxygen</span> <span class="s">{</span>
3254   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3255   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3256 
3257   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3258     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3259   <span class="s">}</span>
3260 
3261   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3262     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3263       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3264     <span class="s">}</span>
3265   <span class="s">}</span>
3266   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3267 <span class="s">}</span>
3268 
3269 <span class="c"># OC=S : THIOESTER OR THIOACID -O-</span>
3270 <span class="c">#</span>
<a name="_IsThioEsterOrThioAcidOxygen-"></a>3271 <span class="k">sub </span><span class="m">_IsThioEsterOrThioAcidOxygen</span> <span class="s">{</span>
3272   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3273   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3274 
3275   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2,O.X1.FC-1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3276     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3277   <span class="s">}</span>
3278 
3279   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3280     <span class="c"># Thio ester, acid or anion Oxygen...</span>
3281     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S&#39;</span><span class="cm">,</span> <span class="q">&#39;O.X1.FC0,O.X2,O.X1.FC-1&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3282       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3283     <span class="s">}</span>
3284   <span class="s">}</span>
3285   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3286 <span class="s">}</span>
3287 
3288 <span class="c"># ONO2 : DIVALENT NITRATE ETHER OXYGEN</span>
3289 <span class="c">#</span>
3290 <span class="c"># Notes:</span>
3291 <span class="c">#    . Nitrate anion Oxygen is matched using O3N atom type.</span>
3292 <span class="c">#    . Divalent Oxygen in Nitrate with one Hydrogen atom is not treated as ether ONO2.</span>
3293 <span class="c">#</span>
<a name="_IsDivalentNitrateEtherOxygen-"></a>3294 <span class="k">sub </span><span class="m">_IsDivalentNitrateEtherOxygen</span> <span class="s">{</span>
3295   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3296   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3297 
3298   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3299     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3300   <span class="s">}</span>
3301 
3302   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;N.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3303     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNitrateNitrogen</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3304       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3305     <span class="s">}</span>
3306   <span class="s">}</span>
3307   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3308 <span class="s">}</span>
3309 
3310 <span class="c"># ON=O : DIVALENT NITRITE ETHER OXYGEN</span>
3311 <span class="c">#</span>
3312 <span class="c"># Notes:</span>
3313 <span class="c">#    . Divalent Oxygen in Nitrite with one Hydrogen atom is not treated as ether ON=O.</span>
3314 <span class="c">#</span>
<a name="_IsDivalentNitriteEtherOxygen-"></a>3315 <span class="k">sub </span><span class="m">_IsDivalentNitriteEtherOxygen</span> <span class="s">{</span>
3316   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3317   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3318 
3319   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3320     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3321   <span class="s">}</span>
3322 
3323   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;N.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3324     <span class="c"># R-O-N=O</span>
3325     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T2.DB1.FC0&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O.FC0&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3326       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3327     <span class="s">}</span>
3328   <span class="s">}</span>
3329   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3330 <span class="s">}</span>
3331 
3332 <span class="c"># OSO3 : DIVALENT OXYGEN ATTACHED TO SULFUR</span>
3333 <span class="c">#</span>
3334 <span class="c"># Notes:</span>
3335 <span class="c">#    . It corresponds to divalent Oxygen in Sulfates.</span>
3336 <span class="c">#    . Oxygen attached to one heavy atom and one Hydrogen atom is treated as divalent</span>
3337 <span class="c">#      Oxygen and matched to OSO3.</span>
3338 <span class="c">#    . Anion Oxygen attached to one heavy atom with no Hydrogen atom is treated as terminal</span>
3339 <span class="c">#      Oxygen and matched to O4S.</span>
3340 <span class="c">#</span>
<a name="_IsOSO3DivalentOxygen-"></a>3341 <span class="k">sub </span><span class="m">_IsOSO3DivalentOxygen</span> <span class="s">{</span>
3342   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3343   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3344 
3345   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S.T4&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3346     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3347   <span class="s">}</span>
3348 
3349   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.T4&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3350     <span class="c"># R&#39;-O-S(=O)(=O)-O-R&quot;</span>
3351     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfateSulfur</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3352       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3353     <span class="s">}</span>
3354   <span class="s">}</span>
3355   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3356 <span class="s">}</span>
3357 
3358 <span class="c"># OSO2 : DIVALENT OXYGEN ATTACHED TO SULFUR</span>
3359 <span class="c">#</span>
3360 <span class="c"># Notes:</span>
3361 <span class="c">#    . It corresponds to divalent Oxygen in Sulfonates, Sulfones and so on.</span>
3362 <span class="c">#    . Oxygen attached to one heavy atom and one Hydrogen atom is treated as divalent</span>
3363 <span class="c">#      Oxygen and matched to OSO2.</span>
3364 <span class="c">#    . Anion Oxygen attached to one heavy atom with no Hydrogen atom is treated as terminal</span>
3365 <span class="c">#      Oxygen and matched to O3S.</span>
3366 <span class="c">#</span>
<a name="_IsOSO2DivalentOxygen-"></a>3367 <span class="k">sub </span><span class="m">_IsOSO2DivalentOxygen</span> <span class="s">{</span>
3368   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3369   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3370 
3371   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S.T4&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3372     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3373   <span class="s">}</span>
3374 
3375   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.T4&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3376     <span class="c"># R&#39;-O-S(=O)(=O)-R&quot;</span>
3377     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfonateSulfur</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3378       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3379     <span class="s">}</span>
3380   <span class="s">}</span>
3381   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3382 <span class="s">}</span>
3383 
3384 <span class="c"># OSO : DIVALENT OXYGEN ATTACHED TO SULFUR</span>
3385 <span class="c">#</span>
3386 <span class="c"># Notes:</span>
3387 <span class="c">#    . It corresponds to divalent Oxygen attached to Sulfur with single bond.</span>
3388 <span class="c">#    . Oxygen attached to one heavy atom and one Hydrogen atom is treated as divalent</span>
3389 <span class="c">#      Oxygen and matched to OSO.</span>
3390 <span class="c">#</span>
<a name="_IsOSODivalentOxygen-"></a>3391 <span class="k">sub </span><span class="m">_IsOSODivalentOxygen</span> <span class="s">{</span>
3392   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3393   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3394 
3395   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S.T2&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3396     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3397   <span class="s">}</span>
3398 
3399   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.T2.DB0&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3400     <span class="c"># R&#39;-O-S-O-R&quot;</span>
3401     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3402       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3403     <span class="s">}</span>
3404   <span class="s">}</span>
3405   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3406 <span class="s">}</span>
3407 
3408 <span class="c"># OS=O : DIVALENT OXYGEN ATTACHED TO SULFOXIDE SULFUR</span>
3409 <span class="c">#</span>
3410 <span class="c"># Notes:</span>
3411 <span class="c">#    . It corresponds to divalent Oxygen in Sulfoxides.</span>
3412 <span class="c">#    . Oxygen attached to one heavy atom and one Hydrogen atom is treated as divalent</span>
3413 <span class="c">#      Oxygen and matched to OS=O.</span>
3414 <span class="c">#</span>
<a name="_IsSulfoxideDivalentOxygen-"></a>3415 <span class="k">sub </span><span class="m">_IsSulfoxideDivalentOxygen</span> <span class="s">{</span>
3416   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3417   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3418 
3419   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S.T3&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3420     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3421   <span class="s">}</span>
3422 
3423   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.T3.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3424     <span class="c"># R&#39;-O-S(=O)-R&quot;</span>
3425     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3426       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3427     <span class="s">}</span>
3428   <span class="s">}</span>
3429   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3430 <span class="s">}</span>
3431 
3432 <span class="c"># -OS : GENERAL DIVALENT OXYGEN ATTACHED TO S</span>
3433 <span class="c">#</span>
3434 <span class="c"># Notes:</span>
3435 <span class="c">#    . It covers any divalent Oxygen attached to Sulfur.</span>
3436 <span class="c">#</span>
<a name="_IsOSDivalentOxygen-"></a>3437 <span class="k">sub </span><span class="m">_IsOSDivalentOxygen</span> <span class="s">{</span>
3438   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3439   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3440 
3441   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3442     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3443   <span class="s">}</span>
3444 
3445   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3446     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3447       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3448     <span class="s">}</span>
3449   <span class="s">}</span>
3450   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3451 <span class="s">}</span>
3452 
3453 <span class="c"># OPO3 : DIVALENT OXYGEN ATTACHED TO PHOSPHOROUS</span>
3454 <span class="c">#</span>
3455 <span class="c"># Notes:</span>
3456 <span class="c">#    . It corresponds to divalent Oxygen in Phopsphates or Phosphodiesters.</span>
3457 <span class="c">#</span>
<a name="_IsOPO3DivalentOxygen-"></a>3458 <span class="k">sub </span><span class="m">_IsOPO3DivalentOxygen</span> <span class="s">{</span>
3459   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3460   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3461 
3462   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3463     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3464   <span class="s">}</span>
3465 
3466   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;P.T4&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3467     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPhosphateOrPhosphodiesterPhosphorus</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3468       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3469     <span class="s">}</span>
3470   <span class="s">}</span>
3471   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3472 <span class="s">}</span>
3473 
3474 <span class="c"># OPO2 : DIVALENT OXYGEN ATTACHED TO PHOSPHOROUS</span>
3475 <span class="c">#</span>
3476 <span class="c"># Notes:</span>
3477 <span class="c">#    . It corresponds to divalent Oxygen in Phopsphonates or their esters.</span>
3478 <span class="c">#</span>
<a name="_IsOPO2DivalentOxygen-"></a>3479 <span class="k">sub </span><span class="m">_IsOPO2DivalentOxygen</span> <span class="s">{</span>
3480   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3481   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3482 
3483   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3484     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3485   <span class="s">}</span>
3486 
3487   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;P.T4&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3488     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPhosphonatePhosphorus</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3489       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3490     <span class="s">}</span>
3491   <span class="s">}</span>
3492   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3493 <span class="s">}</span>
3494 
3495 <span class="c"># OPO : DIVALENT OXYGEN ATTACHED TO PHOSPHOROUS</span>
3496 <span class="c">#</span>
3497 <span class="c"># Notes:</span>
3498 <span class="c">#    . It corresponds to divalent Oxygen in Phopsphinates.</span>
3499 <span class="c">#</span>
<a name="_IsOPODivalentOxygen-"></a>3500 <span class="k">sub </span><span class="m">_IsOPODivalentOxygen</span> <span class="s">{</span>
3501   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3502   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3503 
3504   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3505     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3506   <span class="s">}</span>
3507 
3508   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;P.T4&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3509     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPhosphinatePhosphorus</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3510       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3511     <span class="s">}</span>
3512   <span class="s">}</span>
3513   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3514 <span class="s">}</span>
3515 
3516 <span class="c"># -OP : DIVALENT OXYGEN ATTACHED TO PHOSPHOROUS</span>
3517 <span class="c">#</span>
<a name="_IsOPDivalentOxygen-"></a>3518 <span class="k">sub </span><span class="m">_IsOPDivalentOxygen</span> <span class="s">{</span>
3519   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3520   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3521 
3522   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3523     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3524   <span class="s">}</span>
3525 
3526   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;P&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3527     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;P&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3528       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3529     <span class="s">}</span>
3530   <span class="s">}</span>
3531   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3532 <span class="s">}</span>
3533 
3534 <span class="c"># -O- : GENERAL DIVALENT O</span>
3535 <span class="c">#</span>
<a name="_IsDivalentOxygen-"></a>3536 <span class="k">sub </span><span class="m">_IsDivalentOxygen</span> <span class="s">{</span>
3537   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3538 
3539   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.TSB2&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3540 <span class="s">}</span>
3541 
3542 <span class="c"># O=C : GENERAL C=O</span>
3543 <span class="c">#</span>
<a name="_IsCarbonylOxygen-"></a>3544 <span class="k">sub </span><span class="m">_IsCarbonylOxygen</span> <span class="s">{</span>
3545   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3546 
3547   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.T1.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3548 <span class="s">}</span>
3549 
3550 <span class="c"># O=CN : CARBONYL OXYGEN, AMIDES</span>
3551 <span class="c">#</span>
<a name="_IsAmideCarbonylOxygen-"></a>3552 <span class="k">sub </span><span class="m">_IsAmideCarbonylOxygen</span> <span class="s">{</span>
3553   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3554   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3555 
3556   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.T1.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3557     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3558   <span class="s">}</span>
3559 
3560   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3561     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsAmideCarbonylCarbon</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3562       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3563     <span class="s">}</span>
3564   <span class="s">}</span>
3565   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3566 <span class="s">}</span>
3567 
3568 <span class="c"># O=CR : CARBONYL OXYGEN, ALDEHYDES AND KETONES</span>
3569 <span class="c">#</span>
<a name="_IsCarbonylAldehydeOrKetoneOxygen-"></a>3570 <span class="k">sub </span><span class="m">_IsCarbonylAldehydeOrKetoneOxygen</span> <span class="s">{</span>
3571   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3572   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3573 
3574   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.T1.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3575     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3576   <span class="s">}</span>
3577 
3578   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3579     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsKetoneOrAldehydeCarbonylCarbon</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3580       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3581     <span class="s">}</span>
3582   <span class="s">}</span>
3583   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3584 <span class="s">}</span>
3585 
3586 <span class="c"># O=CO : CARBONYL OXYGEN, CARBOXYLIC ACIDS AND ESTERS</span>
3587 <span class="c">#</span>
<a name="_IsCarbobylCarboxylicAcidsOrEstersOxygen-"></a>3588 <span class="k">sub </span><span class="m">_IsCarbobylCarboxylicAcidsOrEstersOxygen</span> <span class="s">{</span>
3589   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3590   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3591 
3592   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.T1.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3593     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3594   <span class="s">}</span>
3595 
3596   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3597     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsCarboxylicAcidOrEsterCarbonylCarbon</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3598       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3599     <span class="s">}</span>
3600   <span class="s">}</span>
3601   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3602 <span class="s">}</span>
3603 
3604 <span class="c"># O=N : NITROSO OXYGEN</span>
3605 <span class="c">#</span>
<a name="_IsNitrosoOxygen-"></a>3606 <span class="k">sub </span><span class="m">_IsNitrosoOxygen</span> <span class="s">{</span>
3607   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3608 
3609   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.T1.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3610 <span class="s">}</span>
3611 
3612 <span class="c"># O=S : O=S IN SULFOXIDES</span>
3613 <span class="c">#</span>
<a name="_IsSulfoxideOxygen-"></a>3614 <span class="k">sub </span><span class="m">_IsSulfoxideOxygen</span> <span class="s">{</span>
3615   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3616   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3617 
3618   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.T1.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3619     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3620   <span class="s">}</span>
3621 
3622   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3623     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfoxideSulfur</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3624       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3625     <span class="s">}</span>
3626   <span class="s">}</span>
3627   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3628 <span class="s">}</span>
3629 
3630 <span class="c"># O=S= :  O=S ON SULFUR DOUBLY BONDED TO, E.G., CARBON</span>
3631 <span class="c">#</span>
<a name="_IsDoublyBondedOSOxygen-"></a>3632 <span class="k">sub </span><span class="m">_IsDoublyBondedOSOxygen</span> <span class="s">{</span>
3633   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3634   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3635 
3636   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.T1.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3637     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3638   <span class="s">}</span>
3639 
3640   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.DB2&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3641     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3642       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3643     <span class="s">}</span>
3644   <span class="s">}</span>
3645   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3646 <span class="s">}</span>
3647 
3648 <span class="c"># O2CM : OXYGEN IN CARBOXYLATE ANION</span>
3649 <span class="c">#</span>
<a name="_IsCarboxylateAnionOxygen-"></a>3650 <span class="k">sub </span><span class="m">_IsCarboxylateAnionOxygen</span> <span class="s">{</span>
3651   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3652   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3653 
3654   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1.FC-1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3655     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3656   <span class="s">}</span>
3657 
3658   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.T3.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3659     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsCarboxylateAnionCarbon</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3660       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3661     <span class="s">}</span>
3662   <span class="s">}</span>
3663   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3664 <span class="s">}</span>
3665 
3666 <span class="c"># OXN : N-OXIDE OXYGEN</span>
3667 <span class="c">#</span>
<a name="_IsNOxideOxygen-"></a>3668 <span class="k">sub </span><span class="m">_IsNOxideOxygen</span> <span class="s">{</span>
3669   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3670 
3671   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1.FC-1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N.FC+1&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3672 <span class="s">}</span>
3673 
3674 <span class="c"># O2N : NITRO OXYGEN</span>
3675 <span class="c">#</span>
<a name="_IsNitroOxygen-"></a>3676 <span class="k">sub </span><span class="m">_IsNitroOxygen</span> <span class="s">{</span>
3677   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3678   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3679 
3680   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1.DB1,O.X1.FC-1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3681     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3682   <span class="s">}</span>
3683 
3684   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;N.T3.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3685     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNitroNitrogen</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3686       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3687     <span class="s">}</span>
3688   <span class="s">}</span>
3689   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3690 <span class="s">}</span>
3691 
3692 <span class="c"># O2NO : NITRO-GROUP OXYGEN IN NITRATE</span>
3693 <span class="c">#</span>
<a name="_IsNitroGroupNitrateOxygen-"></a>3694 <span class="k">sub </span><span class="m">_IsNitroGroupNitrateOxygen</span> <span class="s">{</span>
3695   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3696   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3697 
3698   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3699     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3700   <span class="s">}</span>
3701 
3702   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;N.T3.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3703     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNitrateNitrogen</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3704       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3705     <span class="s">}</span>
3706   <span class="s">}</span>
3707   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3708 <span class="s">}</span>
3709 
3710 <span class="c"># O3N : NITRATE ANION OXYGEN</span>
3711 <span class="c">#</span>
<a name="_IsNitrateAnionOxygen-"></a>3712 <span class="k">sub </span><span class="m">_IsNitrateAnionOxygen</span> <span class="s">{</span>
3713   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3714   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3715 
3716   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1.FC-1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3717     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3718   <span class="s">}</span>
3719 
3720   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;N.T3.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3721     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsNitrateNitrogen</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3722       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3723     <span class="s">}</span>
3724   <span class="s">}</span>
3725   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3726 <span class="s">}</span>
3727 
3728 <span class="c"># O-S : SINGLE TERMINAL OXYGEN ON TETRACOORD SULFUR</span>
3729 <span class="c">#</span>
<a name="_IsOSTerminalOxygen-"></a>3730 <span class="k">sub </span><span class="m">_IsOSTerminalOxygen</span> <span class="s">{</span>
3731   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3732   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3733 
3734   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S.T4&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3735     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3736   <span class="s">}</span>
3737 
3738   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.T4&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3739     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O.X1&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3740       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3741     <span class="s">}</span>
3742   <span class="s">}</span>
3743   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3744 <span class="s">}</span>
3745 
3746 <span class="c"># O2S : TERMINAL O-S IN SULFONES AND SULFONAMIDES</span>
3747 <span class="c">#</span>
<a name="_IsSulfoneOrSulfonamideTerminalOxygen-"></a>3748 <span class="k">sub </span><span class="m">_IsSulfoneOrSulfonamideTerminalOxygen</span> <span class="s">{</span>
3749   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3750   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3751 
3752   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S.T4&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3753     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3754   <span class="s">}</span>
3755 
3756   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.T4&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3757     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfonamideSulfur</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span> || <span class="i">$This</span><span class="i">-&gt;_IsSulfoneSulfur</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3758       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3759     <span class="s">}</span>
3760   <span class="s">}</span>
3761   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3762 <span class="s">}</span>
3763 
3764 <span class="c"># O3S : TERMINAL O IN SULFONATES</span>
3765 <span class="c">#</span>
3766 <span class="c"># Notes:</span>
3767 <span class="c">#    . It corresponds to monovalent Oxygen in Sulfonates.</span>
3768 <span class="c">#    . Anion Oxygen attached to one heavy atom with no Hydrogen atom is treated as terminal</span>
3769 <span class="c">#      Oxygen and matched to O3S.</span>
3770 <span class="c">#</span>
<a name="_IsSulfonateTerminalOxygen-"></a>3771 <span class="k">sub </span><span class="m">_IsSulfonateTerminalOxygen</span> <span class="s">{</span>
3772   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3773   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3774 
3775   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S.T4&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3776     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3777   <span class="s">}</span>
3778 
3779   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.T4&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3780     <span class="c"># R&#39;-O-S(=O)(=O)-R&quot;, [O-]-S(=O)(=O)-R&quot;,</span>
3781     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfonateSulfur</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3782       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3783     <span class="s">}</span>
3784   <span class="s">}</span>
3785   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3786 <span class="s">}</span>
3787 
3788 <span class="c"># O4S : TERMINAL O IN SO4(-3)</span>
3789 <span class="c">#</span>
3790 <span class="c"># Notes:</span>
3791 <span class="c">#    . It corresponds to monovalent Oxygen in Sulfates.</span>
3792 <span class="c">#    . As far I can tell, SO4 should have a formal charge of -2.</span>
3793 <span class="c">#    . Anion Oxygen attached to one heavy atom with no Hydrogen atom is treated as terminal</span>
3794 <span class="c">#      Oxygen and matched to O4S.</span>
3795 <span class="c">#</span>
<a name="_IsSulfateTerminalOxygen-"></a>3796 <span class="k">sub </span><span class="m">_IsSulfateTerminalOxygen</span> <span class="s">{</span>
3797   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3798   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3799 
3800   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S.T4&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3801     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3802   <span class="s">}</span>
3803 
3804   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.T4&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3805     <span class="c"># R&#39;-O-S(=O)(=O)-O-R&quot;, R&#39;-O-S(=O)(=O)-[O-]</span>
3806     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSulfateSulfur</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3807       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3808     <span class="s">}</span>
3809   <span class="s">}</span>
3810   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3811 <span class="s">}</span>
3812 
3813 <span class="c"># OSMS : TERM O IN THIOSULFINATE ANION - FORMAL CHARGE=-0.5</span>
3814 <span class="c">#</span>
<a name="_IsThioSulfinateTerminalOxygen-"></a>3815 <span class="k">sub </span><span class="m">_IsThioSulfinateTerminalOxygen</span> <span class="s">{</span>
3816   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3817   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3818 
3819   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S.FC+1&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3820     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3821   <span class="s">}</span>
3822 
3823   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.FC+1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3824     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioSulfinateSulfur</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3825       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3826     <span class="s">}</span>
3827   <span class="s">}</span>
3828   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3829 <span class="s">}</span>
3830 
3831 <span class="c"># OP : TERMINAL O IN PHOSPHOXIDES</span>
3832 <span class="c">#</span>
<a name="_IsPhosphoxideTerminalOxygen-"></a>3833 <span class="k">sub </span><span class="m">_IsPhosphoxideTerminalOxygen</span> <span class="s">{</span>
3834   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3835   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3836 
3837   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;P.T4&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3838     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3839   <span class="s">}</span>
3840 
3841   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;P.T4&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3842     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPhosphoxidePhosphorus</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3843       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3844     <span class="s">}</span>
3845   <span class="s">}</span>
3846   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3847 <span class="s">}</span>
3848 
3849 <span class="c"># O2P : TERMINAL O IN PHOSPHINATES</span>
3850 <span class="c">#</span>
<a name="_IsPhosphinateTerminalOxygen-"></a>3851 <span class="k">sub </span><span class="m">_IsPhosphinateTerminalOxygen</span> <span class="s">{</span>
3852   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3853   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3854 
3855   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;P.T4&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3856     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3857   <span class="s">}</span>
3858 
3859   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;P.T4&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3860     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPhosphinatePhosphorus</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3861       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3862     <span class="s">}</span>
3863   <span class="s">}</span>
3864   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3865 <span class="s">}</span>
3866 
3867 <span class="c"># O3P : TERMINAL OXYGEN IN PHOSPHONATES</span>
3868 <span class="c">#</span>
<a name="_IsPhosphonateTerminalOxygen-"></a>3869 <span class="k">sub </span><span class="m">_IsPhosphonateTerminalOxygen</span> <span class="s">{</span>
3870   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3871   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3872 
3873   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;P.T4&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3874     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3875   <span class="s">}</span>
3876 
3877   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;P.T4&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3878     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPhosphonatePhosphorus</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3879       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3880     <span class="s">}</span>
3881   <span class="s">}</span>
3882   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3883 <span class="s">}</span>
3884 
3885 <span class="c"># O4P : TERMINAL OXYGEN IN PHOSPHATES AND PHOSPHODIESTERS</span>
3886 <span class="c">#</span>
<a name="_IsPhosphateOrPhosphodiesterTerminalOxygen-"></a>3887 <span class="k">sub </span><span class="m">_IsPhosphateOrPhosphodiesterTerminalOxygen</span> <span class="s">{</span>
3888   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3889   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3890 
3891   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;P.T4&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3892     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3893   <span class="s">}</span>
3894 
3895   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;P.T4&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3896     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPhosphateOrPhosphodiesterPhosphorus</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3897       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3898     <span class="s">}</span>
3899   <span class="s">}</span>
3900   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3901 <span class="s">}</span>
3902 
3903 <span class="c"># O4CL : OXYGEN IN CLO4(-) ANION - FORMAL CHARGE=-0.25</span>
3904 <span class="c">#</span>
<a name="_IsPerChlorateAnionOxygen-"></a>3905 <span class="k">sub </span><span class="m">_IsPerChlorateAnionOxygen</span> <span class="s">{</span>
3906   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3907   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
3908 
3909   <span class="c"># All Oxygens in PerChlorate anion and ester are matched to O4Cl...</span>
3910   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;Cl&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3911     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3912   <span class="s">}</span>
3913 
3914   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;Cl&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3915     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPerChlorateAnionChlorine</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3916       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3917     <span class="s">}</span>
3918   <span class="s">}</span>
3919   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3920 <span class="s">}</span>
3921 
3922 <span class="c"># OM : ALKOXIDE OXYGEN, NEGATIVELY CHARGED</span>
3923 <span class="c">#</span>
<a name="_IsNegativelyChargedAlkoxideOxygen-"></a>3924 <span class="k">sub </span><span class="m">_IsNegativelyChargedAlkoxideOxygen</span> <span class="s">{</span>
3925   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3926 
3927   <span class="c"># R-(O-)</span>
3928 
3929   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.FC-1.T1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3930 <span class="s">}</span>
3931 
3932 <span class="c"># OM2 : OXIDE OXYGEN ON SP2 CARBON, NEGATIVELY CHARGED</span>
3933 <span class="c">#</span>
<a name="_IsNegativelyChargedSP2OxideOxygen-"></a>3934 <span class="k">sub </span><span class="m">_IsNegativelyChargedSP2OxideOxygen</span> <span class="s">{</span>
3935   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3936 
3937   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.FC-1.T1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C.DB1.T3&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3938 <span class="s">}</span>
3939 
3940 <span class="c"># O+ : POSITIVELY CHARGED OXONIUM (TRICOORDINATE) OXYGEN</span>
3941 <span class="c">#</span>
<a name="_IsPositivelyChargedOxoniumOxygen-"></a>3942 <span class="k">sub </span><span class="m">_IsPositivelyChargedOxoniumOxygen</span> <span class="s">{</span>
3943   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3944 
3945   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.FC+1.T3.DB0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3946 <span class="s">}</span>
3947 
3948 <span class="c"># O=+ : POSITIVELY CHARGED OXENIUM (DICOORDINATE) OXYGEN</span>
3949 <span class="c">#</span>
<a name="_IsPositivelyChargedOxeniumOxygen-"></a>3950 <span class="k">sub </span><span class="m">_IsPositivelyChargedOxeniumOxygen</span> <span class="s">{</span>
3951   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3952 
3953   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.FC+1.T2.DB1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3954 <span class="s">}</span>
3955 
3956 <span class="c"># OFUR : AROMATIC OXYGEN AS IN FURAN</span>
3957 <span class="c">#</span>
<a name="_IsAromaticOxygen-"></a>3958 <span class="k">sub </span><span class="m">_IsAromaticOxygen</span> <span class="s">{</span>
3959   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3960 
3961   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.Ar.RA5&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3962 <span class="s">}</span>
3963 
3964 <span class="c"># OH2 : OXYGEN ON WATER</span>
3965 <span class="c">#</span>
<a name="_IsWaterOxygen-"></a>3966 <span class="k">sub </span><span class="m">_IsWaterOxygen</span> <span class="s">{</span>
3967   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3968 
3969   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.T2.TSB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;H&#39;</span><span class="cm">,</span> <span class="q">&#39;H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3970 <span class="s">}</span>
3971 
3972 <span class="c"># PO4 : PHOSPHOROUS IN PHOSPHATES AND PHOSPHODIESTERS</span>
3973 <span class="c">#</span>
<a name="_IsPhosphateOrPhosphodiesterPhosphorus-"></a>3974 <span class="k">sub </span><span class="m">_IsPhosphateOrPhosphodiesterPhosphorus</span> <span class="s">{</span>
3975   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3976 
3977   <span class="c"># Phosphate: R-O-P(=O)(-O)-O; Phosphate diester: R&#39;-O-P(=O)(-O)-O-R&quot;</span>
3978 
3979   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;P.T4.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3980 <span class="s">}</span>
3981 
3982 <span class="c"># PO3 : TETRACOORDINATE P WITH THREE ATTACHED OXYGENS</span>
3983 <span class="c">#</span>
<a name="_IsPhosphonatePhosphorus-"></a>3984 <span class="k">sub </span><span class="m">_IsPhosphonatePhosphorus</span> <span class="s">{</span>
3985   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3986 
3987   <span class="c"># Phosphonate: R-P(=O)(-O)-O; Phosphonate ester: R&#39;-P(=O)(-O)-O-R&quot;</span>
3988 
3989   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;P.T4.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3990 <span class="s">}</span>
3991 
3992 <span class="c"># PO2 : TETRACOORDINATE P WITH TWO ATTACHED OXYGENS</span>
3993 <span class="c">#</span>
<a name="_IsPhosphinatePhosphorus-"></a>3994 <span class="k">sub </span><span class="m">_IsPhosphinatePhosphorus</span> <span class="s">{</span>
3995   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3996 
3997   <span class="c"># Phosphinate: R-P(=O)(-O)-R&quot;; Phosphinate ester: R&#39;-P(=O)(-O)-R&quot;</span>
3998 
3999   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;P.T4.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4000 <span class="s">}</span>
4001 
4002 <span class="c"># PO : TETRACOORDINATE P WITH ONE ATTACHED OXYGEN</span>
4003 <span class="c">#</span>
<a name="_IsPhosphoxidePhosphorus-"></a>4004 <span class="k">sub </span><span class="m">_IsPhosphoxidePhosphorus</span> <span class="s">{</span>
4005   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4006 
4007   <span class="c"># Phosphoxide: R-P(=O)(-R&quot;)-R&#39;&#39;&#39;</span>
4008 
4009   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;P.T4.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4010 <span class="s">}</span>
4011 
4012 <span class="c"># PTET : GENERAL TETRACOORDINATE PHOSPHORUS</span>
4013 <span class="c">#</span>
<a name="_IsTetraCoordinatedPhosphorus-"></a>4014 <span class="k">sub </span><span class="m">_IsTetraCoordinatedPhosphorus</span> <span class="s">{</span>
4015   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4016 
4017   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;P.T4&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4018 <span class="s">}</span>
4019 
4020 <span class="c"># P : TRICOORDINATE P, AS IN PHOSPHINES</span>
4021 <span class="c">#</span>
<a name="_IsTriCoordinatedPhosphorus-"></a>4022 <span class="k">sub </span><span class="m">_IsTriCoordinatedPhosphorus</span> <span class="s">{</span>
4023   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4024 
4025   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;P.T3&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4026 <span class="s">}</span>
4027 
4028 <span class="c"># -P=C : PHOSPHOROUS DOUBLY BONDED TO CARBON</span>
4029 <span class="c">#</span>
<a name="_IsDoublyBondedToCarbonPhosphorous-"></a>4030 <span class="k">sub </span><span class="m">_IsDoublyBondedToCarbonPhosphorous</span> <span class="s">{</span>
4031   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4032 
4033   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;P.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4034 <span class="s">}</span>
4035 
4036 <span class="c"># S : SULFUR IN THIOETHERS AND MERCAPTANS</span>
4037 <span class="c">#</span>
<a name="_IsThioEthersOrMercaptansSulfur-"></a>4038 <span class="k">sub </span><span class="m">_IsThioEthersOrMercaptansSulfur</span> <span class="s">{</span>
4039   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4040 
4041   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioEtherSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span> || <span class="i">$This</span><span class="i">-&gt;_IsMercaptansSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4042 
4043   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
4044 <span class="s">}</span>
4045 
4046 <span class="c"># Thioethers: R&#39;-S-R&quot;</span>
4047 <span class="c">#</span>
<a name="_IsThioEtherSulfur-"></a>4048 <span class="k">sub </span><span class="m">_IsThioEtherSulfur</span> <span class="s">{</span>
4049   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4050   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
4051 
4052   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.X2.T2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;C&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4053 <span class="s">}</span>
4054 
4055 <span class="c"># Mercaptans or Thiols: R-S-H</span>
4056 <span class="c">#</span>
<a name="_IsMercaptansSulfur-"></a>4057 <span class="k">sub </span><span class="m">_IsMercaptansSulfur</span> <span class="s">{</span>
4058   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4059 
4060   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.T2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4061 <span class="s">}</span>
4062 
4063 <span class="c"># Is it a divalent dicoordinated Sulfur...</span>
4064 <span class="c">#</span>
<a name="_IsDivalentDiCoordinatedSulfur-"></a>4065 <span class="k">sub </span><span class="m">_IsDivalentDiCoordinatedSulfur</span> <span class="s">{</span>
4066   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4067 
4068   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.T2.FC0&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4069 <span class="s">}</span>
4070 
4071 <span class="c"># S=C : TERMINAL SULFUR DOUBLY BONDED TO CARBON</span>
4072 <span class="c">#</span>
<a name="_IsSCTerminalSulfur-"></a>4073 <span class="k">sub </span><span class="m">_IsSCTerminalSulfur</span> <span class="s">{</span>
4074   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4075 
4076   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.X1.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4077 <span class="s">}</span>
4078 
4079 <span class="c"># &gt;S=N : SULFUR, TRICOORD, DOUBLY BONDED TO N</span>
4080 <span class="c">#</span>
<a name="_IsSNTricoordinatedSulfur-"></a>4081 <span class="k">sub </span><span class="m">_IsSNTricoordinatedSulfur</span> <span class="s">{</span>
4082   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4083 
4084   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4085 <span class="s">}</span>
4086 
4087 <span class="c"># S=O : SULFUR IN SULFOXIDES</span>
4088 <span class="c">#</span>
<a name="_IsSulfoxideSulfur-"></a>4089 <span class="k">sub </span><span class="m">_IsSulfoxideSulfur</span> <span class="s">{</span>
4090   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4091 
4092   <span class="c"># Sulfone: R&#39;-S(=O)-R&quot;, R&#39;-S(=O)-O-R&quot;, and so on...</span>
4093 
4094   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4095 <span class="s">}</span>
4096 
4097 <span class="c"># SO2 : SULFUR IN SULFONES</span>
4098 <span class="c">#</span>
<a name="_IsSulfoneSulfur-"></a>4099 <span class="k">sub </span><span class="m">_IsSulfoneSulfur</span> <span class="s">{</span>
4100   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4101 
4102   <span class="c"># Sulfone: R&#39;-S(=O)(=O)-R&quot;</span>
4103 
4104   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.T4.DB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4105 <span class="s">}</span>
4106 
4107 <span class="c">#  =SO2: SULFONE SULPHER DOUBLY BONDED TO CARBON</span>
4108 <span class="c">#</span>
<a name="_IsDoublyBondedToCarbonSulfoneSulfur-"></a>4109 <span class="k">sub </span><span class="m">_IsDoublyBondedToCarbonSulfoneSulfur</span> <span class="s">{</span>
4110   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4111 
4112   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.T3.DB3&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4113 <span class="s">}</span>
4114 
4115 <span class="c"># SO2N : SULFUR IN SULFONAMIDES</span>
4116 <span class="c">#</span>
<a name="_IsSulfonamideSulfur-"></a>4117 <span class="k">sub </span><span class="m">_IsSulfonamideSulfur</span> <span class="s">{</span>
4118   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4119 
4120   <span class="c"># Sulfonamide: R-S(=O)(=O)-N(-R)(-R&quot;)</span>
4121 
4122   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.T4.DB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4123 <span class="s">}</span>
4124 
4125 <span class="c"># SO3 : SULFONATE SULFUR</span>
4126 <span class="c">#</span>
<a name="_IsSulfonateSulfur-"></a>4127 <span class="k">sub </span><span class="m">_IsSulfonateSulfur</span> <span class="s">{</span>
4128   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4129 
4130   <span class="c"># Sulfonate ion: R&#39;-S(=O)(=O)-(O-); Sulfonate ester: R&#39;-S(=O)(=O)-O-R&quot;</span>
4131 
4132   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.T4.DB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4133 <span class="s">}</span>
4134 
4135 <span class="c"># SO4 : SULFATE SULFUR</span>
4136 <span class="c">#</span>
<a name="_IsSulfateSulfur-"></a>4137 <span class="k">sub </span><span class="m">_IsSulfateSulfur</span> <span class="s">{</span>
4138   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4139 
4140   <span class="c"># Sulfate ion: (O-)-S(=O)(=O)-(O-); Sulfate esters: R-O-S(=O)(=O)-O-R&quot;</span>
4141 
4142   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.T4.DB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4143 <span class="s">}</span>
4144 
4145 <span class="c"># SNO : SULFUR IN NITROGEN ANALOG OF A SULFONE</span>
4146 <span class="c">#</span>
<a name="_IsNitrogenAnalogOfSulfoneSulfur-"></a>4147 <span class="k">sub </span><span class="m">_IsNitrogenAnalogOfSulfoneSulfur</span> <span class="s">{</span>
4148   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4149 
4150   <span class="c"># Sulfone: R&#39;-S(=N)(=O)-R&quot;</span>
4151 
4152   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.T4.DB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;N&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4153 <span class="s">}</span>
4154 
4155 <span class="c"># STHI : SULFUR AS IN THIOPHENE</span>
4156 <span class="c">#</span>
<a name="_IsSTHISulfur-"></a>4157 <span class="k">sub </span><span class="m">_IsSTHISulfur</span> <span class="s">{</span>
4158   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4159 
4160   <span class="c"># Is it an aromatic atom in a five membered ring?</span>
4161   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.Ar.RA5.FC0&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4162     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
4163   <span class="s">}</span>
4164 
4165   <span class="c"># Is it part of five membered ring containing only one hetero atom?</span>
4166   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="cm">,</span> <span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="s">)</span><span class="sc">;</span>
4167 
4168   <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetRingsWithSize</span><span class="s">(</span><span class="n">5</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4169     <span class="s">(</span><span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;_GetHeteroAtomsInformationInRing</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
4170     <span class="k">if</span> <span class="s">(</span><span class="i">$RingIsAromatic</span> &amp;&amp; <span class="i">$NumOfHeteroAtoms</span> == <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
4171       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
4172     <span class="s">}</span>
4173   <span class="s">}</span>
4174   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
4175 <span class="s">}</span>
4176 
4177 <span class="c"># S-P : TERMINAL SULFUR BONDED TO PHOSPHORUS</span>
4178 <span class="c">#</span>
<a name="_IsSPTerminalSulfur-"></a>4179 <span class="k">sub </span><span class="m">_IsSPTerminalSulfur</span> <span class="s">{</span>
4180   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4181 
4182   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.X1.T2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;P&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4183 <span class="s">}</span>
4184 
4185 <span class="c"># S2CM : TERMINAL SULFUR IN THIOCARBOXYLATE ANION</span>
4186 <span class="c">#</span>
<a name="_IsThioCarboxylateAnionTerminalSulfur-"></a>4187 <span class="k">sub </span><span class="m">_IsThioCarboxylateAnionTerminalSulfur</span> <span class="s">{</span>
4188   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4189   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
4190 
4191   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.X1.FC-1, S.X1.DB1.FC0&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4192     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
4193   <span class="s">}</span>
4194 
4195   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;C.DB1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4196     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioCarboxylateAnionCarbon</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4197       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
4198     <span class="s">}</span>
4199   <span class="s">}</span>
4200   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
4201 <span class="s">}</span>
4202 
4203 <span class="c"># SM : TERMINAL SULFUR - FORMAL CHARGE=-1</span>
4204 <span class="c">#</span>
<a name="_IsNegativelyChargedTerminalSulfur-"></a>4205 <span class="k">sub </span><span class="m">_IsNegativelyChargedTerminalSulfur</span> <span class="s">{</span>
4206   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4207 
4208   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.X1.FC-1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4209 <span class="s">}</span>
4210 
4211 <span class="c"># SSMO : TERMINAL SULFUR IN THIOSULFINATE GROUP</span>
4212 <span class="c">#</span>
<a name="_IsThioSulfinateTerminalSulfur-"></a>4213 <span class="k">sub </span><span class="m">_IsThioSulfinateTerminalSulfur</span> <span class="s">{</span>
4214   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4215   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
4216 
4217   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.X1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S.FC+1&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4218     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
4219   <span class="s">}</span>
4220 
4221   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighborsUsingAtomSpecification</span><span class="s">(</span><span class="q">&#39;S.FC+1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4222     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioSulfinateSulfur</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4223       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
4224     <span class="s">}</span>
4225   <span class="s">}</span>
4226   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
4227 <span class="s">}</span>
4228 
4229 <span class="c"># SO2M : SULFUR IN NEGATIVELY CHARGED SULFINATE GROUP</span>
4230 <span class="c">#</span>
<a name="_IsNegativelyChargedSulfinateSulfur-"></a>4231 <span class="k">sub </span><span class="m">_IsNegativelyChargedSulfinateSulfur</span> <span class="s">{</span>
4232   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4233 
4234   <span class="c"># Sulfinate ion: R&#39;-S(=O)-(O-)</span>
4235 
4236   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O.X1.FC-1&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4237 <span class="s">}</span>
4238 
4239 <span class="c"># Sulfinate: R&#39;-S(=O)-OH; Sulfinate esters: R&#39;-S(=O)-O-R</span>
4240 <span class="c">#</span>
<a name="_IsSulfinateSulfur-"></a>4241 <span class="k">sub </span><span class="m">_IsSulfinateSulfur</span> <span class="s">{</span>
4242   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4243 
4244   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.T3.DB1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O.X1.FC0,O.X2&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4245 <span class="s">}</span>
4246 
4247 <span class="c"># SSOM : TRICOORD SULFUR IN THIOSULFINATE GROUP</span>
4248 <span class="c">#</span>
<a name="_IsTriCoordinatedThioSulfinateSulfur-"></a>4249 <span class="k">sub </span><span class="m">_IsTriCoordinatedThioSulfinateSulfur</span> <span class="s">{</span>
4250   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4251   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
4252 
4253   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.X3&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4254     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
4255   <span class="s">}</span>
4256 
4257   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsThioSulfinateSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4258       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
4259   <span class="s">}</span>
4260 
4261   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
4262 <span class="s">}</span>
4263 
4264 <span class="c"># Is it a Thiosulfinate group?</span>
4265 <span class="c">#</span>
<a name="_IsThioSulfinateSulfur-"></a>4266 <span class="k">sub </span><span class="m">_IsThioSulfinateSulfur</span> <span class="s">{</span>
4267   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4268 
4269   <span class="c"># R&#39;-[S+1](-[O-1])-S-R&quot;</span>
4270 
4271   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.FC+1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O.FC-1&#39;</span><span class="cm">,</span> <span class="q">&#39;S&#39;</span><span class="cm">,</span> <span class="q">&#39;!O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4272 <span class="s">}</span>
4273 
4274 <span class="c">#   =S=O:  SULFINYL SULFUR, EG. IN C=S=O</span>
4275 <span class="c">#</span>
<a name="_IsSulfinylSulfur-"></a>4276 <span class="k">sub </span><span class="m">_IsSulfinylSulfur</span> <span class="s">{</span>
4277   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4278 
4279   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.X2.DB2&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4280 <span class="s">}</span>
4281 
4282 <span class="c"># CLO4 : CHLORINE IN PERCHLORATE ANION, CLO4(-)</span>
4283 <span class="c">#</span>
<a name="_IsPerChlorateAnionChlorine-"></a>4284 <span class="k">sub </span><span class="m">_IsPerChlorateAnionChlorine</span> <span class="s">{</span>
4285   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4286 
4287   <span class="c"># R-O-Cl(=O)(=O)=O or (O-)-Cl(=O)(=O)=O</span>
4288   <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;Cl.X4.DB3&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O.X1.FC-1,O.T2.FC0&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4289     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
4290   <span class="s">}</span>
4291 
4292   <span class="c"># Match distributed formal charge of -0.25 on each Oxygen?</span>
4293   <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;Cl.X4.DB3&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O.FC-0.25&#39;</span><span class="cm">,</span> <span class="q">&#39;O.FC-0.25&#39;</span><span class="cm">,</span> <span class="q">&#39;O.FC-0.25&#39;</span><span class="cm">,</span> <span class="q">&#39;O.FC-0.25&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4294     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
4295   <span class="s">}</span>
4296 
4297   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
4298 <span class="s">}</span>
4299 
4300 <span class="c"># Get MMFF94 atom type for Hydrogen attached to Carbon...</span>
4301 <span class="c">#</span>
<a name="_GetAtomTypeForHydrogenAttachedToCarbon-"></a>4302 <span class="k">sub </span><span class="m">_GetAtomTypeForHydrogenAttachedToCarbon</span> <span class="s">{</span>
4303   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$CarbonAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4304   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
4305 
4306   <span class="c"># HC :  H  ATTACHED TO C</span>
4307   <span class="i">$AtomType</span> = <span class="q">&#39;HC&#39;</span><span class="sc">;</span>
4308 
4309   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
4310 <span class="s">}</span>
4311 
4312 <span class="c"># Get MMFF94 atom type for Hydrogen attached to Nitrogen...</span>
4313 <span class="c">#</span>
4314 <span class="c"># 25 AtomTypeSymbols for element H:</span>
4315 <span class="c">#</span>
4316 <span class="c"># AtomTypeSymbol   AtomTypeNum   AtomTypeDefinition</span>
4317 <span class="c">#   HNR      23    H-N(SP3)</span>
4318 <span class="c">#   H3N      23    H-N(SP3), AMMONIA</span>
4319 <span class="c">#   HPYL     23    H-N IN PYRROLE</span>
4320 <span class="c">#   HNOX     23    H-N IN IN A N-OXIDE</span>
4321 <span class="c">#   HNM      23    H ON DICOORD, NEGATIVELY CHARGED NITROGEN</span>
4322 <span class="c">#   HN       23    GENERAL H ON NITROGEN</span>
4323 <span class="c">#   HN=N     27    AZO HYDROGEN</span>
4324 <span class="c">#   HN=C     27    IMINE HYDROGEN</span>
4325 <span class="c">#   HNCO     28    AMIDE HYDROGEN</span>
4326 <span class="c">#   HNCS     28    THIOAMIDE HYDROGEN</span>
4327 <span class="c">#   HNCC     28    H-N IN ENAMINES</span>
4328 <span class="c">#   HNCN     28    H-N IN H-N-C=N</span>
4329 <span class="c">#   HNNC     28    H-N IN H-N-N=C</span>
4330 <span class="c">#   HNNN     28    H-N IN H-N-N=N</span>
4331 <span class="c">#   HNSO     28    H-N IN SULFONAMIDE</span>
4332 <span class="c">#   HNPO     28    H-N IN PHOSPHONAMIDE</span>
4333 <span class="c">#   HNC%     28    HYDROGEN ON N ATTACHED TO TRIPLY BONDED CARBON</span>
4334 <span class="c">#   HSP2     28    GENERAL H ON SP2 NITROGEN</span>
4335 <span class="c">#   HNR+     36    H ON QUATERNARY NITROGEN</span>
4336 <span class="c">#   HIM+     36    H ON IMIDAZOLIUM-TYPE NITROGEN</span>
4337 <span class="c">#   HPD+     36    H ON PROTONATED PYRIDINE NITROGEN</span>
4338 <span class="c">#   HNN+     36    H ON AMIDINIUM-TYPE NITROGEN</span>
4339 <span class="c">#   HNC+     36    H ON PROTONATED IMINE NITROGEN</span>
4340 <span class="c">#   HGD+     36    H ON GUANIDINIUM-TYPE NITROGEN</span>
4341 <span class="c">#   HN5+     36    H ON N5+, N5A+ OR N5B+</span>
4342 <span class="c">#</span>
<a name="_GetAtomTypeForHydrogenAttachedToNitrogen-"></a>4343 <span class="k">sub </span><span class="m">_GetAtomTypeForHydrogenAttachedToNitrogen</span> <span class="s">{</span>
4344   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4345   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="cm">,</span> <span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="s">)</span><span class="sc">;</span>
4346 
4347   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
4348 
4349   <span class="s">(</span><span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="s">)</span> = <span class="s">(</span><span class="q">&#39;0&#39;</span><span class="s">)</span> x <span class="n">2</span><span class="sc">;</span>
4350 
4351   <span class="s">(</span><span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="s">)</span> = <span class="i">$NitrogenAtom</span><span class="i">-&gt;GetNumOfSigmaAndPiBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4352   <span class="i">$NumOfSigmaBonds</span> += <span class="i">$NitrogenAtom</span><span class="i">-&gt;GetAtomicInvariantValue</span><span class="s">(</span><span class="q">&#39;H&#39;</span><span class="s">)</span><span class="sc">;</span>
4353 
4354   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
4355 
4356     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfPiBonds</span> == <span class="n">0</span><span class="s">)</span> <span class="s">{</span>
4357       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForHydrogenAttachedToNitrogenWithOnlySigmaBonds</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="sc">;</span>
4358       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4359     <span class="s">}</span>
4360 
4361     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfPiBonds</span> == <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
4362       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForHydrogenAttachedToNitrogenWithOnePiBond</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="sc">;</span>
4363       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4364     <span class="s">}</span>
4365 
4366     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfPiBonds</span> == <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
4367       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForHydrogenAttachedToNitrogenWithTwoPiBonds</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="sc">;</span>
4368       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4369     <span class="s">}</span>
4370 
4371     <span class="c"># HN : GENERAL H ON NITROGEN</span>
4372     <span class="i">$AtomType</span> = <span class="q">&#39;HN&#39;</span><span class="sc">;</span>
4373   <span class="s">}</span>
4374   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
4375 <span class="s">}</span>
4376 
4377 <span class="c"># Get atom type for Hydrogen attached to a Nitrogen with only sigma bonds...</span>
4378 <span class="c">#</span>
<a name="_GetAtomTypeForHydrogenAttachedToNitrogenWithOnlySigmaBonds-"></a>4379 <span class="k">sub </span><span class="m">_GetAtomTypeForHydrogenAttachedToNitrogenWithOnlySigmaBonds</span> <span class="s">{</span>
4380   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4381   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
4382 
4383   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
4384 
4385   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
4386 
4387     <span class="c"># HNC% : HYDROGEN ON N ATTACHED TO TRIPLY BONDED CARBON</span>
4388     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToTriplyBondedToCarbonNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4389       <span class="i">$AtomType</span> = <span class="q">&#39;HNC%&#39;</span><span class="sc">;</span>
4390       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4391     <span class="s">}</span>
4392 
4393     <span class="c"># HPYL : H-N IN PYRROLE</span>
4394     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToPyrroleNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4395       <span class="i">$AtomType</span> = <span class="q">&#39;HPYL&#39;</span><span class="sc">;</span>
4396       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4397     <span class="s">}</span>
4398 
4399     <span class="c"># HN5+ : H ON N5+, N5A+ OR N5B+</span>
4400     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToFiveMemberedHetreoCyclicPostivelyChargedNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4401       <span class="i">$AtomType</span> =  <span class="q">&#39;HN5+&#39;</span><span class="sc">;</span>
4402       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4403     <span class="s">}</span>
4404 
4405     <span class="c"># HGD+ : H ON GUANIDINIUM-TYPE NITROGEN</span>
4406     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToGuanidiniumNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4407       <span class="i">$AtomType</span> = <span class="q">&#39;HGD+&#39;</span><span class="sc">;</span>
4408       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4409     <span class="s">}</span>
4410 
4411     <span class="c"># HNCS : THIOAMIDE HYDROGEN</span>
4412     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToThioamideNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4413       <span class="i">$AtomType</span> = <span class="q">&#39;HNCS&#39;</span><span class="sc">;</span>
4414       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4415     <span class="s">}</span>
4416 
4417     <span class="c"># HNCO : AMIDE HYDROGEN</span>
4418     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToAmideNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4419       <span class="i">$AtomType</span> = <span class="q">&#39;HNCO&#39;</span><span class="sc">;</span>
4420       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4421     <span class="s">}</span>
4422 
4423     <span class="c"># HNSO : H-N IN SULFONAMIDE</span>
4424     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToSulfonamideNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4425       <span class="i">$AtomType</span> = <span class="q">&#39;HNSO&#39;</span><span class="sc">;</span>
4426       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4427     <span class="s">}</span>
4428 
4429     <span class="c"># HNPO : H-N IN PHOSPHONAMIDE</span>
4430     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToPhosphonamideNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4431       <span class="i">$AtomType</span> = <span class="q">&#39;HNPO&#39;</span><span class="sc">;</span>
4432       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4433     <span class="s">}</span>
4434 
4435     <span class="c"># HNOX : H-N IN IN A N-OXIDE</span>
4436     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToNOXideNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4437       <span class="i">$AtomType</span> = <span class="q">&#39;HNOX&#39;</span><span class="sc">;</span>
4438       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4439     <span class="s">}</span>
4440 
4441     <span class="c"># HNCC : H-N IN ENAMINES (H-N-C=C)</span>
4442     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToEnamineNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4443       <span class="i">$AtomType</span> = <span class="q">&#39;HNCC&#39;</span><span class="sc">;</span>
4444       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4445     <span class="s">}</span>
4446 
4447     <span class="c"># HNCN : H-N IN H-N-C=N</span>
4448     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToNCNNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4449       <span class="i">$AtomType</span> = <span class="q">&#39;HNCN&#39;</span><span class="sc">;</span>
4450       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4451     <span class="s">}</span>
4452 
4453     <span class="c">#  HNNC : H-N IN H-N-N=C</span>
4454     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToNNCNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4455       <span class="i">$AtomType</span> = <span class="q">&#39;HNNC&#39;</span><span class="sc">;</span>
4456       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4457     <span class="s">}</span>
4458 
4459     <span class="c"># HNNN : H-N IN H-N-N=N</span>
4460     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToNNNNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4461       <span class="i">$AtomType</span> = <span class="q">&#39;HNNN&#39;</span><span class="sc">;</span>
4462       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4463     <span class="s">}</span>
4464 
4465     <span class="c"># HNM : H ON DICOORD, NEGATIVELY CHARGED NITROGEN</span>
4466     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToNegativelyChargedDicoordinatedNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4467       <span class="i">$AtomType</span> = <span class="q">&#39;HNM&#39;</span><span class="sc">;</span>
4468       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4469     <span class="s">}</span>
4470 
4471     <span class="c"># H3N : H-N(SP3), AMMONIA</span>
4472     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToSP3AmmoniaNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4473       <span class="i">$AtomType</span> = <span class="q">&#39;H3N&#39;</span><span class="sc">;</span>
4474       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4475     <span class="s">}</span>
4476 
4477     <span class="c"># HNR : H-N(SP3)</span>
4478     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToSP3Nitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4479       <span class="i">$AtomType</span> = <span class="q">&#39;HNR&#39;</span><span class="sc">;</span>
4480       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4481     <span class="s">}</span>
4482 
4483     <span class="c"># HNR+ : H ON QUATERNARY NITROGEN</span>
4484     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToQuaternaryNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4485       <span class="i">$AtomType</span> = <span class="q">&#39;HNR+&#39;</span><span class="sc">;</span>
4486       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4487     <span class="s">}</span>
4488 
4489     <span class="c"># HN : GENERAL H ON NITROGEN</span>
4490     <span class="i">$AtomType</span> = <span class="q">&#39;HN&#39;</span><span class="sc">;</span>
4491   <span class="s">}</span>
4492   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
4493 <span class="s">}</span>
4494 
4495 <span class="c"># Get atom type for Hydrogen attached to a Nitrogen with one pi bonds...</span>
4496 <span class="c">#</span>
<a name="_GetAtomTypeForHydrogenAttachedToNitrogenWithOnePiBond-"></a>4497 <span class="k">sub </span><span class="m">_GetAtomTypeForHydrogenAttachedToNitrogenWithOnePiBond</span> <span class="s">{</span>
4498   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4499   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
4500 
4501   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
4502 
4503   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
4504 
4505     <span class="c"># HPYL : H-N IN PYRROLE</span>
4506     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToPyrroleNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4507       <span class="i">$AtomType</span> = <span class="q">&#39;HPYL&#39;</span><span class="sc">;</span>
4508       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4509     <span class="s">}</span>
4510 
4511     <span class="c"># HIM+ : H ON IMIDAZOLIUM-TYPE NITROGEN</span>
4512     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToImidazoliumNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4513       <span class="i">$AtomType</span> =  <span class="q">&#39;HIM+&#39;</span><span class="sc">;</span>
4514       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4515     <span class="s">}</span>
4516 
4517     <span class="c"># HN5+ : H ON N5+, N5A+ OR N5B+</span>
4518     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToFiveMemberedHetreoCyclicPostivelyChargedNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4519       <span class="i">$AtomType</span> =  <span class="q">&#39;HN5+&#39;</span><span class="sc">;</span>
4520       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4521     <span class="s">}</span>
4522 
4523     <span class="c"># HPD+ : H ON PROTONATED PYRIDINE NITROGEN</span>
4524     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToPositivelyChargedPyridineNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4525       <span class="i">$AtomType</span> = <span class="q">&#39;HPD+&#39;</span><span class="sc">;</span>
4526       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4527     <span class="s">}</span>
4528 
4529     <span class="c"># HNOX : H-N IN IN A N-OXIDE</span>
4530     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToNOXideNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4531       <span class="i">$AtomType</span> = <span class="q">&#39;HNOX&#39;</span><span class="sc">;</span>
4532       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4533     <span class="s">}</span>
4534 
4535     <span class="c"># HGD+ : H ON GUANIDINIUM-TYPE NITROGEN</span>
4536     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToGuanidiniumNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4537       <span class="i">$AtomType</span> = <span class="q">&#39;HGD+&#39;</span><span class="sc">;</span>
4538       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4539     <span class="s">}</span>
4540 
4541     <span class="c"># HNN+ : H ON AMIDINIUM-TYPE NITROGEN</span>
4542     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToAmidiniumNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4543       <span class="i">$AtomType</span> = <span class="q">&#39;HNN+&#39;</span><span class="sc">;</span>
4544       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4545     <span class="s">}</span>
4546 
4547     <span class="c"># HNC+ : H ON PROTONATED IMINE NITROGEN</span>
4548     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToPositivelyChargedImineNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4549       <span class="i">$AtomType</span> = <span class="q">&#39;HNC+&#39;</span><span class="sc">;</span>
4550       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4551     <span class="s">}</span>
4552 
4553     <span class="c"># HN=N : AZO HYDROGEN</span>
4554     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToAzoNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4555       <span class="i">$AtomType</span> = <span class="q">&#39;HN=N&#39;</span><span class="sc">;</span>
4556       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4557     <span class="s">}</span>
4558 
4559     <span class="c"># HN=C : IMINE HYDROGEN</span>
4560     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToImineNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4561       <span class="i">$AtomType</span> = <span class="q">&#39;HN=C&#39;</span><span class="sc">;</span>
4562       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4563     <span class="s">}</span>
4564 
4565     <span class="c"># HSP2: GENERAL H ON SP2 NITROGEN</span>
4566     <span class="i">$AtomType</span> = <span class="q">&#39;HSP2&#39;</span><span class="sc">;</span>
4567   <span class="s">}</span>
4568   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
4569 <span class="s">}</span>
4570 
4571 <span class="c"># Get atom type for Hydrogen attached to a Nitrogen with two pi bonds...</span>
4572 <span class="c">#</span>
<a name="_GetAtomTypeForHydrogenAttachedToNitrogenWithTwoPiBonds-"></a>4573 <span class="k">sub </span><span class="m">_GetAtomTypeForHydrogenAttachedToNitrogenWithTwoPiBonds</span> <span class="s">{</span>
4574   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4575   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
4576 
4577   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
4578 
4579   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
4580 
4581     <span class="c"># HN : GENERAL H ON NITROGEN</span>
4582     <span class="i">$AtomType</span> = <span class="q">&#39;HN&#39;</span><span class="sc">;</span>
4583   <span class="s">}</span>
4584   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
4585 <span class="s">}</span>
4586 
4587 <span class="c"># HNR : H-N(SP3)</span>
4588 <span class="c">#</span>
<a name="_IsHydrogenAttachedToSP3Nitrogen-"></a>4589 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToSP3Nitrogen</span> <span class="s">{</span>
4590   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4591 
4592   <span class="k">return</span> <span class="i">$NitrogenAtom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T3.FC0&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4593 <span class="s">}</span>
4594 
4595 <span class="c"># H3N : H-N(SP3), AMMONIA</span>
4596 <span class="c">#</span>
<a name="_IsHydrogenAttachedToSP3AmmoniaNitrogen-"></a>4597 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToSP3AmmoniaNitrogen</span> <span class="s">{</span>
4598   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4599 
4600   <span class="k">return</span> <span class="i">$NitrogenAtom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T4.FC+1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;H&#39;</span><span class="cm">,</span> <span class="q">&#39;H&#39;</span><span class="cm">,</span> <span class="q">&#39;H&#39;</span><span class="cm">,</span> <span class="q">&#39;H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4601 <span class="s">}</span>
4602 
4603 <span class="c"># HPYL : H-N IN PYRROLE</span>
4604 <span class="c">#</span>
<a name="_IsHydrogenAttachedToPyrroleNitrogen-"></a>4605 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToPyrroleNitrogen</span> <span class="s">{</span>
4606   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4607 
4608   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsPyrroleNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4609 <span class="s">}</span>
4610 
4611 <span class="c"># HNOX : H-N IN IN A N-OXIDE</span>
4612 <span class="c">#</span>
<a name="_IsHydrogenAttachedToNOXideNitrogen-"></a>4613 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToNOXideNitrogen</span> <span class="s">{</span>
4614   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4615 
4616   <span class="k">return</span> <span class="i">$NitrogenAtom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.FC+1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;O.X1.FC-1&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4617 <span class="s">}</span>
4618 
4619 <span class="c"># HNM : H ON DICOORD, NEGATIVELY CHARGED NITROGEN</span>
4620 <span class="c">#</span>
<a name="_IsHydrogenAttachedToNegativelyChargedDicoordinatedNitrogen-"></a>4621 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToNegativelyChargedDicoordinatedNitrogen</span> <span class="s">{</span>
4622   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4623 
4624   <span class="k">return</span> <span class="i">$NitrogenAtom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T2.FC-1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4625 <span class="s">}</span>
4626 
4627 <span class="c"># HN=N : AZO HYDROGEN</span>
4628 <span class="c">#</span>
<a name="_IsHydrogenAttachedToAzoNitrogen-"></a>4629 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToAzoNitrogen</span> <span class="s">{</span>
4630   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4631 
4632   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsAzoNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4633 <span class="s">}</span>
4634 
4635 <span class="c"># HN=C : IMINE HYDROGEN</span>
4636 <span class="c">#</span>
<a name="_IsHydrogenAttachedToImineNitrogen-"></a>4637 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToImineNitrogen</span> <span class="s">{</span>
4638   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4639 
4640   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsImineNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4641 <span class="s">}</span>
4642 
4643 <span class="c"># HNCO : AMIDE HYDROGEN</span>
4644 <span class="c">#</span>
<a name="_IsHydrogenAttachedToAmideNitrogen-"></a>4645 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToAmideNitrogen</span> <span class="s">{</span>
4646   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4647 
4648   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsAmideNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4649 <span class="s">}</span>
4650 
4651 <span class="c"># HNCS : THIOAMIDE HYDROGEN</span>
4652 <span class="c">#</span>
<a name="_IsHydrogenAttachedToThioamideNitrogen-"></a>4653 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToThioamideNitrogen</span> <span class="s">{</span>
4654   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4655 
4656   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsThioAmideNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4657 <span class="s">}</span>
4658 
4659 <span class="c"># HNCC : H-N IN ENAMINES (H-N-C=C)</span>
4660 <span class="c">#</span>
<a name="_IsHydrogenAttachedToEnamineNitrogen-"></a>4661 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToEnamineNitrogen</span> <span class="s">{</span>
4662   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4663 
4664   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsNCCNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4665 <span class="s">}</span>
4666 
4667 <span class="c"># HNCN : H-N IN H-N-C=N</span>
4668 <span class="c">#</span>
<a name="_IsHydrogenAttachedToNCNNitrogen-"></a>4669 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToNCNNitrogen</span> <span class="s">{</span>
4670   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4671 
4672   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsNCNNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4673 <span class="s">}</span>
4674 
4675 <span class="c">#  HNNC : H-N IN H-N-N=C</span>
4676 <span class="c">#</span>
<a name="_IsHydrogenAttachedToNNCNitrogen-"></a>4677 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToNNCNitrogen</span> <span class="s">{</span>
4678   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4679 
4680   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsNNCNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4681 <span class="s">}</span>
4682 
4683 <span class="c"># HNNN : H-N IN H-N-N=N</span>
4684 <span class="c">#</span>
<a name="_IsHydrogenAttachedToNNNNitrogen-"></a>4685 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToNNNNitrogen</span> <span class="s">{</span>
4686   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4687 
4688   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsNNNNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4689 <span class="s">}</span>
4690 
4691 <span class="c"># HNSO : H-N IN SULFONAMIDE</span>
4692 <span class="c">#</span>
<a name="_IsHydrogenAttachedToSulfonamideNitrogen-"></a>4693 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToSulfonamideNitrogen</span> <span class="s">{</span>
4694   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4695 
4696   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsNSO2SulfonamideNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4697 <span class="s">}</span>
4698 
4699 <span class="c"># HNPO : H-N IN PHOSPHONAMIDE</span>
4700 <span class="c">#</span>
<a name="_IsHydrogenAttachedToPhosphonamideNitrogen-"></a>4701 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToPhosphonamideNitrogen</span> <span class="s">{</span>
4702   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4703 
4704   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsNPO2PhosphonamideNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4705 <span class="s">}</span>
4706 
4707 <span class="c"># HNC% : HYDROGEN ON N ATTACHED TO TRIPLY BONDED CARBON</span>
4708 <span class="c">#</span>
<a name="_IsHydrogenAttachedToTriplyBondedToCarbonNitrogen-"></a>4709 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToTriplyBondedToCarbonNitrogen</span> <span class="s">{</span>
4710   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4711 
4712   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsAttchedToCCTripleBondNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4713 <span class="s">}</span>
4714 
4715 <span class="c"># HSP2 : GENERAL H ON SP2 NITROGEN</span>
4716 <span class="c">#</span>
<a name="_IsHydrogenAttachedToSP2Nitrogen-"></a>4717 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToSP2Nitrogen</span> <span class="s">{</span>
4718   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4719 
4720   <span class="k">return</span> <span class="i">$NitrogenAtom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.DB1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4721 <span class="s">}</span>
4722 
4723 <span class="c"># HNR+ : H ON QUATERNARY NITROGEN</span>
4724 <span class="c">#</span>
<a name="_IsHydrogenAttachedToQuaternaryNitrogen-"></a>4725 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToQuaternaryNitrogen</span> <span class="s">{</span>
4726   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4727 
4728   <span class="k">return</span> <span class="i">$NitrogenAtom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.T4.FC+1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4729 <span class="s">}</span>
4730 
4731 <span class="c"># HIM+ : H ON IMIDAZOLIUM-TYPE NITROGEN</span>
4732 <span class="c">#</span>
<a name="_IsHydrogenAttachedToImidazoliumNitrogen-"></a>4733 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToImidazoliumNitrogen</span> <span class="s">{</span>
4734   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4735 
4736   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsImidazoliumNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4737 <span class="s">}</span>
4738 
4739 <span class="c"># HPD+ : H ON PROTONATED PYRIDINE NITROGEN</span>
4740 <span class="c">#</span>
<a name="_IsHydrogenAttachedToPositivelyChargedPyridineNitrogen-"></a>4741 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToPositivelyChargedPyridineNitrogen</span> <span class="s">{</span>
4742   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4743 
4744   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsPyridiniumNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4745 <span class="s">}</span>
4746 
4747 <span class="c"># HNN+ : H ON AMIDINIUM-TYPE NITROGEN</span>
4748 <span class="c">#</span>
<a name="_IsHydrogenAttachedToAmidiniumNitrogen-"></a>4749 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToAmidiniumNitrogen</span> <span class="s">{</span>
4750   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4751 
4752   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsPositivelyChargedAzoNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4753 <span class="s">}</span>
4754 
4755 <span class="c"># HNC+ : H ON PROTONATED IMINE NITROGEN</span>
4756 <span class="c">#</span>
<a name="_IsHydrogenAttachedToPositivelyChargedImineNitrogen-"></a>4757 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToPositivelyChargedImineNitrogen</span> <span class="s">{</span>
4758   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4759 
4760   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsPositivelyChargedIminiumNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4761 <span class="s">}</span>
4762 
4763 <span class="c"># HGD+ : H ON GUANIDINIUM-TYPE NITROGEN</span>
4764 <span class="c">#</span>
<a name="_IsHydrogenAttachedToGuanidiniumNitrogen-"></a>4765 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToGuanidiniumNitrogen</span> <span class="s">{</span>
4766   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4767 
4768   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsGuanidiniumNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4769 <span class="s">}</span>
4770 
4771 <span class="c"># HN5+ : H ON N5+, N5A+ OR N5B+</span>
4772 <span class="c">#</span>
<a name="_IsHydrogenAttachedToFiveMemberedHetreoCyclicPostivelyChargedNitrogen-"></a>4773 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToFiveMemberedHetreoCyclicPostivelyChargedNitrogen</span> <span class="s">{</span>
4774   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NitrogenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4775 
4776   <span class="k">if</span> <span class="s">(</span>!<span class="i">$NitrogenAtom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.RA5.FC+1&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4777     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
4778   <span class="s">}</span>
4779 
4780   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsPositivelyChargedFiveMemberedHeteroAromaticRingAlphaNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ||
4781          <span class="i">$This</span><span class="i">-&gt;_IsPositivelyChargedFiveMemberedHeteroAromaticRingBetaNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span> ||
4782          <span class="i">$This</span><span class="i">-&gt;_IsPositivelyChargedFiveMemberedHeteroCyclicRingNitrogen</span><span class="s">(</span><span class="i">$NitrogenAtom</span><span class="s">)</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4783 <span class="s">}</span>
4784 
4785 <span class="c"># Get MMFF94 atom type for Hydrogen attached to Oxygen...</span>
4786 <span class="c">#</span>
4787 <span class="c"># 11 AtomTypeSymbols for element H:</span>
4788 <span class="c">#</span>
4789 <span class="c"># AtomTypeSymbol   AtomTypeNum   AtomTypeDefinition</span>
4790 <span class="c">#   HOR      21    HYDROGEN IN ALCOHOLS</span>
4791 <span class="c">#   HO       21    GENERAL H ON OXYGEN</span>
4792 <span class="c">#   HOM      21    HYDROGEN IN HYDROXIDE ANION</span>
4793 <span class="c">#   HOCO     24    H-O IN CARBOXYLIC ACIDS</span>
4794 <span class="c">#   HOP      24    HYDROGEN ON OXYGEN ATTACHED TO PHOSPHOROUS</span>
4795 <span class="c">#   HOCC     29    H-O IN ENOLS AND PHENOLS</span>
4796 <span class="c">#   HOCN     29    H-O IN HO-C=N</span>
4797 <span class="c">#   HOH      31    HYDROGEN IN H2O</span>
4798 <span class="c">#   HOS      33    H ON OXYGEN ATTACHED TO SULFUR</span>
4799 <span class="c">#   HO+      50    HYDROGEN ON O+ OXYGEN</span>
4800 <span class="c">#   HO=+     52    HYDROGEN ON OXENIUM OXYGEN</span>
4801 <span class="c">#</span>
<a name="_GetAtomTypeForHydrogenAttachedToOxygen-"></a>4802 <span class="k">sub </span><span class="m">_GetAtomTypeForHydrogenAttachedToOxygen</span> <span class="s">{</span>
4803   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$OxygenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4804   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
4805 
4806   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
4807 
4808   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
4809 
4810     <span class="c"># HOP : HYDROGEN ON OXYGEN ATTACHED TO PHOSPHOROUS</span>
4811     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToOPOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4812       <span class="i">$AtomType</span> = <span class="q">&#39;HOP&#39;</span><span class="sc">;</span>
4813       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4814     <span class="s">}</span>
4815 
4816     <span class="c"># HOS : H ON OXYGEN ATTACHED TO SULFUR</span>
4817     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToOSOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4818       <span class="i">$AtomType</span> = <span class="q">&#39;HOS&#39;</span><span class="sc">;</span>
4819       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4820     <span class="s">}</span>
4821 
4822     <span class="c"># HOCO : H-O IN CARBOXYLIC ACIDS</span>
4823     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToCarboxylicAcidOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4824       <span class="i">$AtomType</span> = <span class="q">&#39;HOCO&#39;</span><span class="sc">;</span>
4825       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4826     <span class="s">}</span>
4827 
4828     <span class="c"># HOCC : H-O IN ENOLS AND PHENOLS</span>
4829     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToEnolOrPhenolOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4830       <span class="i">$AtomType</span> = <span class="q">&#39;HOCC&#39;</span><span class="sc">;</span>
4831       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4832     <span class="s">}</span>
4833 
4834     <span class="c"># HOCN : H-O IN HO-C=N</span>
4835     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToOCNOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4836       <span class="i">$AtomType</span> = <span class="q">&#39;HOCN&#39;</span><span class="sc">;</span>
4837       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4838     <span class="s">}</span>
4839 
4840     <span class="c"># HOM : HYDROGEN IN HYDROXIDE ANION</span>
4841     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToHydroxideAnionOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4842       <span class="i">$AtomType</span> = <span class="q">&#39;HOM&#39;</span><span class="sc">;</span>
4843       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4844     <span class="s">}</span>
4845 
4846     <span class="c"># HO+ : HYDROGEN ON O+ OXYGEN</span>
4847     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToPositivelyChargedOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4848       <span class="i">$AtomType</span> = <span class="q">&#39;HO+&#39;</span><span class="sc">;</span>
4849       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4850     <span class="s">}</span>
4851 
4852     <span class="c"># HO=+ : HYDROGEN ON OXENIUM OXYGEN</span>
4853     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToOxeniumOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4854       <span class="i">$AtomType</span> = <span class="q">&#39;HO=+&#39;</span><span class="sc">;</span>
4855       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4856     <span class="s">}</span>
4857 
4858     <span class="c"># HOR : HYDROGEN IN ALCOHOLS</span>
4859     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToAlcoholOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4860       <span class="i">$AtomType</span> = <span class="q">&#39;HOR&#39;</span><span class="sc">;</span>
4861       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4862     <span class="s">}</span>
4863 
4864     <span class="c"># HOH : HYDROGEN IN H2O</span>
4865     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHydrogenAttachedToWaterOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4866       <span class="i">$AtomType</span> = <span class="q">&#39;HOH&#39;</span><span class="sc">;</span>
4867       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4868     <span class="s">}</span>
4869 
4870     <span class="c"># HO: GENERAL H ON OXYGEN</span>
4871     <span class="i">$AtomType</span> = <span class="q">&#39;HO&#39;</span><span class="sc">;</span>
4872   <span class="s">}</span>
4873   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
4874 <span class="s">}</span>
4875 
4876 <span class="c"># HOR : HYDROGEN IN ALCOHOLS</span>
4877 <span class="c">#</span>
<a name="_IsHydrogenAttachedToAlcoholOxygen-"></a>4878 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToAlcoholOxygen</span> <span class="s">{</span>
4879   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$OxygenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4880 
4881   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsAlcoholOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4882 <span class="s">}</span>
4883 
4884 <span class="c"># HO : GENERAL H ON OXYGEN</span>
4885 <span class="c">#</span>
<a name="_IsHydrogenAttachedToOxygen-"></a>4886 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToOxygen</span> <span class="s">{</span>
4887   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$OxygenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4888 
4889   <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
4890 <span class="s">}</span>
4891 
4892 <span class="c"># HOM : HYDROGEN IN HYDROXIDE ANION</span>
4893 <span class="c">#</span>
<a name="_IsHydrogenAttachedToHydroxideAnionOxygen-"></a>4894 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToHydroxideAnionOxygen</span> <span class="s">{</span>
4895   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$OxygenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4896 
4897   <span class="c"># H-(O-)</span>
4898   <span class="k">return</span> <span class="i">$OxygenAtom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.FC-1.T1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;H&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4899 <span class="s">}</span>
4900 
4901 <span class="c"># HOCO : H-O IN CARBOXYLIC ACIDS</span>
4902 <span class="c">#</span>
<a name="_IsHydrogenAttachedToCarboxylicAcidOxygen-"></a>4903 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToCarboxylicAcidOxygen</span> <span class="s">{</span>
4904   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$OxygenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4905 
4906   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsEsterOrCarboxylicAcidOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4907 <span class="s">}</span>
4908 
4909 <span class="c"># HOP : HYDROGEN ON OXYGEN ATTACHED TO PHOSPHOROUS</span>
4910 <span class="c">#</span>
<a name="_IsHydrogenAttachedToOPOxygen-"></a>4911 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToOPOxygen</span> <span class="s">{</span>
4912   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$OxygenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4913 
4914   <span class="k">return</span> <span class="i">$OxygenAtom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;P&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4915 <span class="s">}</span>
4916 
4917 <span class="c"># HOCC : H-O IN ENOLS AND PHENOLS</span>
4918 <span class="c">#</span>
<a name="_IsHydrogenAttachedToEnolOrPhenolOxygen-"></a>4919 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToEnolOrPhenolOxygen</span> <span class="s">{</span>
4920   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$OxygenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4921 
4922   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsEnolicOrPhenolicOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4923 <span class="s">}</span>
4924 
4925 <span class="c"># HOCN : H-O IN HO-C=N</span>
4926 <span class="c">#</span>
<a name="_IsHydrogenAttachedToOCNOxygen-"></a>4927 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToOCNOxygen</span> <span class="s">{</span>
4928   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$OxygenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4929 
4930   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsOCNDivalentOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4931 <span class="s">}</span>
4932 
4933 <span class="c"># HOH : HYDROGEN IN H2O</span>
4934 <span class="c">#</span>
<a name="_IsHydrogenAttachedToWaterOxygen-"></a>4935 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToWaterOxygen</span> <span class="s">{</span>
4936   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$OxygenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4937 
4938   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsWaterOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4939 <span class="s">}</span>
4940 
4941 <span class="c"># HOS : H ON OXYGEN ATTACHED TO SULFUR</span>
4942 <span class="c">#</span>
<a name="_IsHydrogenAttachedToOSOxygen-"></a>4943 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToOSOxygen</span> <span class="s">{</span>
4944   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$OxygenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4945 
4946   <span class="k">return</span> <span class="i">$OxygenAtom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;S&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4947 <span class="s">}</span>
4948 
4949 <span class="c"># HO+ : HYDROGEN ON O+ OXYGEN</span>
4950 <span class="c">#</span>
<a name="_IsHydrogenAttachedToPositivelyChargedOxygen-"></a>4951 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToPositivelyChargedOxygen</span> <span class="s">{</span>
4952   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$OxygenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4953 
4954   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsPositivelyChargedOxoniumOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4955 <span class="s">}</span>
4956 
4957 <span class="c"># HO=+ : HYDROGEN ON OXENIUM OXYGEN</span>
4958 <span class="c">#</span>
<a name="_IsHydrogenAttachedToOxeniumOxygen-"></a>4959 <span class="k">sub </span><span class="m">_IsHydrogenAttachedToOxeniumOxygen</span> <span class="s">{</span>
4960   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$OxygenAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4961 
4962   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsPositivelyChargedOxeniumOxygen</span><span class="s">(</span><span class="i">$OxygenAtom</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4963 <span class="s">}</span>
4964 
4965 <span class="c"># Get MMFF94 atom type for Hydrogen attached to Phosphorus...</span>
4966 <span class="c">#</span>
<a name="_GetAtomTypeForHydrogenAttachedToPhosphorus-"></a>4967 <span class="k">sub </span><span class="m">_GetAtomTypeForHydrogenAttachedToPhosphorus</span> <span class="s">{</span>
4968   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$PhosphorusAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4969   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
4970 
4971   <span class="c"># HP : H ATTACHED TO TRI- OR TETRACOORDINATE PHOSPHORUS</span>
4972   <span class="i">$AtomType</span> = <span class="q">&#39;HP&#39;</span><span class="sc">;</span>
4973 
4974   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
4975 <span class="s">}</span>
4976 
4977 <span class="c"># Get MMFF94 atom type for Hydrogen attached to Sulfur...</span>
4978 <span class="c">#</span>
<a name="_GetAtomTypeForHydrogenAttachedToSulfur-"></a>4979 <span class="k">sub </span><span class="m">_GetAtomTypeForHydrogenAttachedToSulfur</span> <span class="s">{</span>
4980   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$SulfurAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4981   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
4982 
4983   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
4984 
4985   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
4986 
4987    <span class="c"># HS=N : H ATTACHED TO TETRAVALENT, TRICOODR S DBL BONDED TO N</span>
4988     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsSNTricoordinatedSulfur</span><span class="s">(</span><span class="i">$SulfurAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4989       <span class="i">$AtomType</span> = <span class="q">&#39;HS=N&#39;</span><span class="sc">;</span>
4990       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4991     <span class="s">}</span>
4992 
4993     <span class="c"># HS : H ATTACHED TO DIVALENT, DICOORDINATE S</span>
4994     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsDivalentDiCoordinatedSulfur</span><span class="s">(</span><span class="i">$SulfurAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4995       <span class="i">$AtomType</span> = <span class="q">&#39;HS&#39;</span><span class="sc">;</span>
4996       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
4997     <span class="s">}</span>
4998 
4999     <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
5000     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomTypeForHydrogenAttachedToSulfur: MMFF94 atom type for Sulfur cann&#39;t be assigned...&quot;</span><span class="sc">;</span>
5001   <span class="s">}</span>
5002   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
5003 <span class="s">}</span>
5004 
5005 <span class="c"># Get MMFF94 atom type for Hydrogen attached to Silicon...</span>
5006 <span class="c">#</span>
<a name="_GetAtomTypeForHydrogenAttachedToSilicon-"></a>5007 <span class="k">sub </span><span class="m">_GetAtomTypeForHydrogenAttachedToSilicon</span> <span class="s">{</span>
5008   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$SiliconAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
5009   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
5010 
5011   <span class="c"># HSI : H ATTACHED TO SI</span>
5012   <span class="i">$AtomType</span> = <span class="q">&#39;HSI&#39;</span><span class="sc">;</span>
5013 
5014   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
5015 <span class="s">}</span>
5016 
5017 <span class="c"># Get information about number and types of hetero atoms present in ring...</span>
5018 <span class="c">#</span>
5019 <span class="c"># Note:</span>
5020 <span class="c">#   . Any atom other than Carbon and Hydrogen atom is considered a hetero atom.</span>
5021 <span class="c">#</span>
<a name="_GetHeteroAtomsInformationInRing-"></a>5022 <span class="k">sub </span><span class="m">_GetHeteroAtomsInformationInRing</span> <span class="s">{</span>
5023   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
5024   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtom</span><span class="cm">,</span> <span class="i">$RingAtomSymbol</span><span class="cm">,</span> <span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfAromaticAtoms</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="cm">,</span> <span class="i">%HeteroAtomSymbolsMap</span><span class="s">)</span><span class="sc">;</span>
5025 
5026   <span class="i">%HeteroAtomSymbolsMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
5027 
5028   <span class="i">$NumOfAromaticAtoms</span> = <span class="n">0</span><span class="sc">;</span>
5029   <span class="i">$NumOfHeteroAtoms</span> = <span class="n">0</span><span class="sc">;</span>
5030 
5031   <span class="j">RINGATOM:</span> <span class="k">for</span> <span class="i">$RingAtom</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$RingAtomsRef</span>}<span class="s">)</span> <span class="s">{</span>
5032     <span class="k">if</span> <span class="s">(</span><span class="i">$RingAtom</span><span class="i">-&gt;IsAromatic</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
5033       <span class="i">$NumOfAromaticAtoms</span>++<span class="sc">;</span>
5034     <span class="s">}</span>
5035 
5036     <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;_IsHeteroAtom</span><span class="s">(</span><span class="i">$RingAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
5037       <span class="k">next</span> <span class="j">RINGATOM</span><span class="sc">;</span>
5038     <span class="s">}</span>
5039     <span class="i">$NumOfHeteroAtoms</span>++<span class="sc">;</span>
5040 
5041     <span class="i">$RingAtomSymbol</span> = <span class="i">$RingAtom</span><span class="i">-&gt;GetAtomSymbol</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
5042     <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$HeteroAtomSymbolsMap</span>{<span class="i">$RingAtomSymbol</span>}<span class="s">)</span> <span class="s">{</span>
5043       <span class="i">$HeteroAtomSymbolsMap</span>{<span class="i">$RingAtomSymbol</span>} += <span class="n">1</span><span class="sc">;</span>
5044     <span class="s">}</span>
5045     <span class="k">else</span> <span class="s">{</span>
5046       <span class="i">$HeteroAtomSymbolsMap</span>{<span class="i">$RingAtomSymbol</span>} = <span class="n">1</span><span class="sc">;</span>
5047     <span class="s">}</span>
5048   <span class="s">}</span>
5049   <span class="i">$RingIsAromatic</span> = <span class="s">(</span><span class="i">$NumOfAromaticAtoms</span> == <span class="k">scalar</span> <span class="i">@</span>{<span class="i">$RingAtomsRef</span>}<span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
5050 
5051   <span class="k">return</span> <span class="s">(</span><span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="cm">,</span> \<span class="i">%HeteroAtomSymbolsMap</span><span class="s">)</span><span class="sc">;</span>
5052 <span class="s">}</span>
5053 
5054 <span class="c"># Check whether specified atom has a hetero atom at alpha position in an aromatic ring...</span>
5055 <span class="c">#</span>
<a name="_IsAtomPositionAlphaInHeteroAromaticRing-"></a>5056 <span class="k">sub </span><span class="m">_IsAtomPositionAlphaInHeteroAromaticRing</span> <span class="s">{</span>
5057   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
5058   <span class="k">my</span><span class="s">(</span><span class="i">$CheckRingAromaticity</span><span class="s">)</span><span class="sc">;</span>
5059 
5060   <span class="i">$CheckRingAromaticity</span> = <span class="n">1</span><span class="sc">;</span>
5061 
5062   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsAtomPositionAlphaInHeteroRing</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="cm">,</span> <span class="i">$CheckRingAromaticity</span><span class="s">)</span><span class="sc">;</span>
5063 <span class="s">}</span>
5064 
5065 <span class="c"># Check whether specified atom has a hetero atom at beta position in an aromatic ring...</span>
5066 <span class="c">#</span>
<a name="_IsAtomPositionBetaInHeteroAromaticRing-"></a>5067 <span class="k">sub </span><span class="m">_IsAtomPositionBetaInHeteroAromaticRing</span> <span class="s">{</span>
5068   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
5069   <span class="k">my</span><span class="s">(</span><span class="i">$CheckRingAromaticity</span><span class="s">)</span><span class="sc">;</span>
5070 
5071   <span class="i">$CheckRingAromaticity</span> = <span class="n">1</span><span class="sc">;</span>
5072 
5073   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsAtomPositionBetaInHeteroRing</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="cm">,</span> <span class="i">$CheckRingAromaticity</span><span class="s">)</span><span class="sc">;</span>
5074 <span class="s">}</span>
5075 
5076 <span class="c"># Check whether specified atom has a hetero atom at alpha position in an aromatic or non-aromatic</span>
5077 <span class="c"># ring...</span>
5078 <span class="c">#</span>
<a name="_IsAtomPositionAlphaInHeteroRing-"></a>5079 <span class="k">sub </span><span class="m">_IsAtomPositionAlphaInHeteroRing</span> <span class="s">{</span>
5080   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="cm">,</span> <span class="i">$CheckRingAromaticity</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
5081   <span class="k">my</span><span class="s">(</span><span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="cm">,</span> <span class="i">$NumOfAllowedHeteroAtoms</span><span class="cm">,</span> <span class="i">$HeteroAtomPositionsRef</span><span class="s">)</span><span class="sc">;</span>
5082 
5083   <span class="i">$CheckRingAromaticity</span> = <span class="k">defined</span><span class="s">(</span><span class="i">$CheckRingAromaticity</span><span class="s">)</span> &amp;&amp; <span class="i">$CheckRingAromaticity</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
5084 
5085   <span class="c"># Is it an aromatic ring containing appropriate number hertero atoms?</span>
5086   <span class="s">(</span><span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;_GetHeteroAtomsInformationInRing</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
5087   <span class="i">$NumOfAllowedHeteroAtoms</span> = <span class="i">$Atom</span><span class="i">-&gt;IsCarbon</span><span class="s">(</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">2</span><span class="sc">;</span>
5088 
5089   <span class="k">if</span> <span class="s">(</span><span class="i">$CheckRingAromaticity</span> &amp;&amp; !<span class="i">$RingIsAromatic</span><span class="s">)</span> <span class="s">{</span>
5090     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
5091   <span class="s">}</span>
5092 
5093   <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfHeteroAtoms</span> != <span class="i">$NumOfAllowedHeteroAtoms</span><span class="s">)</span> <span class="s">{</span>
5094     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
5095   <span class="s">}</span>
5096 
5097   <span class="c"># Does ring contain hetero atoms at alpha position?</span>
5098   <span class="i">$HeteroAtomPositionsRef</span> = <span class="i">$This</span><span class="i">-&gt;_GetHeteroAtomPositionsInRing</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
5099   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span><span class="s">(</span><span class="i">$HeteroAtomPositionsRef</span>-&gt;{<span class="w">Alpha</span>}<span class="s">)</span> &amp;&amp; !<span class="k">exists</span><span class="s">(</span><span class="i">$HeteroAtomPositionsRef</span>-&gt;{<span class="w">Beta</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
5100     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
5101   <span class="s">}</span>
5102 
5103   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
5104 <span class="s">}</span>
5105 
5106 <span class="c"># Check whether specified atom has a hetero atom at alpha position in an aromatic or non-aromatic</span>
5107 <span class="c"># ring...</span>
5108 <span class="c">#</span>
<a name="_IsAtomPositionBetaInHeteroRing-"></a>5109 <span class="k">sub </span><span class="m">_IsAtomPositionBetaInHeteroRing</span> <span class="s">{</span>
5110   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="cm">,</span> <span class="i">$CheckRingAromaticity</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
5111   <span class="k">my</span><span class="s">(</span><span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="cm">,</span> <span class="i">$NumOfAllowedHeteroAtoms</span><span class="cm">,</span> <span class="i">$HeteroAtomPositionsRef</span><span class="s">)</span><span class="sc">;</span>
5112 
5113   <span class="i">$CheckRingAromaticity</span> = <span class="k">defined</span><span class="s">(</span><span class="i">$CheckRingAromaticity</span><span class="s">)</span> &amp;&amp; <span class="i">$CheckRingAromaticity</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
5114 
5115   <span class="c"># Is it an aromatic ring containing hertero atoms?</span>
5116   <span class="s">(</span><span class="i">$RingIsAromatic</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;_GetHeteroAtomsInformationInRing</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
5117   <span class="i">$NumOfAllowedHeteroAtoms</span> = <span class="i">$Atom</span><span class="i">-&gt;IsCarbon</span><span class="s">(</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">2</span><span class="sc">;</span>
5118 
5119   <span class="k">if</span> <span class="s">(</span><span class="i">$CheckRingAromaticity</span> &amp;&amp; !<span class="i">$RingIsAromatic</span><span class="s">)</span> <span class="s">{</span>
5120     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
5121   <span class="s">}</span>
5122 
5123   <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfHeteroAtoms</span> != <span class="i">$NumOfAllowedHeteroAtoms</span><span class="s">)</span> <span class="s">{</span>
5124     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
5125   <span class="s">}</span>
5126 
5127   <span class="c"># Does ring contain hetero atoms at alpha position?</span>
5128   <span class="i">$HeteroAtomPositionsRef</span> = <span class="i">$This</span><span class="i">-&gt;_GetHeteroAtomPositionsInRing</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
5129   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span><span class="s">(</span><span class="i">$HeteroAtomPositionsRef</span>-&gt;{<span class="w">Beta</span>}<span class="s">)</span> &amp;&amp; !<span class="k">exists</span><span class="s">(</span><span class="i">$HeteroAtomPositionsRef</span>-&gt;{<span class="w">Alpha</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
5130     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
5131   <span class="s">}</span>
5132 
5133   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
5134 <span class="s">}</span>
5135 
5136 <span class="c"># Get hetro atom positions relative to atom position...</span>
5137 <span class="c">#</span>
5138 <span class="c"># Notes:</span>
5139 <span class="c">#    . Any atom other than Carbon and Hydrogen atom is considered a hetero atom.</span>
5140 <span class="c">#</span>
<a name="_GetHeteroAtomPositionsInRing-"></a>5141 <span class="k">sub </span><span class="m">_GetHeteroAtomPositionsInRing</span> <span class="s">{</span>
5142   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
5143   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtom</span><span class="cm">,</span> <span class="i">$Index</span><span class="cm">,</span> <span class="i">$AtomIndex</span><span class="cm">,</span> <span class="i">$NumOfHeteroAtoms</span><span class="cm">,</span> <span class="i">%HeteroAtomPositionsMap</span><span class="s">)</span><span class="sc">;</span>
5144 
5145   <span class="i">%HeteroAtomPositionsMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
5146 
5147   <span class="i">$NumOfHeteroAtoms</span> = <span class="n">0</span><span class="sc">;</span>
5148   <span class="i">$AtomIndex</span> = <span class="n">0</span><span class="sc">;</span>
5149   <span class="i">$Index</span> = <span class="n">0</span><span class="sc">;</span>
5150 
5151   <span class="c"># Find position of specified atom in the ring and count hetero atoms...</span>
5152   <span class="k">for</span> <span class="i">$RingAtom</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$RingAtomsRef</span>}<span class="s">)</span> <span class="s">{</span>
5153     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsHeteroAtom</span><span class="s">(</span><span class="i">$RingAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
5154       <span class="i">$NumOfHeteroAtoms</span>++<span class="sc">;</span>
5155     <span class="s">}</span>
5156     <span class="k">if</span> <span class="s">(</span><span class="i">$RingAtom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span> == <span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
5157       <span class="i">$AtomIndex</span> = <span class="i">$Index</span><span class="sc">;</span>
5158     <span class="s">}</span>
5159     <span class="i">$Index</span>++<span class="sc">;</span>
5160   <span class="s">}</span>
5161 
5162   <span class="c"># Does ring contain any hetereo atoms?</span>
5163   <span class="k">if</span> <span class="s">(</span>!<span class="i">$NumOfHeteroAtoms</span><span class="s">)</span> <span class="s">{</span>
5164     <span class="k">return</span> \<span class="i">%HeteroAtomPositionsMap</span><span class="sc">;</span>
5165   <span class="s">}</span>
5166 
5167   <span class="c"># Check hetero atoms around specified atom to determine their position using their</span>
5168   <span class="c"># their distance from specified atom: 1 - Alpha, 2 - Beta, 3 - Gamma, 4 - Delta, 5 - Omega</span>
5169   <span class="c">#</span>
5170   <span class="k">my</span><span class="s">(</span><span class="i">$RingSize</span><span class="cm">,</span> <span class="i">$MaxPositionNum</span><span class="cm">,</span> <span class="i">$PositionNum</span><span class="cm">,</span> <span class="i">$PositionName</span><span class="cm">,</span> <span class="i">$MaxAtomIndex</span><span class="cm">,</span> <span class="i">$BeforeAtomIndex</span><span class="cm">,</span> <span class="i">$AfterAtomIndex</span><span class="cm">,</span> <span class="i">$BeforeAtom</span><span class="cm">,</span> <span class="i">$AfterAtom</span><span class="cm">,</span> <span class="i">%PositionNumToNameMap</span><span class="s">)</span><span class="sc">;</span>
5171 
5172   <span class="i">%PositionNumToNameMap</span> = <span class="s">(</span><span class="q">&#39;1&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;Alpha&#39;</span><span class="cm">,</span> <span class="q">&#39;2&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;Beta&#39;</span><span class="cm">,</span> <span class="q">&#39;3&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;Gamma&#39;</span><span class="cm">,</span> <span class="q">&#39;4&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;Delta&#39;</span><span class="cm">,</span> <span class="q">&#39;5&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;Omega&#39;</span><span class="s">)</span><span class="sc">;</span>
5173 
5174   <span class="i">$RingSize</span> = <span class="k">scalar</span> <span class="i">@</span>{<span class="i">$RingAtomsRef</span>}<span class="sc">;</span>
5175   <span class="i">$MaxPositionNum</span> = <span class="k">int</span> <span class="i">$RingSize</span>/<span class="n">2</span><span class="sc">;</span>
5176   <span class="i">$MaxAtomIndex</span> = <span class="i">$RingSize</span> - <span class="n">1</span><span class="sc">;</span>
5177 
5178   <span class="j">POSITIONNUM:</span> <span class="k">for</span> <span class="i">$PositionNum</span> <span class="s">(</span><span class="n">1</span> .. <span class="i">$MaxPositionNum</span><span class="s">)</span> <span class="s">{</span>
5179     <span class="c"># Get atom before atom at a specific position...</span>
5180     <span class="i">$BeforeAtomIndex</span> = <span class="i">$AtomIndex</span> - <span class="i">$PositionNum</span><span class="sc">;</span>
5181     <span class="k">if</span> <span class="s">(</span><span class="i">$BeforeAtomIndex</span> &lt; <span class="n">0</span><span class="s">)</span> <span class="s">{</span>
5182       <span class="i">$BeforeAtomIndex</span> = <span class="i">$MaxAtomIndex</span> + <span class="i">$BeforeAtomIndex</span> + <span class="n">1</span><span class="sc">;</span>
5183     <span class="s">}</span>
5184     <span class="i">$BeforeAtom</span> = <span class="i">$RingAtomsRef</span>-&gt;[<span class="i">$BeforeAtomIndex</span>]<span class="sc">;</span>
5185 
5186     <span class="i">$PositionName</span> = <span class="k">exists</span> <span class="i">$PositionNumToNameMap</span>{<span class="i">$PositionNum</span>} ? <span class="i">$PositionNumToNameMap</span>{<span class="i">$PositionNum</span>} <span class="co">:</span> <span class="q">&#39;Unknown&#39;</span><span class="sc">;</span>
5187 
5188     <span class="c"># Is atom before atom at a specific position a hetero atom?</span>
5189     <span class="k">if</span> <span class="s">(</span>!<span class="i">$BeforeAtom</span><span class="i">-&gt;IsCarbon</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
5190       <span class="i">$This</span><span class="i">-&gt;_TrackHeteroAtomPositionInRing</span><span class="s">(</span><span class="i">$BeforeAtom</span><span class="cm">,</span> <span class="i">$PositionName</span><span class="cm">,</span> \<span class="i">%HeteroAtomPositionsMap</span><span class="s">)</span><span class="sc">;</span>
5191     <span class="s">}</span>
5192 
5193     <span class="c"># Get atom after atom at a specific position...</span>
5194     <span class="i">$AfterAtomIndex</span> = <span class="i">$AtomIndex</span> + <span class="i">$PositionNum</span><span class="sc">;</span>
5195     <span class="k">if</span> <span class="s">(</span><span class="i">$AfterAtomIndex</span> &gt; <span class="i">$MaxAtomIndex</span><span class="s">)</span> <span class="s">{</span>
5196       <span class="i">$AfterAtomIndex</span> = <span class="i">$AfterAtomIndex</span> - <span class="i">$MaxAtomIndex</span> - <span class="n">1</span><span class="sc">;</span>
5197     <span class="s">}</span>
5198 
5199     <span class="c"># Is it a different atom?</span>
5200     <span class="k">if</span> <span class="s">(</span><span class="i">$AfterAtomIndex</span> == <span class="i">$BeforeAtomIndex</span><span class="s">)</span> <span class="s">{</span>
5201       <span class="k">next</span> <span class="j">POSITIONNUM</span><span class="sc">;</span>
5202     <span class="s">}</span>
5203 
5204     <span class="c"># Is atom after atom at a specific position a hetero atom?</span>
5205     <span class="i">$AfterAtom</span> = <span class="i">$RingAtomsRef</span>-&gt;[<span class="i">$AfterAtomIndex</span>]<span class="sc">;</span>
5206 
5207     <span class="k">if</span> <span class="s">(</span>!<span class="i">$AfterAtom</span><span class="i">-&gt;IsCarbon</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
5208       <span class="i">$This</span><span class="i">-&gt;_TrackHeteroAtomPositionInRing</span><span class="s">(</span><span class="i">$AfterAtom</span><span class="cm">,</span> <span class="i">$PositionName</span><span class="cm">,</span> \<span class="i">%HeteroAtomPositionsMap</span><span class="s">)</span><span class="sc">;</span>
5209     <span class="s">}</span>
5210   <span class="s">}</span>
5211   <span class="k">return</span> \<span class="i">%HeteroAtomPositionsMap</span><span class="sc">;</span>
5212 <span class="s">}</span>
5213 
5214 <span class="c"># Is it a hetero atom?</span>
5215 <span class="c">#</span>
5216 <span class="c"># Notes:</span>
5217 <span class="c">#    . Any atom other than Carbon and Hydrogen atom is considered a hetero atom.</span>
5218 <span class="c">#</span>
<a name="_IsHeteroAtom-"></a>5219 <span class="k">sub </span><span class="m">_IsHeteroAtom</span> <span class="s">{</span>
5220   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
5221 
5222   <span class="k">return</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsCarbon</span><span class="s">(</span><span class="s">)</span> || <span class="i">$Atom</span><span class="i">-&gt;IsHydrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> ? <span class="n">0</span> <span class="co">:</span> <span class="n">1</span><span class="sc">;</span>
5223 <span class="s">}</span>
5224 
5225 <span class="c"># Track hetero atom positions in ring by updating data in specified data hash reference...</span>
5226 <span class="c">#</span>
<a name="_TrackHeteroAtomPositionInRing-"></a>5227 <span class="k">sub </span><span class="m">_TrackHeteroAtomPositionInRing</span> <span class="s">{</span>
5228   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$HeteroAtom</span><span class="cm">,</span> <span class="i">$PositionName</span><span class="cm">,</span> <span class="i">$HeteroAtomPositionsMapRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
5229   <span class="k">my</span><span class="s">(</span><span class="i">$HeteroAtomSymbol</span><span class="s">)</span><span class="sc">;</span>
5230 
5231   <span class="c"># Is it a new hetero atom position?</span>
5232   <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$HeteroAtomPositionsMapRef</span>-&gt;{<span class="i">$PositionName</span>}<span class="s">)</span> <span class="s">{</span>
5233     <span class="i">%</span>{<span class="i">$HeteroAtomPositionsMapRef</span>-&gt;{<span class="i">$PositionName</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
5234   <span class="s">}</span>
5235 
5236   <span class="i">$HeteroAtomSymbol</span> = <span class="i">$HeteroAtom</span><span class="i">-&gt;GetAtomSymbol</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
5237   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$HeteroAtomPositionsMapRef</span>-&gt;{<span class="i">$PositionName</span>}{<span class="i">$HeteroAtomSymbol</span>}<span class="s">)</span> <span class="s">{</span>
5238     <span class="i">$HeteroAtomPositionsMapRef</span>-&gt;{<span class="i">$PositionName</span>}{<span class="i">$HeteroAtomSymbol</span>} += <span class="n">1</span><span class="sc">;</span>
5239   <span class="s">}</span>
5240   <span class="k">else</span> <span class="s">{</span>
5241     <span class="i">$HeteroAtomPositionsMapRef</span>-&gt;{<span class="i">$PositionName</span>}{<span class="i">$HeteroAtomSymbol</span>} += <span class="n">1</span><span class="sc">;</span>
5242   <span class="s">}</span>
5243   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
5244 <span class="s">}</span>
5245 
5246 <span class="c"># Return a string containg data for MMFF94AtomTypes object...</span>
5247 <span class="c">#</span>
<a name="StringifyMMFF94AtomTypes-"></a>5248 <span class="k">sub </span><span class="m">StringifyMMFF94AtomTypes</span> <span class="s">{</span>
5249   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
5250   <span class="k">my</span><span class="s">(</span><span class="i">$AtomTypesString</span><span class="s">)</span><span class="sc">;</span>
5251 
5252   <span class="c"># Type of AtomTypes...</span>
5253   <span class="i">$AtomTypesString</span> = <span class="q">&quot;AtomTypes: $This-&gt;{Type}; IgnoreHydrogens: &quot;</span> . <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">IgnoreHydrogens</span>} ? <span class="q">&quot;Yes&quot;</span> <span class="co">:</span> <span class="q">&quot;No&quot;</span><span class="s">)</span><span class="sc">;</span>
5254 
5255   <span class="c"># Setup atom types information...</span>
5256   <span class="k">my</span><span class="s">(</span><span class="i">$AtomID</span><span class="cm">,</span> <span class="i">$AtomType</span><span class="cm">,</span> <span class="i">@AtomTypesInfo</span><span class="cm">,</span> <span class="i">%AssignedAtomTypes</span><span class="s">)</span><span class="sc">;</span>
5257 
5258   <span class="i">@AtomTypesInfo</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
5259   <span class="i">%AssignedAtomTypes</span> = <span class="i">$This</span><span class="i">-&gt;GetAtomTypes</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
5260 
5261   <span class="k">for</span> <span class="i">$AtomID</span> <span class="s">(</span><span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> &lt;=&gt; <span class="i">$b</span> <span class="s">}</span> <span class="k">keys</span> <span class="i">%AssignedAtomTypes</span><span class="s">)</span> <span class="s">{</span>
5262     <span class="i">$AtomType</span> = <span class="i">$AssignedAtomTypes</span>{<span class="i">$AtomID</span>} ? <span class="i">$AssignedAtomTypes</span>{<span class="i">$AtomID</span>} <span class="co">:</span> <span class="q">&#39;None&#39;</span><span class="sc">;</span>
5263     <span class="k">push</span> <span class="i">@AtomTypesInfo</span><span class="cm">,</span> <span class="q">&quot;$AtomID:$AtomType&quot;</span><span class="sc">;</span>
5264   <span class="s">}</span>
5265   <span class="i">$AtomTypesString</span> .= <span class="q">&quot;; AtomIDs:AtomTypes: &lt;&quot;</span> . <span class="i">TextUtil::JoinWords</span><span class="s">(</span>\<span class="i">@AtomTypesInfo</span><span class="cm">,</span> <span class="q">&quot;, &quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span> . <span class="q">&quot;&gt;&quot;</span><span class="sc">;</span>
5266 
5267   <span class="k">return</span> <span class="i">$AtomTypesString</span><span class="sc">;</span>
5268 <span class="s">}</span>
5269 
5270 <span class="c"># Is it a MMFF94AtomTypes object?</span>
<a name="_IsMMFF94AtomTypes-"></a>5271 <span class="k">sub </span><span class="m">_IsMMFF94AtomTypes</span> <span class="s">{</span>
5272   <span class="k">my</span><span class="s">(</span><span class="i">$Object</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
5273 
5274   <span class="k">return</span> <span class="s">(</span><span class="i">Scalar::Util::blessed</span><span class="s">(</span><span class="i">$Object</span><span class="s">)</span> &amp;&amp; <span class="i">$Object</span><span class="i">-&gt;isa</span><span class="s">(</span><span class="i">$ClassName</span><span class="s">)</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
5275 <span class="s">}</span>
5276 
5277 <span class="c"># Check and load MMFF94 atom types data...</span>
5278 <span class="c">#</span>
<a name="_CheckAndLoadMMFF94AtomTypesData-"></a>5279 <span class="k">sub </span><span class="m">_CheckAndLoadMMFF94AtomTypesData</span> <span class="s">{</span>
5280 
5281   <span class="c"># Is it already loaded?</span>
5282   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$MMFF94AtomTypesDataMap</span>{<span class="w">AtomTypes</span>}<span class="s">)</span> <span class="s">{</span>
5283     <span class="k">return</span><span class="sc">;</span>
5284   <span class="s">}</span>
5285 
5286   <span class="i">_LoadMMFF94AtomTypesData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
5287 <span class="s">}</span>
5288 
5289 <span class="c"># Load MMFF94 atom types data from the file assuming first column to be atom type symbol..</span>
5290 <span class="c">#</span>
5291 <span class="c"># Format:</span>
5292 <span class="c">#</span>
5293 <span class="c"># &quot;AtomTypeSymbol&quot;,&quot;AtomTypeNum&quot;,&quot;ElementSymbol&quot;,&quot;AtomTypeDefinition&quot;</span>
5294 <span class="c"># &quot;CR&quot;,&quot;1&quot;,&quot;C&quot;,&quot;ALKYL CARBON, SP3&quot;</span>
5295 <span class="c"># &quot;C=C&quot;,&quot;2&quot;,&quot;C&quot;,&quot;VINYLIC CARBON, SP2&quot;</span>
5296 <span class="c">#</span>
<a name="_LoadMMFF94AtomTypesData-"></a>5297 <span class="k">sub </span><span class="m">_LoadMMFF94AtomTypesData</span> <span class="s">{</span>
5298   <span class="k">my</span><span class="s">(</span><span class="i">$AtomTypesDataFile</span><span class="cm">,</span> <span class="i">$MayaChemToolsLibDir</span><span class="s">)</span><span class="sc">;</span>
5299 
5300   <span class="i">$MayaChemToolsLibDir</span> = <span class="i">FileUtil::GetMayaChemToolsLibDirName</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
5301 
5302   <span class="i">$AtomTypesDataFile</span> =  <span class="q">&quot;$MayaChemToolsLibDir&quot;</span> . <span class="q">&quot;/data/MMFF94AtomTypes.csv&quot;</span><span class="sc">;</span>
5303   <span class="k">if</span> <span class="s">(</span>! <span class="k">-e</span> <span class="q">&quot;$AtomTypesDataFile&quot;</span><span class="s">)</span> <span class="s">{</span>
5304     <span class="w">croak</span> <span class="q">&quot;Error: MayaChemTools package file, $AtomTypesDataFile, is missing: Possible installation problems...&quot;</span><span class="sc">;</span>
5305   <span class="s">}</span>
5306 
5307   <span class="i">%MMFF94AtomTypesDataMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
5308   <span class="i">AtomTypes::AtomTypes::LoadAtomTypesData</span><span class="s">(</span><span class="i">$AtomTypesDataFile</span><span class="cm">,</span> \<span class="i">%MMFF94AtomTypesDataMap</span><span class="s">)</span><span class="sc">;</span>
5309 <span class="s">}</span>
5310 
<a name="EOF-"></a></pre>
<p>&nbsp;</p>
<br />
<center>
<img src="../../../images/h2o2.png">
</center>
</body>
</html>
