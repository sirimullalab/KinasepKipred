<html>
<head>
<title>MayaChemTools:Code:Atom.pm</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<link rel="stylesheet" type="text/css" href="../../../css/MayaChemToolsCode.css">
</head>
<body leftmargin="20" rightmargin="20" topmargin="10" bottommargin="10">
<br/>
<center>
<a href="http://www.mayachemtools.org" title="MayaChemTools Home"><img src="../../../images/MayaChemToolsLogo.gif" border="0" alt="MayaChemTools"></a>
</center>
<br/>
<pre>
<a name="package-Atom-"></a>   1 <span class="k">package </span><span class="i">Atom</span><span class="sc">;</span>
   2 <span class="c">#</span>
   3 <span class="c"># File: Atom.pm</span>
   4 <span class="c"># Author: Manish Sud &lt;msud@san.rr.com&gt;</span>
   5 <span class="c">#</span>
   6 <span class="c"># Copyright (C) 2018 Manish Sud. All rights reserved.</span>
   7 <span class="c">#</span>
   8 <span class="c"># This file is part of MayaChemTools.</span>
   9 <span class="c">#</span>
  10 <span class="c"># MayaChemTools is free software; you can redistribute it and/or modify it under</span>
  11 <span class="c"># the terms of the GNU Lesser General Public License as published by the Free</span>
  12 <span class="c"># Software Foundation; either version 3 of the License, or (at your option) any</span>
  13 <span class="c"># later version.</span>
  14 <span class="c">#</span>
  15 <span class="c"># MayaChemTools is distributed in the hope that it will be useful, but without</span>
  16 <span class="c"># any warranty; without even the implied warranty of merchantability of fitness</span>
  17 <span class="c"># for a particular purpose.  See the GNU Lesser General Public License for more</span>
  18 <span class="c"># details.</span>
  19 <span class="c">#</span>
  20 <span class="c"># You should have received a copy of the GNU Lesser General Public License</span>
  21 <span class="c"># along with MayaChemTools; if not, see &lt;http://www.gnu.org/licenses/&gt; or</span>
  22 <span class="c"># write to the Free Software Foundation Inc., 59 Temple Place, Suite 330,</span>
  23 <span class="c"># Boston, MA, 02111-1307, USA.</span>
  24 <span class="c">#</span>
  25 
  26 <span class="k">use</span> <span class="w">strict</span><span class="sc">;</span>
  27 <span class="k">use</span> <span class="w">Carp</span><span class="sc">;</span>
  28 <span class="k">use</span> <span class="w">Exporter</span><span class="sc">;</span>
  29 <span class="k">use</span> <span class="w">Storable</span> <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  30 <span class="k">use</span> <span class="w">Scalar::Util</span> <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  31 <span class="k">use</span> <span class="w">ObjectProperty</span><span class="sc">;</span>
  32 <span class="k">use</span> <span class="w">PeriodicTable</span><span class="sc">;</span>
  33 <span class="k">use</span> <span class="w">Vector</span><span class="sc">;</span>
  34 <span class="k">use</span> <span class="w">MathUtil</span><span class="sc">;</span>
  35 <span class="k">use</span> <span class="w">Text::ParseWords</span><span class="sc">;</span>
  36 <span class="k">use</span> <span class="w">TextUtil</span><span class="sc">;</span>
  37 <span class="k">use</span> <span class="w">FileUtil</span><span class="sc">;</span>
  38 
  39 <span class="k">use</span> <span class="w">vars</span> <span class="q">qw(@ISA @EXPORT @EXPORT_OK %EXPORT_TAGS)</span><span class="sc">;</span>
  40 
  41 <span class="i">@ISA</span> = <span class="q">qw(ObjectProperty Exporter)</span><span class="sc">;</span>
  42 <span class="i">@EXPORT</span> = <span class="q">qw()</span><span class="sc">;</span>
  43 <span class="i">@EXPORT_OK</span> = <span class="q">qw()</span><span class="sc">;</span>
  44 
  45 <span class="i">%EXPORT_TAGS</span> = <span class="s">(</span><span class="w">all</span>  <span class="cm">=&gt;</span> <span class="s">[</span><span class="i">@EXPORT</span><span class="cm">,</span> <span class="i">@EXPORT_OK</span><span class="s">]</span><span class="s">)</span><span class="sc">;</span>
  46 
  47 <span class="c"># Setup class variables...</span>
  48 <span class="k">my</span><span class="s">(</span><span class="i">$ClassName</span><span class="cm">,</span> <span class="i">$ObjectID</span><span class="cm">,</span> <span class="i">%MDLValenceModelDataMap</span><span class="cm">,</span> <span class="i">%DaylightValenceModelDataMap</span><span class="s">)</span><span class="sc">;</span>
  49 <span class="i">_InitializeClass</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  50 
  51 <span class="c"># Overload Perl functions...</span>
  52 <span class="k">use</span> <span class="w">overload</span> <span class="q">&#39;&quot;&quot;&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;StringifyAtom&#39;</span><span class="sc">;</span>
  53 
  54 <span class="c"># Class constructor...</span>
<a name="new-"></a>  55 <span class="k">sub </span><span class="m">new</span> <span class="s">{</span>
  56   <span class="k">my</span><span class="s">(</span><span class="i">$Class</span><span class="cm">,</span> <span class="i">%NamesAndValues</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  57 
  58   <span class="c"># Initialize object...</span>
  59   <span class="k">my</span> <span class="i">$This</span> = <span class="s">{</span><span class="s">}</span><span class="sc">;</span>
  60   <span class="k">bless</span> <span class="i">$This</span><span class="cm">,</span> <span class="k">ref</span><span class="s">(</span><span class="i">$Class</span><span class="s">)</span> || <span class="i">$Class</span><span class="sc">;</span>
  61   <span class="i">$This</span><span class="i">-&gt;_InitializeAtom</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  62 
  63   <span class="i">$This</span><span class="i">-&gt;_InitializeAtomProperties</span><span class="s">(</span><span class="i">%NamesAndValues</span><span class="s">)</span><span class="sc">;</span>
  64 
  65   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
  66 <span class="s">}</span>
  67 
  68 <span class="c"># Initialize object data...</span>
<a name="_InitializeAtom-"></a>  69 <span class="k">sub </span><span class="m">_InitializeAtom</span> <span class="s">{</span>
  70   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  71   <span class="k">my</span><span class="s">(</span><span class="i">$ObjectID</span><span class="s">)</span> = <span class="i">_GetNewObjectID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  72 
  73   <span class="c"># All other property names and values along with all Set/Get&lt;PropertyName&gt; methods</span>
  74   <span class="c"># are implemented on-demand using ObjectProperty class.</span>
  75   <span class="i">$This</span>-&gt;{<span class="w">ID</span>} = <span class="i">$ObjectID</span><span class="sc">;</span>
  76   <span class="i">$This</span>-&gt;{<span class="w">Name</span>} = <span class="q">&quot;Atom ${ObjectID}&quot;</span><span class="sc">;</span>
  77   <span class="i">$This</span>-&gt;{<span class="w">AtomSymbol</span>} = <span class="q">&#39;&#39;</span><span class="sc">;</span>
  78   <span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>} = <span class="n">0</span><span class="sc">;</span>
  79   <span class="i">$This</span>-&gt;{<span class="w">XYZ</span>} = <span class="w">Vector::ZeroVector</span><span class="sc">;</span>
  80 <span class="s">}</span>
  81 
  82 <span class="c"># Initialize atom properties...</span>
<a name="_InitializeAtomProperties-"></a>  83 <span class="k">sub </span><span class="m">_InitializeAtomProperties</span> <span class="s">{</span>
  84   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">%NamesAndValues</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  85 
  86   <span class="k">my</span><span class="s">(</span><span class="i">$Name</span><span class="cm">,</span> <span class="i">$Value</span><span class="cm">,</span> <span class="i">$MethodName</span><span class="s">)</span><span class="sc">;</span>
  87   <span class="k">while</span> <span class="s">(</span><span class="s">(</span><span class="i">$Name</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="k">each</span>  <span class="i">%NamesAndValues</span><span class="s">)</span> <span class="s">{</span>
  88     <span class="i">$MethodName</span> = <span class="q">&quot;Set${Name}&quot;</span><span class="sc">;</span>
  89     <span class="i">$This</span><span class="i">-&gt;$MethodName</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span><span class="sc">;</span>
  90   <span class="s">}</span>
  91   <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$NamesAndValues</span>{<span class="q">&#39;AtomSymbol&#39;</span>}<span class="s">)</span> <span class="s">{</span>
  92     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;new: Atom object instantiated without setting atom symbol...&quot;</span><span class="sc">;</span>
  93   <span class="s">}</span>
  94 
  95   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
  96 <span class="s">}</span>
  97 
  98 <span class="c"># Initialize class ...</span>
<a name="_InitializeClass-"></a>  99 <span class="k">sub </span><span class="m">_InitializeClass</span> <span class="s">{</span>
 100   <span class="c">#Class name...</span>
 101   <span class="i">$ClassName</span> = <span class="w">__PACKAGE__</span><span class="sc">;</span>
 102 
 103   <span class="c"># ID to keep track of objects...</span>
 104   <span class="i">$ObjectID</span> = <span class="n">0</span><span class="sc">;</span>
 105 
 106   <span class="c"># Load atom class data...</span>
 107   <span class="i">_LoadAtomClassData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 108 <span class="s">}</span>
 109 
 110 <span class="c"># Setup an explicit SetID method to block setting of ID by AUTOLOAD function...</span>
<a name="SetID-"></a> 111 <span class="k">sub </span><span class="m">SetID</span> <span class="s">{</span>
 112   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 113 
 114   <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;SetID: Object ID can&#39;t be changed: it&#39;s used for internal tracking...&quot;</span><span class="sc">;</span>
 115 
 116   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 117 <span class="s">}</span>
 118 
 119 <span class="c"># Setup an explicit SetMolecule method to block setting of ID by AUTOLOAD function...</span>
<a name="SetMolecule-"></a> 120 <span class="k">sub </span><span class="m">SetMolecule</span> <span class="s">{</span>
 121   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 122 
 123   <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;SetMolecule: Molecule property can&#39;t be changed: it&#39;s used for internal tracking...&quot;</span><span class="sc">;</span>
 124 
 125   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 126 <span class="s">}</span>
 127 
 128 <span class="c"># Assign atom to  molecule...</span>
<a name="_SetMolecule-"></a> 129 <span class="k">sub </span><span class="m">_SetMolecule</span> <span class="s">{</span>
 130   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Molecule</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 131 
 132   <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>} = <span class="i">$Molecule</span><span class="sc">;</span>
 133 
 134   <span class="c"># Weaken the reference to disable increment of reference count; otherwise,</span>
 135   <span class="c"># it it becomes a circular reference and destruction of Molecule object doesn&#39;t</span>
 136   <span class="c"># get initiated which in turn disables destruction of atom object.</span>
 137   <span class="c">#</span>
 138   <span class="i">Scalar::Util::weaken</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="s">)</span><span class="sc">;</span>
 139 
 140   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 141 <span class="s">}</span>
 142 
 143 <span class="c"># Setup atom symbol and atomic number for the element...</span>
 144 <span class="c">#</span>
 145 <span class="c"># Possible atom symbol values:</span>
 146 <span class="c">#    . An element symbol or some other type of atom: L - Atom list; LP - Lone pair; R# - R group;</span>
 147 <span class="c">#       A, Q, * - unknown atom; or something else?</span>
 148 <span class="c">#</span>
 149 <span class="c"># Default mass number corresponds to the most abundant natural isotope unless it&#39;s explicity</span>
 150 <span class="c"># set using &quot;MassNumber&quot; property.</span>
 151 <span class="c">#</span>
<a name="SetAtomSymbol-"></a> 152 <span class="k">sub </span><span class="m">SetAtomSymbol</span> <span class="s">{</span>
 153   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$AtomSymbol</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 154   <span class="k">my</span><span class="s">(</span><span class="i">$AtomicNumber</span><span class="s">)</span><span class="sc">;</span>
 155 
 156   <span class="i">$This</span>-&gt;{<span class="w">AtomSymbol</span>} = <span class="i">$AtomSymbol</span><span class="sc">;</span>
 157 
 158   <span class="i">$AtomicNumber</span> = <span class="i">PeriodicTable::GetElementAtomicNumber</span><span class="s">(</span><span class="i">$AtomSymbol</span><span class="s">)</span><span class="sc">;</span>
 159   <span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>} = <span class="s">(</span><span class="k">defined</span> <span class="i">$AtomicNumber</span><span class="s">)</span> ? <span class="i">$AtomicNumber</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 160 
 161   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 162 <span class="s">}</span>
 163 
 164 <span class="c"># Setup atom symbol and atomic number for the element...</span>
<a name="SetAtomicNumber-"></a> 165 <span class="k">sub </span><span class="m">SetAtomicNumber</span> <span class="s">{</span>
 166   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$AtomicNumber</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 167   <span class="k">my</span><span class="s">(</span><span class="i">$AtomSymbol</span><span class="s">)</span><span class="sc">;</span>
 168 
 169   <span class="i">$AtomSymbol</span> = <span class="i">PeriodicTable::GetElementAtomSymbol</span><span class="s">(</span><span class="i">$AtomicNumber</span><span class="s">)</span><span class="sc">;</span>
 170   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$AtomSymbol</span><span class="s">)</span> <span class="s">{</span>
 171     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;SetAtomicNumber: Didn&#39;t set atomic number: Invalid atomic number, $AtomicNumber, specified...&quot;</span><span class="sc">;</span>
 172     <span class="k">return</span><span class="sc">;</span>
 173   <span class="s">}</span>
 174   <span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>} = <span class="i">$AtomicNumber</span><span class="sc">;</span>
 175   <span class="i">$This</span>-&gt;{<span class="w">AtomSymbol</span>} = <span class="i">$AtomSymbol</span><span class="sc">;</span>
 176 
 177   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 178 <span class="s">}</span>
 179 
 180 <span class="c"># Set atom as stereo center...</span>
 181 <span class="c">#</span>
<a name="SetStereoCenter-"></a> 182 <span class="k">sub </span><span class="m">SetStereoCenter</span> <span class="s">{</span>
 183   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$StereoCenter</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 184 
 185   <span class="i">$This</span><span class="i">-&gt;SetProperty</span><span class="s">(</span><span class="q">&#39;StereoCenter&#39;</span><span class="cm">,</span> <span class="i">$StereoCenter</span><span class="s">)</span><span class="sc">;</span>
 186 
 187   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 188 <span class="s">}</span>
 189 
 190 <span class="c"># Is it a stereo center?</span>
 191 <span class="c">#</span>
<a name="IsStereoCenter-"></a> 192 <span class="k">sub </span><span class="m">IsStereoCenter</span> <span class="s">{</span>
 193   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 194   <span class="k">my</span><span class="s">(</span><span class="i">$StereoCenter</span><span class="s">)</span><span class="sc">;</span>
 195 
 196   <span class="i">$StereoCenter</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;StereoCenter&#39;</span><span class="s">)</span><span class="sc">;</span>
 197 
 198   <span class="k">return</span> <span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$StereoCenter</span><span class="s">)</span> &amp;&amp; <span class="i">$StereoCenter</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 199 <span class="s">}</span>
 200 
 201 <span class="c"># Set atom stereochemistry.</span>
 202 <span class="c">#</span>
 203 <span class="c"># Supported values are: R, S.</span>
 204 <span class="c">#</span>
 205 <span class="c"># Notes:</span>
 206 <span class="c">#</span>
 207 <span class="c"># . After the ligands around a central stereocenter has been ranked using CIP priority scheme and</span>
 208 <span class="c"># the lowest ranked ligand lies behind the center atom, then R and S values correspond to:</span>
 209 <span class="c">#</span>
 210 <span class="c"># R: Clockwise arrangement of remaining ligands around the central atom going from highest to lowest ranked ligand</span>
 211 <span class="c"># S: CounterClockwise arrangement of remaining ligands around the central atom going from highest to lowest ranked ligand</span>
 212 <span class="c">#</span>
 213 <span class="c"># . Assignment of any other arbitray values besides R and S is also allowed; however, a warning is printed.</span>
 214 <span class="c">#</span>
<a name="SetStereochemistry-"></a> 215 <span class="k">sub </span><span class="m">SetStereochemistry</span> <span class="s">{</span>
 216   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Stereochemistry</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 217 
 218   <span class="k">if</span> <span class="s">(</span><span class="i">$Stereochemistry</span> !~ <span class="q">/^(R|S)$/i</span><span class="s">)</span> <span class="s">{</span>
 219     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;SetStereochemistry: Assigning non-supported Stereochemistry value of $Stereochemistry. Supported values: R, S...&quot;</span><span class="sc">;</span>
 220   <span class="s">}</span>
 221 
 222   <span class="i">$This</span><span class="i">-&gt;SetProperty</span><span class="s">(</span><span class="q">&#39;StereoCenter&#39;</span><span class="cm">,</span> <span class="n">1</span><span class="s">)</span><span class="sc">;</span>
 223   <span class="i">$This</span><span class="i">-&gt;SetProperty</span><span class="s">(</span><span class="q">&#39;Stereochemistry&#39;</span><span class="cm">,</span> <span class="i">$Stereochemistry</span><span class="s">)</span><span class="sc">;</span>
 224 
 225   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 226 <span class="s">}</span>
 227 
 228 <span class="c"># Setup mass number for atom...</span>
<a name="SetMassNumber-"></a> 229 <span class="k">sub </span><span class="m">SetMassNumber</span> <span class="s">{</span>
 230   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$MassNumber</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 231   <span class="k">my</span><span class="s">(</span><span class="i">$AtomicNumber</span><span class="cm">,</span> <span class="i">$AtomSymbol</span><span class="s">)</span><span class="sc">;</span>
 232 
 233   <span class="i">$AtomicNumber</span> = <span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>}<span class="sc">;</span>
 234   <span class="i">$AtomSymbol</span> = <span class="i">$This</span>-&gt;{<span class="w">AtomSymbol</span>}<span class="sc">;</span>
 235   <span class="k">if</span> <span class="s">(</span>!<span class="i">$AtomicNumber</span><span class="s">)</span> <span class="s">{</span>
 236     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;SetMassNumber: Didn&#39;t set mass number: Non standard atom with atomic number, $AtomicNumber, and atomic symbol, $AtomSymbol...&quot;</span><span class="sc">;</span>
 237     <span class="k">return</span><span class="sc">;</span>
 238   <span class="s">}</span>
 239   <span class="k">if</span> <span class="s">(</span>!<span class="i">PeriodicTable::IsElementNaturalIsotopeMassNumber</span><span class="s">(</span><span class="i">$AtomicNumber</span><span class="cm">,</span> <span class="i">$MassNumber</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 240     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;SetMassNumber: Unknown mass number, $MassNumber, specified for atom with atomic number, $AtomicNumber, and atomic symbol, $AtomSymbol. Don&#39;t forget to Set ExactMass property explicitly; otherwise, GetExactMass method would return mass of most abundant isotope...&quot;</span><span class="sc">;</span>
 241   <span class="s">}</span>
 242   <span class="i">$This</span><span class="i">-&gt;SetProperty</span><span class="s">(</span><span class="q">&#39;MassNumber&#39;</span><span class="cm">,</span> <span class="i">$MassNumber</span><span class="s">)</span><span class="sc">;</span>
 243 
 244   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 245 <span class="s">}</span>
 246 
 247 <span class="c"># Get mass number...</span>
 248 <span class="c">#</span>
<a name="GetMassNumber-"></a> 249 <span class="k">sub </span><span class="m">GetMassNumber</span> <span class="s">{</span>
 250   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 251 
 252   <span class="c"># Is mass number explicity set?</span>
 253   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;MassNumber&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 254     <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;MassNumber&#39;</span><span class="s">)</span><span class="sc">;</span>
 255   <span class="s">}</span>
 256 
 257   <span class="c"># Is it an element symbol?</span>
 258   <span class="k">my</span><span class="s">(</span><span class="i">$AtomicNumber</span><span class="s">)</span> = <span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>}<span class="sc">;</span>
 259   <span class="k">if</span> <span class="s">(</span>!<span class="i">$AtomicNumber</span><span class="s">)</span> <span class="s">{</span>
 260     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
 261   <span class="s">}</span>
 262 
 263   <span class="c"># Return most abundant mass number...</span>
 264   <span class="k">return</span> <span class="i">PeriodicTable::GetElementMostAbundantNaturalIsotopeMassNumber</span><span class="s">(</span><span class="i">$AtomicNumber</span><span class="s">)</span><span class="sc">;</span>
 265 <span class="s">}</span>
 266 
 267 <span class="c"># Get atomic weight:</span>
 268 <span class="c">#   . Explicitly set by the caller</span>
 269 <span class="c">#   . Using atomic number</span>
 270 <span class="c">#</span>
<a name="GetAtomicWeight-"></a> 271 <span class="k">sub </span><span class="m">GetAtomicWeight</span> <span class="s">{</span>
 272   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 273 
 274   <span class="c"># Is atomic weight explicity set?</span>
 275   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;AtomicWeight&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 276     <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;AtomicWeight&#39;</span><span class="s">)</span><span class="sc">;</span>
 277   <span class="s">}</span>
 278 
 279   <span class="c"># Is it an element symbol?</span>
 280   <span class="k">my</span><span class="s">(</span><span class="i">$AtomicNumber</span><span class="s">)</span> = <span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>}<span class="sc">;</span>
 281   <span class="k">if</span> <span class="s">(</span>!<span class="i">$AtomicNumber</span><span class="s">)</span> <span class="s">{</span>
 282     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
 283   <span class="s">}</span>
 284 
 285   <span class="c"># Return its atomic weight...</span>
 286   <span class="k">return</span> <span class="i">PeriodicTable::GetElementAtomicWeight</span><span class="s">(</span><span class="i">$AtomicNumber</span><span class="s">)</span><span class="sc">;</span>
 287 <span class="s">}</span>
 288 
 289 <span class="c"># Get exact mass weight:</span>
 290 <span class="c">#   . Explicitly set by the caller</span>
 291 <span class="c">#   . Using atomic number and mass number explicity set by the caller</span>
 292 <span class="c">#   . Using atomic number and most abundant isotope</span>
 293 <span class="c">#</span>
<a name="GetExactMass-"></a> 294 <span class="k">sub </span><span class="m">GetExactMass</span> <span class="s">{</span>
 295   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 296 
 297   <span class="c"># Is exact mass explicity set?</span>
 298   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;ExactMass&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 299     <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;ExactMass&#39;</span><span class="s">)</span><span class="sc">;</span>
 300   <span class="s">}</span>
 301 
 302   <span class="c"># Is it an element symbol?</span>
 303   <span class="k">my</span><span class="s">(</span><span class="i">$AtomicNumber</span><span class="s">)</span> = <span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>}<span class="sc">;</span>
 304   <span class="k">if</span> <span class="s">(</span>!<span class="i">$AtomicNumber</span><span class="s">)</span> <span class="s">{</span>
 305     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
 306   <span class="s">}</span>
 307 
 308   <span class="c"># Is mass number explicitly set?</span>
 309   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;MassNumber&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 310     <span class="k">my</span><span class="s">(</span><span class="i">$MassNumber</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;MassNumber&#39;</span><span class="s">)</span><span class="sc">;</span>
 311     <span class="k">if</span> <span class="s">(</span><span class="i">PeriodicTable::IsElementNaturalIsotopeMassNumber</span><span class="s">(</span><span class="i">$AtomicNumber</span><span class="cm">,</span> <span class="i">$MassNumber</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 312       <span class="k">return</span> <span class="i">PeriodicTable::GetElementNaturalIsotopeMass</span><span class="s">(</span><span class="i">$AtomicNumber</span><span class="cm">,</span> <span class="i">$MassNumber</span><span class="s">)</span><span class="sc">;</span>
 313     <span class="s">}</span>
 314   <span class="s">}</span>
 315 
 316   <span class="c"># Return most abundant isotope mass...</span>
 317   <span class="k">return</span> <span class="i">PeriodicTable::GetElementMostAbundantNaturalIsotopeMass</span><span class="s">(</span><span class="i">$AtomicNumber</span><span class="s">)</span><span class="sc">;</span>
 318 <span class="s">}</span>
 319 
 320 <span class="c"># Get formal charge:</span>
 321 <span class="c">#   . Explicitly set by the caller</span>
 322 <span class="c">#   . Or return zero insetad of undef</span>
 323 <span class="c">#</span>
<a name="GetFormalCharge-"></a> 324 <span class="k">sub </span><span class="m">GetFormalCharge</span> <span class="s">{</span>
 325   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 326   <span class="k">my</span><span class="s">(</span><span class="i">$FormalCharge</span><span class="s">)</span><span class="sc">;</span>
 327 
 328   <span class="i">$FormalCharge</span> = <span class="n">0</span><span class="sc">;</span>
 329   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;FormalCharge&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 330     <span class="i">$FormalCharge</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;FormalCharge&#39;</span><span class="s">)</span><span class="sc">;</span>
 331   <span class="s">}</span>
 332 
 333   <span class="k">return</span> <span class="k">defined</span><span class="s">(</span><span class="i">$FormalCharge</span><span class="s">)</span> ? <span class="i">$FormalCharge</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 334 <span class="s">}</span>
 335 
 336 <span class="c"># Get spin multiplicity:</span>
 337 <span class="c">#   . Explicitly set by the caller</span>
 338 <span class="c">#   . From FreeRadicalElectrons value explicitly set by the caller</span>
 339 <span class="c">#   . Or return zero insetad of undef</span>
 340 <span class="c">#</span>
<a name="GetSpinMultiplicity-"></a> 341 <span class="k">sub </span><span class="m">GetSpinMultiplicity</span> <span class="s">{</span>
 342   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 343   <span class="k">my</span><span class="s">(</span><span class="i">$SpinMultiplicity</span><span class="s">)</span><span class="sc">;</span>
 344 
 345   <span class="i">$SpinMultiplicity</span> = <span class="n">0</span><span class="sc">;</span>
 346   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;SpinMultiplicity&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 347     <span class="i">$SpinMultiplicity</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;SpinMultiplicity&#39;</span><span class="s">)</span><span class="sc">;</span>
 348     <span class="k">return</span> <span class="k">defined</span><span class="s">(</span><span class="i">$SpinMultiplicity</span><span class="s">)</span> ? <span class="i">$SpinMultiplicity</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 349   <span class="s">}</span>
 350 
 351   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;FreeRadicalElectrons&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 352     <span class="k">my</span><span class="s">(</span><span class="i">$FreeRadicalElectrons</span><span class="s">)</span><span class="sc">;</span>
 353     <span class="i">$FreeRadicalElectrons</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;FreeRadicalElectrons&#39;</span><span class="s">)</span><span class="sc">;</span>
 354 
 355     <span class="j">SPINMULTIPLICITY:</span> <span class="s">{</span>
 356       <span class="k">if</span> <span class="s">(</span><span class="i">$FreeRadicalElectrons</span> == <span class="n">1</span><span class="s">)</span> <span class="s">{</span> <span class="i">$SpinMultiplicity</span> = <span class="n">2</span><span class="sc">;</span> <span class="k">last</span> <span class="j">SPINMULTIPLICITY</span><span class="sc">;</span><span class="s">}</span>
 357       <span class="k">if</span> <span class="s">(</span><span class="i">$FreeRadicalElectrons</span> == <span class="n">2</span><span class="s">)</span> <span class="s">{</span> <span class="i">$SpinMultiplicity</span> = <span class="n">1</span><span class="sc">;</span> <span class="k">last</span> <span class="j">SPINMULTIPLICITY</span><span class="sc">;</span><span class="s">}</span>
 358       <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;GetSpinMultiplicity: It&#39;s not possible to determine spin multiplicity from the specified free radical electrons value, $FreeRadicalElectrons. It has been set to 0...&quot;</span><span class="sc">;</span>
 359       <span class="i">$SpinMultiplicity</span> = <span class="n">0</span><span class="sc">;</span>
 360     <span class="s">}</span>
 361   <span class="s">}</span>
 362 
 363   <span class="k">return</span> <span class="i">$SpinMultiplicity</span><span class="sc">;</span>
 364 <span class="s">}</span>
 365 
 366 <span class="c"># Get number of free radical electrons:</span>
 367 <span class="c">#   . Explicitly set by the caller</span>
 368 <span class="c">#   . From SpinMultiplicity value explicitly set by the caller</span>
 369 <span class="c">#   . Or return zero insetad of undef</span>
 370 <span class="c">#</span>
 371 <span class="c"># Notes:</span>
 372 <span class="c">#  . For atoms with explicit assignment of SpinMultiplicity property values corresponding to</span>
 373 <span class="c">#    Singlet (two unpaired electrons corresponding to one spin state), Doublet (free radical; an unpaired</span>
 374 <span class="c">#    electron corresponding to two spin states), and Triplet (two unparied electrons corresponding to</span>
 375 <span class="c">#    three spin states; divalent carbon atoms (carbenes)), FreeRadicalElectrons are calculated as follows:</span>
 376 <span class="c">#</span>
 377 <span class="c">#       SpinMultiplicity: Doublet(2); FreeRadicalElectrons: 1</span>
 378 <span class="c">#       SpinMultiplicity: Singlet(1)/Triplet(3); FreeRadicalElectrons: 2</span>
 379 <span class="c">#</span>
<a name="GetFreeRadicalElectrons-"></a> 380 <span class="k">sub </span><span class="m">GetFreeRadicalElectrons</span> <span class="s">{</span>
 381   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 382   <span class="k">my</span><span class="s">(</span><span class="i">$FreeRadicalElectrons</span><span class="s">)</span><span class="sc">;</span>
 383 
 384   <span class="i">$FreeRadicalElectrons</span> = <span class="n">0</span><span class="sc">;</span>
 385 
 386   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;FreeRadicalElectrons&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 387     <span class="i">$FreeRadicalElectrons</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;FreeRadicalElectrons&#39;</span><span class="s">)</span><span class="sc">;</span>
 388     <span class="k">return</span> <span class="k">defined</span><span class="s">(</span><span class="i">$FreeRadicalElectrons</span><span class="s">)</span> ? <span class="i">$FreeRadicalElectrons</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 389   <span class="s">}</span>
 390 
 391   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;SpinMultiplicity&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 392     <span class="k">my</span><span class="s">(</span><span class="i">$SpinMultiplicity</span><span class="s">)</span><span class="sc">;</span>
 393     <span class="i">$SpinMultiplicity</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;SpinMultiplicity&#39;</span><span class="s">)</span><span class="sc">;</span>
 394 
 395     <span class="j">SPINMULTIPLICITY:</span> <span class="s">{</span>
 396       <span class="k">if</span> <span class="s">(</span><span class="i">$SpinMultiplicity</span> == <span class="n">1</span><span class="s">)</span> <span class="s">{</span> <span class="i">$FreeRadicalElectrons</span> = <span class="n">2</span><span class="sc">;</span> <span class="k">last</span> <span class="j">SPINMULTIPLICITY</span><span class="sc">;</span><span class="s">}</span>
 397       <span class="k">if</span> <span class="s">(</span><span class="i">$SpinMultiplicity</span> == <span class="n">2</span><span class="s">)</span> <span class="s">{</span> <span class="i">$FreeRadicalElectrons</span> = <span class="n">1</span><span class="sc">;</span> <span class="k">last</span> <span class="j">SPINMULTIPLICITY</span><span class="sc">;</span><span class="s">}</span>
 398       <span class="k">if</span> <span class="s">(</span><span class="i">$SpinMultiplicity</span> == <span class="n">3</span><span class="s">)</span> <span class="s">{</span> <span class="i">$FreeRadicalElectrons</span> = <span class="n">2</span><span class="sc">;</span> <span class="k">last</span> <span class="j">SPINMULTIPLICITY</span><span class="sc">;</span><span class="s">}</span>
 399       <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;GetFreeRadicalElectrons: It&#39;s not possible to determine free radical electrons from the specified spin multiplicity value, $FreeRadicalElectrons. It has been set to 0...&quot;</span><span class="sc">;</span>
 400       <span class="i">$FreeRadicalElectrons</span> = <span class="n">0</span><span class="sc">;</span>
 401     <span class="s">}</span>
 402   <span class="s">}</span>
 403 
 404   <span class="k">return</span> <span class="i">$FreeRadicalElectrons</span><span class="sc">;</span>
 405 <span class="s">}</span>
 406 
 407 <span class="c"># Set atom coordinates using:</span>
 408 <span class="c"># . An array reference with three values</span>
 409 <span class="c"># . An array containg three values</span>
 410 <span class="c"># . A 3D vector</span>
 411 <span class="c">#</span>
<a name="SetXYZ-"></a> 412 <span class="k">sub </span><span class="m">SetXYZ</span> <span class="s">{</span>
 413   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@Values</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 414 
 415   <span class="k">if</span> <span class="s">(</span>!<span class="i">@Values</span><span class="s">)</span> <span class="s">{</span>
 416     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;SetXYZ: No values specified...&quot;</span><span class="sc">;</span>
 417     <span class="k">return</span><span class="sc">;</span>
 418   <span class="s">}</span>
 419 
 420   <span class="i">$This</span>-&gt;{<span class="w">XYZ</span>}<span class="i">-&gt;SetXYZ</span><span class="s">(</span><span class="i">@Values</span><span class="s">)</span><span class="sc">;</span>
 421   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 422 <span class="s">}</span>
 423 
 424 <span class="c"># Set X value...</span>
<a name="SetX-"></a> 425 <span class="k">sub </span><span class="m">SetX</span> <span class="s">{</span>
 426   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 427 
 428   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$Value</span><span class="s">)</span> <span class="s">{</span>
 429     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;SetX: Undefined X value...&quot;</span><span class="sc">;</span>
 430     <span class="k">return</span><span class="sc">;</span>
 431   <span class="s">}</span>
 432   <span class="i">$This</span>-&gt;{<span class="w">XYZ</span>}<span class="i">-&gt;SetX</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span><span class="sc">;</span>
 433   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 434 <span class="s">}</span>
 435 
 436 <span class="c"># Set Y value...</span>
<a name="SetY-"></a> 437 <span class="k">sub </span><span class="m">SetY</span> <span class="s">{</span>
 438   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 439 
 440   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$Value</span><span class="s">)</span> <span class="s">{</span>
 441     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;SetY: Undefined Y value...&quot;</span><span class="sc">;</span>
 442     <span class="k">return</span><span class="sc">;</span>
 443   <span class="s">}</span>
 444   <span class="i">$This</span>-&gt;{<span class="w">XYZ</span>}<span class="i">-&gt;SetY</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span><span class="sc">;</span>
 445   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 446 <span class="s">}</span>
 447 
 448 <span class="c"># Set Z value...</span>
<a name="SetZ-"></a> 449 <span class="k">sub </span><span class="m">SetZ</span> <span class="s">{</span>
 450   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 451 
 452   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$Value</span><span class="s">)</span> <span class="s">{</span>
 453     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;SetZ: Undefined Z value...&quot;</span><span class="sc">;</span>
 454     <span class="k">return</span><span class="sc">;</span>
 455   <span class="s">}</span>
 456   <span class="i">$This</span>-&gt;{<span class="w">XYZ</span>}<span class="i">-&gt;SetZ</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span><span class="sc">;</span>
 457   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 458 <span class="s">}</span>
 459 
 460 <span class="c"># Return XYZ as:</span>
 461 <span class="c"># . Reference to an array</span>
 462 <span class="c"># . An array</span>
 463 <span class="c">#</span>
<a name="GetXYZ-"></a> 464 <span class="k">sub </span><span class="m">GetXYZ</span> <span class="s">{</span>
 465   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 466 
 467   <span class="k">return</span> <span class="i">$This</span>-&gt;{<span class="w">XYZ</span>}<span class="i">-&gt;GetXYZ</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 468 <span class="s">}</span>
 469 
 470 <span class="c"># Return XYZ as a vector object...</span>
 471 <span class="c">#</span>
<a name="GetXYZVector-"></a> 472 <span class="k">sub </span><span class="m">GetXYZVector</span> <span class="s">{</span>
 473   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 474 
 475   <span class="k">return</span> <span class="i">$This</span>-&gt;{<span class="w">XYZ</span>}<span class="sc">;</span>
 476 <span class="s">}</span>
 477 
 478 <span class="c"># Get X value...</span>
<a name="GetX-"></a> 479 <span class="k">sub </span><span class="m">GetX</span> <span class="s">{</span>
 480   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 481 
 482   <span class="k">return</span> <span class="i">$This</span>-&gt;{<span class="w">XYZ</span>}<span class="i">-&gt;GetX</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 483 <span class="s">}</span>
 484 
 485 <span class="c"># Get Y value...</span>
<a name="GetY-"></a> 486 <span class="k">sub </span><span class="m">GetY</span> <span class="s">{</span>
 487   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 488 
 489   <span class="k">return</span> <span class="i">$This</span>-&gt;{<span class="w">XYZ</span>}<span class="i">-&gt;GetY</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 490 <span class="s">}</span>
 491 
 492 <span class="c"># Get Z value...</span>
<a name="GetZ-"></a> 493 <span class="k">sub </span><span class="m">GetZ</span> <span class="s">{</span>
 494   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 495 
 496   <span class="k">return</span> <span class="i">$This</span>-&gt;{<span class="w">XYZ</span>}<span class="i">-&gt;GetZ</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 497 <span class="s">}</span>
 498 
 499 <span class="c"># Delete atom...</span>
<a name="DeleteAtom-"></a> 500 <span class="k">sub </span><span class="m">DeleteAtom</span> <span class="s">{</span>
 501   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 502 
 503   <span class="c"># Is this atom in a molecule?</span>
 504   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 505     <span class="c"># Nothing to do...</span>
 506     <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 507   <span class="s">}</span>
 508   <span class="k">my</span><span class="s">(</span><span class="i">$Molecule</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="sc">;</span>
 509 
 510   <span class="k">return</span> <span class="i">$Molecule</span><span class="i">-&gt;_DeleteAtom</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span><span class="sc">;</span>
 511 <span class="s">}</span>
 512 
 513 <span class="c"># Get atom neighbor objects as array. In scalar conetxt, return number of neighbors...</span>
<a name="GetNeighbors-"></a> 514 <span class="k">sub </span><span class="m">GetNeighbors</span> <span class="s">{</span>
 515   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@ExcludeNeighbors</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 516 
 517   <span class="c"># Is this atom in a molecule?</span>
 518   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 519     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 520   <span class="s">}</span>
 521   <span class="k">my</span><span class="s">(</span><span class="i">$Molecule</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="sc">;</span>
 522 
 523   <span class="k">if</span> <span class="s">(</span><span class="i">@ExcludeNeighbors</span><span class="s">)</span> <span class="s">{</span>
 524     <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetAtomNeighbors</span><span class="s">(</span><span class="i">@ExcludeNeighbors</span><span class="s">)</span><span class="sc">;</span>
 525   <span class="s">}</span>
 526   <span class="k">else</span> <span class="s">{</span>
 527     <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetAtomNeighbors</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 528   <span class="s">}</span>
 529 <span class="s">}</span>
 530 
 531 <span class="c"># Get atom neighbor objects as array. In scalar conetxt, return number of neighbors...</span>
<a name="_GetAtomNeighbors-"></a> 532 <span class="k">sub </span><span class="m">_GetAtomNeighbors</span> <span class="s">{</span>
 533   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@ExcludeNeighbors</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 534   <span class="k">my</span><span class="s">(</span><span class="i">$Molecule</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="sc">;</span>
 535 
 536   <span class="k">if</span> <span class="s">(</span>!<span class="i">@ExcludeNeighbors</span><span class="s">)</span> <span class="s">{</span>
 537     <span class="k">return</span> <span class="i">$Molecule</span><span class="i">-&gt;_GetAtomNeighbors</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span><span class="sc">;</span>
 538   <span class="s">}</span>
 539 
 540   <span class="c"># Setup a map for neigbhors to exclude...</span>
 541   <span class="k">my</span><span class="s">(</span><span class="i">$ExcludeNeighbor</span><span class="cm">,</span> <span class="i">$ExcludeNeighborID</span><span class="cm">,</span> <span class="i">%ExcludeNeighborsIDsMap</span><span class="s">)</span><span class="sc">;</span>
 542 
 543   <span class="i">%ExcludeNeighborsIDsMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 544   <span class="k">for</span> <span class="i">$ExcludeNeighbor</span> <span class="s">(</span><span class="i">@ExcludeNeighbors</span><span class="s">)</span> <span class="s">{</span>
 545     <span class="i">$ExcludeNeighborID</span> = <span class="i">$ExcludeNeighbor</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 546     <span class="i">$ExcludeNeighborsIDsMap</span>{<span class="i">$ExcludeNeighborID</span>} = <span class="i">$ExcludeNeighborID</span><span class="sc">;</span>
 547   <span class="s">}</span>
 548 
 549   <span class="c"># Generate a filtered neighbors list...</span>
 550   <span class="k">my</span><span class="s">(</span><span class="i">$Neighbor</span><span class="cm">,</span> <span class="i">$NeighborID</span><span class="cm">,</span> <span class="i">@FilteredAtomNeighbors</span><span class="s">)</span><span class="sc">;</span>
 551   <span class="i">@FilteredAtomNeighbors</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 552   <span class="j">NEIGHBOR:</span> <span class="k">for</span> <span class="i">$Neighbor</span> <span class="s">(</span><span class="i">$Molecule</span><span class="i">-&gt;_GetAtomNeighbors</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 553       <span class="i">$NeighborID</span> = <span class="i">$Neighbor</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 554       <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$ExcludeNeighborsIDsMap</span>{<span class="i">$NeighborID</span>}<span class="s">)</span> <span class="s">{</span>
 555         <span class="k">next</span> <span class="j">NEIGHBOR</span><span class="sc">;</span>
 556       <span class="s">}</span>
 557     <span class="k">push</span> <span class="i">@FilteredAtomNeighbors</span><span class="cm">,</span> <span class="i">$Neighbor</span><span class="sc">;</span>
 558   <span class="s">}</span>
 559 
 560   <span class="k">return</span> <span class="k">wantarray</span> ? <span class="i">@FilteredAtomNeighbors</span> <span class="co">:</span> <span class="k">scalar</span> <span class="i">@FilteredAtomNeighbors</span><span class="sc">;</span>
 561 <span class="s">}</span>
 562 
 563 <span class="c"># Get specific atom neighbor objects as array. In scalar conetxt, return number of neighbors.</span>
 564 <span class="c">#</span>
 565 <span class="c"># Notes:</span>
 566 <span class="c">#   . AtomSpecification correspond to any valid AtomicInvariant based atomic specifications</span>
 567 <span class="c">#     as implemented in DoesAtomNeighborhoodMatch method.</span>
 568 <span class="c">#   . Multiple atom specifications can be used in a string delimited by comma.</span>
 569 <span class="c">#</span>
<a name="GetNeighborsUsingAtomSpecification-"></a> 570 <span class="k">sub </span><span class="m">GetNeighborsUsingAtomSpecification</span> <span class="s">{</span>
 571   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$AtomSpecification</span><span class="cm">,</span> <span class="i">@ExcludeNeighbors</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 572   <span class="k">my</span><span class="s">(</span><span class="i">@AtomNeighbors</span><span class="s">)</span><span class="sc">;</span>
 573 
 574   <span class="i">@AtomNeighbors</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 575   <span class="i">@AtomNeighbors</span> = <span class="i">$This</span><span class="i">-&gt;GetNeighbors</span><span class="s">(</span><span class="i">@ExcludeNeighbors</span><span class="s">)</span><span class="sc">;</span>
 576 
 577   <span class="c"># Does atom has any neighbors and do they need to be filtered?</span>
 578   <span class="k">if</span> <span class="s">(</span>!<span class="s">(</span><span class="i">@AtomNeighbors</span> &amp;&amp; <span class="k">defined</span><span class="s">(</span><span class="i">$AtomSpecification</span><span class="s">)</span> &amp;&amp; <span class="i">$AtomSpecification</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 579     <span class="k">return</span> <span class="k">wantarray</span> ? <span class="i">@AtomNeighbors</span> <span class="co">:</span> <span class="k">scalar</span> <span class="i">@AtomNeighbors</span><span class="sc">;</span>
 580   <span class="s">}</span>
 581 
 582   <span class="c"># Filter neighbors using atom specification...</span>
 583   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="cm">,</span> <span class="i">@FilteredAtomNeighbors</span><span class="s">)</span><span class="sc">;</span>
 584 
 585   <span class="i">@FilteredAtomNeighbors</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 586   <span class="j">NEIGHBOR:</span> <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">@AtomNeighbors</span><span class="s">)</span> <span class="s">{</span>
 587     <span class="k">if</span> <span class="s">(</span>!<span class="i">$AtomNeighbor</span><span class="i">-&gt;_DoesAtomSpecificationMatch</span><span class="s">(</span><span class="i">$AtomSpecification</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 588       <span class="k">next</span> <span class="j">NEIGHBOR</span><span class="sc">;</span>
 589     <span class="s">}</span>
 590     <span class="k">push</span> <span class="i">@FilteredAtomNeighbors</span><span class="cm">,</span> <span class="i">$AtomNeighbor</span><span class="sc">;</span>
 591   <span class="s">}</span>
 592 
 593   <span class="k">return</span> <span class="k">wantarray</span> ? <span class="i">@FilteredAtomNeighbors</span> <span class="co">:</span> <span class="k">scalar</span> <span class="i">@FilteredAtomNeighbors</span><span class="sc">;</span>
 594 <span class="s">}</span>
 595 
 596 
 597 <span class="c"># Get non-hydrogen atom neighbor objects as array. In scalar context, return number of neighbors...</span>
<a name="GetHeavyAtomNeighbors-"></a> 598 <span class="k">sub </span><span class="m">GetHeavyAtomNeighbors</span> <span class="s">{</span>
 599   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 600 
 601   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNonHydrogenAtomNeighbors</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 602 <span class="s">}</span>
 603 
 604 <span class="c"># Get non-hydrogen atom neighbor objects as array. In scalar context, return number of neighbors...</span>
<a name="GetNonHydrogenAtomNeighbors-"></a> 605 <span class="k">sub </span><span class="m">GetNonHydrogenAtomNeighbors</span> <span class="s">{</span>
 606   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 607 
 608   <span class="c"># Is this atom in a molecule?</span>
 609   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 610     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 611   <span class="s">}</span>
 612   <span class="k">my</span><span class="s">(</span><span class="i">$NonHydrogenAtomsOnly</span><span class="cm">,</span> <span class="i">$HydrogenAtomsOnly</span><span class="s">)</span> = <span class="s">(</span><span class="n">1</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span><span class="sc">;</span>
 613 
 614   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetFilteredAtomNeighbors</span><span class="s">(</span><span class="i">$NonHydrogenAtomsOnly</span><span class="cm">,</span> <span class="i">$HydrogenAtomsOnly</span><span class="s">)</span><span class="sc">;</span>
 615 <span class="s">}</span>
 616 
 617 <span class="c"># Get hydrogen atom neighbor objects as array. In scalar context, return numbe of neighbors...</span>
<a name="GetHydrogenAtomNeighbors-"></a> 618 <span class="k">sub </span><span class="m">GetHydrogenAtomNeighbors</span> <span class="s">{</span>
 619   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 620 
 621   <span class="c"># Is this atom in a molecule?</span>
 622   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 623     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 624   <span class="s">}</span>
 625   <span class="k">my</span><span class="s">(</span><span class="i">$NonHydrogenAtomsOnly</span><span class="cm">,</span> <span class="i">$HydrogenAtomsOnly</span><span class="s">)</span> = <span class="s">(</span><span class="n">0</span><span class="cm">,</span> <span class="n">1</span><span class="s">)</span><span class="sc">;</span>
 626 
 627   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetFilteredAtomNeighbors</span><span class="s">(</span><span class="i">$NonHydrogenAtomsOnly</span><span class="cm">,</span> <span class="i">$HydrogenAtomsOnly</span><span class="s">)</span><span class="sc">;</span>
 628 <span class="s">}</span>
 629 
 630 <span class="c"># Get non-hydrogen neighbor of hydrogen atom...</span>
 631 <span class="c">#</span>
<a name="GetNonHydrogenNeighborOfHydrogenAtom-"></a> 632 <span class="k">sub </span><span class="m">GetNonHydrogenNeighborOfHydrogenAtom</span> <span class="s">{</span>
 633   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 634 
 635   <span class="c"># Is it Hydrogen?</span>
 636   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;IsHydrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 637     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 638   <span class="s">}</span>
 639   <span class="k">my</span><span class="s">(</span><span class="i">@Neighbors</span><span class="s">)</span><span class="sc">;</span>
 640 
 641   <span class="i">@Neighbors</span> = <span class="i">$This</span><span class="i">-&gt;GetNonHydrogenAtomNeighbors</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 642 
 643   <span class="k">return</span> <span class="s">(</span><span class="i">@Neighbors</span> == <span class="n">1</span><span class="s">)</span> ? <span class="i">$Neighbors</span>[<span class="n">0</span>] <span class="co">:</span> <span class="k">undef</span><span class="sc">;</span>
 644 <span class="s">}</span>
 645 
 646 <span class="c"># Get filtered atom atom neighbors</span>
<a name="_GetFilteredAtomNeighbors-"></a> 647 <span class="k">sub </span><span class="m">_GetFilteredAtomNeighbors</span> <span class="s">{</span>
 648   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NonHydrogenAtomsOnly</span><span class="cm">,</span> <span class="i">$HydrogenAtomsOnly</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 649 
 650   <span class="c"># Check flags...</span>
 651   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$NonHydrogenAtomsOnly</span><span class="s">)</span> <span class="s">{</span>
 652     <span class="i">$NonHydrogenAtomsOnly</span> = <span class="n">0</span><span class="sc">;</span>
 653   <span class="s">}</span>
 654   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$HydrogenAtomsOnly</span><span class="s">)</span> <span class="s">{</span>
 655     <span class="i">$HydrogenAtomsOnly</span> = <span class="n">0</span><span class="sc">;</span>
 656   <span class="s">}</span>
 657   <span class="k">my</span><span class="s">(</span><span class="i">$Neighbor</span><span class="cm">,</span> <span class="i">@FilteredAtomNeighbors</span><span class="s">)</span><span class="sc">;</span>
 658 
 659   <span class="i">@FilteredAtomNeighbors</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 660   <span class="j">NEIGHBOR:</span> <span class="k">for</span> <span class="i">$Neighbor</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetNeighbors</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 661     <span class="k">if</span> <span class="s">(</span><span class="i">$NonHydrogenAtomsOnly</span> &amp;&amp; <span class="i">$Neighbor</span><span class="i">-&gt;IsHydrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 662       <span class="k">next</span> <span class="j">NEIGHBOR</span><span class="sc">;</span>
 663     <span class="s">}</span>
 664     <span class="k">if</span> <span class="s">(</span><span class="i">$HydrogenAtomsOnly</span> &amp;&amp; <span class="s">(</span>!<span class="i">$Neighbor</span><span class="i">-&gt;IsHydrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 665       <span class="k">next</span> <span class="j">NEIGHBOR</span><span class="sc">;</span>
 666     <span class="s">}</span>
 667     <span class="k">push</span> <span class="i">@FilteredAtomNeighbors</span><span class="cm">,</span> <span class="i">$Neighbor</span><span class="sc">;</span>
 668   <span class="s">}</span>
 669 
 670   <span class="k">return</span> <span class="k">wantarray</span> ? <span class="i">@FilteredAtomNeighbors</span> <span class="co">:</span> <span class="k">scalar</span> <span class="i">@FilteredAtomNeighbors</span><span class="sc">;</span>
 671 <span class="s">}</span>
 672 
 673 <span class="c"># Get number of neighbors...</span>
 674 <span class="c">#</span>
<a name="GetNumOfNeighbors-"></a> 675 <span class="k">sub </span><span class="m">GetNumOfNeighbors</span> <span class="s">{</span>
 676   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 677   <span class="k">my</span><span class="s">(</span><span class="i">$NumOfNeighbors</span><span class="s">)</span><span class="sc">;</span>
 678 
 679   <span class="i">$NumOfNeighbors</span> = <span class="i">$This</span><span class="i">-&gt;GetNeighbors</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 680 
 681   <span class="k">return</span> <span class="s">(</span><span class="k">defined</span> <span class="i">$NumOfNeighbors</span><span class="s">)</span> ? <span class="i">$NumOfNeighbors</span> <span class="co">:</span> <span class="k">undef</span><span class="sc">;</span>
 682 <span class="s">}</span>
 683 
 684 <span class="c"># Get number of neighbors which are non-hydrogen atoms...</span>
<a name="GetNumOfHeavyAtomNeighbors-"></a> 685 <span class="k">sub </span><span class="m">GetNumOfHeavyAtomNeighbors</span> <span class="s">{</span>
 686   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 687 
 688   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfNonHydrogenAtomNeighbors</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 689 <span class="s">}</span>
 690 
 691 <span class="c"># Get number of neighbors which are non-hydrogen atoms...</span>
<a name="GetNumOfNonHydrogenAtomNeighbors-"></a> 692 <span class="k">sub </span><span class="m">GetNumOfNonHydrogenAtomNeighbors</span> <span class="s">{</span>
 693   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 694   <span class="k">my</span><span class="s">(</span><span class="i">$NumOfNeighbors</span><span class="s">)</span><span class="sc">;</span>
 695 
 696   <span class="i">$NumOfNeighbors</span> = <span class="i">$This</span><span class="i">-&gt;GetNonHydrogenAtomNeighbors</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 697 
 698   <span class="k">return</span> <span class="s">(</span><span class="k">defined</span> <span class="i">$NumOfNeighbors</span><span class="s">)</span> ? <span class="i">$NumOfNeighbors</span> <span class="co">:</span> <span class="k">undef</span><span class="sc">;</span>
 699 <span class="s">}</span>
 700 
 701 <span class="c"># Get number of neighbors which are hydrogen atoms...</span>
<a name="GetNumOfHydrogenAtomNeighbors-"></a> 702 <span class="k">sub </span><span class="m">GetNumOfHydrogenAtomNeighbors</span> <span class="s">{</span>
 703   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 704   <span class="k">my</span><span class="s">(</span><span class="i">$NumOfNeighbors</span><span class="s">)</span><span class="sc">;</span>
 705 
 706   <span class="i">$NumOfNeighbors</span> = <span class="i">$This</span><span class="i">-&gt;GetHydrogenAtomNeighbors</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 707 
 708   <span class="k">return</span> <span class="s">(</span><span class="k">defined</span> <span class="i">$NumOfNeighbors</span><span class="s">)</span> ? <span class="i">$NumOfNeighbors</span> <span class="co">:</span> <span class="k">undef</span><span class="sc">;</span>
 709 <span class="s">}</span>
 710 
 711 <span class="c"># Get bond objects as array. In scalar context, return number of bonds...</span>
<a name="GetBonds-"></a> 712 <span class="k">sub </span><span class="m">GetBonds</span> <span class="s">{</span>
 713   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 714 
 715   <span class="c"># Is this atom in a molecule?</span>
 716   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 717     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 718   <span class="s">}</span>
 719   <span class="k">my</span><span class="s">(</span><span class="i">$Molecule</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="sc">;</span>
 720 
 721   <span class="k">return</span> <span class="i">$Molecule</span><span class="i">-&gt;_GetAtomBonds</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span><span class="sc">;</span>
 722 <span class="s">}</span>
 723 
 724 <span class="c"># Get bond to specified atom...</span>
<a name="GetBondToAtom-"></a> 725 <span class="k">sub </span><span class="m">GetBondToAtom</span> <span class="s">{</span>
 726   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Other</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 727 
 728   <span class="c"># Is this atom in a molecule?</span>
 729   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 730     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 731   <span class="s">}</span>
 732   <span class="k">my</span><span class="s">(</span><span class="i">$Molecule</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="sc">;</span>
 733 
 734   <span class="k">return</span> <span class="i">$Molecule</span><span class="i">-&gt;_GetBondToAtom</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Other</span><span class="s">)</span><span class="sc">;</span>
 735 <span class="s">}</span>
 736 
 737 <span class="c"># It it bonded to a specified atom?</span>
<a name="IsBondedToAtom-"></a> 738 <span class="k">sub </span><span class="m">IsBondedToAtom</span> <span class="s">{</span>
 739   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Other</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 740 
 741   <span class="c"># Is this atom in a molecule?</span>
 742   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 743     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 744   <span class="s">}</span>
 745   <span class="k">my</span><span class="s">(</span><span class="i">$Molecule</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="sc">;</span>
 746 
 747   <span class="k">return</span> <span class="i">$Molecule</span><span class="i">-&gt;_IsBondedToAtom</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Other</span><span class="s">)</span><span class="sc">;</span>
 748 <span class="s">}</span>
 749 
 750 <span class="c"># Get bond objects to non-hydrogen atoms as array. In scalar context, return number of bonds...</span>
<a name="GetBondsToHeavyAtoms-"></a> 751 <span class="k">sub </span><span class="m">GetBondsToHeavyAtoms</span> <span class="s">{</span>
 752   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 753 
 754   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 755 <span class="s">}</span>
 756 
 757 <span class="c"># Get bond objects to non-hydrogen atoms as array. In scalar context, return number of bonds...</span>
<a name="GetBondsToNonHydrogenAtoms-"></a> 758 <span class="k">sub </span><span class="m">GetBondsToNonHydrogenAtoms</span> <span class="s">{</span>
 759   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 760 
 761   <span class="c"># Is this atom in a molecule?</span>
 762   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 763     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 764   <span class="s">}</span>
 765   <span class="k">my</span><span class="s">(</span><span class="i">$BondsToNonHydrogenAtomsOnly</span><span class="cm">,</span> <span class="i">$BondsToHydrogenAtomsOnly</span><span class="s">)</span> = <span class="s">(</span><span class="n">1</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span><span class="sc">;</span>
 766 
 767   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetFilteredBonds</span><span class="s">(</span><span class="i">$BondsToNonHydrogenAtomsOnly</span><span class="cm">,</span> <span class="i">$BondsToHydrogenAtomsOnly</span><span class="s">)</span><span class="sc">;</span>
 768 <span class="s">}</span>
 769 
 770 <span class="c"># Get bond objects to hydrogen atoms as array. In scalar context, return number of bonds...</span>
<a name="GetBondsToHydrogenAtoms-"></a> 771 <span class="k">sub </span><span class="m">GetBondsToHydrogenAtoms</span> <span class="s">{</span>
 772   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 773 
 774   <span class="c"># Is this atom in a molecule?</span>
 775   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 776     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 777   <span class="s">}</span>
 778   <span class="k">my</span><span class="s">(</span><span class="i">$BondsToNonHydrogenAtomsOnly</span><span class="cm">,</span> <span class="i">$BondsToHydrogenAtomsOnly</span><span class="s">)</span> = <span class="s">(</span><span class="n">0</span><span class="cm">,</span> <span class="n">1</span><span class="s">)</span><span class="sc">;</span>
 779 
 780   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetFilteredBonds</span><span class="s">(</span><span class="i">$BondsToNonHydrogenAtomsOnly</span><span class="cm">,</span> <span class="i">$BondsToHydrogenAtomsOnly</span><span class="s">)</span><span class="sc">;</span>
 781 <span class="s">}</span>
 782 
 783 <span class="c"># Get filtered bonds...</span>
<a name="_GetFilteredBonds-"></a> 784 <span class="k">sub </span><span class="m">_GetFilteredBonds</span> <span class="s">{</span>
 785   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$BondsToNonHydrogenAtomsOnly</span><span class="cm">,</span> <span class="i">$BondsToHydrogenAtomsOnly</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 786 
 787   <span class="c"># Check flags...</span>
 788   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$BondsToNonHydrogenAtomsOnly</span><span class="s">)</span> <span class="s">{</span>
 789     <span class="i">$BondsToNonHydrogenAtomsOnly</span> = <span class="n">0</span><span class="sc">;</span>
 790   <span class="s">}</span>
 791   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$BondsToHydrogenAtomsOnly</span><span class="s">)</span> <span class="s">{</span>
 792     <span class="i">$BondsToHydrogenAtomsOnly</span> = <span class="n">0</span><span class="sc">;</span>
 793   <span class="s">}</span>
 794 
 795   <span class="k">my</span><span class="s">(</span><span class="i">$Bond</span><span class="cm">,</span> <span class="i">$BondedAtom</span><span class="cm">,</span> <span class="i">@FilteredBonds</span><span class="s">)</span><span class="sc">;</span>
 796 
 797   <span class="i">@FilteredBonds</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 798   <span class="j">BOND:</span> <span class="k">for</span> <span class="i">$Bond</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetBonds</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 799     <span class="i">$BondedAtom</span> = <span class="i">$Bond</span><span class="i">-&gt;GetBondedAtom</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span><span class="sc">;</span>
 800     <span class="k">if</span> <span class="s">(</span><span class="i">$BondsToNonHydrogenAtomsOnly</span> &amp;&amp; <span class="i">$BondedAtom</span><span class="i">-&gt;IsHydrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 801       <span class="k">next</span> <span class="j">BOND</span><span class="sc">;</span>
 802     <span class="s">}</span>
 803     <span class="k">if</span> <span class="s">(</span><span class="i">$BondsToHydrogenAtomsOnly</span> &amp;&amp; <span class="s">(</span>!<span class="i">$BondedAtom</span><span class="i">-&gt;IsHydrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 804       <span class="k">next</span> <span class="j">BOND</span><span class="sc">;</span>
 805     <span class="s">}</span>
 806     <span class="k">push</span> <span class="i">@FilteredBonds</span><span class="cm">,</span> <span class="i">$Bond</span><span class="sc">;</span>
 807   <span class="s">}</span>
 808 
 809   <span class="k">return</span> <span class="k">wantarray</span> ? <span class="i">@FilteredBonds</span> <span class="co">:</span> <span class="s">(</span><span class="k">scalar</span> <span class="i">@FilteredBonds</span><span class="s">)</span><span class="sc">;</span>
 810 <span class="s">}</span>
 811 
 812 <span class="c"># Get number of bonds...</span>
 813 <span class="c">#</span>
<a name="GetNumOfBonds-"></a> 814 <span class="k">sub </span><span class="m">GetNumOfBonds</span> <span class="s">{</span>
 815   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 816   <span class="k">my</span><span class="s">(</span><span class="i">$NumOfBonds</span><span class="s">)</span><span class="sc">;</span>
 817 
 818   <span class="i">$NumOfBonds</span> = <span class="i">$This</span><span class="i">-&gt;GetBonds</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 819 
 820   <span class="k">return</span> <span class="s">(</span><span class="k">defined</span> <span class="i">$NumOfBonds</span><span class="s">)</span> ? <span class="s">(</span><span class="i">$NumOfBonds</span><span class="s">)</span> <span class="co">:</span> <span class="k">undef</span><span class="sc">;</span>
 821 <span class="s">}</span>
 822 
 823 <span class="c"># Get number of bonds to non-hydrogen atoms...</span>
<a name="GetNumOfBondsToHeavyAtoms-"></a> 824 <span class="k">sub </span><span class="m">GetNumOfBondsToHeavyAtoms</span> <span class="s">{</span>
 825   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 826 
 827   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 828 <span class="s">}</span>
 829 
 830 <span class="c"># Get number of bonds to non-hydrogen atoms...</span>
<a name="GetNumOfBondsToNonHydrogenAtoms-"></a> 831 <span class="k">sub </span><span class="m">GetNumOfBondsToNonHydrogenAtoms</span> <span class="s">{</span>
 832   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 833   <span class="k">my</span><span class="s">(</span><span class="i">$NumOfBonds</span><span class="s">)</span><span class="sc">;</span>
 834 
 835   <span class="i">$NumOfBonds</span> = <span class="i">$This</span><span class="i">-&gt;GetBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 836 
 837   <span class="k">return</span> <span class="s">(</span><span class="k">defined</span> <span class="i">$NumOfBonds</span><span class="s">)</span> ? <span class="s">(</span><span class="i">$NumOfBonds</span><span class="s">)</span> <span class="co">:</span> <span class="k">undef</span><span class="sc">;</span>
 838 <span class="s">}</span>
 839 
 840 <span class="c"># Get number of single bonds to heavy atoms...</span>
<a name="GetNumOfSingleBondsToHeavyAtoms-"></a> 841 <span class="k">sub </span><span class="m">GetNumOfSingleBondsToHeavyAtoms</span> <span class="s">{</span>
 842   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 843 
 844   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfSingleBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 845 <span class="s">}</span>
 846 
 847 <span class="c"># Get number of single bonds to non-hydrogen atoms...</span>
<a name="GetNumOfSingleBondsToNonHydrogenAtoms-"></a> 848 <span class="k">sub </span><span class="m">GetNumOfSingleBondsToNonHydrogenAtoms</span> <span class="s">{</span>
 849   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 850 
 851   <span class="c"># Is this atom in a molecule?</span>
 852   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 853     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 854   <span class="s">}</span>
 855   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetNumOfBondsWithSpecifiedBondOrderToNonHydrogenAtoms</span><span class="s">(</span><span class="n">1</span><span class="s">)</span><span class="sc">;</span>
 856 <span class="s">}</span>
 857 
 858 <span class="c"># Get number of double bonds to heavy atoms...</span>
<a name="GetNumOfDoubleBondsToHeavyAtoms-"></a> 859 <span class="k">sub </span><span class="m">GetNumOfDoubleBondsToHeavyAtoms</span> <span class="s">{</span>
 860   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 861 
 862   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfDoubleBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 863 <span class="s">}</span>
 864 
 865 <span class="c"># Get number of double bonds to non-hydrogen atoms...</span>
<a name="GetNumOfDoubleBondsToNonHydrogenAtoms-"></a> 866 <span class="k">sub </span><span class="m">GetNumOfDoubleBondsToNonHydrogenAtoms</span> <span class="s">{</span>
 867   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 868 
 869   <span class="c"># Is this atom in a molecule?</span>
 870   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 871     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 872   <span class="s">}</span>
 873   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetNumOfBondsWithSpecifiedBondOrderToNonHydrogenAtoms</span><span class="s">(</span><span class="n">2</span><span class="s">)</span><span class="sc">;</span>
 874 <span class="s">}</span>
 875 
 876 <span class="c"># Get number of triple bonds to heavy atoms...</span>
<a name="GetNumOfTripleBondsToHeavyAtoms-"></a> 877 <span class="k">sub </span><span class="m">GetNumOfTripleBondsToHeavyAtoms</span> <span class="s">{</span>
 878   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 879 
 880   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfTripleBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 881 <span class="s">}</span>
 882 
 883 <span class="c"># Get number of triple bonds to non-hydrogen atoms...</span>
<a name="GetNumOfTripleBondsToNonHydrogenAtoms-"></a> 884 <span class="k">sub </span><span class="m">GetNumOfTripleBondsToNonHydrogenAtoms</span> <span class="s">{</span>
 885   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 886 
 887   <span class="c"># Is this atom in a molecule?</span>
 888   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 889     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 890   <span class="s">}</span>
 891   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetNumOfBondsWithSpecifiedBondOrderToNonHydrogenAtoms</span><span class="s">(</span><span class="n">3</span><span class="s">)</span><span class="sc">;</span>
 892 <span class="s">}</span>
 893 
 894 <span class="c"># Get number of bonds of specified bond order to non-hydrogen atoms...</span>
<a name="_GetNumOfBondsWithSpecifiedBondOrderToNonHydrogenAtoms-"></a> 895 <span class="k">sub </span><span class="m">_GetNumOfBondsWithSpecifiedBondOrderToNonHydrogenAtoms</span> <span class="s">{</span>
 896   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$SpecifiedBondOrder</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 897   <span class="k">my</span><span class="s">(</span><span class="i">$NumOfBonds</span><span class="cm">,</span> <span class="i">$Bond</span><span class="cm">,</span> <span class="i">$BondOrder</span><span class="cm">,</span> <span class="i">@Bonds</span><span class="s">)</span><span class="sc">;</span>
 898 
 899   <span class="i">$NumOfBonds</span> = <span class="n">0</span><span class="sc">;</span>
 900   <span class="i">@Bonds</span> = <span class="i">$This</span><span class="i">-&gt;GetBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 901   <span class="k">for</span> <span class="i">$Bond</span> <span class="s">(</span><span class="i">@Bonds</span><span class="s">)</span> <span class="s">{</span>
 902     <span class="i">$BondOrder</span> = <span class="i">$Bond</span><span class="i">-&gt;GetBondOrder</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 903     <span class="k">if</span> <span class="s">(</span><span class="i">$SpecifiedBondOrder</span> == <span class="i">$BondOrder</span><span class="s">)</span> <span class="s">{</span>
 904       <span class="i">$NumOfBonds</span>++<span class="sc">;</span>
 905     <span class="s">}</span>
 906   <span class="s">}</span>
 907   <span class="k">return</span> <span class="i">$NumOfBonds</span><span class="sc">;</span>
 908 <span class="s">}</span>
 909 
 910 <span class="c"># Get number of aromatic bonds to heavy atoms...</span>
<a name="GetNumOfAromaticBondsToHeavyAtoms-"></a> 911 <span class="k">sub </span><span class="m">GetNumOfAromaticBondsToHeavyAtoms</span> <span class="s">{</span>
 912   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 913 
 914   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfAromaticBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 915 <span class="s">}</span>
 916 
 917 <span class="c"># Get number of aromatic bonds to non-hydrogen atoms...</span>
<a name="GetNumOfAromaticBondsToNonHydrogenAtoms-"></a> 918 <span class="k">sub </span><span class="m">GetNumOfAromaticBondsToNonHydrogenAtoms</span> <span class="s">{</span>
 919   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 920   <span class="k">my</span><span class="s">(</span><span class="i">$NumOfBonds</span><span class="cm">,</span> <span class="i">$Bond</span><span class="cm">,</span> <span class="i">@Bonds</span><span class="s">)</span><span class="sc">;</span>
 921 
 922   <span class="c"># Is this atom in a molecule?</span>
 923   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 924     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 925   <span class="s">}</span>
 926 
 927   <span class="i">$NumOfBonds</span> = <span class="n">0</span><span class="sc">;</span>
 928   <span class="i">@Bonds</span> = <span class="i">$This</span><span class="i">-&gt;GetBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 929   <span class="k">for</span> <span class="i">$Bond</span> <span class="s">(</span><span class="i">@Bonds</span><span class="s">)</span> <span class="s">{</span>
 930     <span class="k">if</span> <span class="s">(</span><span class="i">$Bond</span><span class="i">-&gt;IsAromatic</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span> <span class="i">$NumOfBonds</span>++<span class="sc">;</span> <span class="s">}</span>
 931   <span class="s">}</span>
 932   <span class="k">return</span> <span class="i">$NumOfBonds</span><span class="sc">;</span>
 933 <span class="s">}</span>
 934 
 935 <span class="c"># Get number of different bond types to non-hydrogen atoms...</span>
 936 <span class="c">#</span>
<a name="GetNumOfBondTypesToHeavyAtoms-"></a> 937 <span class="k">sub </span><span class="m">GetNumOfBondTypesToHeavyAtoms</span> <span class="s">{</span>
 938   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$CountAromaticBonds</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 939 
 940   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfBondTypesToNonHydrogenAtoms</span><span class="s">(</span><span class="i">$CountAromaticBonds</span><span class="s">)</span><span class="sc">;</span>
 941 <span class="s">}</span>
 942 
 943 <span class="c"># Get number of single, double, triple, and aromatic bonds from an atom to all other</span>
 944 <span class="c"># non-hydrogen atoms. Value of CountAtomaticBonds parameter controls whether</span>
 945 <span class="c"># number of aromatic bonds is returned; default is not to count aromatic bonds. During</span>
 946 <span class="c"># counting of aromatic bonds, the bond marked aromatic is not included in the count</span>
 947 <span class="c"># of other bond types.</span>
 948 <span class="c">#</span>
<a name="GetNumOfBondTypesToNonHydrogenAtoms-"></a> 949 <span class="k">sub </span><span class="m">GetNumOfBondTypesToNonHydrogenAtoms</span> <span class="s">{</span>
 950   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$CountAromaticBonds</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 951   <span class="k">my</span><span class="s">(</span><span class="i">$NumOfSingleBonds</span><span class="cm">,</span> <span class="i">$NumOfDoubleBonds</span><span class="cm">,</span> <span class="i">$NumOfTripleBonds</span><span class="cm">,</span> <span class="i">$NumOfAromaticBonds</span><span class="cm">,</span> <span class="i">$None</span><span class="cm">,</span> <span class="i">$Bond</span><span class="cm">,</span> <span class="i">@Bonds</span><span class="s">)</span><span class="sc">;</span>
 952 
 953   <span class="i">$CountAromaticBonds</span> = <span class="k">defined</span><span class="s">(</span><span class="i">$CountAromaticBonds</span><span class="s">)</span> ? <span class="i">$CountAromaticBonds</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 954 
 955   <span class="s">(</span><span class="i">$NumOfSingleBonds</span><span class="cm">,</span> <span class="i">$NumOfDoubleBonds</span><span class="cm">,</span> <span class="i">$NumOfTripleBonds</span><span class="s">)</span> = <span class="s">(</span><span class="q">&#39;0&#39;</span><span class="s">)</span> x <span class="n">3</span><span class="sc">;</span>
 956   <span class="i">$NumOfAromaticBonds</span> = <span class="i">$CountAromaticBonds</span> ? <span class="n">0</span> <span class="co">:</span> <span class="k">undef</span><span class="sc">;</span>
 957 
 958   <span class="c"># Is this atom in a molecule?</span>
 959   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 960     <span class="k">return</span> <span class="s">(</span><span class="i">$NumOfSingleBonds</span><span class="cm">,</span> <span class="i">$NumOfDoubleBonds</span><span class="cm">,</span> <span class="i">$NumOfTripleBonds</span><span class="cm">,</span> <span class="i">$NumOfAromaticBonds</span><span class="s">)</span><span class="sc">;</span>
 961   <span class="s">}</span>
 962 
 963   <span class="i">@Bonds</span> = <span class="i">$This</span><span class="i">-&gt;GetBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 964 
 965   <span class="k">for</span> <span class="i">$Bond</span> <span class="s">(</span><span class="i">@Bonds</span><span class="s">)</span> <span class="s">{</span>
 966     <span class="j">BONDTYPE:</span> <span class="s">{</span>
 967       <span class="k">if</span> <span class="s">(</span><span class="i">$CountAromaticBonds</span><span class="s">)</span> <span class="s">{</span>
 968         <span class="k">if</span> <span class="s">(</span><span class="i">$Bond</span><span class="i">-&gt;IsAromatic</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span> <span class="i">$NumOfAromaticBonds</span>++<span class="sc">;</span> <span class="k">last</span> <span class="j">BONDTYPE</span><span class="sc">;</span> <span class="s">}</span>
 969       <span class="s">}</span>
 970       <span class="k">if</span> <span class="s">(</span><span class="i">$Bond</span><span class="i">-&gt;IsSingle</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span> <span class="i">$NumOfSingleBonds</span>++<span class="sc">;</span> <span class="k">last</span> <span class="j">BONDTYPE</span><span class="sc">;</span> <span class="s">}</span>
 971       <span class="k">if</span> <span class="s">(</span><span class="i">$Bond</span><span class="i">-&gt;IsDouble</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span> <span class="i">$NumOfDoubleBonds</span>++<span class="sc">;</span> <span class="k">last</span> <span class="j">BONDTYPE</span><span class="sc">;</span> <span class="s">}</span>
 972       <span class="k">if</span> <span class="s">(</span><span class="i">$Bond</span><span class="i">-&gt;IsTriple</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span> <span class="i">$NumOfTripleBonds</span>++<span class="sc">;</span> <span class="k">last</span> <span class="j">BONDTYPE</span><span class="sc">;</span> <span class="s">}</span>
 973       <span class="i">$None</span> = <span class="n">1</span><span class="sc">;</span>
 974     <span class="s">}</span>
 975   <span class="s">}</span>
 976   <span class="k">return</span> <span class="s">(</span><span class="i">$NumOfSingleBonds</span><span class="cm">,</span> <span class="i">$NumOfDoubleBonds</span><span class="cm">,</span> <span class="i">$NumOfTripleBonds</span><span class="cm">,</span> <span class="i">$NumOfAromaticBonds</span><span class="s">)</span><span class="sc">;</span>
 977 <span class="s">}</span>
 978 
 979 <span class="c"># Get number of sigma and pi bonds to heavy atoms...</span>
 980 <span class="c">#</span>
<a name="GetNumOfSigmaAndPiBondsToHeavyAtoms-"></a> 981 <span class="k">sub </span><span class="m">GetNumOfSigmaAndPiBondsToHeavyAtoms</span> <span class="s">{</span>
 982   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 983 
 984   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfSigmaAndPiBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 985 <span class="s">}</span>
 986 
 987 <span class="c"># Get number of sigma and pi bonds from an atom to all other non-hydrogen atoms.</span>
 988 <span class="c"># Sigma and pi bonds are counted using the following methodology: a single bond</span>
 989 <span class="c"># correspond to one sigma bond; a double bond contributes one to sigma bond count</span>
 990 <span class="c"># and one to pi bond count; a triple bond contributes one to sigma bond count and</span>
 991 <span class="c"># two to pi bond count.</span>
 992 <span class="c">#</span>
<a name="GetNumOfSigmaAndPiBondsToNonHydrogenAtoms-"></a> 993 <span class="k">sub </span><span class="m">GetNumOfSigmaAndPiBondsToNonHydrogenAtoms</span> <span class="s">{</span>
 994   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 995   <span class="k">my</span><span class="s">(</span><span class="i">$NumOfSingleBonds</span><span class="cm">,</span> <span class="i">$NumOfDoubleBonds</span><span class="cm">,</span> <span class="i">$NumOfTripleBonds</span><span class="cm">,</span> <span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="s">)</span><span class="sc">;</span>
 996 
 997   <span class="s">(</span><span class="i">$NumOfSingleBonds</span><span class="cm">,</span> <span class="i">$NumOfDoubleBonds</span><span class="cm">,</span> <span class="i">$NumOfTripleBonds</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;GetNumOfBondTypesToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 998 
 999   <span class="i">$NumOfSigmaBonds</span> = <span class="i">$NumOfSingleBonds</span> + <span class="i">$NumOfDoubleBonds</span> + <span class="i">$NumOfTripleBonds</span><span class="sc">;</span>
1000   <span class="i">$NumOfPiBonds</span> = <span class="i">$NumOfDoubleBonds</span> + <span class="n">2</span>*<span class="i">$NumOfTripleBonds</span><span class="sc">;</span>
1001 
1002   <span class="k">return</span> <span class="s">(</span><span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="s">)</span><span class="sc">;</span>
1003 <span class="s">}</span>
1004 
1005 <span class="c"># Get information related to atoms for all heavy atoms attached to an atom..</span>
1006 <span class="c">#</span>
<a name="GetHeavyAtomNeighborsAtomInformation-"></a>1007 <span class="k">sub </span><span class="m">GetHeavyAtomNeighborsAtomInformation</span> <span class="s">{</span>
1008   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1009 
1010   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNonHydrogenAtomNeighborsAtomInformation</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1011 <span class="s">}</span>
1012 
1013 <span class="c"># Get information related to atoms for all non-hydrogen atoms attached to an atom..</span>
1014 <span class="c">#</span>
1015 <span class="c"># The following values are returned:</span>
1016 <span class="c">#   . Number of non-hydrogen atom neighbors</span>
1017 <span class="c">#   . A reference to an array containing atom objects correpsonding to non-hydrogen</span>
1018 <span class="c">#     atom neighbors</span>
1019 <span class="c">#   . Number of different types of non-hydrogen atom neighbors</span>
1020 <span class="c">#   . A reference to a hash containing atom symbol as key with value corresponding</span>
1021 <span class="c">#     to its count for non-hydrogen atom neighbors</span>
1022 <span class="c">#</span>
<a name="GetNonHydrogenAtomNeighborsAtomInformation-"></a>1023 <span class="k">sub </span><span class="m">GetNonHydrogenAtomNeighborsAtomInformation</span> <span class="s">{</span>
1024   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1025 
1026   <span class="c"># Is this atom in a molecule?</span>
1027   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1028     <span class="k">return</span> <span class="s">(</span><span class="k">undef</span><span class="cm">,</span> <span class="k">undef</span><span class="cm">,</span> <span class="k">undef</span><span class="cm">,</span> <span class="k">undef</span><span class="s">)</span><span class="sc">;</span>
1029   <span class="s">}</span>
1030   <span class="k">my</span><span class="s">(</span><span class="i">$AtomSymbol</span><span class="cm">,</span> <span class="i">$AtomNeighbor</span><span class="cm">,</span> <span class="i">$NumOfAtomNeighbors</span><span class="cm">,</span> <span class="i">$NumOfAtomNeighborsType</span><span class="cm">,</span> <span class="i">@AtomNeighbors</span><span class="cm">,</span> <span class="i">%AtomNeighborsTypeMap</span><span class="s">)</span><span class="sc">;</span>
1031 
1032   <span class="i">$NumOfAtomNeighbors</span> = <span class="n">0</span><span class="sc">;</span> <span class="i">@AtomNeighbors</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1033   <span class="i">$NumOfAtomNeighborsType</span> = <span class="n">0</span><span class="sc">;</span> <span class="i">%AtomNeighborsTypeMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1034 
1035   <span class="i">@AtomNeighbors</span> = <span class="i">$This</span><span class="i">-&gt;GetNonHydrogenAtomNeighbors</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1036   <span class="i">$NumOfAtomNeighbors</span> = <span class="k">scalar</span> <span class="i">@AtomNeighbors</span><span class="sc">;</span>
1037 
1038   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">@AtomNeighbors</span><span class="s">)</span> <span class="s">{</span>
1039     <span class="i">$AtomSymbol</span> = <span class="i">$AtomNeighbor</span>-&gt;{<span class="w">AtomSymbol</span>}<span class="sc">;</span>
1040     <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$AtomNeighborsTypeMap</span>{<span class="i">$AtomSymbol</span>}<span class="s">)</span> <span class="s">{</span>
1041       <span class="i">$AtomNeighborsTypeMap</span>{<span class="i">$AtomSymbol</span>} += <span class="n">1</span><span class="sc">;</span>
1042     <span class="s">}</span>
1043     <span class="k">else</span> <span class="s">{</span>
1044       <span class="i">$AtomNeighborsTypeMap</span>{<span class="i">$AtomSymbol</span>} = <span class="n">1</span><span class="sc">;</span>
1045       <span class="i">$NumOfAtomNeighborsType</span>++<span class="sc">;</span>
1046     <span class="s">}</span>
1047   <span class="s">}</span>
1048 
1049   <span class="k">return</span> <span class="s">(</span><span class="i">$NumOfAtomNeighbors</span><span class="cm">,</span> \<span class="i">@AtomNeighbors</span><span class="cm">,</span> <span class="i">$NumOfAtomNeighborsType</span><span class="cm">,</span> \<span class="i">%AtomNeighborsTypeMap</span><span class="s">)</span><span class="sc">;</span>
1050 <span class="s">}</span>
1051 
1052 <span class="c"># Get information related to bonds for all heavy atoms attached to an atom..</span>
1053 <span class="c">#</span>
<a name="GetHeavyAtomNeighborsBondformation-"></a>1054 <span class="k">sub </span><span class="m">GetHeavyAtomNeighborsBondformation</span> <span class="s">{</span>
1055   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1056 
1057   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNonHydrogenAtomNeighborsBondInformation</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1058 <span class="s">}</span>
1059 
1060 <span class="c"># Get information related to bonds for all non-hydrogen atoms attached to an atom..</span>
1061 <span class="c">#</span>
1062 <span class="c"># The following values are returned:</span>
1063 <span class="c">#   . Number of bonds to non-hydrogen atom neighbors</span>
1064 <span class="c">#   . A reference to an array containing bond objects correpsonding to non-hydrogen</span>
1065 <span class="c">#     atom neighbors</span>
1066 <span class="c">#   . A reference to a hash containing bond type as key with value corresponding</span>
1067 <span class="c">#     to its count for non-hydrogen atom neighbors. Bond types are: Single, Double or Triple</span>
1068 <span class="c">#   . A reference to a hash containing atom symbol as key pointing to bond type as second</span>
1069 <span class="c">#     key with values correponding to count of bond types for atom symbol for non-hydrogen</span>
1070 <span class="c">#     atom neighbors</span>
1071 <span class="c">#   . A reference to a hash containing atom symbol as key pointing to bond type as second</span>
1072 <span class="c">#     key with values correponding to atom objects array involved in corresponding bond type for</span>
1073 <span class="c">#     atom symbol for non-hydrogen atom neighbors</span>
1074 <span class="c">#</span>
<a name="GetNonHydrogenAtomNeighborsBondInformation-"></a>1075 <span class="k">sub </span><span class="m">GetNonHydrogenAtomNeighborsBondInformation</span> <span class="s">{</span>
1076   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1077 
1078   <span class="c"># Is this atom in a molecule?</span>
1079   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1080     <span class="k">return</span> <span class="s">(</span><span class="k">undef</span><span class="cm">,</span> <span class="k">undef</span><span class="cm">,</span> <span class="k">undef</span><span class="cm">,</span> <span class="k">undef</span><span class="cm">,</span> <span class="k">undef</span><span class="s">)</span><span class="sc">;</span>
1081   <span class="s">}</span>
1082   <span class="k">my</span><span class="s">(</span><span class="i">$BondedAtom</span><span class="cm">,</span> <span class="i">$BondedAtomSymbol</span><span class="cm">,</span> <span class="i">$BondType</span><span class="cm">,</span> <span class="i">$None</span><span class="cm">,</span> <span class="i">$Bond</span><span class="cm">,</span> <span class="i">$NumOfBonds</span><span class="cm">,</span> <span class="i">@Bonds</span><span class="cm">,</span> <span class="i">%BondTypeCountMap</span><span class="cm">,</span> <span class="i">%AtomsBondTypesCountMap</span><span class="cm">,</span> <span class="i">%AtomsBondTypeAtomsMap</span><span class="s">)</span><span class="sc">;</span>
1083 
1084   <span class="i">$NumOfBonds</span> = <span class="n">0</span><span class="sc">;</span> <span class="i">@Bonds</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1085   <span class="i">%BondTypeCountMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1086   <span class="i">%AtomsBondTypesCountMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span> <span class="i">%AtomsBondTypeAtomsMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1087 
1088   <span class="i">$BondTypeCountMap</span>{<span class="w">Single</span>} = <span class="n">0</span><span class="sc">;</span>
1089   <span class="i">$BondTypeCountMap</span>{<span class="w">Double</span>} = <span class="n">0</span><span class="sc">;</span>
1090   <span class="i">$BondTypeCountMap</span>{<span class="w">Triple</span>} = <span class="n">0</span><span class="sc">;</span>
1091 
1092   <span class="i">@Bonds</span> = <span class="i">$This</span><span class="i">-&gt;GetBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1093   <span class="i">$NumOfBonds</span> = <span class="k">scalar</span> <span class="i">@Bonds</span><span class="sc">;</span>
1094 
1095   <span class="j">BOND:</span> <span class="k">for</span> <span class="i">$Bond</span> <span class="s">(</span><span class="i">@Bonds</span><span class="s">)</span> <span class="s">{</span>
1096     <span class="i">$BondType</span> = <span class="i">$Bond</span><span class="i">-&gt;IsSingle</span><span class="s">(</span><span class="s">)</span> ? <span class="q">&quot;Single&quot;</span> <span class="co">:</span> <span class="s">(</span><span class="i">$Bond</span><span class="i">-&gt;IsDouble</span><span class="s">(</span><span class="s">)</span> ? <span class="q">&quot;Double&quot;</span> <span class="co">:</span> <span class="s">(</span><span class="i">$Bond</span><span class="i">-&gt;IsTriple</span><span class="s">(</span><span class="s">)</span> ? <span class="q">&quot;Triple&quot;</span> <span class="co">:</span> <span class="q">&quot;&quot;</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
1097     <span class="k">if</span> <span class="s">(</span>!<span class="i">$BondType</span><span class="s">)</span> <span class="s">{</span>
1098       <span class="k">next</span> <span class="j">BOND</span><span class="sc">;</span>
1099     <span class="s">}</span>
1100 
1101     <span class="c"># Track bond types...</span>
1102     <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$BondTypeCountMap</span>{<span class="i">$BondType</span>}<span class="s">)</span> <span class="s">{</span>
1103       <span class="i">$BondTypeCountMap</span>{<span class="i">$BondType</span>} += <span class="n">1</span><span class="sc">;</span>
1104     <span class="s">}</span>
1105     <span class="k">else</span> <span class="s">{</span>
1106       <span class="i">$BondTypeCountMap</span>{<span class="i">$BondType</span>} = <span class="n">1</span><span class="sc">;</span>
1107     <span class="s">}</span>
1108 
1109     <span class="i">$BondedAtom</span> = <span class="i">$Bond</span><span class="i">-&gt;GetBondedAtom</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span><span class="sc">;</span>
1110     <span class="i">$BondedAtomSymbol</span> = <span class="i">$BondedAtom</span>-&gt;{<span class="w">AtomSymbol</span>}<span class="sc">;</span>
1111 
1112     <span class="c"># Track bond types count for atom types involved in specific bond types...</span>
1113     <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$AtomsBondTypesCountMap</span>{<span class="i">$BondedAtomSymbol</span>}<span class="s">)</span> <span class="s">{</span>
1114       <span class="i">%</span>{<span class="i">$AtomsBondTypesCountMap</span>{<span class="i">$BondedAtomSymbol</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1115     <span class="s">}</span>
1116     <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$AtomsBondTypesCountMap</span>{<span class="i">$BondedAtomSymbol</span>}{<span class="i">$BondType</span>}<span class="s">)</span> <span class="s">{</span>
1117       <span class="i">$AtomsBondTypesCountMap</span>{<span class="i">$BondedAtomSymbol</span>}{<span class="i">$BondType</span>} += <span class="n">1</span><span class="sc">;</span>
1118     <span class="s">}</span>
1119     <span class="k">else</span> <span class="s">{</span>
1120       <span class="i">$AtomsBondTypesCountMap</span>{<span class="i">$BondedAtomSymbol</span>}{<span class="i">$BondType</span>} = <span class="n">1</span><span class="sc">;</span>
1121     <span class="s">}</span>
1122 
1123     <span class="c"># Track atoms involved in specific bond types for specific atom types...</span>
1124     <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$AtomsBondTypeAtomsMap</span>{<span class="i">$BondedAtomSymbol</span>}<span class="s">)</span> <span class="s">{</span>
1125       <span class="i">%</span>{<span class="i">$AtomsBondTypeAtomsMap</span>{<span class="i">$BondedAtomSymbol</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1126     <span class="s">}</span>
1127     <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$AtomsBondTypeAtomsMap</span>{<span class="i">$BondedAtomSymbol</span>}{<span class="i">$BondType</span>}<span class="s">)</span> <span class="s">{</span>
1128       <span class="i">@</span>{<span class="i">$AtomsBondTypeAtomsMap</span>{<span class="i">$BondedAtomSymbol</span>}{<span class="i">$BondType</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1129     <span class="s">}</span>
1130     <span class="k">push</span> <span class="i">@</span>{<span class="i">$AtomsBondTypeAtomsMap</span>{<span class="i">$BondedAtomSymbol</span>}{<span class="i">$BondType</span>}}<span class="cm">,</span> <span class="i">$BondedAtom</span><span class="sc">;</span>
1131   <span class="s">}</span>
1132 
1133   <span class="k">return</span> <span class="s">(</span><span class="i">$NumOfBonds</span><span class="cm">,</span> \<span class="i">@Bonds</span><span class="cm">,</span> \<span class="i">%BondTypeCountMap</span><span class="cm">,</span> \<span class="i">%AtomsBondTypesCountMap</span><span class="cm">,</span> \<span class="i">%AtomsBondTypeAtomsMap</span><span class="s">)</span><span class="sc">;</span>
1134 <span class="s">}</span>
1135 
1136 <span class="c"># Get number of bonds to hydrogen atoms...</span>
<a name="GetNumOfBondsToHydrogenAtoms-"></a>1137 <span class="k">sub </span><span class="m">GetNumOfBondsToHydrogenAtoms</span> <span class="s">{</span>
1138   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1139   <span class="k">my</span><span class="s">(</span><span class="i">$NumOfBonds</span><span class="s">)</span><span class="sc">;</span>
1140 
1141   <span class="i">$NumOfBonds</span> = <span class="i">$This</span><span class="i">-&gt;GetBondsToHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1142 
1143   <span class="k">return</span> <span class="s">(</span><span class="k">defined</span> <span class="i">$NumOfBonds</span><span class="s">)</span> ? <span class="s">(</span><span class="i">$NumOfBonds</span><span class="s">)</span> <span class="co">:</span> <span class="k">undef</span><span class="sc">;</span>
1144 <span class="s">}</span>
1145 
1146 <span class="c"># Get sum of bond orders to all bonded atoms...</span>
1147 <span class="c">#</span>
<a name="GetSumOfBondOrders-"></a>1148 <span class="k">sub </span><span class="m">GetSumOfBondOrders</span> <span class="s">{</span>
1149   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1150 
1151   <span class="c"># Is this atom in a molecule?</span>
1152   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1153     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
1154   <span class="s">}</span>
1155 
1156   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetSumOfBondOrders</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1157 <span class="s">}</span>
1158 
1159 <span class="c"># Get sum of bond orders to non-hydrogen atoms only...</span>
1160 <span class="c">#</span>
<a name="GetSumOfBondOrdersToHeavyAtoms-"></a>1161 <span class="k">sub </span><span class="m">GetSumOfBondOrdersToHeavyAtoms</span> <span class="s">{</span>
1162   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1163 
1164   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetSumOfBondOrdersToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1165 <span class="s">}</span>
1166 
1167 <span class="c"># Get sum of bond orders to non-hydrogen atoms only...</span>
1168 <span class="c">#</span>
<a name="GetSumOfBondOrdersToNonHydrogenAtoms-"></a>1169 <span class="k">sub </span><span class="m">GetSumOfBondOrdersToNonHydrogenAtoms</span> <span class="s">{</span>
1170   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1171 
1172   <span class="c"># Is this atom in a molecule?</span>
1173   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1174     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
1175   <span class="s">}</span>
1176   <span class="k">my</span><span class="s">(</span><span class="i">$ToNonHydrogenAtomsOnly</span><span class="cm">,</span> <span class="i">$ToHydrogenAtomsOnly</span><span class="s">)</span> = <span class="s">(</span><span class="n">1</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span><span class="sc">;</span>
1177 
1178   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetSumOfBondOrders</span><span class="s">(</span><span class="i">$ToNonHydrogenAtomsOnly</span><span class="cm">,</span> <span class="i">$ToHydrogenAtomsOnly</span><span class="s">)</span><span class="sc">;</span>
1179 <span class="s">}</span>
1180 
1181 <span class="c"># Get sum of bond orders to hydrogen atoms only...</span>
1182 <span class="c">#</span>
<a name="GetSumOfBondOrdersToHydrogenAtoms-"></a>1183 <span class="k">sub </span><span class="m">GetSumOfBondOrdersToHydrogenAtoms</span> <span class="s">{</span>
1184   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1185 
1186   <span class="c"># Is this atom in a molecule?</span>
1187   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1188     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
1189   <span class="s">}</span>
1190   <span class="k">my</span><span class="s">(</span><span class="i">$ToNonHydrogenAtomsOnly</span><span class="cm">,</span> <span class="i">$ToHydrogenAtomsOnly</span><span class="s">)</span> = <span class="s">(</span><span class="n">0</span><span class="cm">,</span> <span class="n">1</span><span class="s">)</span><span class="sc">;</span>
1191 
1192   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetSumOfBondOrders</span><span class="s">(</span><span class="i">$ToNonHydrogenAtomsOnly</span><span class="cm">,</span> <span class="i">$ToHydrogenAtomsOnly</span><span class="s">)</span><span class="sc">;</span>
1193 <span class="s">}</span>
1194 
1195 <span class="c"># Get sum of bond orders to all bonded atoms,  non-hydrogen or hydrogen bonded atoms...</span>
1196 <span class="c">#</span>
<a name="_GetSumOfBondOrders-"></a>1197 <span class="k">sub </span><span class="m">_GetSumOfBondOrders</span> <span class="s">{</span>
1198   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$ToNonHydrogenAtomsOnly</span><span class="cm">,</span> <span class="i">$ToHydrogenAtomsOnly</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1199 
1200   <span class="c"># Check flags...</span>
1201   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$ToNonHydrogenAtomsOnly</span><span class="s">)</span> <span class="s">{</span>
1202     <span class="i">$ToNonHydrogenAtomsOnly</span> = <span class="n">0</span><span class="sc">;</span>
1203   <span class="s">}</span>
1204   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$ToHydrogenAtomsOnly</span><span class="s">)</span> <span class="s">{</span>
1205     <span class="i">$ToHydrogenAtomsOnly</span> = <span class="n">0</span><span class="sc">;</span>
1206   <span class="s">}</span>
1207   <span class="k">my</span><span class="s">(</span><span class="i">$Bond</span><span class="cm">,</span> <span class="i">$SumOfBondOrders</span><span class="cm">,</span> <span class="i">@Bonds</span><span class="s">)</span><span class="sc">;</span>
1208   <span class="i">@Bonds</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1209 
1210   <span class="k">if</span> <span class="s">(</span><span class="i">$ToNonHydrogenAtomsOnly</span><span class="s">)</span> <span class="s">{</span>
1211     <span class="i">@Bonds</span> = <span class="i">$This</span><span class="i">-&gt;GetBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1212   <span class="s">}</span>
1213   <span class="k">elsif</span> <span class="s">(</span><span class="i">$ToHydrogenAtomsOnly</span><span class="s">)</span> <span class="s">{</span>
1214     <span class="i">@Bonds</span> = <span class="i">$This</span><span class="i">-&gt;GetBondsToHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1215   <span class="s">}</span>
1216   <span class="k">else</span> <span class="s">{</span>
1217     <span class="c"># All bonds...</span>
1218     <span class="i">@Bonds</span> = <span class="i">$This</span><span class="i">-&gt;GetBonds</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1219   <span class="s">}</span>
1220 
1221   <span class="i">$SumOfBondOrders</span> = <span class="n">0</span><span class="sc">;</span>
1222   <span class="k">for</span> <span class="i">$Bond</span> <span class="s">(</span><span class="i">@Bonds</span><span class="s">)</span> <span class="s">{</span>
1223     <span class="i">$SumOfBondOrders</span> += <span class="i">$Bond</span><span class="i">-&gt;GetBondOrder</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1224   <span class="s">}</span>
1225 
1226   <span class="k">if</span> <span class="s">(</span><span class="i">$SumOfBondOrders</span> =~ <span class="q">/\./</span><span class="s">)</span> <span class="s">{</span>
1227     <span class="c">#</span>
1228     <span class="c"># Change any fractional bond order to next largest integer...</span>
1229     <span class="c">#</span>
1230     <span class="c"># As long as aromatic bond orders in a ring are correctly using using 4n + 2 Huckel rule</span>
1231     <span class="c"># (BondOrder: 1.5) or explicity set as Kekule  bonds (alternate single/double),</span>
1232     <span class="c"># SumOfBondOrders should add up to an integer.</span>
1233     <span class="c">#</span>
1234     <span class="i">$SumOfBondOrders</span> = <span class="i">ceil</span><span class="s">(</span><span class="i">$SumOfBondOrders</span><span class="s">)</span><span class="sc">;</span>
1235   <span class="s">}</span>
1236 
1237   <span class="k">return</span> <span class="i">$SumOfBondOrders</span><span class="sc">;</span>
1238 <span class="s">}</span>
1239 
1240 <span class="c"># Get largest bond order to any bonded atoms...</span>
1241 <span class="c">#</span>
<a name="GetLargestBondOrder-"></a>1242 <span class="k">sub </span><span class="m">GetLargestBondOrder</span> <span class="s">{</span>
1243   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1244 
1245   <span class="c"># Is this atom in a molecule?</span>
1246   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1247     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
1248   <span class="s">}</span>
1249 
1250   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetLargestBondOrder</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1251 <span class="s">}</span>
1252 
1253 <span class="c"># Get largest bond order to bonded non-hydrogen atoms...</span>
1254 <span class="c">#</span>
<a name="GetLargestBondOrderToHeavyAtoms-"></a>1255 <span class="k">sub </span><span class="m">GetLargestBondOrderToHeavyAtoms</span> <span class="s">{</span>
1256   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1257 
1258   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetLargestBondOrderToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1259 <span class="s">}</span>
1260 
1261 <span class="c"># Get largest bond order to bonded non-hydrogen atoms...</span>
1262 <span class="c">#</span>
<a name="GetLargestBondOrderToNonHydrogenAtoms-"></a>1263 <span class="k">sub </span><span class="m">GetLargestBondOrderToNonHydrogenAtoms</span> <span class="s">{</span>
1264   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1265 
1266   <span class="c"># Is this atom in a molecule?</span>
1267   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1268     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
1269   <span class="s">}</span>
1270 
1271   <span class="k">my</span><span class="s">(</span><span class="i">$ToNonHydrogenAtomsOnly</span><span class="s">)</span> = <span class="s">(</span><span class="n">1</span><span class="s">)</span><span class="sc">;</span>
1272 
1273   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetLargestBondOrder</span><span class="s">(</span><span class="i">$ToNonHydrogenAtomsOnly</span><span class="s">)</span><span class="sc">;</span>
1274 <span class="s">}</span>
1275 
1276 <span class="c"># Get largest bond order to all bonded atoms, non-hydrogen or hydrogen bonded atoms...</span>
1277 <span class="c">#</span>
<a name="_GetLargestBondOrder-"></a>1278 <span class="k">sub </span><span class="m">_GetLargestBondOrder</span> <span class="s">{</span>
1279   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$ToNonHydrogenAtomsOnly</span><span class="cm">,</span> <span class="i">$ToHydrogenAtomsOnly</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1280 
1281   <span class="c"># Check flags...</span>
1282   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$ToNonHydrogenAtomsOnly</span><span class="s">)</span> <span class="s">{</span>
1283     <span class="i">$ToNonHydrogenAtomsOnly</span> = <span class="n">0</span><span class="sc">;</span>
1284   <span class="s">}</span>
1285   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$ToHydrogenAtomsOnly</span><span class="s">)</span> <span class="s">{</span>
1286     <span class="i">$ToHydrogenAtomsOnly</span> = <span class="n">0</span><span class="sc">;</span>
1287   <span class="s">}</span>
1288   <span class="k">my</span><span class="s">(</span><span class="i">$Bond</span><span class="cm">,</span> <span class="i">$LargestBondOrder</span><span class="cm">,</span> <span class="i">$BondOrder</span><span class="cm">,</span> <span class="i">@Bonds</span><span class="s">)</span><span class="sc">;</span>
1289   <span class="i">@Bonds</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1290 
1291   <span class="k">if</span> <span class="s">(</span><span class="i">$ToNonHydrogenAtomsOnly</span><span class="s">)</span> <span class="s">{</span>
1292     <span class="i">@Bonds</span> = <span class="i">$This</span><span class="i">-&gt;GetBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1293   <span class="s">}</span>
1294   <span class="k">elsif</span> <span class="s">(</span><span class="i">$ToHydrogenAtomsOnly</span><span class="s">)</span> <span class="s">{</span>
1295     <span class="i">@Bonds</span> = <span class="i">$This</span><span class="i">-&gt;GetBondsToHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1296   <span class="s">}</span>
1297   <span class="k">else</span> <span class="s">{</span>
1298     <span class="c"># All bonds...</span>
1299     <span class="i">@Bonds</span> = <span class="i">$This</span><span class="i">-&gt;GetBonds</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1300   <span class="s">}</span>
1301 
1302   <span class="i">$LargestBondOrder</span> = <span class="n">0</span><span class="sc">;</span>
1303   <span class="k">for</span> <span class="i">$Bond</span> <span class="s">(</span><span class="i">@Bonds</span><span class="s">)</span> <span class="s">{</span>
1304     <span class="i">$BondOrder</span> = <span class="i">$Bond</span><span class="i">-&gt;GetBondOrder</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1305     <span class="k">if</span> <span class="s">(</span><span class="i">$BondOrder</span> &gt; <span class="i">$LargestBondOrder</span><span class="s">)</span> <span class="s">{</span>
1306       <span class="i">$LargestBondOrder</span> = <span class="i">$BondOrder</span><span class="sc">;</span>
1307     <span class="s">}</span>
1308   <span class="s">}</span>
1309 
1310   <span class="k">return</span> <span class="i">$LargestBondOrder</span><span class="sc">;</span>
1311 <span class="s">}</span>
1312 
1313 <span class="c"># Get number of implicit hydrogen for atom...</span>
1314 <span class="c">#</span>
<a name="GetImplicitHydrogens-"></a>1315 <span class="k">sub </span><span class="m">GetImplicitHydrogens</span> <span class="s">{</span>
1316   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1317 
1318   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfImplicitHydrogens</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1319 <span class="s">}</span>
1320 
1321 <span class="c"># Get number of implicit hydrogen for atom...</span>
1322 <span class="c">#</span>
<a name="GetNumOfImplicitHydrogens-"></a>1323 <span class="k">sub </span><span class="m">GetNumOfImplicitHydrogens</span> <span class="s">{</span>
1324   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1325 
1326   <span class="c"># Is this atom in a molecule?</span>
1327   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1328     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
1329   <span class="s">}</span>
1330 
1331   <span class="c"># Is ImplicitHydrogens property explicitly set?</span>
1332   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;ImplicitHydrogens&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1333     <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;ImplicitHydrogens&#39;</span><span class="s">)</span><span class="sc">;</span>
1334   <span class="s">}</span>
1335 
1336   <span class="c"># Is it an element symbol?</span>
1337   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>}<span class="s">)</span> <span class="s">{</span>
1338     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1339   <span class="s">}</span>
1340 
1341   <span class="k">my</span><span class="s">(</span><span class="i">$ImplicitHydrogens</span><span class="cm">,</span> <span class="i">$PotentialTotalValence</span><span class="cm">,</span> <span class="i">$SumOfBondOrders</span><span class="s">)</span><span class="sc">;</span>
1342 
1343   <span class="i">$ImplicitHydrogens</span> = <span class="n">0</span><span class="sc">;</span>
1344   <span class="i">$SumOfBondOrders</span> = <span class="i">$This</span><span class="i">-&gt;GetSumOfBondOrders</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1345   <span class="i">$PotentialTotalValence</span> = <span class="i">$This</span><span class="i">-&gt;GetPotentialTotalCommonValence</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1346 
1347   <span class="k">if</span> <span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$PotentialTotalValence</span><span class="s">)</span> &amp;&amp; <span class="k">defined</span><span class="s">(</span><span class="i">$SumOfBondOrders</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1348     <span class="c"># Subtract sum of bond orders to non-hydrogen and hydrogen atom neighbors...</span>
1349     <span class="i">$ImplicitHydrogens</span> = <span class="i">$PotentialTotalValence</span> - <span class="i">$SumOfBondOrders</span><span class="sc">;</span>
1350   <span class="s">}</span>
1351 
1352   <span class="k">return</span> <span class="i">$ImplicitHydrogens</span> &gt; <span class="n">0</span> ? <span class="i">$ImplicitHydrogens</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1353 <span class="s">}</span>
1354 
1355 <span class="c"># Get number of bonds available to form additional bonds with heavy atoms, excluding</span>
1356 <span class="c"># any implicit bonds to hydrogens set using ImplicitHydrogens property.</span>
1357 <span class="c">#</span>
1358 <span class="c"># It&#39;s different from number of implicit or missing hydrogens, both of which are equivalent.</span>
1359 <span class="c">#</span>
1360 <span class="c"># For example, in a SMILES string, [nH] ring atom corresponds to an aromatic nitrogen.</span>
1361 <span class="c"># Although the hydrogen specified for n is treated internally as implicit hydrogen and shows</span>
1362 <span class="c"># up in missing hydrogen count, it&#39;s not available to participate in double bonds to additional</span>
1363 <span class="c"># heavy atoms.</span>
1364 <span class="c">#</span>
<a name="GetNumOfBondsAvailableForHeavyAtoms-"></a>1365 <span class="k">sub </span><span class="m">GetNumOfBondsAvailableForHeavyAtoms</span> <span class="s">{</span>
1366   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1367 
1368   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfBondsAvailableForNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1369 <span class="s">}</span>
1370 
1371 <span class="c"># It&#39;s another name for GetNumOfBondsAvailableForHeavyAtoms</span>
1372 <span class="c">#</span>
<a name="GetNumOfBondsAvailableForNonHydrogenAtoms-"></a>1373 <span class="k">sub </span><span class="m">GetNumOfBondsAvailableForNonHydrogenAtoms</span> <span class="s">{</span>
1374   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1375   <span class="k">my</span><span class="s">(</span><span class="i">$NumOfAvailableBonds</span><span class="cm">,</span> <span class="i">$PotentialTotalValence</span><span class="cm">,</span> <span class="i">$SumOfBondOrders</span><span class="s">)</span><span class="sc">;</span>
1376 
1377   <span class="i">$NumOfAvailableBonds</span> = <span class="n">0</span><span class="sc">;</span>
1378 
1379   <span class="i">$SumOfBondOrders</span> = <span class="i">$This</span><span class="i">-&gt;GetSumOfBondOrders</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1380   <span class="i">$PotentialTotalValence</span> = <span class="i">$This</span><span class="i">-&gt;GetPotentialTotalCommonValence</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1381 
1382   <span class="k">if</span> <span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$PotentialTotalValence</span><span class="s">)</span> &amp;&amp; <span class="k">defined</span><span class="s">(</span><span class="i">$SumOfBondOrders</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1383     <span class="c"># Subtract sum of bond orders to non-hydrogen and hydrogen atom neighbors...</span>
1384     <span class="i">$NumOfAvailableBonds</span> = <span class="i">$PotentialTotalValence</span> - <span class="i">$SumOfBondOrders</span><span class="sc">;</span>
1385   <span class="s">}</span>
1386 
1387   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;ImplicitHydrogens&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1388     <span class="i">$NumOfAvailableBonds</span> -= <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;ImplicitHydrogens&#39;</span><span class="s">)</span><span class="sc">;</span>
1389   <span class="s">}</span>
1390 
1391   <span class="k">return</span> <span class="i">$NumOfAvailableBonds</span> &gt; <span class="n">0</span> ? <span class="i">$NumOfAvailableBonds</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1392 <span class="s">}</span>
1393 
1394 <span class="c"># Disable setting of explicit hydrogens property...</span>
<a name="SetExplicitHydrogens-"></a>1395 <span class="k">sub </span><span class="m">SetExplicitHydrogens</span> <span class="s">{</span>
1396   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1397 
1398   <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;SetExplicitHydrogens: Setting of explicit hydrogens is not supported...&quot;</span><span class="sc">;</span>
1399 
1400   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1401 <span class="s">}</span>
1402 
1403 <span class="c"># Get number of explicit hydrogens for atom...</span>
1404 <span class="c">#</span>
<a name="GetExplicitHydrogens-"></a>1405 <span class="k">sub </span><span class="m">GetExplicitHydrogens</span> <span class="s">{</span>
1406   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1407 
1408   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfExplicitHydrogens</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1409 <span class="s">}</span>
1410 
1411 <span class="c"># Get number of explicit hydrogens for atom...</span>
1412 <span class="c">#</span>
<a name="GetNumOfExplicitHydrogens-"></a>1413 <span class="k">sub </span><span class="m">GetNumOfExplicitHydrogens</span> <span class="s">{</span>
1414   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1415   <span class="k">my</span><span class="s">(</span><span class="i">$HydrogenAtomNbrs</span><span class="s">)</span><span class="sc">;</span>
1416 
1417   <span class="c"># Is this atom in a molecule?</span>
1418   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1419     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
1420   <span class="s">}</span>
1421 
1422   <span class="i">$HydrogenAtomNbrs</span> = <span class="i">$This</span><span class="i">-&gt;GetNumOfHydrogenAtomNeighbors</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1423 
1424   <span class="k">return</span> <span class="k">defined</span> <span class="i">$HydrogenAtomNbrs</span> ? <span class="i">$HydrogenAtomNbrs</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1425 <span class="s">}</span>
1426 
1427 <span class="c"># Get num of missing hydrogens...</span>
1428 <span class="c">#</span>
<a name="GetMissingHydrogens-"></a>1429 <span class="k">sub </span><span class="m">GetMissingHydrogens</span> <span class="s">{</span>
1430   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1431 
1432   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfMissingHydrogens</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1433 <span class="s">}</span>
1434 
1435 <span class="c"># Get num of missing hydrogens...</span>
1436 <span class="c">#</span>
<a name="GetNumOfMissingHydrogens-"></a>1437 <span class="k">sub </span><span class="m">GetNumOfMissingHydrogens</span> <span class="s">{</span>
1438   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1439 
1440   <span class="c"># Is this atom in a molecule?</span>
1441   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1442     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
1443   <span class="s">}</span>
1444 
1445   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfImplicitHydrogens</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1446 <span class="s">}</span>
1447 
1448 <span class="c"># Get total number of hydrogens...</span>
1449 <span class="c">#</span>
<a name="GetHydrogens-"></a>1450 <span class="k">sub </span><span class="m">GetHydrogens</span> <span class="s">{</span>
1451   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1452 
1453   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfHydrogens</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1454 <span class="s">}</span>
1455 
1456 <span class="c"># Get total number of hydrogens...</span>
1457 <span class="c">#</span>
<a name="GetNumOfHydrogens-"></a>1458 <span class="k">sub </span><span class="m">GetNumOfHydrogens</span> <span class="s">{</span>
1459   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1460 
1461   <span class="c"># Is this atom in a molecule?</span>
1462   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1463     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
1464   <span class="s">}</span>
1465 
1466   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfImplicitHydrogens</span><span class="s">(</span><span class="s">)</span> + <span class="i">$This</span><span class="i">-&gt;GetNumOfExplicitHydrogens</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1467 <span class="s">}</span>
1468 
1469 <span class="c"># Valence corresponds to the number of electrons used by an atom in bonding:</span>
1470 <span class="c">#</span>
1471 <span class="c">#   Valence = ValenceElectrons - ValenceFreeElectrons = BondingElectrons</span>
1472 <span class="c">#</span>
1473 <span class="c"># Single, double, triple bonds with bond orders of 1, 2 and 3 correspond to contribution of</span>
1474 <span class="c"># 1, 2, and 3 bonding electrons. So Valence can be computed using:</span>
1475 <span class="c">#</span>
1476 <span class="c">#   Valence = SumOfBondOrders + NumOfMissingHydrogens + FormalCharge</span>
1477 <span class="c">#</span>
1478 <span class="c"># where positive and negative values of FormalCharge increase and decrease the number</span>
1479 <span class="c"># of bonding electrons respectively.</span>
1480 <span class="c">#</span>
1481 <span class="c"># The current release of MayaChemTools supports the following three valence models, which</span>
1482 <span class="c"># are used during calculation of implicit hydrogens: MDLValenceModel, DaylightValenceModel,</span>
1483 <span class="c"># InternalValenceModel or MayaChemToolsValenceModel.</span>
1484 <span class="c">#</span>
1485 <span class="c"># Notes:</span>
1486 <span class="c">#  . This doesn&#39;t always corresponds to explicit valence.</span>
1487 <span class="c">#  . Missing hydrogens are included in the valence.</span>
1488 <span class="c">#  . For neutral molecules, valence and sum of bond order are equal.</span>
1489 <span class="c">#  . For molecules containing only single bonds, SumOfBondOrders and NumOfBonds are equal.</span>
1490 <span class="c">#  . Free radical electrons lead to the decrease in valence. For atoms with explicit assignment</span>
1491 <span class="c">#    of SpinMultiplicity property values corresponding to Singlet (two unparied electrons</span>
1492 <span class="c">#    corresponding to one spin state), Doublet (free radical; an unpaired electron corresponding</span>
1493 <span class="c">#    to two spin states), and Triplet (two unparied electrons corresponding to three spin states;</span>
1494 <span class="c">#    divalent carbon atoms (carbenes)), FreeRadicalElectrons are calculated as follows:</span>
1495 <span class="c">#</span>
1496 <span class="c">#       SpinMultiplicity: Doublet(2); FreeRadicalElectrons: 1 (one valence electron not available for bonding)</span>
1497 <span class="c">#       SpinMultiplicity: Singlet(1)/Triplet(3); FreeRadicalElectrons: 2 (two valence electrons not available for bonding)</span>
1498 <span class="c">#</span>
<a name="GetValence-"></a>1499 <span class="k">sub </span><span class="m">GetValence</span> <span class="s">{</span>
1500   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1501 
1502   <span class="c"># Is this atom in a molecule?</span>
1503   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1504     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
1505   <span class="s">}</span>
1506 
1507   <span class="c"># Is Valence property explicitly set?</span>
1508   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Valence&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1509     <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Valence&#39;</span><span class="s">)</span><span class="sc">;</span>
1510   <span class="s">}</span>
1511   <span class="k">my</span><span class="s">(</span><span class="i">$Valence</span><span class="s">)</span><span class="sc">;</span>
1512 
1513   <span class="i">$Valence</span> = <span class="i">$This</span><span class="i">-&gt;GetSumOfBondOrders</span><span class="s">(</span><span class="s">)</span> + <span class="i">$This</span><span class="i">-&gt;GetNumOfMissingHydrogens</span><span class="s">(</span><span class="s">)</span> + <span class="i">$This</span><span class="i">-&gt;GetFormalCharge</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1514 
1515   <span class="k">return</span> <span class="i">$Valence</span> &gt; <span class="n">0</span> ? <span class="i">$Valence</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1516 <span class="s">}</span>
1517 
1518 <span class="c"># Get free non-bodning valence electrons left on atom after taking into account</span>
1519 <span class="c"># sum of bond orders, missing hydrogens and formal charged on the atom. Free</span>
1520 <span class="c"># radical electrons are included in the valence free electrons count by default.</span>
1521 <span class="c">#</span>
1522 <span class="c"># Valence corresponds to number of electrons used by atom in bonding:</span>
1523 <span class="c">#</span>
1524 <span class="c">#   Valence = ValenceElectrons - ValenceFreeElectrons</span>
1525 <span class="c">#</span>
1526 <span class="c"># Additionally, valence can also be calculated by:</span>
1527 <span class="c">#</span>
1528 <span class="c">#   Valence = SumOfBondOrders + NumOfMissingHydrogens + FormalCharge</span>
1529 <span class="c">#</span>
1530 <span class="c"># Valence and SumOfBondOrders are equal for neutral molecules.</span>
1531 <span class="c">#</span>
1532 <span class="c"># From two formulas for Valence described above, non-bonding free electrons</span>
1533 <span class="c"># left can be computed by:</span>
1534 <span class="c">#</span>
1535 <span class="c">#  ValenceFreeElectrons = ValenceElectrons - Valence</span>
1536 <span class="c">#                       = ValenceElectrons - SumOfBondOrders -</span>
1537 <span class="c">#                         NumOfMissingHydrogens - FormalCharge</span>
1538 <span class="c">#</span>
1539 <span class="c"># . Notes:</span>
1540 <span class="c">#    . Missing hydrogens are excluded from the valence free electrons.</span>
1541 <span class="c">#    . Any free radical electrons are considered part of the valence free electrons</span>
1542 <span class="c">#      by default.</span>
1543 <span class="c">#</span>
1544 <span class="c"># Examples:</span>
1545 <span class="c">#</span>
1546 <span class="c"># o NH3: ValenceFreeElectrons = 5 - 3 = 5 - 3 - 0 - 0 = 2</span>
1547 <span class="c"># o NH2: ValenceFreeElectrons = 5 - 3 = 5 - 2 - 1 - 0 = 2</span>
1548 <span class="c"># o NH4+; ValenceFreeElectrons = 5 - 5 = 5 - 4 - 0 - 1 = 0</span>
1549 <span class="c"># o NH3+; ValenceFreeElectrons = 5 - 5 = 5 - 3 - 1 - 1 = 0</span>
1550 <span class="c"># o C(=O)O- : ValenceFreeElectrons on O- = 6 - 0 = 6 - 1 - 0 - (-1) = 6</span>
1551 <span class="c"># o C(=O)O- : ValenceFreeElectrons on =O = 6 - 2 = 6 - 2 - 0 - 0 = 4</span>
1552 <span class="c">#</span>
1553 <span class="c">#</span>
<a name="GetValenceFreeElectrons-"></a>1554 <span class="k">sub </span><span class="m">GetValenceFreeElectrons</span> <span class="s">{</span>
1555   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$ExcludeFreeRadicalElectrons</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1556 
1557   <span class="c"># Is this atom in a molecule?</span>
1558   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1559     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
1560   <span class="s">}</span>
1561 
1562   <span class="c"># Is ValenceFreeElectrons property explicitly set?</span>
1563   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;ValenceFreeElectrons&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1564     <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;ValenceFreeElectrons&#39;</span><span class="s">)</span><span class="sc">;</span>
1565   <span class="s">}</span>
1566 
1567   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>}<span class="s">)</span> <span class="s">{</span>
1568     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1569   <span class="s">}</span>
1570 
1571   <span class="k">my</span><span class="s">(</span><span class="i">$ValenceFreeElectrons</span><span class="s">)</span><span class="sc">;</span>
1572 
1573   <span class="i">$ValenceFreeElectrons</span> = <span class="i">$This</span><span class="i">-&gt;GetValenceElectrons</span><span class="s">(</span><span class="s">)</span> - <span class="i">$This</span><span class="i">-&gt;GetValence</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1574   <span class="k">if</span> <span class="s">(</span><span class="i">$ExcludeFreeRadicalElectrons</span><span class="s">)</span> <span class="s">{</span>
1575     <span class="i">$ValenceFreeElectrons</span> -= <span class="i">$This</span><span class="i">-&gt;GetFreeRadicalElectrons</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1576   <span class="s">}</span>
1577 
1578   <span class="k">return</span> <span class="i">$ValenceFreeElectrons</span> &gt; <span class="n">0</span> ? <span class="i">$ValenceFreeElectrons</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1579 <span class="s">}</span>
1580 
1581 <span class="c"># Get potential total common valence for calculating the number of implicit hydrogens</span>
1582 <span class="c"># using the specified common valence model or default internal model for a molecule...</span>
1583 <span class="c">#</span>
<a name="GetPotentialTotalCommonValence-"></a>1584 <span class="k">sub </span><span class="m">GetPotentialTotalCommonValence</span> <span class="s">{</span>
1585   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1586 
1587   <span class="c"># Is this atom in a molecule?</span>
1588   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1589     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
1590   <span class="s">}</span>
1591   <span class="k">my</span><span class="s">(</span><span class="i">$PotentialTotalValence</span><span class="cm">,</span> <span class="i">$ValenceModel</span><span class="s">)</span><span class="sc">;</span>
1592 
1593   <span class="i">$PotentialTotalValence</span> = <span class="n">0</span><span class="sc">;</span>
1594   <span class="i">$ValenceModel</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="i">-&gt;GetValenceModel</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1595 
1596   <span class="j">VALENCEMODEL:</span> <span class="s">{</span>
1597     <span class="k">if</span> <span class="s">(</span><span class="i">$ValenceModel</span> =~ <span class="q">/^MDLValenceModel$/i</span><span class="s">)</span> <span class="s">{</span>
1598       <span class="i">$PotentialTotalValence</span> = <span class="i">$This</span><span class="i">-&gt;_GetPotentialTotalCommonValenceUsingMDLValenceModel</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1599       <span class="k">last</span> <span class="j">VALENCEMODEL</span><span class="sc">;</span>
1600     <span class="s">}</span>
1601     <span class="k">if</span> <span class="s">(</span><span class="i">$ValenceModel</span> =~ <span class="q">/^DaylightValenceModel$/i</span><span class="s">)</span> <span class="s">{</span>
1602        <span class="i">$PotentialTotalValence</span> = <span class="i">$This</span><span class="i">-&gt;_GetPotentialTotalCommonValenceUsingDaylightValenceModel</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1603       <span class="k">last</span> <span class="j">VALENCEMODEL</span><span class="sc">;</span>
1604     <span class="s">}</span>
1605     <span class="k">if</span> <span class="s">(</span><span class="i">$ValenceModel</span> !~ <span class="q">/^(InternalValenceModel|MayaChemToolsValenceModel)$/i</span><span class="s">)</span> <span class="s">{</span>
1606       <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;GetPotentialTotalCommonValence: The current release of MayaChemTools doesn&#39;t support the specified valence model $ValenceModel. Supported valence models: MDLValenceModel, DaylightValenceModel, InternalValenceModel. Using internal valence model...&quot;</span><span class="sc">;</span>
1607     <span class="s">}</span>
1608     <span class="c"># Use internal valence model as the default valence model...</span>
1609     <span class="i">$PotentialTotalValence</span> = <span class="i">$This</span><span class="i">-&gt;_GetPotentialTotalCommonValenceUsingInternalValenceModel</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1610   <span class="s">}</span>
1611 
1612   <span class="k">return</span> <span class="i">$PotentialTotalValence</span><span class="sc">;</span>
1613 <span class="s">}</span>
1614 
1615 <span class="c"># Get potential total common valence using data for MDL valence model available in file,</span>
1616 <span class="c"># lib/data/MDLValenceModelData.csv, distributed with the package...</span>
1617 <span class="c">#</span>
<a name="_GetPotentialTotalCommonValenceUsingMDLValenceModel-"></a>1618 <span class="k">sub </span><span class="m">_GetPotentialTotalCommonValenceUsingMDLValenceModel</span> <span class="s">{</span>
1619   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1620 
1621   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetPotentialTotalCommonValenceUsingValenceModelData</span><span class="s">(</span>\<span class="i">%MDLValenceModelDataMap</span><span class="s">)</span><span class="sc">;</span>
1622 
1623 <span class="s">}</span>
1624 
1625 <span class="c"># Get potential total common valence using data for Daylight valence model available in file,</span>
1626 <span class="c"># lib/data/DaylightValenceModelData.csv, distributed with the release...</span>
1627 <span class="c">#</span>
<a name="_GetPotentialTotalCommonValenceUsingDaylightValenceModel-"></a>1628 <span class="k">sub </span><span class="m">_GetPotentialTotalCommonValenceUsingDaylightValenceModel</span> <span class="s">{</span>
1629   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1630 
1631   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetPotentialTotalCommonValenceUsingValenceModelData</span><span class="s">(</span>\<span class="i">%DaylightValenceModelDataMap</span><span class="s">)</span><span class="sc">;</span>
1632 <span class="s">}</span>
1633 
1634 <span class="c"># Get potential total common valence using data for a specific valence model...</span>
1635 <span class="c">#</span>
<a name="_GetPotentialTotalCommonValenceUsingValenceModelData-"></a>1636 <span class="k">sub </span><span class="m">_GetPotentialTotalCommonValenceUsingValenceModelData</span> <span class="s">{</span>
1637   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$ValenceModelDataRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1638   <span class="k">my</span><span class="s">(</span><span class="i">$AtomicNumber</span><span class="cm">,</span> <span class="i">$FormalCharge</span><span class="s">)</span><span class="sc">;</span>
1639 
1640   <span class="i">$AtomicNumber</span> = <span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>}<span class="sc">;</span>
1641   <span class="k">if</span> <span class="s">(</span>!<span class="i">$AtomicNumber</span><span class="s">)</span> <span class="s">{</span>
1642     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1643   <span class="s">}</span>
1644 
1645   <span class="i">$FormalCharge</span> = <span class="i">$This</span><span class="i">-&gt;GetFormalCharge</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1646 
1647   <span class="c"># Is any valence model data available for atomic number and formal charge?</span>
1648   <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$ValenceModelDataRef</span>-&gt;{<span class="i">$AtomicNumber</span>}<span class="s">)</span> <span class="s">{</span>
1649     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1650   <span class="s">}</span>
1651   <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$ValenceModelDataRef</span>-&gt;{<span class="i">$AtomicNumber</span>}{<span class="i">$FormalCharge</span>}<span class="s">)</span> <span class="s">{</span>
1652     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1653   <span class="s">}</span>
1654 
1655   <span class="k">my</span><span class="s">(</span><span class="i">$PotentialTotalValence</span><span class="cm">,</span> <span class="i">$SumOfBondOrders</span><span class="cm">,</span> <span class="i">$CurrentEffectiveValence</span><span class="cm">,</span> <span class="i">$AvailableCommonValence</span><span class="s">)</span><span class="sc">;</span>
1656 
1657   <span class="i">$SumOfBondOrders</span> = <span class="i">$This</span><span class="i">-&gt;GetSumOfBondOrders</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1658   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$SumOfBondOrders</span><span class="s">)</span> <span class="s">{</span>
1659     <span class="i">$SumOfBondOrders</span> = <span class="n">0</span><span class="sc">;</span>
1660   <span class="s">}</span>
1661   <span class="i">$CurrentEffectiveValence</span> = <span class="i">$SumOfBondOrders</span> + <span class="i">$This</span><span class="i">-&gt;GetFreeRadicalElectrons</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1662 
1663   <span class="i">$PotentialTotalValence</span> = <span class="n">0</span><span class="sc">;</span>
1664   <span class="j">VALENCE:</span> <span class="k">for</span> <span class="i">$AvailableCommonValence</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$ValenceModelDataRef</span>-&gt;{<span class="i">$AtomicNumber</span>}{<span class="i">$FormalCharge</span>}{<span class="w">CommonValences</span>}}<span class="s">)</span> <span class="s">{</span>
1665       <span class="k">if</span> <span class="s">(</span><span class="i">$CurrentEffectiveValence</span> &lt;= <span class="i">$AvailableCommonValence</span><span class="s">)</span> <span class="s">{</span>
1666         <span class="i">$PotentialTotalValence</span> = <span class="i">$AvailableCommonValence</span><span class="sc">;</span>
1667         <span class="k">last</span> <span class="j">VALENCE</span><span class="sc">;</span>
1668       <span class="s">}</span>
1669   <span class="s">}</span>
1670 
1671   <span class="k">return</span> <span class="i">$PotentialTotalValence</span><span class="sc">;</span>
1672 <span class="s">}</span>
1673 
1674 <span class="c">#</span>
1675 <span class="c"># For elements with one one common valence, potential total common valence used</span>
1676 <span class="c"># during the calculation for number of implicit hydrogens during InternalValenceMode</span>
1677 <span class="c"># corresponds to:</span>
1678 <span class="c">#</span>
1679 <span class="c">#   CommonValence + FormalCharge - FreeRadicalElectrons</span>
1680 <span class="c">#</span>
1681 <span class="c"># For elements with multiple common valences, each common valence is used to</span>
1682 <span class="c"># calculate total potential common valence as shown above, and the first total potential</span>
1683 <span class="c"># common valence gerater than the sum of bond orderes is selected as the final total</span>
1684 <span class="c"># common valence.</span>
1685 <span class="c">#</span>
1686 <span class="c"># Group numbers &gt; 14 - Group numbers 15 (N), 16 (O), 17 (F), 18 (He)</span>
1687 <span class="c">#</span>
1688 <span class="c"># Formal charge sign is not adjusted. Positive and negative values result in the</span>
1689 <span class="c"># increase and decrease of valence.</span>
1690 <span class="c">#</span>
1691 <span class="c"># Group 14 containing C, Si, Ge, Sn, Pb...</span>
1692 <span class="c">#</span>
1693 <span class="c"># Formal charge sign is reversed for positive values. Both positive and negative</span>
1694 <span class="c"># values result in the decrease of valence.</span>
1695 <span class="c">#</span>
1696 <span class="c"># Group 13 containing B, Al, Ga, In, Tl...</span>
1697 <span class="c">#</span>
1698 <span class="c"># Formal charge sign is always reversed. Positive and negative values result in the</span>
1699 <span class="c"># decrease and increase of valence.</span>
1700 <span class="c">#</span>
1701 <span class="c"># Groups 1 (H) through 12 (Zn)...</span>
1702 <span class="c">#</span>
1703 <span class="c"># Formal charge sign is reversed for positive values. Both positive and negative</span>
1704 <span class="c"># values result in the decrease of valence.</span>
1705 <span class="c">#</span>
1706 <span class="c"># Lanthanides and actinides...</span>
1707 <span class="c">#</span>
1708 <span class="c"># Formal charge sign is reversed for positive values. Both positive and negative</span>
1709 <span class="c"># values result in the decrease of valence.</span>
1710 <span class="c">#</span>
1711 <span class="c"># Notes:</span>
1712 <span class="c">#  . CommonValence and HighestCommonValence available from PeriodicTable module</span>
1713 <span class="c">#    are equivalent to most common and highest sum of bond orders for an element. For</span>
1714 <span class="c">#    neutral atoms involved only in single bonds, it corresponds to highest number of</span>
1715 <span class="c">#    allowed bonds for the atom.</span>
1716 <span class="c">#  . FormalCharge sign is reversed for electropositive elements with positive formal charge</span>
1717 <span class="c">#    during common valence calculations. Electropositive elements, metals and transition elements,</span>
1718 <span class="c">#    have usually plus formal charge and it leads to decrease in common valence; the negative</span>
1719 <span class="c">#    formal charge should result in the decrease of common valence.</span>
1720 <span class="c">#  . For carbon, both plus/minus formal charge cause decrease in common valence</span>
1721 <span class="c">#  . For elements on the right of carbon in periodic table, electronegative elements, plus formal</span>
1722 <span class="c">#    charge causes common valence to increase and minus formal charge cause it to decrease.</span>
1723 <span class="c">#</span>
<a name="_GetPotentialTotalCommonValenceUsingInternalValenceModel-"></a>1724 <span class="k">sub </span><span class="m">_GetPotentialTotalCommonValenceUsingInternalValenceModel</span> <span class="s">{</span>
1725   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1726   <span class="k">my</span><span class="s">(</span><span class="i">$AtomicNumber</span><span class="cm">,</span> <span class="i">$CommonValences</span><span class="s">)</span><span class="sc">;</span>
1727 
1728   <span class="i">$AtomicNumber</span> = <span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>}<span class="sc">;</span>
1729   <span class="k">if</span> <span class="s">(</span>!<span class="i">$AtomicNumber</span><span class="s">)</span> <span class="s">{</span>
1730     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1731   <span class="s">}</span>
1732 
1733   <span class="i">$CommonValences</span> = <span class="i">PeriodicTable::GetElementCommonValences</span><span class="s">(</span><span class="i">$AtomicNumber</span><span class="s">)</span><span class="sc">;</span>
1734   <span class="k">if</span> <span class="s">(</span>!<span class="i">$CommonValences</span><span class="s">)</span> <span class="s">{</span>
1735     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1736   <span class="s">}</span>
1737 
1738   <span class="k">my</span><span class="s">(</span><span class="i">$PotentialTotalValence</span><span class="cm">,</span> <span class="i">$AdjustedFormalCharge</span><span class="cm">,</span> <span class="i">$FreeRadicalElectrons</span><span class="cm">,</span> <span class="i">$SumOfBondOrders</span><span class="cm">,</span> <span class="i">$AvailableCommonValence</span><span class="cm">,</span> <span class="i">@AvailableCommonValences</span><span class="s">)</span><span class="sc">;</span>
1739 
1740   <span class="i">$AdjustedFormalCharge</span> = <span class="i">$This</span><span class="i">-&gt;_GetFormalChargeAdjustedForInternalValenceModel</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1741   <span class="i">$FreeRadicalElectrons</span> = <span class="i">$This</span><span class="i">-&gt;GetFreeRadicalElectrons</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1742 
1743   <span class="i">$SumOfBondOrders</span> = <span class="i">$This</span><span class="i">-&gt;GetSumOfBondOrders</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1744   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$SumOfBondOrders</span><span class="s">)</span> <span class="s">{</span>
1745     <span class="i">$SumOfBondOrders</span> = <span class="n">0</span><span class="sc">;</span>
1746   <span class="s">}</span>
1747 
1748   <span class="i">@AvailableCommonValences</span> = <span class="k">split</span> <span class="q">/\,/</span><span class="cm">,</span> <span class="i">$CommonValences</span><span class="sc">;</span>
1749 
1750   <span class="k">if</span> <span class="s">(</span><span class="i">@AvailableCommonValences</span> == <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
1751     <span class="c"># Calculate potential total valence using the only available common valence...</span>
1752     <span class="i">$PotentialTotalValence</span> = <span class="i">$AvailableCommonValences</span>[<span class="n">0</span>] + <span class="i">$AdjustedFormalCharge</span> - <span class="i">$FreeRadicalElectrons</span><span class="sc">;</span>
1753   <span class="s">}</span>
1754   <span class="k">else</span> <span class="s">{</span>
1755     <span class="c"># Calculate potential total valence using common valence from a list of available valences</span>
1756     <span class="c"># that makes it higher than sum of bond orders or using the highest common valence...</span>
1757     <span class="j">VALENCE:</span> <span class="k">for</span> <span class="i">$AvailableCommonValence</span> <span class="s">(</span><span class="i">@AvailableCommonValences</span><span class="s">)</span> <span class="s">{</span>
1758       <span class="i">$PotentialTotalValence</span> = <span class="i">$AvailableCommonValence</span> + <span class="i">$AdjustedFormalCharge</span> - <span class="i">$FreeRadicalElectrons</span><span class="sc">;</span>
1759 
1760       <span class="k">if</span> <span class="s">(</span><span class="i">$PotentialTotalValence</span> &lt; <span class="n">0</span> || <span class="i">$PotentialTotalValence</span> &gt;= <span class="i">$SumOfBondOrders</span><span class="s">)</span> <span class="s">{</span>
1761         <span class="k">last</span> <span class="j">VALENCE</span><span class="sc">;</span>
1762       <span class="s">}</span>
1763     <span class="s">}</span>
1764   <span class="s">}</span>
1765 
1766   <span class="k">return</span> <span class="i">$PotentialTotalValence</span> &gt; <span class="n">0</span> ? <span class="i">$PotentialTotalValence</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1767 <span class="s">}</span>
1768 
1769 <span class="c"># Adjust sign of the formal charge for potential total common valence calculation</span>
1770 <span class="c"># used during internal valence model to figure out number of implicit hydrogens.</span>
1771 <span class="c">#</span>
<a name="_GetFormalChargeAdjustedForInternalValenceModel-"></a>1772 <span class="k">sub </span><span class="m">_GetFormalChargeAdjustedForInternalValenceModel</span> <span class="s">{</span>
1773   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1774   <span class="k">my</span><span class="s">(</span><span class="i">$FormalCharge</span><span class="cm">,</span> <span class="i">$GroupNumber</span><span class="cm">,</span> <span class="i">$SwitchSign</span><span class="s">)</span><span class="sc">;</span>
1775 
1776   <span class="i">$FormalCharge</span> = <span class="i">$This</span><span class="i">-&gt;GetFormalCharge</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1777   <span class="k">if</span> <span class="s">(</span><span class="i">$FormalCharge</span> == <span class="n">0</span><span class="s">)</span> <span class="s">{</span>
1778     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1779   <span class="s">}</span>
1780 
1781   <span class="i">$GroupNumber</span> = <span class="i">$This</span><span class="i">-&gt;GetGroupNumber</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1782   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$GroupNumber</span><span class="s">)</span> <span class="s">{</span>
1783     <span class="k">return</span> <span class="i">$FormalCharge</span><span class="sc">;</span>
1784   <span class="s">}</span>
1785 
1786   <span class="c"># Group numbers &gt; 14 - Group numbers 15 (N), 16 (O), 17 (F), 18 (He)</span>
1787   <span class="c">#</span>
1788   <span class="c"># Formal charge sign is not adjusted. Positive and negative values result in the</span>
1789   <span class="c"># increase and decrease of valence.</span>
1790   <span class="c">#</span>
1791   <span class="c"># Group 14 containing C, Si, Ge, Sn, Pb...</span>
1792   <span class="c">#</span>
1793   <span class="c"># Formal charge sign is reversed for positive values. Both positive and negative</span>
1794   <span class="c"># values result in the decrease of valence.</span>
1795   <span class="c">#</span>
1796   <span class="c"># Group 13 containing B, Al, Ga, In, Tl...</span>
1797   <span class="c">#</span>
1798   <span class="c"># Formal charge sign is always reversed. Positive and negative values result in the</span>
1799   <span class="c"># decrease and increase of valence.</span>
1800   <span class="c">#</span>
1801   <span class="c"># Groups 1 (H) through 12 (Zn)...</span>
1802   <span class="c">#</span>
1803   <span class="c"># Formal charge sign is reversed for positive values. Both positive and negative</span>
1804   <span class="c"># values result in the decrease of valence.</span>
1805   <span class="c">#</span>
1806   <span class="c"># Lanthanides and actinides...</span>
1807   <span class="c">#</span>
1808   <span class="c"># Formal charge sign is reversed for positive values. Both positive and negative</span>
1809   <span class="c"># values result in the decrease of valence.</span>
1810   <span class="c">#</span>
1811 
1812   <span class="i">$SwitchSign</span> = <span class="n">0</span><span class="sc">;</span>
1813   <span class="k">if</span> <span class="s">(</span><span class="k">length</span> <span class="i">$GroupNumber</span><span class="s">)</span> <span class="s">{</span>
1814     <span class="j">GROUPNUMBER:</span> <span class="s">{</span>
1815       <span class="k">if</span> <span class="s">(</span><span class="i">$GroupNumber</span> &gt; <span class="n">14</span><span class="s">)</span> <span class="s">{</span>
1816         <span class="c"># Groups on the right side of C group in the periodic table...</span>
1817         <span class="i">$SwitchSign</span> = <span class="n">0</span><span class="sc">;</span>
1818         <span class="k">last</span> <span class="j">GROUPNUMBER</span><span class="sc">;</span>
1819       <span class="s">}</span>
1820       <span class="k">if</span> <span class="s">(</span><span class="i">$GroupNumber</span> == <span class="n">14</span><span class="s">)</span> <span class="s">{</span>
1821         <span class="c"># Group containing C, Si, Ge, Sn, Pb...</span>
1822         <span class="i">$SwitchSign</span> = <span class="s">(</span><span class="i">$FormalCharge</span> &gt; <span class="n">0</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1823         <span class="k">last</span> <span class="j">GROUPNUMBER</span><span class="sc">;</span>
1824       <span class="s">}</span>
1825       <span class="k">if</span> <span class="s">(</span><span class="i">$GroupNumber</span> == <span class="n">13</span><span class="s">)</span> <span class="s">{</span>
1826         <span class="c"># Group containing B, Al, Ga, In, Tl...</span>
1827         <span class="i">$SwitchSign</span> = <span class="n">1</span><span class="sc">;</span>
1828         <span class="k">last</span> <span class="j">GROUPNUMBER</span><span class="sc">;</span>
1829       <span class="s">}</span>
1830       <span class="c"># Groups 1 (H) through 12 (Zn)...</span>
1831       <span class="k">if</span> <span class="s">(</span><span class="i">$GroupNumber</span> &gt;=<span class="n">1</span> &amp;&amp; <span class="i">$GroupNumber</span> &lt;= <span class="n">12</span><span class="s">)</span> <span class="s">{</span>
1832         <span class="c"># Groups 1 (H) through 12 (Zn)...</span>
1833         <span class="i">$SwitchSign</span> = <span class="s">(</span><span class="i">$FormalCharge</span> &gt; <span class="n">0</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1834         <span class="k">last</span> <span class="j">GROUPNUMBER</span><span class="sc">;</span>
1835       <span class="s">}</span>
1836     <span class="s">}</span>
1837   <span class="s">}</span>
1838   <span class="k">else</span> <span class="s">{</span>
1839     <span class="c"># Lanthanides and actinides...</span>
1840     <span class="i">$SwitchSign</span> = <span class="s">(</span><span class="i">$FormalCharge</span> &gt; <span class="n">0</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1841   <span class="s">}</span>
1842 
1843   <span class="k">if</span> <span class="s">(</span><span class="i">$SwitchSign</span><span class="s">)</span> <span class="s">{</span>
1844     <span class="i">$FormalCharge</span> *= <span class="n">-1.0</span><span class="sc">;</span>
1845   <span class="s">}</span>
1846 
1847   <span class="k">return</span> <span class="i">$FormalCharge</span><span class="sc">;</span>
1848 <span class="s">}</span>
1849 
1850 <span class="c"># Get lowest common valence...</span>
<a name="GetLowestCommonValence-"></a>1851 <span class="k">sub </span><span class="m">GetLowestCommonValence</span> <span class="s">{</span>
1852   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1853 
1854   <span class="c"># Is LowestCommonValence property explicitly set?</span>
1855   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;LowestCommonValence&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1856     <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;LowestCommonValence&#39;</span><span class="s">)</span><span class="sc">;</span>
1857   <span class="s">}</span>
1858   <span class="k">my</span><span class="s">(</span><span class="i">$AtomicNumber</span><span class="cm">,</span> <span class="i">$LowestCommonValence</span><span class="s">)</span><span class="sc">;</span>
1859 
1860   <span class="i">$AtomicNumber</span> = <span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>}<span class="sc">;</span>
1861   <span class="k">if</span> <span class="s">(</span>!<span class="i">$AtomicNumber</span><span class="s">)</span> <span class="s">{</span>
1862     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1863   <span class="s">}</span>
1864   <span class="c"># Any need to differentiate between internal and other valence models...</span>
1865 
1866   <span class="c"># LowestCommonValence is not set for all elements...</span>
1867   <span class="i">$LowestCommonValence</span> = <span class="i">PeriodicTable::GetElementLowestCommonValence</span><span class="s">(</span><span class="i">$AtomicNumber</span><span class="s">)</span><span class="sc">;</span>
1868   <span class="k">if</span> <span class="s">(</span>!<span class="i">$LowestCommonValence</span><span class="s">)</span> <span class="s">{</span>
1869     <span class="i">$LowestCommonValence</span> = <span class="k">undef</span><span class="sc">;</span>
1870   <span class="s">}</span>
1871 
1872   <span class="k">return</span> <span class="i">$LowestCommonValence</span><span class="sc">;</span>
1873 <span class="s">}</span>
1874 
1875 <span class="c"># Get highest common valence...</span>
<a name="GetHighestCommonValence-"></a>1876 <span class="k">sub </span><span class="m">GetHighestCommonValence</span> <span class="s">{</span>
1877   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1878 
1879   <span class="c"># Is HighestCommonValence property explicitly set?</span>
1880   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;HighestCommonValence&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1881     <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;HighestCommonValence&#39;</span><span class="s">)</span><span class="sc">;</span>
1882   <span class="s">}</span>
1883   <span class="k">my</span><span class="s">(</span><span class="i">$AtomicNumber</span><span class="cm">,</span> <span class="i">$HighestCommonValence</span><span class="s">)</span><span class="sc">;</span>
1884 
1885   <span class="i">$AtomicNumber</span> = <span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>}<span class="sc">;</span>
1886   <span class="k">if</span> <span class="s">(</span>!<span class="i">$AtomicNumber</span><span class="s">)</span> <span class="s">{</span>
1887     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1888   <span class="s">}</span>
1889 
1890   <span class="c"># Any need to differentiate between internal and other valence models...</span>
1891 
1892   <span class="c"># HighestCommonValence is not set for all elements...</span>
1893   <span class="i">$HighestCommonValence</span> = <span class="i">PeriodicTable::GetElementHighestCommonValence</span><span class="s">(</span><span class="i">$AtomicNumber</span><span class="s">)</span><span class="sc">;</span>
1894   <span class="k">if</span> <span class="s">(</span>!<span class="i">$HighestCommonValence</span><span class="s">)</span> <span class="s">{</span>
1895     <span class="i">$HighestCommonValence</span> = <span class="k">undef</span><span class="sc">;</span>
1896   <span class="s">}</span>
1897 
1898   <span class="k">return</span> <span class="i">$HighestCommonValence</span><span class="sc">;</span>
1899 <span class="s">}</span>
1900 
1901 <span class="c"># Get valence electrons...</span>
<a name="GetValenceElectrons-"></a>1902 <span class="k">sub </span><span class="m">GetValenceElectrons</span> <span class="s">{</span>
1903   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1904 
1905   <span class="c"># Is ValenceElectrons property explicitly set?</span>
1906   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;ValenceElectrons&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1907     <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;ValenceElectrons&#39;</span><span class="s">)</span><span class="sc">;</span>
1908   <span class="s">}</span>
1909   <span class="k">my</span><span class="s">(</span><span class="i">$AtomicNumber</span><span class="cm">,</span> <span class="i">$ValenceElectrons</span><span class="s">)</span><span class="sc">;</span>
1910 
1911   <span class="i">$AtomicNumber</span> = <span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>}<span class="sc">;</span>
1912   <span class="k">if</span> <span class="s">(</span>!<span class="i">$AtomicNumber</span><span class="s">)</span> <span class="s">{</span>
1913     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1914   <span class="s">}</span>
1915 
1916   <span class="i">$ValenceElectrons</span> = <span class="i">PeriodicTable::GetElementValenceElectrons</span><span class="s">(</span><span class="i">$AtomicNumber</span><span class="s">)</span><span class="sc">;</span>
1917 
1918   <span class="k">return</span> <span class="i">$ValenceElectrons</span><span class="sc">;</span>
1919 <span class="s">}</span>
1920 
1921 <span class="c"># Add hydrogens to specified atom in molecule and return number of hydrogens added:</span>
1922 <span class="c">#</span>
1923 <span class="c">#   o HydrogensToAdd = ImplicitHydrogenCount - ExplicitHydrogenCount</span>
1924 <span class="c">#</span>
1925 <span class="c">#   o XYZ are set to ZeroVector</span>
1926 <span class="c">#</span>
<a name="AddHydrogens-"></a>1927 <span class="k">sub </span><span class="m">AddHydrogens</span> <span class="s">{</span>
1928   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$HydrogenPositionsWarning</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1929 
1930   <span class="c"># Is this atom in a molecule?</span>
1931   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1932     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
1933   <span class="s">}</span>
1934   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$HydrogenPositionsWarning</span><span class="s">)</span> <span class="s">{</span>
1935     <span class="i">$HydrogenPositionsWarning</span> = <span class="n">1</span><span class="sc">;</span>
1936   <span class="s">}</span>
1937   <span class="k">if</span> <span class="s">(</span><span class="i">$HydrogenPositionsWarning</span><span class="s">)</span> <span class="s">{</span>
1938     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;AddHydrogens: The current release of MayaChemTools doesn&#39;t assign any hydrogen positions...&quot;</span><span class="sc">;</span>
1939   <span class="s">}</span>
1940 
1941   <span class="c"># Is it an element symbol?</span>
1942   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>}<span class="s">)</span> <span class="s">{</span>
1943     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1944   <span class="s">}</span>
1945 
1946   <span class="k">my</span><span class="s">(</span><span class="i">$Molecule</span><span class="cm">,</span> <span class="i">$HydrogensAdded</span><span class="cm">,</span> <span class="i">$HydrogensToAdd</span><span class="s">)</span><span class="sc">;</span>
1947 
1948   <span class="i">$Molecule</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="sc">;</span>
1949   <span class="i">$HydrogensAdded</span> = <span class="n">0</span><span class="sc">;</span>
1950   <span class="i">$HydrogensToAdd</span> = <span class="i">$This</span><span class="i">-&gt;GetNumOfMissingHydrogens</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1951   <span class="k">if</span> <span class="s">(</span><span class="i">$HydrogensToAdd</span> &lt;= <span class="n">0</span><span class="s">)</span> <span class="s">{</span>
1952     <span class="k">return</span> <span class="i">$HydrogensAdded</span><span class="sc">;</span>
1953   <span class="s">}</span>
1954 
1955   <span class="k">my</span><span class="s">(</span><span class="i">$Count</span><span class="cm">,</span> <span class="i">$Hydrogen</span><span class="s">)</span><span class="sc">;</span>
1956 
1957   <span class="k">for</span> <span class="i">$Count</span> <span class="s">(</span><span class="n">1</span> .. <span class="i">$HydrogensToAdd</span><span class="s">)</span> <span class="s">{</span>
1958     <span class="i">$HydrogensAdded</span>++<span class="sc">;</span>
1959 
1960     <span class="i">$Hydrogen</span> = <span class="i">$Molecule</span><span class="i">-&gt;NewAtom</span><span class="s">(</span><span class="q">&#39;AtomSymbol&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;H&#39;</span><span class="cm">,</span> <span class="q">&#39;XYZ&#39;</span> <span class="cm">=&gt;</span> <span class="s">[</span><span class="n">0</span><span class="cm">,</span> <span class="n">0</span><span class="cm">,</span> <span class="n">0</span><span class="s">]</span><span class="s">)</span><span class="sc">;</span>
1961     <span class="i">$Molecule</span><span class="i">-&gt;NewBond</span><span class="s">(</span><span class="q">&#39;Atoms&#39;</span> <span class="cm">=&gt;</span> <span class="s">[</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Hydrogen</span><span class="s">]</span><span class="cm">,</span> <span class="q">&#39;BondOrder&#39;</span> <span class="cm">=&gt;</span> <span class="n">1</span><span class="s">)</span><span class="sc">;</span>
1962   <span class="s">}</span>
1963 
1964   <span class="k">return</span> <span class="i">$HydrogensAdded</span><span class="sc">;</span>
1965 <span class="s">}</span>
1966 
1967 <span class="c"># Delete hydrogens attached to atom in molecule and return total number of hydrogens deleted...</span>
<a name="DeleteHydrogens-"></a>1968 <span class="k">sub </span><span class="m">DeleteHydrogens</span> <span class="s">{</span>
1969   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1970 
1971   <span class="c"># Is this atom in a molecule?</span>
1972   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1973     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
1974   <span class="s">}</span>
1975 
1976   <span class="c"># Is it an element symbol?</span>
1977   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>}<span class="s">)</span> <span class="s">{</span>
1978     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1979   <span class="s">}</span>
1980 
1981   <span class="k">my</span><span class="s">(</span><span class="i">$Molecule</span><span class="cm">,</span> <span class="i">$Neighbor</span><span class="cm">,</span> <span class="i">$HydrogensDeleted</span><span class="cm">,</span> <span class="i">@Neighbors</span><span class="s">)</span><span class="sc">;</span>
1982 
1983   <span class="i">$Molecule</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="sc">;</span>
1984   <span class="i">$HydrogensDeleted</span> = <span class="n">0</span><span class="sc">;</span>
1985   <span class="i">@Neighbors</span> = <span class="i">$This</span><span class="i">-&gt;GetNeighbors</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1986 
1987   <span class="j">NEIGHBOR:</span> <span class="k">for</span> <span class="i">$Neighbor</span> <span class="s">(</span><span class="i">@Neighbors</span><span class="s">)</span> <span class="s">{</span>
1988     <span class="k">if</span> <span class="s">(</span>!<span class="i">$Neighbor</span><span class="i">-&gt;IsHydrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1989       <span class="k">next</span> <span class="j">NEIGHBOR</span><span class="sc">;</span>
1990     <span class="s">}</span>
1991     <span class="i">$Molecule</span><span class="i">-&gt;_DeleteAtom</span><span class="s">(</span><span class="i">$Neighbor</span><span class="s">)</span><span class="sc">;</span>
1992     <span class="i">$HydrogensDeleted</span>++<span class="sc">;</span>
1993   <span class="s">}</span>
1994 
1995   <span class="k">return</span> <span class="i">$HydrogensDeleted</span><span class="sc">;</span>
1996 <span class="s">}</span>
1997 
1998 <span class="c"># Copy atom and all its associated data...</span>
<a name="Copy-"></a>1999 <span class="k">sub </span><span class="m">Copy</span> <span class="s">{</span>
2000   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2001   <span class="k">my</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
2002 
2003   <span class="i">$Atom</span> = <span class="i">Storable::dclone</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span><span class="sc">;</span>
2004 
2005   <span class="k">return</span> <span class="i">$Atom</span><span class="sc">;</span>
2006 <span class="s">}</span>
2007 
2008 <span class="c"># Get atomic invariant value...</span>
2009 <span class="c">#</span>
<a name="GetAtomicInvariantValue-"></a>2010 <span class="k">sub </span><span class="m">GetAtomicInvariantValue</span> <span class="s">{</span>
2011   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$AtomicInvariant</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2012   <span class="k">my</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span><span class="sc">;</span>
2013 
2014   <span class="i">$Value</span> = <span class="q">&quot;&quot;</span><span class="sc">;</span>
2015 
2016   <span class="j">ATOMICVARIANT:</span> <span class="s">{</span>
2017     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomicInvariant</span> =~ <span class="q">/^(AS|AtomSymbol|ElementSymbol)$/i</span><span class="s">)</span> <span class="s">{</span>
2018       <span class="i">$Value</span> = <span class="i">$This</span><span class="i">-&gt;GetAtomSymbol</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2019       <span class="k">last</span> <span class="j">ATOMICVARIANT</span><span class="sc">;</span>
2020     <span class="s">}</span>
2021     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomicInvariant</span> =~ <span class="q">/^(X|NumOfNonHydrogenAtomNeighbors|NumOfHeavyAtomNeighbors)$/i</span><span class="s">)</span> <span class="s">{</span>
2022       <span class="i">$Value</span> = <span class="i">$This</span><span class="i">-&gt;GetNumOfNonHydrogenAtomNeighbors</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2023       <span class="k">last</span> <span class="j">ATOMICVARIANT</span><span class="sc">;</span>
2024     <span class="s">}</span>
2025     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomicInvariant</span> =~ <span class="q">/^(BO|SumOfBondOrdersToNonHydrogenAtoms|SumOfBondOrdersToHeavyAtoms)$/i</span><span class="s">)</span> <span class="s">{</span>
2026       <span class="i">$Value</span> = <span class="i">$This</span><span class="i">-&gt;GetSumOfBondOrdersToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2027       <span class="k">last</span> <span class="j">ATOMICVARIANT</span><span class="sc">;</span>
2028     <span class="s">}</span>
2029     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomicInvariant</span> =~ <span class="q">/^(LBO|LargestBondOrderToNonHydrogenAtoms|LargestBondOrderToHeavyAtoms)$/i</span><span class="s">)</span> <span class="s">{</span>
2030       <span class="i">$Value</span> = <span class="i">$This</span><span class="i">-&gt;GetLargestBondOrderToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2031       <span class="k">last</span> <span class="j">ATOMICVARIANT</span><span class="sc">;</span>
2032     <span class="s">}</span>
2033     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomicInvariant</span> =~ <span class="q">/^(H|NumOfImplicitAndExplicitHydrogens)$/i</span><span class="s">)</span> <span class="s">{</span>
2034       <span class="i">$Value</span> = <span class="i">$This</span><span class="i">-&gt;GetNumOfHydrogens</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2035       <span class="k">last</span> <span class="j">ATOMICVARIANT</span><span class="sc">;</span>
2036     <span class="s">}</span>
2037     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomicInvariant</span> =~ <span class="q">/^(SB|NumOfSingleBondsToNonHydrogenAtoms|NumOfSingleBondsToHeavyAtoms)$/i</span><span class="s">)</span> <span class="s">{</span>
2038       <span class="i">$Value</span> = <span class="i">$This</span><span class="i">-&gt;GetNumOfSingleBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2039       <span class="k">last</span> <span class="j">ATOMICVARIANT</span><span class="sc">;</span>
2040     <span class="s">}</span>
2041     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomicInvariant</span> =~ <span class="q">/^(DB|NumOfDoubleBondsToNonHydrogenAtoms|NumOfDoubleBondsToHeavyAtoms)$/i</span><span class="s">)</span> <span class="s">{</span>
2042       <span class="i">$Value</span> = <span class="i">$This</span><span class="i">-&gt;GetNumOfDoubleBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2043       <span class="k">last</span> <span class="j">ATOMICVARIANT</span><span class="sc">;</span>
2044     <span class="s">}</span>
2045     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomicInvariant</span> =~ <span class="q">/^(TB|NumOfTripleBondsToNonHydrogenAtoms|NumOfTripleBondsToHeavyAtoms)$/i</span><span class="s">)</span> <span class="s">{</span>
2046       <span class="i">$Value</span> = <span class="i">$This</span><span class="i">-&gt;GetNumOfTripleBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2047       <span class="k">last</span> <span class="j">ATOMICVARIANT</span><span class="sc">;</span>
2048     <span class="s">}</span>
2049     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomicInvariant</span> =~ <span class="q">/^(AB|NumOfAromaticBondsToNonHydrogenAtoms|NumOfAromaticBondsToHeavyAtoms)$/i</span><span class="s">)</span> <span class="s">{</span>
2050       <span class="i">$Value</span> = <span class="i">$This</span><span class="i">-&gt;GetNumOfAromaticBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2051       <span class="k">last</span> <span class="j">ATOMICVARIANT</span><span class="sc">;</span>
2052     <span class="s">}</span>
2053     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomicInvariant</span> =~ <span class="q">/^(FC|FormalCharge)$/i</span><span class="s">)</span> <span class="s">{</span>
2054       <span class="i">$Value</span> = <span class="i">$This</span><span class="i">-&gt;GetFormalCharge</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2055       <span class="i">$Value</span> = <span class="k">defined</span> <span class="i">$Value</span> ? <span class="i">$Value</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2056       <span class="k">last</span> <span class="j">ATOMICVARIANT</span><span class="sc">;</span>
2057     <span class="s">}</span>
2058     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomicInvariant</span> =~ <span class="q">/^(T|TotalNumOfAtomNeighbors)$/i</span><span class="s">)</span> <span class="s">{</span>
2059       <span class="i">$Value</span> = <span class="i">$This</span><span class="i">-&gt;GetNumOfNonHydrogenAtomNeighbors</span><span class="s">(</span><span class="s">)</span> + <span class="i">$This</span><span class="i">-&gt;GetNumOfHydrogens</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2060       <span class="k">last</span> <span class="j">ATOMICVARIANT</span><span class="sc">;</span>
2061     <span class="s">}</span>
2062     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomicInvariant</span> =~ <span class="q">/^(TSB|TotalNumOfSingleBonds)$/i</span><span class="s">)</span> <span class="s">{</span>
2063       <span class="i">$Value</span> = <span class="i">$This</span><span class="i">-&gt;GetNumOfSingleBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span> + <span class="i">$This</span><span class="i">-&gt;GetNumOfHydrogens</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2064       <span class="k">last</span> <span class="j">ATOMICVARIANT</span><span class="sc">;</span>
2065     <span class="s">}</span>
2066     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomicInvariant</span> =~ <span class="q">/^(Ar|Aromatic)$/i</span><span class="s">)</span> <span class="s">{</span>
2067       <span class="i">$Value</span> = <span class="i">$This</span><span class="i">-&gt;IsAromatic</span><span class="s">(</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2068       <span class="k">last</span> <span class="j">ATOMICVARIANT</span><span class="sc">;</span>
2069     <span class="s">}</span>
2070     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomicInvariant</span> =~ <span class="q">/^(RA|RingAtom)$/i</span><span class="s">)</span> <span class="s">{</span>
2071       <span class="i">$Value</span> = <span class="i">$This</span><span class="i">-&gt;IsInRing</span><span class="s">(</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2072       <span class="k">last</span> <span class="j">ATOMICVARIANT</span><span class="sc">;</span>
2073     <span class="s">}</span>
2074     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomicInvariant</span> =~ <span class="q">/^(Str|Stereochemistry)$/i</span><span class="s">)</span> <span class="s">{</span>
2075       <span class="i">$Value</span> = <span class="i">$This</span><span class="i">-&gt;GetStereochemistry</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2076       <span class="i">$Value</span>= <span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span> &amp;&amp; <span class="s">(</span><span class="i">$Value</span> =~ <span class="q">/^(R|S)$/i</span><span class="s">)</span><span class="s">)</span> ? <span class="i">$Value</span> <span class="co">:</span> <span class="q">&#39;&#39;</span><span class="sc">;</span>
2077       <span class="k">last</span> <span class="j">ATOMICVARIANT</span><span class="sc">;</span>
2078     <span class="s">}</span>
2079     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomicInvariant</span> =~ <span class="q">/^(AN|AtomicNumber)$/i</span><span class="s">)</span> <span class="s">{</span>
2080       <span class="i">$Value</span> = <span class="i">$This</span><span class="i">-&gt;GetAtomicNumber</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2081       <span class="k">last</span> <span class="j">ATOMICVARIANT</span><span class="sc">;</span>
2082     <span class="s">}</span>
2083     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomicInvariant</span> =~ <span class="q">/^(AM|AtomicMass)$/i</span><span class="s">)</span> <span class="s">{</span>
2084       <span class="i">$Value</span> = <span class="i">round</span><span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetExactMass</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="n">4</span><span class="s">)</span> + <span class="n">0</span><span class="sc">;</span>
2085       <span class="k">last</span> <span class="j">ATOMICVARIANT</span><span class="sc">;</span>
2086     <span class="s">}</span>
2087     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomicInvariant</span> =~ <span class="q">/^(MN|MassNumber)$/i</span><span class="s">)</span> <span class="s">{</span>
2088       <span class="i">$Value</span> = <span class="i">$This</span><span class="i">-&gt;GetMassNumber</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2089       <span class="k">last</span> <span class="j">ATOMICVARIANT</span><span class="sc">;</span>
2090     <span class="s">}</span>
2091     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomicInvariant</span> =~ <span class="q">/^(SM|SpinMultiplicity)$/i</span><span class="s">)</span> <span class="s">{</span>
2092       <span class="i">$Value</span> = <span class="i">$This</span><span class="i">-&gt;GetSpinMultiplicity</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2093       <span class="i">$Value</span> = <span class="k">defined</span> <span class="i">$Value</span> ? <span class="i">$Value</span> <span class="co">:</span> <span class="q">&#39;&#39;</span><span class="sc">;</span>
2094       <span class="k">last</span> <span class="j">ATOMICVARIANT</span><span class="sc">;</span>
2095     <span class="s">}</span>
2096     <span class="i">$Value</span> = <span class="q">&quot;&quot;</span><span class="sc">;</span>
2097     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;GetAtomicInvariantValue: Unknown atomic invariant $AtomicInvariant...&quot;</span><span class="sc">;</span>
2098   <span class="s">}</span>
2099 
2100   <span class="k">return</span> <span class="i">$Value</span><span class="sc">;</span>
2101 <span class="s">}</span>
2102 
2103 <span class="c"># Get period number of the atom..</span>
2104 <span class="c">#</span>
<a name="GetPeriodNumber-"></a>2105 <span class="k">sub </span><span class="m">GetPeriodNumber</span> <span class="s">{</span>
2106   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2107 
2108   <span class="c"># Is PeriodNumber property explicitly set?</span>
2109   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;PeriodNumber&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2110     <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;PeriodNumber&#39;</span><span class="s">)</span><span class="sc">;</span>
2111   <span class="s">}</span>
2112   <span class="k">my</span><span class="s">(</span><span class="i">$AtomicNumber</span><span class="cm">,</span> <span class="i">$PeriodNumber</span><span class="s">)</span><span class="sc">;</span>
2113 
2114   <span class="i">$AtomicNumber</span> = <span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>}<span class="sc">;</span>
2115   <span class="k">if</span> <span class="s">(</span>!<span class="i">$AtomicNumber</span><span class="s">)</span> <span class="s">{</span>
2116     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2117   <span class="s">}</span>
2118 
2119   <span class="i">$PeriodNumber</span> = <span class="i">PeriodicTable::GetElementPeriodNumber</span><span class="s">(</span><span class="i">$AtomicNumber</span><span class="s">)</span><span class="sc">;</span>
2120 
2121   <span class="k">return</span> <span class="i">$PeriodNumber</span><span class="sc">;</span>
2122 <span class="s">}</span>
2123 
2124 <span class="c"># Get group number of the atom..</span>
2125 <span class="c">#</span>
<a name="GetGroupNumber-"></a>2126 <span class="k">sub </span><span class="m">GetGroupNumber</span> <span class="s">{</span>
2127   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2128 
2129   <span class="c"># Is GroupNumber property explicitly set?</span>
2130   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;GroupNumber&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2131     <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;GroupNumber&#39;</span><span class="s">)</span><span class="sc">;</span>
2132   <span class="s">}</span>
2133   <span class="k">my</span><span class="s">(</span><span class="i">$AtomicNumber</span><span class="cm">,</span> <span class="i">$GroupNumber</span><span class="s">)</span><span class="sc">;</span>
2134 
2135   <span class="i">$AtomicNumber</span> = <span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>}<span class="sc">;</span>
2136   <span class="k">if</span> <span class="s">(</span>!<span class="i">$AtomicNumber</span><span class="s">)</span> <span class="s">{</span>
2137     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2138   <span class="s">}</span>
2139 
2140   <span class="i">$GroupNumber</span> = <span class="i">PeriodicTable::GetElementGroupNumber</span><span class="s">(</span><span class="i">$AtomicNumber</span><span class="s">)</span><span class="sc">;</span>
2141 
2142   <span class="k">return</span> <span class="i">$GroupNumber</span><span class="sc">;</span>
2143 <span class="s">}</span>
2144 
2145 <span class="c"># Is it a specified topological pharmacophore atom type?</span>
2146 <span class="c">#</span>
<a name="IsTopologicalPharmacophoreType-"></a>2147 <span class="k">sub </span><span class="m">IsTopologicalPharmacophoreType</span> <span class="s">{</span>
2148   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Type</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2149 
2150   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsFunctionalClassType</span><span class="s">(</span><span class="i">$Type</span><span class="s">)</span><span class="sc">;</span>
2151 <span class="s">}</span>
2152 
2153 <span class="c"># Is it a specified functional class atom type?</span>
2154 <span class="c">#</span>
<a name="IsFunctionalClassType-"></a>2155 <span class="k">sub </span><span class="m">IsFunctionalClassType</span> <span class="s">{</span>
2156   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Type</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2157 
2158   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsFunctionalClassType</span><span class="s">(</span><span class="i">$Type</span><span class="s">)</span><span class="sc">;</span>
2159 <span class="s">}</span>
2160 
2161 <span class="c"># Is it a specified functional/topological pharmacophore atom type?</span>
2162 <span class="c">#</span>
<a name="_IsFunctionalClassType-"></a>2163 <span class="k">sub </span><span class="m">_IsFunctionalClassType</span> <span class="s">{</span>
2164   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Type</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2165   <span class="k">my</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span><span class="sc">;</span>
2166 
2167   <span class="i">$Value</span> = <span class="n">0</span><span class="sc">;</span>
2168 
2169   <span class="j">TYPE:</span> <span class="s">{</span>
2170     <span class="k">if</span> <span class="s">(</span><span class="i">$Type</span> =~ <span class="q">/^(HBD|HydrogenBondDonor)$/i</span><span class="s">)</span> <span class="s">{</span>
2171       <span class="i">$Value</span> = <span class="i">$This</span><span class="i">-&gt;IsHydrogenBondDonor</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2172       <span class="k">last</span> <span class="j">TYPE</span><span class="sc">;</span>
2173     <span class="s">}</span>
2174     <span class="k">if</span> <span class="s">(</span><span class="i">$Type</span> =~ <span class="q">/^(HBA|HydrogenBondAcceptor)$/i</span><span class="s">)</span> <span class="s">{</span>
2175       <span class="i">$Value</span> = <span class="i">$This</span><span class="i">-&gt;IsHydrogenBondAcceptor</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2176       <span class="k">last</span> <span class="j">TYPE</span><span class="sc">;</span>
2177     <span class="s">}</span>
2178     <span class="k">if</span> <span class="s">(</span><span class="i">$Type</span> =~ <span class="q">/^(PI|PositivelyIonizable)$/i</span><span class="s">)</span> <span class="s">{</span>
2179       <span class="i">$Value</span> = <span class="i">$This</span><span class="i">-&gt;IsPositivelyIonizable</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2180       <span class="k">last</span> <span class="j">TYPE</span><span class="sc">;</span>
2181     <span class="s">}</span>
2182     <span class="k">if</span> <span class="s">(</span><span class="i">$Type</span> =~ <span class="q">/^(NI|NegativelyIonizable)$/i</span><span class="s">)</span> <span class="s">{</span>
2183       <span class="i">$Value</span> = <span class="i">$This</span><span class="i">-&gt;IsNegativelyIonizable</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2184       <span class="k">last</span> <span class="j">TYPE</span><span class="sc">;</span>
2185     <span class="s">}</span>
2186     <span class="k">if</span> <span class="s">(</span><span class="i">$Type</span> =~ <span class="q">/^(H|Hydrophobic)$/i</span><span class="s">)</span> <span class="s">{</span>
2187       <span class="i">$Value</span> = <span class="i">$This</span><span class="i">-&gt;IsHydrophobic</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2188       <span class="k">last</span> <span class="j">TYPE</span><span class="sc">;</span>
2189     <span class="s">}</span>
2190     <span class="k">if</span> <span class="s">(</span><span class="i">$Type</span> =~ <span class="q">/^(Ar|Aromatic)$/i</span><span class="s">)</span> <span class="s">{</span>
2191       <span class="i">$Value</span> = <span class="i">$This</span><span class="i">-&gt;IsAromatic</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2192       <span class="k">last</span> <span class="j">TYPE</span><span class="sc">;</span>
2193     <span class="s">}</span>
2194     <span class="k">if</span> <span class="s">(</span><span class="i">$Type</span> =~ <span class="q">/^(Hal|Halogen)$/i</span><span class="s">)</span> <span class="s">{</span>
2195       <span class="i">$Value</span> = <span class="i">$This</span><span class="i">-&gt;IsHalogen</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2196       <span class="k">last</span> <span class="j">TYPE</span><span class="sc">;</span>
2197     <span class="s">}</span>
2198     <span class="k">if</span> <span class="s">(</span><span class="i">$Type</span> =~ <span class="q">/^(RA|RingAtom)$/i</span><span class="s">)</span> <span class="s">{</span>
2199       <span class="i">$Value</span> = <span class="i">$This</span><span class="i">-&gt;IsInRing</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2200       <span class="k">last</span> <span class="j">TYPE</span><span class="sc">;</span>
2201     <span class="s">}</span>
2202     <span class="k">if</span> <span class="s">(</span><span class="i">$Type</span> =~ <span class="q">/^(CA|ChainAtom)$/i</span><span class="s">)</span> <span class="s">{</span>
2203       <span class="i">$Value</span> = <span class="i">$This</span><span class="i">-&gt;IsNotInRing</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2204       <span class="k">last</span> <span class="j">TYPE</span><span class="sc">;</span>
2205     <span class="s">}</span>
2206     <span class="i">$Value</span> = <span class="n">0</span><span class="sc">;</span>
2207     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_IsType: Unknown functional/pharmacohore type $Type...&quot;</span><span class="sc">;</span>
2208   <span class="s">}</span>
2209   <span class="k">return</span> <span class="i">$Value</span><span class="sc">;</span>
2210 <span class="s">}</span>
2211 
2212 <span class="c"># Is it a Hydrogen atom?</span>
<a name="IsHydrogen-"></a>2213 <span class="k">sub </span><span class="m">IsHydrogen</span> <span class="s">{</span>
2214   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2215 
2216   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>} == <span class="n">1</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2217 <span class="s">}</span>
2218 
2219 <span class="c"># Is it a Carbon atom?</span>
<a name="IsCarbon-"></a>2220 <span class="k">sub </span><span class="m">IsCarbon</span> <span class="s">{</span>
2221   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2222 
2223   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>} == <span class="n">6</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2224 <span class="s">}</span>
2225 
2226 <span class="c"># Is it a Nitrogen atom?</span>
<a name="IsNitrogen-"></a>2227 <span class="k">sub </span><span class="m">IsNitrogen</span> <span class="s">{</span>
2228   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2229 
2230   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>} == <span class="n">7</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2231 <span class="s">}</span>
2232 
2233 <span class="c"># Is it a Oxygen atom?</span>
<a name="IsOxygen-"></a>2234 <span class="k">sub </span><span class="m">IsOxygen</span> <span class="s">{</span>
2235   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2236 
2237   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>} == <span class="n">8</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2238 <span class="s">}</span>
2239 
2240 <span class="c"># Is it a Fluorine atom?</span>
<a name="IsFluorine-"></a>2241 <span class="k">sub </span><span class="m">IsFluorine</span> <span class="s">{</span>
2242   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2243 
2244   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>} == <span class="n">9</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2245 <span class="s">}</span>
2246 
2247 <span class="c"># Is it a Silicon atom?</span>
<a name="IsSilicon-"></a>2248 <span class="k">sub </span><span class="m">IsSilicon</span> <span class="s">{</span>
2249   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2250 
2251   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>} == <span class="n">14</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2252 <span class="s">}</span>
2253 
2254 <span class="c"># Is it a Phosphorus atom?</span>
<a name="IsPhosphorus-"></a>2255 <span class="k">sub </span><span class="m">IsPhosphorus</span> <span class="s">{</span>
2256   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2257 
2258   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>} == <span class="n">15</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2259 <span class="s">}</span>
2260 
2261 <span class="c"># Is it a Sulphur atom?</span>
<a name="IsSulphur-"></a>2262 <span class="k">sub </span><span class="m">IsSulphur</span> <span class="s">{</span>
2263   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2264 
2265   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;IsSulfur</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2266 <span class="s">}</span>
2267 
2268 <span class="c"># Is it a Sulfur atom?</span>
<a name="IsSulfur-"></a>2269 <span class="k">sub </span><span class="m">IsSulfur</span> <span class="s">{</span>
2270   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2271 
2272   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>} == <span class="n">16</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2273 <span class="s">}</span>
2274 
2275 <span class="c"># Is it a Chlorine atom?</span>
<a name="IsChlorine-"></a>2276 <span class="k">sub </span><span class="m">IsChlorine</span> <span class="s">{</span>
2277   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2278 
2279   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>} == <span class="n">17</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2280 <span class="s">}</span>
2281 
2282 <span class="c"># Is it a Arsenic atom?</span>
<a name="IsArsenic-"></a>2283 <span class="k">sub </span><span class="m">IsArsenic</span> <span class="s">{</span>
2284   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2285 
2286   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>} == <span class="n">33</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2287 <span class="s">}</span>
2288 
2289 <span class="c"># Is it a Selenium atom?</span>
<a name="IsSelenium-"></a>2290 <span class="k">sub </span><span class="m">IsSelenium</span> <span class="s">{</span>
2291   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2292 
2293   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>} == <span class="n">34</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2294 <span class="s">}</span>
2295 
2296 <span class="c"># Is it a Bromine atom?</span>
<a name="IsBromine-"></a>2297 <span class="k">sub </span><span class="m">IsBromine</span> <span class="s">{</span>
2298   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2299 
2300   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>} == <span class="n">35</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2301 <span class="s">}</span>
2302 
2303 <span class="c"># Is it a Tellurium atom?</span>
<a name="IsTellurium-"></a>2304 <span class="k">sub </span><span class="m">IsTellurium</span> <span class="s">{</span>
2305   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2306 
2307   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>} == <span class="n">52</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2308 <span class="s">}</span>
2309 
2310 <span class="c"># Is it a Iodine atom?</span>
<a name="IsIodine-"></a>2311 <span class="k">sub </span><span class="m">IsIodine</span> <span class="s">{</span>
2312   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2313 
2314   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>} == <span class="n">53</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2315 <span class="s">}</span>
2316 
2317 <span class="c"># Is it a hetro atom? (N, O, F, P, S, Cl, Br, I)</span>
<a name="IsHeteroAtom-"></a>2318 <span class="k">sub </span><span class="m">IsHeteroAtom</span> <span class="s">{</span>
2319   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2320 
2321   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>} =~ <span class="q">/^(7|8|9|15|16|17|35|53)$/</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2322 <span class="s">}</span>
2323 
2324 <span class="c"># Is it a halogen atom? (F, Cl, Br, I)</span>
<a name="IsHalogen-"></a>2325 <span class="k">sub </span><span class="m">IsHalogen</span> <span class="s">{</span>
2326   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2327 
2328   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>} =~ <span class="q">/^(9|17|35|53)$/</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2329 <span class="s">}</span>
2330 
2331 <span class="c"># Is it classified as metallic?</span>
<a name="IsMetallic-"></a>2332 <span class="k">sub </span><span class="m">IsMetallic</span> <span class="s">{</span>
2333   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2334   <span class="k">my</span><span class="s">(</span><span class="i">$Classification</span><span class="s">)</span><span class="sc">;</span>
2335 
2336   <span class="i">$Classification</span> = <span class="i">PeriodicTable::GetElementClassification</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>}<span class="s">)</span><span class="sc">;</span>
2337 
2338   <span class="k">return</span> <span class="s">(</span><span class="i">$Classification</span> =~ <span class="q">/^Metallic$/i</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2339 <span class="s">}</span>
2340 
2341 <span class="c"># Is it a non carbon or hydrogen atom? (C, H)</span>
<a name="IsNonCarbonOrHydrogen-"></a>2342 <span class="k">sub </span><span class="m">IsNonCarbonOrHydrogen</span> <span class="s">{</span>
2343   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2344 
2345   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>} =~ <span class="q">/^(1|6)$/</span><span class="s">)</span> ? <span class="n">0</span> <span class="co">:</span> <span class="n">1</span><span class="sc">;</span>
2346 <span class="s">}</span>
2347 
2348 <span class="c"># Is it a polar atom? ( N, O,  P, S)</span>
<a name="IsPolarAtom-"></a>2349 <span class="k">sub </span><span class="m">IsPolarAtom</span> <span class="s">{</span>
2350   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2351 
2352   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>} =~ <span class="q">/^(7|8|15|16)$/</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2353 <span class="s">}</span>
2354 
2355 <span class="c"># Is it an isotope?</span>
<a name="IsIsotope-"></a>2356 <span class="k">sub </span><span class="m">IsIsotope</span> <span class="s">{</span>
2357   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2358 
2359   <span class="k">my</span><span class="s">(</span><span class="i">$AtomicNumber</span><span class="s">)</span> = <span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>}<span class="sc">;</span>
2360   <span class="k">if</span> <span class="s">(</span>!<span class="i">$AtomicNumber</span><span class="s">)</span> <span class="s">{</span>
2361     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2362   <span class="s">}</span>
2363 
2364   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;MassNumber&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2365     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2366   <span class="s">}</span>
2367   <span class="k">my</span><span class="s">(</span><span class="i">$MassNumber</span><span class="cm">,</span> <span class="i">$MostAbundantMassNumber</span><span class="s">)</span><span class="sc">;</span>
2368 
2369   <span class="i">$MassNumber</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;MassNumber&#39;</span><span class="s">)</span><span class="sc">;</span>
2370   <span class="i">$MostAbundantMassNumber</span> = <span class="i">PeriodicTable::GetElementMostAbundantNaturalIsotopeMassNumber</span><span class="s">(</span><span class="i">$AtomicNumber</span><span class="s">)</span><span class="sc">;</span>
2371 
2372   <span class="k">return</span> <span class="s">(</span><span class="i">$MassNumber</span> == <span class="i">$MostAbundantMassNumber</span><span class="s">)</span> ? <span class="n">0</span> <span class="co">:</span> <span class="n">1</span><span class="sc">;</span>
2373 <span class="s">}</span>
2374 
2375 <span class="c"># Is it a terminal atom?</span>
<a name="IsTerminal-"></a>2376 <span class="k">sub </span><span class="m">IsTerminal</span> <span class="s">{</span>
2377   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2378 
2379   <span class="c"># Is this atom in a molecule?</span>
2380   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2381     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
2382   <span class="s">}</span>
2383 
2384   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetNumOfNonHydrogenAtomNeighbors</span><span class="s">(</span><span class="s">)</span> &lt;= <span class="n">1</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span>
2385 
2386 <span class="s">}</span>
2387 
2388 <span class="c"># Is aromatic property set for the atom?</span>
<a name="IsAromatic-"></a>2389 <span class="k">sub </span><span class="m">IsAromatic</span> <span class="s">{</span>
2390   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2391   <span class="k">my</span><span class="s">(</span><span class="i">$Aromatic</span><span class="s">)</span><span class="sc">;</span>
2392 
2393   <span class="i">$Aromatic</span> = <span class="i">$This</span><span class="i">-&gt;GetAromatic</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2394 
2395   <span class="k">return</span> <span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$Aromatic</span><span class="s">)</span> &amp;&amp; <span class="i">$Aromatic</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2396 <span class="s">}</span>
2397 
2398 <span class="c"># Is this a hydrogen atom and attached to one of these atoms: N, O, P, S</span>
<a name="IsPolarHydrogen-"></a>2399 <span class="k">sub </span><span class="m">IsPolarHydrogen</span> <span class="s">{</span>
2400   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2401 
2402   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;IsHydrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2403     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2404   <span class="s">}</span>
2405 
2406   <span class="k">my</span><span class="s">(</span><span class="i">@Bonds</span><span class="s">)</span><span class="sc">;</span>
2407   <span class="i">@Bonds</span> = <span class="i">$This</span><span class="i">-&gt;GetBonds</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2408   <span class="k">if</span> <span class="s">(</span><span class="i">@Bonds</span> &gt; <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
2409     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2410   <span class="s">}</span>
2411 
2412   <span class="k">my</span><span class="s">(</span><span class="i">$Bond</span><span class="cm">,</span> <span class="i">$BondedAtom</span><span class="s">)</span><span class="sc">;</span>
2413   <span class="s">(</span><span class="i">$Bond</span><span class="s">)</span> = <span class="i">@Bonds</span><span class="sc">;</span>
2414   <span class="i">$BondedAtom</span> = <span class="i">$Bond</span><span class="i">-&gt;GetBondedAtom</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span><span class="sc">;</span>
2415 
2416   <span class="k">return</span> <span class="i">$BondedAtom</span><span class="i">-&gt;IsPolarAtom</span><span class="s">(</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2417 <span class="s">}</span>
2418 
2419 <span class="c"># Is it a hydrogen bond donor atom?</span>
2420 <span class="c">#</span>
<a name="IsHBondDonor-"></a>2421 <span class="k">sub </span><span class="m">IsHBondDonor</span> <span class="s">{</span>
2422   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$HydrogenBondsType</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2423 
2424   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;IsHydrogenBondDonor</span><span class="s">(</span><span class="i">$HydrogenBondsType</span><span class="s">)</span><span class="sc">;</span>
2425 <span class="s">}</span>
2426 
2427 <span class="c"># The currrent release of MayaChemTools supports identification of two types of</span>
2428 <span class="c"># hydrogen bond donor and acceptor atoms with these names:</span>
2429 <span class="c">#</span>
2430 <span class="c"># HBondsType1 or HydrogenBondsType1</span>
2431 <span class="c"># HBondsType2 or HydrogenBondsType2</span>
2432 <span class="c">#</span>
2433 <span class="c"># The names of these hydrogen bond types are rather arbitrary. However, their</span>
2434 <span class="c"># definitions have specific meaning and are as follows:</span>
2435 <span class="c">#</span>
2436 <span class="c"># HydrogenBondsType1 [ Ref 60-61, Ref 65-66 ]:</span>
2437 <span class="c">#   . Donor: NH, NH2, NH3, OH - Any N and O with available H</span>
2438 <span class="c">#   . Acceptor: N[!H], O - Any N without available H and any O</span>
2439 <span class="c">#</span>
2440 <span class="c"># HydrogenBondsType2 [ Ref 91 ]:</span>
2441 <span class="c">#   . Donor: NH, NH2, NH3, OH - Any N and O with availabe H</span>
2442 <span class="c">#   . Acceptor: N, O - Any N and O</span>
2443 <span class="c">#</span>
2444 <span class="c"># Note:</span>
2445 <span class="c">#   . HydrogenBondsType2 definition corresponds to Rule of 5.</span>
2446 <span class="c">#</span>
2447 
2448 <span class="c"># Is it a hydrogen bond donor atom?</span>
2449 <span class="c">#</span>
2450 <span class="c"># The currrent release of MayaChemTools supports identification of two types of</span>
<a name="IsHydrogenBondDonor-"></a>2451 <span class="k">sub </span><span class="m">IsHydrogenBondDonor</span> <span class="s">{</span>
2452   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$HydrogenBondsType</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2453   <span class="k">my</span><span class="s">(</span><span class="i">$Status</span><span class="s">)</span><span class="sc">;</span>
2454 
2455   <span class="i">$HydrogenBondsType</span> = <span class="k">defined</span> <span class="i">$HydrogenBondsType</span> ? <span class="i">$HydrogenBondsType</span> <span class="co">:</span> <span class="q">&#39;HBondsType1&#39;</span><span class="sc">;</span>
2456   <span class="i">$Status</span> = <span class="n">0</span><span class="sc">;</span>
2457 
2458   <span class="j">HYDROGENBONDSTYPE:</span> <span class="s">{</span>
2459 
2460       <span class="k">if</span> <span class="s">(</span><span class="i">$HydrogenBondsType</span> =~ <span class="q">/^(HBondsType1|HydrogenBondsType1)$/i</span><span class="s">)</span> <span class="s">{</span>
2461         <span class="i">$Status</span> = <span class="i">$This</span><span class="i">-&gt;_IsHydrogenBondDonorOfType1</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2462         <span class="k">last</span> <span class="j">HYDROGENBONDSTYPE</span><span class="sc">;</span>
2463       <span class="s">}</span>
2464 
2465       <span class="k">if</span> <span class="s">(</span><span class="i">$HydrogenBondsType</span> =~ <span class="q">/^(HBondsType2|HydrogenBondsType2)$/i</span><span class="s">)</span> <span class="s">{</span>
2466         <span class="i">$Status</span> = <span class="i">$This</span><span class="i">-&gt;_IsHydrogenBondDonorOfType2</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2467         <span class="k">last</span> <span class="j">HYDROGENBONDSTYPE</span><span class="sc">;</span>
2468       <span class="s">}</span>
2469 
2470       <span class="i">$Status</span> = <span class="n">0</span><span class="sc">;</span>
2471       <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;IsHydrogenBondDonor: The current release of MayaChemTools doesn&#39;t support specified value, $HydrogenBondsType, for HydrogenBondsType. Valid values: HBondsType1, HydrogenBondsType1, HBondsType2 HydrogenBondsType2 ...&quot;</span><span class="sc">;</span>
2472   <span class="s">}</span>
2473 
2474   <span class="k">return</span> <span class="i">$Status</span><span class="sc">;</span>
2475 <span class="s">}</span>
2476 
2477 <span class="c"># Is it a MayaChemTools HBondType1 hydrogen bond donor atom?</span>
2478 <span class="c">#</span>
<a name="_IsHydrogenBondDonorOfType1-"></a>2479 <span class="k">sub </span><span class="m">_IsHydrogenBondDonorOfType1</span> <span class="s">{</span>
2480   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2481 
2482   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsHydrogenBondDonorOfType1OrType2</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2483 <span class="s">}</span>
2484 
2485 <span class="c"># Is it a MayaChemTools HBondType2 hydrogen bond donor atom?</span>
2486 <span class="c">#</span>
<a name="_IsHydrogenBondDonorOfType2-"></a>2487 <span class="k">sub </span><span class="m">_IsHydrogenBondDonorOfType2</span> <span class="s">{</span>
2488   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2489 
2490   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_IsHydrogenBondDonorOfType1OrType2</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2491 <span class="s">}</span>
2492 
2493 <span class="c"># Is it a hydrogen bond donor atom of MayaChemTools Type1 or Type2?</span>
2494 <span class="c">#</span>
2495 <span class="c"># HydrogenBondDonor definition [ Ref 60-61, Ref 65-66, Ref 91 ]: NH, NH2, OH</span>
2496 <span class="c">#</span>
2497 <span class="c"># In other words:</span>
2498 <span class="c">#   . NH, NH2 - Nitrogen atom with available hydrogen</span>
2499 <span class="c">#   . OH - Oxygen atom with avilable hydrogen</span>
2500 <span class="c">#</span>
<a name="_IsHydrogenBondDonorOfType1OrType2-"></a>2501 <span class="k">sub </span><span class="m">_IsHydrogenBondDonorOfType1OrType2</span> <span class="s">{</span>
2502   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2503 
2504   <span class="c"># Is this atom in a molecule?</span>
2505   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2506     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2507   <span class="s">}</span>
2508 
2509   <span class="c"># Is it N or O?</span>
2510   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>} !~ <span class="q">/^(7|8)$/</span><span class="s">)</span> <span class="s">{</span>
2511     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2512   <span class="s">}</span>
2513 
2514   <span class="c"># Any explicitly attached hydrogens?</span>
2515   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetExplicitHydrogens</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2516     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2517   <span class="s">}</span>
2518 
2519   <span class="c"># Any missing hydrogens?</span>
2520   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfMissingHydrogens</span><span class="s">(</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2521 <span class="s">}</span>
2522 
2523 <span class="c"># Is it a hydrogen bond acceptor atom?</span>
2524 <span class="c">#</span>
<a name="IsHBondAcceptor-"></a>2525 <span class="k">sub </span><span class="m">IsHBondAcceptor</span> <span class="s">{</span>
2526   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$HydrogenBondsType</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2527 
2528   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;IsHydrogenBondAcceptor</span><span class="s">(</span><span class="i">$HydrogenBondsType</span><span class="s">)</span><span class="sc">;</span>
2529 <span class="s">}</span>
2530 
2531 <span class="c"># Is it a hydrogen bond acceptor atom?</span>
2532 <span class="c">#</span>
<a name="IsHydrogenBondAcceptor-"></a>2533 <span class="k">sub </span><span class="m">IsHydrogenBondAcceptor</span> <span class="s">{</span>
2534   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$HydrogenBondsType</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2535   <span class="k">my</span><span class="s">(</span><span class="i">$Status</span><span class="s">)</span><span class="sc">;</span>
2536 
2537   <span class="i">$HydrogenBondsType</span> = <span class="k">defined</span> <span class="i">$HydrogenBondsType</span> ? <span class="i">$HydrogenBondsType</span> <span class="co">:</span> <span class="q">&#39;HBondsType1&#39;</span><span class="sc">;</span>
2538   <span class="i">$Status</span> = <span class="n">0</span><span class="sc">;</span>
2539 
2540   <span class="j">HYDROGENBONDSTYPE:</span> <span class="s">{</span>
2541 
2542       <span class="k">if</span> <span class="s">(</span><span class="i">$HydrogenBondsType</span> =~ <span class="q">/^(HBondsType1|HydrogenBondsType1)$/i</span><span class="s">)</span> <span class="s">{</span>
2543         <span class="i">$Status</span> = <span class="i">$This</span><span class="i">-&gt;_IsHydrogenBondAcceptorOfType1</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2544         <span class="k">last</span> <span class="j">HYDROGENBONDSTYPE</span><span class="sc">;</span>
2545       <span class="s">}</span>
2546 
2547       <span class="k">if</span> <span class="s">(</span><span class="i">$HydrogenBondsType</span> =~ <span class="q">/^(HBondsType2|HydrogenBondsType2)$/i</span><span class="s">)</span> <span class="s">{</span>
2548         <span class="i">$Status</span> = <span class="i">$This</span><span class="i">-&gt;_IsHydrogenBondAcceptorOfType2</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2549         <span class="k">last</span> <span class="j">HYDROGENBONDSTYPE</span><span class="sc">;</span>
2550       <span class="s">}</span>
2551 
2552       <span class="i">$Status</span> = <span class="n">0</span><span class="sc">;</span>
2553       <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;IsHydrogenBondAcceptor: The current release of MayaChemTools doesn&#39;t support specified value, $HydrogenBondsType, for HydrogenBondsType. Valid values: HBondsType1, HydrogenBondsType1, HBondsType2 HydrogenBondsType2 ...&quot;</span><span class="sc">;</span>
2554   <span class="s">}</span>
2555 
2556   <span class="k">return</span> <span class="i">$Status</span><span class="sc">;</span>
2557 <span class="s">}</span>
2558 
2559 <span class="c"># Is it a MayaChemTools HBondType1 hydrogen bond acceptor atom?</span>
2560 <span class="c">#</span>
2561 <span class="c"># HydrogenBondAcceptor definition [ Ref 60-61, Ref 65-66 ]: N[!H], O</span>
2562 <span class="c">#</span>
2563 <span class="c"># In other words:</span>
2564 <span class="c">#   . N[!H] - Nitrogen atom with no hydrogen</span>
2565 <span class="c">#   . O - Oxygen atom</span>
2566 <span class="c">#</span>
<a name="_IsHydrogenBondAcceptorOfType1-"></a>2567 <span class="k">sub </span><span class="m">_IsHydrogenBondAcceptorOfType1</span> <span class="s">{</span>
2568   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2569 
2570   <span class="c"># Is this atom in a molecule?</span>
2571   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2572     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2573   <span class="s">}</span>
2574 
2575   <span class="c"># Is it N or O?</span>
2576   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>} !~ <span class="q">/^(7|8)$/</span><span class="s">)</span> <span class="s">{</span>
2577     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2578   <span class="s">}</span>
2579 
2580   <span class="c"># Is it O?</span>
2581   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>} == <span class="n">8</span> <span class="s">)</span> <span class="s">{</span>
2582     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2583   <span class="s">}</span>
2584 
2585   <span class="c"># Any explicitly attached hydrogens?</span>
2586   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetExplicitHydrogens</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2587     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2588   <span class="s">}</span>
2589 
2590   <span class="c"># Any missing hydrogens?</span>
2591   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfMissingHydrogens</span><span class="s">(</span><span class="s">)</span> ? <span class="n">0</span> <span class="co">:</span> <span class="n">1</span><span class="sc">;</span>
2592 <span class="s">}</span>
2593 
2594 <span class="c"># Is it a MayaChemTools HBondType2 hydrogen bond acceptor atom?</span>
2595 <span class="c">#</span>
2596 <span class="c"># HydrogenBondAcceptor definition [ Ref 91 ]: N, O</span>
2597 <span class="c">#</span>
2598 <span class="c"># In other words:</span>
2599 <span class="c">#   . Any Nitrogen or Oxygen atom</span>
2600 <span class="c">#</span>
2601 <span class="c"># Note:</span>
2602 <span class="c">#   . HydrogenBondsType2 definition corresponds to Rule of 5.</span>
2603 <span class="c">#</span>
<a name="_IsHydrogenBondAcceptorOfType2-"></a>2604 <span class="k">sub </span><span class="m">_IsHydrogenBondAcceptorOfType2</span> <span class="s">{</span>
2605   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2606 
2607   <span class="c"># Is this atom in a molecule?</span>
2608   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2609     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2610   <span class="s">}</span>
2611 
2612   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>} =~ <span class="q">/^(7|8)$/</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2613 <span class="s">}</span>
2614 
2615 <span class="c"># Is it a positively ionizable atom?</span>
2616 <span class="c">#</span>
2617 <span class="c"># PositivelyIonizable defintion [ Ref 60-61, Ref 65-66 ]: +, NH2</span>
2618 <span class="c">#</span>
2619 <span class="c"># In other words:</span>
2620 <span class="c">#   . Any atom with positve formal charge</span>
2621 <span class="c">#   . NH2 - Nitogen atom in amino group</span>
2622 <span class="c">#</span>
<a name="IsPositivelyIonizable-"></a>2623 <span class="k">sub </span><span class="m">IsPositivelyIonizable</span> <span class="s">{</span>
2624   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2625   <span class="k">my</span><span class="s">(</span><span class="i">$FormalCharge</span><span class="s">)</span><span class="sc">;</span>
2626 
2627   <span class="c"># Is this atom in a molecule?</span>
2628   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2629     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2630   <span class="s">}</span>
2631 
2632   <span class="c"># Any explicit positive formal charge?</span>
2633   <span class="i">$FormalCharge</span> = <span class="i">$This</span><span class="i">-&gt;GetFormalCharge</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2634   <span class="k">if</span> <span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$FormalCharge</span><span class="s">)</span> &amp;&amp; <span class="i">$FormalCharge</span> &gt; <span class="n">0</span><span class="s">)</span> <span class="s">{</span>
2635     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2636   <span class="s">}</span>
2637 
2638   <span class="c"># Is it  N?</span>
2639   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>} != <span class="n">7</span> <span class="s">)</span> <span class="s">{</span>
2640     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2641   <span class="s">}</span>
2642 
2643   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetNumOfHydrogens</span><span class="s">(</span><span class="s">)</span> == <span class="n">2</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2644 <span class="s">}</span>
2645 
2646 <span class="c"># Is it a negatively ionizable atom?</span>
2647 <span class="c">#</span>
2648 <span class="c"># NegativelyIonizable definition [ Ref 60-61, Ref 65-66 ]: -, C(=O)OH, S(=O)OH, P(=O)OH</span>
2649 <span class="c">#</span>
2650 <span class="c"># In other words:</span>
2651 <span class="c">#   . Any atom with negative formal charge</span>
2652 <span class="c">#   . Carbon atom in C(=O)OH group</span>
2653 <span class="c">#   . Phosphorous in P(=O)OH group</span>
2654 <span class="c">#   . Sulfur atom in S(=O)OH group</span>
2655 <span class="c">#</span>
<a name="IsNegativelyIonizable-"></a>2656 <span class="k">sub </span><span class="m">IsNegativelyIonizable</span> <span class="s">{</span>
2657   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2658   <span class="k">my</span><span class="s">(</span><span class="i">$FormalCharge</span><span class="s">)</span><span class="sc">;</span>
2659 
2660   <span class="c"># Is this atom in a molecule?</span>
2661   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2662     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2663   <span class="s">}</span>
2664 
2665   <span class="c"># Any explicit negative formal charge?</span>
2666   <span class="i">$FormalCharge</span> = <span class="i">$This</span><span class="i">-&gt;GetFormalCharge</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2667   <span class="k">if</span> <span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$FormalCharge</span><span class="s">)</span> &amp;&amp; <span class="i">$FormalCharge</span> &lt; <span class="n">0</span><span class="s">)</span> <span class="s">{</span>
2668     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2669   <span class="s">}</span>
2670 
2671   <span class="c"># Is it C, P or S?</span>
2672   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>} !~ <span class="q">/^(6|15|16)$/</span> <span class="s">)</span> <span class="s">{</span>
2673     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2674   <span class="s">}</span>
2675 
2676   <span class="c"># Collect oxygens connected to C, P or S with single or double bonds and not connected to</span>
2677   <span class="c"># any other heavy atom...</span>
2678   <span class="k">my</span><span class="s">(</span><span class="i">$Neighbor</span><span class="cm">,</span> <span class="i">$NeighborOxygenBondOrder</span><span class="cm">,</span> <span class="i">$NumOfNeighborOxygensWithSingleBonds</span><span class="cm">,</span> <span class="i">$NumOfNeighborOxygensWithDoubleBonds</span><span class="s">)</span><span class="sc">;</span>
2679 
2680   <span class="i">$NumOfNeighborOxygensWithSingleBonds</span> = <span class="n">0</span><span class="sc">;</span> <span class="i">$NumOfNeighborOxygensWithDoubleBonds</span> = <span class="n">0</span><span class="sc">;</span>
2681 
2682   <span class="j">NEIGHBOR:</span> <span class="k">for</span> <span class="i">$Neighbor</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetNeighbors</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2683     <span class="c"># Is it an oxygen?</span>
2684     <span class="k">if</span> <span class="s">(</span><span class="i">$Neighbor</span>-&gt;{<span class="w">AtomicNumber</span>} != <span class="n">8</span><span class="s">)</span> <span class="s">{</span>
2685       <span class="k">next</span> <span class="j">NEIGHBOR</span><span class="sc">;</span>
2686     <span class="s">}</span>
2687     <span class="c"># Is oxygent connected to only heavy atom?</span>
2688     <span class="k">if</span> <span class="s">(</span><span class="i">$Neighbor</span><span class="i">-&gt;GetNumOfHeavyAtomNeighbors</span><span class="s">(</span><span class="s">)</span> != <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
2689       <span class="k">next</span> <span class="j">NEIGHBOR</span><span class="sc">;</span>
2690     <span class="s">}</span>
2691     <span class="i">$NeighborOxygenBondOrder</span> = <span class="i">$This</span><span class="i">-&gt;GetBondToAtom</span><span class="s">(</span><span class="i">$Neighbor</span><span class="s">)</span><span class="i">-&gt;GetBondOrder</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2692 
2693     <span class="k">if</span> <span class="s">(</span><span class="i">$NeighborOxygenBondOrder</span> == <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
2694       <span class="i">$NumOfNeighborOxygensWithDoubleBonds</span>++<span class="sc">;</span>
2695     <span class="s">}</span>
2696     <span class="k">elsif</span> <span class="s">(</span><span class="i">$NeighborOxygenBondOrder</span> == <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
2697       <span class="i">$NumOfNeighborOxygensWithSingleBonds</span>++<span class="sc">;</span>
2698     <span class="s">}</span>
2699   <span class="s">}</span>
2700   <span class="k">return</span> <span class="s">(</span><span class="i">$NumOfNeighborOxygensWithDoubleBonds</span> &gt;= <span class="n">1</span> &amp;&amp; <span class="i">$NumOfNeighborOxygensWithSingleBonds</span> &gt;= <span class="n">1</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2701 <span class="s">}</span>
2702 
2703 <span class="c"># Is it a liphophilic atom?</span>
2704 <span class="c">#</span>
2705 <span class="c"># Lipophilic definition [ Ref 60-61, Ref 65-66 ]: C(C)(C)(C)(C), Cl, Br, I, S(C)(C)</span>
2706 <span class="c">#</span>
2707 <span class="c"># In other words:</span>
2708 <span class="c">#   . C(C)(C)(C)(C) - Carbon atom connected to only other carbons</span>
2709 <span class="c">#   . Chlorine, Bromine or Iodine atom</span>
2710 <span class="c">#   . S(C)(C) - Sulfur connected to two carbons</span>
2711 <span class="c">#</span>
<a name="IsLipophilic-"></a>2712 <span class="k">sub </span><span class="m">IsLipophilic</span> <span class="s">{</span>
2713   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2714 
2715   <span class="c"># Is this atom in a molecule?</span>
2716   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2717     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2718   <span class="s">}</span>
2719 
2720   <span class="c"># Is it Cl, Br, I?</span>
2721   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>} =~ <span class="q">/^(17|35|53)$/</span><span class="s">)</span> <span class="s">{</span>
2722     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2723   <span class="s">}</span>
2724 
2725   <span class="c"># Is it C, S?</span>
2726   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>} !~ <span class="q">/^(6|16)$/</span><span class="s">)</span> <span class="s">{</span>
2727     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2728   <span class="s">}</span>
2729 
2730   <span class="c"># Are all heavy atom neighbors Carbons?</span>
2731   <span class="k">my</span><span class="s">(</span><span class="i">$HeavyAtomNeighbor</span><span class="cm">,</span> <span class="i">@HeavyAtomNeighbors</span><span class="s">)</span><span class="sc">;</span>
2732   <span class="i">@HeavyAtomNeighbors</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2733   <span class="i">@HeavyAtomNeighbors</span> = <span class="i">$This</span><span class="i">-&gt;GetHeavyAtomNeighbors</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2734 
2735   <span class="k">for</span> <span class="i">$HeavyAtomNeighbor</span> <span class="s">(</span><span class="i">@HeavyAtomNeighbors</span><span class="s">)</span> <span class="s">{</span>
2736     <span class="k">if</span> <span class="s">(</span><span class="i">$HeavyAtomNeighbor</span>-&gt;{<span class="w">AtomicNumber</span>} != <span class="n">6</span><span class="s">)</span> <span class="s">{</span>
2737       <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2738     <span class="s">}</span>
2739   <span class="s">}</span>
2740 
2741   <span class="c"># Does sulfur has two carbon neighbors?</span>
2742   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>} == <span class="n">16</span><span class="s">)</span> <span class="s">{</span>
2743     <span class="k">if</span> <span class="s">(</span><span class="i">@HeavyAtomNeighbors</span> != <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
2744       <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2745     <span class="s">}</span>
2746   <span class="s">}</span>
2747   <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2748 <span class="s">}</span>
2749 
2750 <span class="c"># Is it hydrophobic?</span>
2751 <span class="c">#</span>
<a name="IsHydrophobic-"></a>2752 <span class="k">sub </span><span class="m">IsHydrophobic</span> <span class="s">{</span>
2753   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2754 
2755   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;IsLipophilic</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2756 <span class="s">}</span>
2757 
2758 <span class="c"># Is it a Nitrogen atom in Guadinium group?</span>
2759 <span class="c">#</span>
<a name="IsGuadiniumNitrogen-"></a>2760 <span class="k">sub </span><span class="m">IsGuadiniumNitrogen</span> <span class="s">{</span>
2761   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2762 
2763   <span class="c"># Is it Nitrogen?</span>
2764   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;IsNitrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2765     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2766   <span class="s">}</span>
2767 
2768   <span class="c"># Is it connected to a Guadinium Carbon?</span>
2769   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2770 
2771   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetNonHydrogenAtomNeighbors</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2772     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;IsGuadiniumCarbon</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2773       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2774     <span class="s">}</span>
2775   <span class="s">}</span>
2776 
2777   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2778 <span class="s">}</span>
2779 
2780 <span class="c"># Is it a Carbon atom in Guadinium group?</span>
2781 <span class="c">#</span>
2782 <span class="c"># Guadinium group definition:</span>
2783 <span class="c">#</span>
2784 <span class="c">#   R2N-C(=NR)-(NR2) or R2N-C(=NR2+)-(NR2)</span>
2785 <span class="c">#</span>
2786 <span class="c">#   where:</span>
2787 <span class="c">#      . R = Hydrogens or group of atoms attached through Carbon</span>
2788 <span class="c">#      . Only one of the three Nitrogens has a double bond to Carbon and has optional</span>
2789 <span class="c">#        formal charge allowing it to be neutral or charged state</span>
2790 <span class="c">#</span>
<a name="IsGuadiniumCarbon-"></a>2791 <span class="k">sub </span><span class="m">IsGuadiniumCarbon</span> <span class="s">{</span>
2792   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2793 
2794   <span class="c"># Is it Carbon?</span>
2795   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;IsCarbon</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2796     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2797   <span class="s">}</span>
2798 
2799   <span class="c"># Match atom neighborhood...</span>
2800   <span class="k">my</span><span class="s">(</span><span class="i">$CentralAtomSpec</span><span class="cm">,</span> <span class="i">@NbrAtomSpecsRef</span><span class="cm">,</span> <span class="i">@NbrBondSpecsRef</span><span class="cm">,</span> <span class="i">@NbrOfNbrAtomSpecsRef</span><span class="s">)</span><span class="sc">;</span>
2801 
2802   <span class="i">$CentralAtomSpec</span> = <span class="q">&#39;C.X3.BO4&#39;</span><span class="sc">;</span>
2803   <span class="i">@NbrAtomSpecsRef</span> = <span class="s">(</span><span class="q">&#39;N.FC0&#39;</span><span class="cm">,</span> <span class="q">&#39;N.FC0&#39;</span><span class="cm">,</span> <span class="q">&#39;N.FC0,N.FC+1&#39;</span><span class="s">)</span><span class="sc">;</span>
2804   <span class="i">@NbrBondSpecsRef</span> = <span class="s">(</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="s">)</span><span class="sc">;</span>
2805   <span class="i">@NbrOfNbrAtomSpecsRef</span> = <span class="s">(</span><span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H&#39;</span><span class="s">)</span><span class="sc">;</span>
2806 
2807   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="i">$CentralAtomSpec</span><span class="cm">,</span> \<span class="i">@NbrAtomSpecsRef</span><span class="cm">,</span> \<span class="i">@NbrBondSpecsRef</span><span class="cm">,</span> \<span class="i">@NbrOfNbrAtomSpecsRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2808     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2809   <span class="s">}</span>
2810 
2811   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2812 <span class="s">}</span>
2813 
2814 <span class="c"># Is it a Nitrogen atom in Amide group?</span>
2815 <span class="c">#</span>
<a name="IsAmideNitrogen-"></a>2816 <span class="k">sub </span><span class="m">IsAmideNitrogen</span> <span class="s">{</span>
2817   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2818 
2819   <span class="c"># Is it Nitrogen?</span>
2820   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;IsNitrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2821     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2822   <span class="s">}</span>
2823 
2824   <span class="c"># Is it connected to a Amide Carbon?</span>
2825   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2826 
2827   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetNonHydrogenAtomNeighbors</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2828     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;IsAmideCarbon</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2829       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2830     <span class="s">}</span>
2831   <span class="s">}</span>
2832 
2833   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2834 <span class="s">}</span>
2835 
2836 <span class="c"># Is it a Carbon atom in Amide group?</span>
2837 <span class="c">#</span>
2838 <span class="c"># Amide group definition: R-C(=O)-N(-R&#39;)-R&#39;&#39;</span>
2839 <span class="c">#</span>
2840 <span class="c">#   where:</span>
2841 <span class="c">#      . R = Hydrogen or groups of atoms attached through Carbon</span>
2842 <span class="c">#      . R&#39; = Hydrogens or groups of atoms attached through Carbon or hetro atoms</span>
2843 <span class="c">#      . R&#39;&#39; = Hydrogens or groups of atoms attached through Carbon or hetro atoms</span>
2844 <span class="c">#</span>
<a name="IsAmideCarbon-"></a>2845 <span class="k">sub </span><span class="m">IsAmideCarbon</span> <span class="s">{</span>
2846   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2847 
2848   <span class="c"># Is this atom in a molecule?</span>
2849   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2850     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2851   <span class="s">}</span>
2852 
2853   <span class="c"># Is it Carbon?</span>
2854   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;IsCarbon</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2855     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2856   <span class="s">}</span>
2857 
2858   <span class="c"># Match atom neighborhood...</span>
2859   <span class="k">my</span><span class="s">(</span><span class="i">$CentralAtomSpec</span><span class="cm">,</span> <span class="i">@NbrAtomSpecsRef</span><span class="cm">,</span> <span class="i">@NbrBondSpecsRef</span><span class="cm">,</span> <span class="i">@NbrOfNbrAtomSpecsRef</span><span class="s">)</span><span class="sc">;</span>
2860 
2861   <span class="i">$CentralAtomSpec</span> = <span class="q">&#39;C.X3.BO4,C.X2.BO3&#39;</span><span class="sc">;</span>
2862   <span class="i">@NbrAtomSpecsRef</span> = <span class="s">(</span><span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;N&#39;</span><span class="s">)</span><span class="sc">;</span>
2863   <span class="i">@NbrBondSpecsRef</span> = <span class="s">(</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">)</span><span class="sc">;</span>
2864   <span class="i">@NbrOfNbrAtomSpecsRef</span> = <span class="s">(</span><span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;C,H,N,O,S,P,F,Cl,Br,I&#39;</span><span class="s">)</span><span class="sc">;</span>
2865 
2866   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="i">$CentralAtomSpec</span><span class="cm">,</span> \<span class="i">@NbrAtomSpecsRef</span><span class="cm">,</span> \<span class="i">@NbrBondSpecsRef</span><span class="cm">,</span> \<span class="i">@NbrOfNbrAtomSpecsRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2867     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2868   <span class="s">}</span>
2869 
2870   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2871 <span class="s">}</span>
2872 
2873 <span class="c"># Is it a Oxygen atom in Carboxylate group?</span>
2874 <span class="c">#</span>
<a name="IsCarboxylateOxygen-"></a>2875 <span class="k">sub </span><span class="m">IsCarboxylateOxygen</span> <span class="s">{</span>
2876   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2877 
2878   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_MatchCarboxylateAndOrCarboxylOxygen</span><span class="s">(</span><span class="q">&#39;Carboxylate&#39;</span><span class="s">)</span><span class="sc">;</span>
2879 <span class="s">}</span>
2880 
2881 <span class="c"># Is it a Carbon atom in Carboxylate group?</span>
2882 <span class="c">#</span>
2883 <span class="c"># Carboxyl group definition: R-C(=O)-O-</span>
2884 <span class="c">#</span>
<a name="IsCarboxylateCarbon-"></a>2885 <span class="k">sub </span><span class="m">IsCarboxylateCarbon</span> <span class="s">{</span>
2886   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2887 
2888   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_MatchCarboxylateAndOrCarboxylCarbon</span><span class="s">(</span><span class="q">&#39;Carboxylate&#39;</span><span class="s">)</span><span class="sc">;</span>
2889 <span class="s">}</span>
2890 
2891 <span class="c"># Is it a Oxygen atom in Carboxyl group?</span>
2892 <span class="c">#</span>
<a name="IsCarboxylOxygen-"></a>2893 <span class="k">sub </span><span class="m">IsCarboxylOxygen</span> <span class="s">{</span>
2894   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2895 
2896   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_MatchCarboxylateAndOrCarboxylOxygen</span><span class="s">(</span><span class="q">&#39;Carboxyl&#39;</span><span class="s">)</span><span class="sc">;</span>
2897 <span class="s">}</span>
2898 
2899 <span class="c"># Is it a Carbon atom in Carboxyl group?</span>
2900 <span class="c">#</span>
2901 <span class="c"># Carboxyl group definition: R-C(=O)-OH</span>
2902 <span class="c">#</span>
<a name="IsCarboxylCarbon-"></a>2903 <span class="k">sub </span><span class="m">IsCarboxylCarbon</span> <span class="s">{</span>
2904   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2905 
2906   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_MatchCarboxylateAndOrCarboxylCarbon</span><span class="s">(</span><span class="q">&#39;Carboxyl&#39;</span><span class="s">)</span><span class="sc">;</span>
2907 <span class="s">}</span>
2908 
2909 <span class="c"># Match Carboxylate and/or Carboxyl oxygen...</span>
2910 <span class="c">#</span>
<a name="_MatchCarboxylateAndOrCarboxylOxygen-"></a>2911 <span class="k">sub </span><span class="m">_MatchCarboxylateAndOrCarboxylOxygen</span> <span class="s">{</span>
2912   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Mode</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2913 
2914   <span class="c"># Is it Oxygen?</span>
2915   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;IsOxygen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2916     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2917   <span class="s">}</span>
2918 
2919   <span class="c"># Is it connected to a Carboxylate Carbon?</span>
2920   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2921 
2922   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetNonHydrogenAtomNeighbors</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2923     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;_MatchCarboxylateAndOrCarboxylCarbon</span><span class="s">(</span><span class="i">$Mode</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2924       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2925     <span class="s">}</span>
2926   <span class="s">}</span>
2927 
2928   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2929 <span class="s">}</span>
2930 
2931 <span class="c"># Match Carboxylate and Carboxyl Carbon</span>
2932 <span class="c">#</span>
2933 <span class="c"># Carboxylate group definition: R-C(=O)-O-</span>
2934 <span class="c"># Carboxyl group definition: R-C(=O)-OH</span>
2935 <span class="c">#</span>
2936 <span class="c">#   where:</span>
2937 <span class="c">#      . R = Hydrogens or groups of atoms attached through Carbon</span>
2938 <span class="c">#</span>
<a name="_MatchCarboxylateAndOrCarboxylCarbon-"></a>2939 <span class="k">sub </span><span class="m">_MatchCarboxylateAndOrCarboxylCarbon</span> <span class="s">{</span>
2940   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Mode</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2941 
2942   <span class="c"># Is this atom in a molecule?</span>
2943   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2944     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2945   <span class="s">}</span>
2946 
2947   <span class="c"># Is it Carbon?</span>
2948   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;IsCarbon</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2949     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2950   <span class="s">}</span>
2951 
2952   <span class="c"># Match atom neighborhood...</span>
2953   <span class="k">my</span><span class="s">(</span><span class="i">$CentralAtomSpec</span><span class="cm">,</span> <span class="i">@NbrAtomSpecsRef</span><span class="cm">,</span> <span class="i">@NbrBondSpecsRef</span><span class="cm">,</span> <span class="i">@NbrOfNbrAtomSpecsRef</span><span class="s">)</span><span class="sc">;</span>
2954 
2955   <span class="i">$CentralAtomSpec</span> = <span class="q">&#39;C.X3.BO4,C.X2.BO3&#39;</span><span class="sc">;</span>
2956   <span class="j">MODE:</span> <span class="s">{</span>
2957     <span class="k">if</span> <span class="s">(</span><span class="i">$Mode</span> =~ <span class="q">/^Carboxylate$/i</span><span class="s">)</span> <span class="s">{</span>
2958       <span class="i">@NbrAtomSpecsRef</span> = <span class="s">(</span><span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O.X1.FC-1&#39;</span><span class="s">)</span><span class="sc">;</span>
2959       <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span>
2960     <span class="s">}</span>
2961     <span class="k">if</span> <span class="s">(</span><span class="i">$Mode</span> =~ <span class="q">/^Carboxyl$/i</span><span class="s">)</span> <span class="s">{</span>
2962       <span class="i">@NbrAtomSpecsRef</span> = <span class="s">(</span><span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O.X1.FC0&#39;</span><span class="s">)</span><span class="sc">;</span>
2963       <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span>
2964     <span class="s">}</span>
2965     <span class="k">if</span> <span class="s">(</span><span class="i">$Mode</span> =~ <span class="q">/^CarboxylateOrCarboxyl$/i</span><span class="s">)</span> <span class="s">{</span>
2966       <span class="i">@NbrAtomSpecsRef</span> = <span class="s">(</span><span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O.X1.FC-1,O.X1.FC0&#39;</span><span class="s">)</span><span class="sc">;</span>
2967       <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span>
2968     <span class="s">}</span>
2969     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_MatchCarboxylateAndCarboxylCarbon.: Unknown mode $Mode...&quot;</span><span class="sc">;</span>
2970     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2971   <span class="s">}</span>
2972   <span class="i">@NbrBondSpecsRef</span> = <span class="s">(</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">)</span><span class="sc">;</span>
2973   <span class="i">@NbrOfNbrAtomSpecsRef</span> = <span class="s">(</span><span class="q">&#39;C,H&#39;</span><span class="cm">,</span> <span class="q">&#39;C&#39;</span><span class="cm">,</span> <span class="q">&#39;C&#39;</span><span class="s">)</span><span class="sc">;</span>
2974 
2975   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="i">$CentralAtomSpec</span><span class="cm">,</span> \<span class="i">@NbrAtomSpecsRef</span><span class="cm">,</span> \<span class="i">@NbrBondSpecsRef</span><span class="cm">,</span> \<span class="i">@NbrOfNbrAtomSpecsRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2976     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2977   <span class="s">}</span>
2978 
2979   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2980 <span class="s">}</span>
2981 
2982 <span class="c"># Is it a Oxygen atom in Phosphate group?</span>
2983 <span class="c">#</span>
<a name="IsPhosphateOxygen-"></a>2984 <span class="k">sub </span><span class="m">IsPhosphateOxygen</span> <span class="s">{</span>
2985   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2986 
2987   <span class="c"># Is it Oxygen?</span>
2988   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;IsOxygen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2989     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2990   <span class="s">}</span>
2991 
2992   <span class="c"># Is it connected to a Phosphate Phosphorus?</span>
2993   <span class="k">my</span><span class="s">(</span><span class="i">$AtomNeighbor</span><span class="s">)</span><span class="sc">;</span>
2994 
2995   <span class="k">for</span> <span class="i">$AtomNeighbor</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetNonHydrogenAtomNeighbors</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2996     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomNeighbor</span><span class="i">-&gt;IsPhosphatePhosphorus</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2997       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2998     <span class="s">}</span>
2999   <span class="s">}</span>
3000 
3001   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3002 <span class="s">}</span>
3003 
3004 <span class="c"># Is it a Phosphorus atom in Phosphate group?</span>
3005 <span class="c">#</span>
3006 <span class="c"># Phosphate group definition: AO-(O=)P(-OA)-OA</span>
3007 <span class="c">#</span>
3008 <span class="c">#   where:</span>
3009 <span class="c">#      . A = Any Groups of atoms including hydrogens</span>
3010 <span class="c">#</span>
<a name="IsPhosphatePhosphorus-"></a>3011 <span class="k">sub </span><span class="m">IsPhosphatePhosphorus</span> <span class="s">{</span>
3012   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3013 
3014   <span class="c"># Is this atom in a molecule?</span>
3015   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3016     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3017   <span class="s">}</span>
3018 
3019   <span class="c"># Is it Phosphorus?</span>
3020   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;IsPhosphorus</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3021     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3022   <span class="s">}</span>
3023 
3024   <span class="c"># Match atom neighborhood...</span>
3025   <span class="k">my</span><span class="s">(</span><span class="i">$CentralAtomSpec</span><span class="cm">,</span> <span class="i">@NbrAtomSpecsRef</span><span class="cm">,</span> <span class="i">@NbrBondSpecsRef</span><span class="cm">,</span> <span class="i">@NbrOfNbrAtomSpecsRef</span><span class="s">)</span><span class="sc">;</span>
3026 
3027   <span class="i">$CentralAtomSpec</span> = <span class="q">&#39;P.X4.BO5&#39;</span><span class="sc">;</span>
3028   <span class="i">@NbrAtomSpecsRef</span> = <span class="s">(</span><span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="cm">,</span> <span class="q">&#39;O&#39;</span><span class="s">)</span><span class="sc">;</span>
3029   <span class="i">@NbrBondSpecsRef</span> = <span class="s">(</span><span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">)</span><span class="sc">;</span>
3030   <span class="i">@NbrOfNbrAtomSpecsRef</span> = <span class="s">(</span><span class="k">undef</span><span class="cm">,</span> <span class="k">undef</span><span class="cm">,</span> <span class="k">undef</span><span class="cm">,</span> <span class="k">undef</span><span class="s">)</span><span class="sc">;</span>
3031 
3032   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="i">$CentralAtomSpec</span><span class="cm">,</span> \<span class="i">@NbrAtomSpecsRef</span><span class="cm">,</span> \<span class="i">@NbrBondSpecsRef</span><span class="cm">,</span> \<span class="i">@NbrOfNbrAtomSpecsRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3033     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3034   <span class="s">}</span>
3035 
3036   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3037 <span class="s">}</span>
3038 
3039 
3040 <span class="c"># Match central atom and its neighborhood using specified atom and bonds specifications...</span>
3041 <span class="c">#</span>
3042 <span class="c"># Let:</span>
3043 <span class="c">#   AS = Atom symbol corresponding to element symbol, atomic number (#n) or any</span>
3044 <span class="c">#        atom (A)</span>
3045 <span class="c">#</span>
3046 <span class="c">#   X&lt;n&gt;   = Number of non-hydrogen atom neighbors or heavy atoms attached to atom</span>
3047 <span class="c">#   T&lt;n&gt;   = Total number of atom neighbors including implcit and explicit hydrogens</span>
3048 <span class="c">#   BO&lt;n&gt; = Sum of bond orders to non-hydrogen atom neighbors or heavy atoms attached to atom</span>
3049 <span class="c">#   LBO&lt;n&gt; = Largest bond order of non-hydrogen atom neighbors or heavy atoms attached to atom</span>
3050 <span class="c">#   SB&lt;n&gt; = Number of single bonds to non-hydrogen atom neighbors or heavy atoms attached to atom</span>
3051 <span class="c">#   TSB&lt;n&gt; = Total number of single bonds to atom neighbors including implcit and explicit hydrogens</span>
3052 <span class="c">#   DB&lt;n&gt; = Number of double bonds to non-hydrogen atom neighbors or heavy atoms attached to atom</span>
3053 <span class="c">#   TB&lt;n&gt; = Number of triple bonds to non-hydrogen atom neighbors or heavy atoms attached to atom</span>
3054 <span class="c">#   H&lt;n&gt;   = Number of implicit and explicit hydrogens for atom</span>
3055 <span class="c">#   Ar     = Aromatic annotation indicating whether atom is aromatic</span>
3056 <span class="c">#   RA or RA&lt;n&gt;  = Ring atom annotation indicating whether atom is a ring</span>
3057 <span class="c">#   TR&lt;n&gt;  = Total number of rings containing atom</span>
3058 <span class="c">#   FC&lt;+n/-n&gt; = Formal charge assigned to atom</span>
3059 <span class="c">#   MN&lt;n&gt; = Mass number indicating isotope other than most abundant isotope</span>
3060 <span class="c">#   SM&lt;n&gt; = Spin multiplicity of atom. Possible values: 1 (singlet), 2 (doublet) or 3 (triplet)</span>
3061 <span class="c">#</span>
3062 <span class="c"># Then:</span>
3063 <span class="c">#</span>
3064 <span class="c">#   Atom specification corresponds to:</span>
3065 <span class="c">#</span>
3066 <span class="c">#     AS.X&lt;n&gt;.T&lt;n&gt;.BO&lt;n&gt;.LBO&lt;n&gt;.&lt;SB&gt;&lt;n&gt;.TSB&lt;n&gt;.&lt;DB&gt;&lt;n&gt;.&lt;TB&gt;&lt;n&gt;.H&lt;n&gt;.Ar.RA&lt;n&gt;.TR&lt;n&gt;FC&lt;+n/-n&gt;.MN&lt;n&gt;.SM&lt;n&gt;</span>
3067 <span class="c">#</span>
3068 <span class="c"># Except for AS which is a required atomic invariant in atom specification, all other atomic invariants are</span>
3069 <span class="c"># optional. For an atom specification to match an atom, the values of all specified atomic invariants must</span>
3070 <span class="c"># match. Exclamation in from of atomic invariant can be used to negate its effect during the match.</span>
3071 <span class="c">#</span>
3072 <span class="c"># A comma delimited atom specification string is used to match any one of the specifed atom specification.</span>
3073 <span class="c">#</span>
3074 <span class="c"># Notes:</span>
3075 <span class="c">#   . During atom specification match to an atom, the first atomic invariant is always assumed to</span>
3076 <span class="c">#     atom symbol.</span>
3077 <span class="c">#   . Atom match specfication is based on AtomicInvariantAtomTypes implemented in</span>
3078 <span class="c">#     AotmTypes::AtomicInvariantAtomType.pm module</span>
3079 <span class="c">#</span>
3080 <span class="c"># Examples:</span>
3081 <span class="c">#     . (&#39;N&#39;, &#39;N&#39;, &#39;N&#39;)</span>
3082 <span class="c">#     . (&#39;N.FC0&#39;, &#39;N.FC0&#39;, &#39;N,N.FC+1.H1&#39;)</span>
3083 <span class="c">#     . (&#39;N.H2&#39;, &#39;N.H2&#39;, &#39;N.H1&#39;)</span>
3084 <span class="c">#     . (&#39;C,N&#39;, &#39;!N&#39;, &#39;!H&#39;)</span>
3085 <span class="c">#     . (&#39;C,N&#39;, &#39;N.Ar&#39;, &#39;N.R5&#39;)</span>
3086 <span class="c">#</span>
3087 <span class="c"># Let:</span>
3088 <span class="c">#   -|1|s|Single = Single bond</span>
3089 <span class="c">#   =|2|d|Double = Double bond</span>
3090 <span class="c">#   #|3|t|Triple  = Triple bond</span>
3091 <span class="c">#   :|1.5|a|Ar|Aromatic = Aromatic bond</span>
3092 <span class="c">#</span>
3093 <span class="c">#   @|RB|Ring = Ring bond</span>
3094 <span class="c">#   ~|*|Any = Any bond</span>
3095 <span class="c">#</span>
3096 <span class="c"># Then:</span>
3097 <span class="c">#</span>
3098 <span class="c">#   Bond specification corresponds to:</span>
3099 <span class="c">#</span>
3100 <span class="c">#     -.:</span>
3101 <span class="c">#     =.@</span>
3102 <span class="c">#     Double.Aromatic</span>
3103 <span class="c">#</span>
3104 <span class="c"># For a bond specification to match bond between two atoms, the values of all specified bond symbols must</span>
3105 <span class="c"># match. Exclamation in from of bond symbol can be used to negate its effect during the match.</span>
3106 <span class="c">#</span>
3107 <span class="c"># A comma delimited bond specification string is used to match any one of the specifed atom specification.</span>
3108 <span class="c">#</span>
<a name="DoesAtomNeighborhoodMatch-"></a>3109 <span class="k">sub </span><span class="m">DoesAtomNeighborhoodMatch</span> <span class="s">{</span>
3110   <span class="k">my</span><span class="s">(</span><span class="i">$CentralAtom</span><span class="cm">,</span> <span class="i">$CentralAtomSpec</span><span class="cm">,</span> <span class="i">$NbrAtomSpecsRef</span><span class="cm">,</span> <span class="i">$NbrBondSpecsRef</span><span class="cm">,</span> <span class="i">$NbrOfNbrAtomSpecsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3111   <span class="k">my</span><span class="s">(</span><span class="i">$NumOfNbrAtomSpecs</span><span class="cm">,</span> <span class="i">$NumOfNbrBondSpecs</span><span class="cm">,</span> <span class="i">$NumOfNbrOfNbrAtomSpecs</span><span class="s">)</span><span class="sc">;</span>
3112 
3113   <span class="c"># Is this atom in a molecule?</span>
3114   <span class="k">if</span> <span class="s">(</span>!<span class="i">$CentralAtom</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3115     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3116   <span class="s">}</span>
3117 
3118   <span class="i">$NumOfNbrAtomSpecs</span> = <span class="k">defined</span> <span class="i">$NbrAtomSpecsRef</span> ? <span class="k">scalar</span> <span class="i">@</span>{<span class="i">$NbrAtomSpecsRef</span>} <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3119   <span class="i">$NumOfNbrBondSpecs</span> = <span class="k">defined</span> <span class="i">$NbrBondSpecsRef</span> ? <span class="k">scalar</span> <span class="i">@</span>{<span class="i">$NbrBondSpecsRef</span>} <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3120   <span class="i">$NumOfNbrOfNbrAtomSpecs</span> = <span class="k">defined</span> <span class="i">$NbrOfNbrAtomSpecsRef</span> ? <span class="k">scalar</span> <span class="i">@</span>{<span class="i">$NbrOfNbrAtomSpecsRef</span>} <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3121 
3122   <span class="c"># Validate number of specifications...</span>
3123   <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfNbrBondSpecs</span> &amp;&amp; <span class="s">(</span><span class="i">$NumOfNbrAtomSpecs</span> != <span class="i">$NumOfNbrBondSpecs</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3124     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;DoesAtomNeighborhoodMatch: Number of specified central atom, $NumOfNbrAtomSpecs, and bond, $NumOfNbrBondSpecs, specifications must be same; No neighborhood match performed ...&quot;</span><span class="sc">;</span>
3125     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3126   <span class="s">}</span>
3127 
3128   <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfNbrOfNbrAtomSpecs</span> &amp;&amp; <span class="s">(</span><span class="i">$NumOfNbrOfNbrAtomSpecs</span> != <span class="i">$NumOfNbrAtomSpecs</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3129     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;DoesAtomNeighborhoodMatch: Number of specified central atom, $NumOfNbrAtomSpecs, and neighbor of neighbor atoms specifications, $NumOfNbrOfNbrAtomSpecs, must be same; No neighborhood match performed ...&quot;</span><span class="sc">;</span>
3130     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3131   <span class="s">}</span>
3132 
3133   <span class="c"># Sort atom and bond specifications in terms of being most specific to least specific..</span>
3134   <span class="s">(</span><span class="i">$NbrAtomSpecsRef</span><span class="cm">,</span> <span class="i">$NbrBondSpecsRef</span><span class="cm">,</span> <span class="i">$NbrOfNbrAtomSpecsRef</span><span class="s">)</span> = <span class="i">$CentralAtom</span><span class="i">-&gt;_SortSpecificationsForAtomNeighborhoodMatch</span><span class="s">(</span><span class="i">$NbrAtomSpecsRef</span><span class="cm">,</span> <span class="i">$NbrBondSpecsRef</span><span class="cm">,</span> <span class="i">$NbrOfNbrAtomSpecsRef</span><span class="s">)</span><span class="sc">;</span>
3135 
3136   <span class="c"># Does central atom specification match?</span>
3137   <span class="k">if</span> <span class="s">(</span>!<span class="i">$CentralAtom</span><span class="i">-&gt;_DoesAtomSpecificationMatch</span><span class="s">(</span><span class="i">$CentralAtomSpec</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3138     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3139   <span class="s">}</span>
3140 
3141   <span class="c"># No neighbors to match...</span>
3142   <span class="k">if</span> <span class="s">(</span>!<span class="i">$NumOfNbrAtomSpecs</span><span class="s">)</span> <span class="s">{</span>
3143     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3144   <span class="s">}</span>
3145 
3146   <span class="c"># Match neighbors...</span>
3147   <span class="k">my</span><span class="s">(</span><span class="i">$NbrSpecsMatched</span><span class="cm">,</span> <span class="i">$NbrSpecCount</span><span class="cm">,</span> <span class="i">$NbrSpecMatchCount</span><span class="cm">,</span> <span class="i">%NbrSpecAlreadyMatchedMap</span><span class="s">)</span><span class="sc">;</span>
3148 
3149   <span class="i">$NbrSpecCount</span> = <span class="i">$NumOfNbrAtomSpecs</span><span class="sc">;</span>
3150   <span class="i">$NbrSpecMatchCount</span> = <span class="n">0</span><span class="sc">;</span>
3151 
3152   <span class="i">%NbrSpecAlreadyMatchedMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3153   <span class="s">(</span><span class="i">$NbrSpecsMatched</span><span class="cm">,</span> <span class="i">$NbrSpecMatchCount</span><span class="s">)</span> = <span class="i">$CentralAtom</span><span class="i">-&gt;_MatchAtomNeighborhoodUsingAtomBondSpecs</span><span class="s">(</span><span class="i">$NbrSpecCount</span><span class="cm">,</span> <span class="i">$NbrSpecMatchCount</span><span class="cm">,</span> \<span class="i">%NbrSpecAlreadyMatchedMap</span><span class="cm">,</span> <span class="i">$NbrAtomSpecsRef</span><span class="cm">,</span> <span class="i">$NbrBondSpecsRef</span><span class="cm">,</span> <span class="i">$NbrOfNbrAtomSpecsRef</span><span class="s">)</span><span class="sc">;</span>
3154 
3155   <span class="k">if</span> <span class="s">(</span><span class="i">$NbrSpecsMatched</span><span class="s">)</span> <span class="s">{</span>
3156     <span class="c"># It&#39;s match...</span>
3157     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3158   <span class="s">}</span>
3159 
3160   <span class="c"># Match central atom&#39;s missing hydrogens with any unmatched atom</span>
3161   <span class="c"># and bond specifications...</span>
3162   <span class="c">#</span>
3163   <span class="s">(</span><span class="i">$NbrSpecsMatched</span><span class="cm">,</span> <span class="i">$NbrSpecMatchCount</span><span class="s">)</span> = <span class="i">$CentralAtom</span><span class="i">-&gt;_MatchAtomNeighborhoodUsingMissingHydrogens</span><span class="s">(</span><span class="i">$NbrSpecCount</span><span class="cm">,</span> <span class="i">$NbrSpecMatchCount</span><span class="cm">,</span> \<span class="i">%NbrSpecAlreadyMatchedMap</span><span class="cm">,</span> <span class="i">$NbrAtomSpecsRef</span><span class="cm">,</span> <span class="i">$NbrBondSpecsRef</span><span class="cm">,</span> <span class="i">$NbrOfNbrAtomSpecsRef</span><span class="s">)</span><span class="sc">;</span>
3164 
3165   <span class="k">if</span> <span class="s">(</span><span class="i">$NbrSpecsMatched</span><span class="s">)</span> <span class="s">{</span>
3166     <span class="c"># It&#39;s match...</span>
3167     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3168   <span class="s">}</span>
3169 
3170   <span class="c"># No match...</span>
3171   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3172 <span class="s">}</span>
3173 
3174 <span class="c"># Match central atom neighborhood atom and bond specifications...</span>
3175 <span class="c">#</span>
<a name="_MatchAtomNeighborhoodUsingAtomBondSpecs-"></a>3176 <span class="k">sub </span><span class="m">_MatchAtomNeighborhoodUsingAtomBondSpecs</span> <span class="s">{</span>
3177   <span class="k">my</span><span class="s">(</span><span class="i">$CentralAtom</span><span class="cm">,</span> <span class="i">$NbrSpecCount</span><span class="cm">,</span> <span class="i">$NbrSpecMatchCount</span><span class="cm">,</span> <span class="i">$NbrSpecAlreadyMatchedRef</span><span class="cm">,</span> <span class="i">$NbrAtomSpecsRef</span><span class="cm">,</span> <span class="i">$NbrBondSpecsRef</span><span class="cm">,</span> <span class="i">$NbrOfNbrAtomSpecsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3178   <span class="k">my</span><span class="s">(</span><span class="i">$Index</span><span class="cm">,</span> <span class="i">$NbrAtom</span><span class="cm">,</span> <span class="i">$NbrAtomSpec</span><span class="cm">,</span> <span class="i">$NbrBondSpec</span><span class="cm">,</span> <span class="i">$NbrOfNbrAtom</span><span class="cm">,</span> <span class="i">$NbrOfNbrAtomSpec</span><span class="cm">,</span> <span class="i">$MatchNbrOfNbrAtomSpecs</span><span class="cm">,</span> <span class="i">$NbrSpecsMatched</span><span class="s">)</span><span class="sc">;</span>
3179 
3180   <span class="i">$MatchNbrOfNbrAtomSpecs</span> = <span class="s">(</span><span class="k">defined</span> <span class="i">$NbrOfNbrAtomSpecsRef</span> &amp;&amp; <span class="k">scalar</span> <span class="i">@</span>{<span class="i">$NbrOfNbrAtomSpecsRef</span>}<span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3181 
3182   <span class="i">$NbrSpecsMatched</span> = <span class="n">0</span><span class="sc">;</span>
3183 
3184   <span class="c"># Match central atom&#39;s  immediate neighbors atom and bond specifications...</span>
3185   <span class="j">NBRATOM:</span>  <span class="k">for</span> <span class="i">$NbrAtom</span> <span class="s">(</span><span class="i">$CentralAtom</span><span class="i">-&gt;GetNeighbors</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3186     <span class="j">NBRATOMSPEC:</span> <span class="k">for</span> <span class="i">$Index</span> <span class="s">(</span><span class="n">0</span> .. <span class="s">(</span><span class="i">$NbrSpecCount</span> - <span class="n">1</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3187       <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$NbrSpecAlreadyMatchedRef</span>-&gt;{<span class="i">$Index</span>}<span class="s">)</span> <span class="s">{</span>
3188         <span class="k">next</span> <span class="j">NBRATOMSPEC</span><span class="sc">;</span>
3189       <span class="s">}</span>
3190       <span class="i">$NbrAtomSpec</span> = <span class="i">$NbrAtomSpecsRef</span>-&gt;[<span class="i">$Index</span>]<span class="sc">;</span>
3191       <span class="i">$NbrBondSpec</span> = <span class="i">$NbrBondSpecsRef</span>-&gt;[<span class="i">$Index</span>]<span class="sc">;</span>
3192 
3193       <span class="i">$NbrOfNbrAtomSpec</span> = <span class="i">$MatchNbrOfNbrAtomSpecs</span> ? <span class="i">$NbrOfNbrAtomSpecsRef</span>-&gt;[<span class="i">$Index</span>] <span class="co">:</span> <span class="k">undef</span><span class="sc">;</span>
3194 
3195       <span class="c"># Match neighbor atom specification...</span>
3196       <span class="k">if</span> <span class="s">(</span>!<span class="i">$NbrAtom</span><span class="i">-&gt;_DoesAtomSpecificationMatch</span><span class="s">(</span><span class="i">$NbrAtomSpec</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3197         <span class="k">next</span> <span class="j">NBRATOMSPEC</span><span class="sc">;</span>
3198       <span class="s">}</span>
3199 
3200       <span class="c"># Match central atom to neighbor atom bond specification...</span>
3201       <span class="k">if</span> <span class="s">(</span>!<span class="i">$CentralAtom</span><span class="i">-&gt;_DoesBondSpecificationMatch</span><span class="s">(</span><span class="i">$NbrAtom</span><span class="cm">,</span> <span class="i">$NbrBondSpec</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3202         <span class="k">next</span> <span class="j">NBRATOMSPEC</span><span class="sc">;</span>
3203       <span class="s">}</span>
3204 
3205       <span class="c"># Match any neighbor of neighbor atom specifications...</span>
3206       <span class="k">if</span> <span class="s">(</span><span class="k">defined</span> <span class="i">$NbrOfNbrAtomSpec</span><span class="s">)</span> <span class="s">{</span>
3207         <span class="c"># Go over the neighbors of central atom skipping the central atom...</span>
3208         <span class="k">for</span> <span class="i">$NbrOfNbrAtom</span> <span class="s">(</span><span class="i">$NbrAtom</span><span class="i">-&gt;GetNeighbors</span><span class="s">(</span><span class="i">$CentralAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3209           <span class="k">if</span> <span class="s">(</span>!<span class="i">$NbrOfNbrAtom</span><span class="i">-&gt;_DoesAtomSpecificationMatch</span><span class="s">(</span><span class="i">$NbrOfNbrAtomSpec</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3210             <span class="k">next</span> <span class="j">NBRATOMSPEC</span><span class="sc">;</span>
3211           <span class="s">}</span>
3212         <span class="s">}</span>
3213       <span class="s">}</span>
3214 
3215       <span class="c"># It&#39;s a match for a neighbor atom specification...</span>
3216       <span class="i">$NbrSpecAlreadyMatchedRef</span>-&gt;{<span class="i">$Index</span>} = <span class="i">$Index</span><span class="sc">;</span>
3217       <span class="i">$NbrSpecMatchCount</span>++<span class="sc">;</span>
3218 
3219       <span class="k">if</span> <span class="s">(</span><span class="i">$NbrSpecMatchCount</span> == <span class="i">$NbrSpecCount</span><span class="s">)</span> <span class="s">{</span>
3220         <span class="c"># It&#39;s match...</span>
3221         <span class="i">$NbrSpecsMatched</span> = <span class="n">1</span><span class="sc">;</span>
3222         <span class="k">last</span> <span class="j">NBRATOM</span><span class="sc">;</span>
3223       <span class="s">}</span>
3224       <span class="c"># Match next neighbor atom...</span>
3225       <span class="k">next</span> <span class="j">NBRATOM</span><span class="sc">;</span>
3226     <span class="s">}</span>
3227   <span class="s">}</span>
3228   <span class="k">return</span> <span class="s">(</span><span class="i">$NbrSpecsMatched</span><span class="cm">,</span> <span class="i">$NbrSpecMatchCount</span><span class="s">)</span><span class="sc">;</span>
3229 <span class="s">}</span>
3230 
3231 <span class="c"># Match central atom&#39;s missing hydrogens with any unmatched atom and bond</span>
3232 <span class="c"># specifications...</span>
3233 <span class="c">#</span>
<a name="_MatchAtomNeighborhoodUsingMissingHydrogens-"></a>3234 <span class="k">sub </span><span class="m">_MatchAtomNeighborhoodUsingMissingHydrogens</span> <span class="s">{</span>
3235   <span class="k">my</span><span class="s">(</span><span class="i">$CentralAtom</span><span class="cm">,</span> <span class="i">$NbrSpecCount</span><span class="cm">,</span> <span class="i">$NbrSpecMatchCount</span><span class="cm">,</span> <span class="i">$NbrSpecAlreadyMatchedRef</span><span class="cm">,</span> <span class="i">$NbrAtomSpecsRef</span><span class="cm">,</span> <span class="i">$NbrBondSpecsRef</span><span class="cm">,</span> <span class="i">$NbrOfNbrAtomSpecsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3236   <span class="k">my</span><span class="s">(</span><span class="i">$Index</span><span class="cm">,</span> <span class="i">$NbrAtom</span><span class="cm">,</span> <span class="i">$NbrAtomSpec</span><span class="cm">,</span> <span class="i">$NbrBondSpec</span><span class="cm">,</span> <span class="i">$NumOfMissingHydrogens</span><span class="cm">,</span> <span class="i">$MissingHydrogensIndex</span><span class="cm">,</span> <span class="i">$NbrSpecsMatched</span><span class="cm">,</span> <span class="i">$AtomSpecMatched</span><span class="cm">,</span> <span class="i">$AtomSpec</span><span class="cm">,</span> <span class="i">$AtomSymbol</span><span class="s">)</span><span class="sc">;</span>
3237 
3238   <span class="i">$NbrSpecsMatched</span> = <span class="n">0</span><span class="sc">;</span>
3239 
3240   <span class="i">$NumOfMissingHydrogens</span> = <span class="i">$CentralAtom</span><span class="i">-&gt;GetNumOfMissingHydrogens</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3241   <span class="k">if</span> <span class="s">(</span><span class="s">(</span><span class="i">$NbrSpecCount</span> - <span class="i">$NbrSpecMatchCount</span><span class="s">)</span> &gt; <span class="i">$NumOfMissingHydrogens</span><span class="s">)</span> <span class="s">{</span>
3242     <span class="c"># It won&#39;t match...</span>
3243     <span class="k">return</span> <span class="s">(</span><span class="i">$NbrSpecsMatched</span><span class="cm">,</span> <span class="i">$NbrSpecMatchCount</span><span class="s">)</span><span class="sc">;</span>
3244   <span class="s">}</span>
3245 
3246   <span class="j">MISSINGHYDROGENNBR:</span> <span class="k">for</span> <span class="i">$MissingHydrogensIndex</span> <span class="s">(</span><span class="n">0</span> .. <span class="s">(</span><span class="i">$NumOfMissingHydrogens</span> - <span class="n">1</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3247     <span class="j">NBRATOMSPEC:</span> <span class="k">for</span> <span class="i">$Index</span> <span class="s">(</span><span class="n">0</span> .. <span class="s">(</span><span class="i">$NbrSpecCount</span> - <span class="n">1</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3248       <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$NbrSpecAlreadyMatchedRef</span>-&gt;{<span class="i">$Index</span>}<span class="s">)</span> <span class="s">{</span>
3249         <span class="k">next</span> <span class="j">NBRATOMSPEC</span><span class="sc">;</span>
3250       <span class="s">}</span>
3251       <span class="i">$NbrAtomSpec</span> = <span class="i">$NbrAtomSpecsRef</span>-&gt;[<span class="i">$Index</span>]<span class="sc">;</span>
3252       <span class="i">$NbrBondSpec</span> = <span class="i">$NbrBondSpecsRef</span>-&gt;[<span class="i">$Index</span>]<span class="sc">;</span>
3253 
3254       <span class="i">$NbrAtomSpec</span> =~ <span class="q">s/ //g</span><span class="sc">;</span>
3255 
3256       <span class="c"># Match neighbor atom specification hydrogen atom symbol...</span>
3257       <span class="i">$AtomSpecMatched</span> = <span class="n">0</span><span class="sc">;</span>
3258       <span class="j">ATOMSPEC:</span> <span class="k">for</span> <span class="i">$AtomSpec</span> <span class="s">(</span><span class="k">split</span> <span class="q">/\,/</span><span class="cm">,</span> <span class="i">$NbrAtomSpec</span><span class="s">)</span> <span class="s">{</span>
3259         <span class="s">(</span><span class="i">$AtomSymbol</span><span class="s">)</span> = <span class="k">split</span> <span class="q">/\./</span><span class="cm">,</span> <span class="i">$AtomSpec</span><span class="sc">;</span>
3260         <span class="k">if</span> <span class="s">(</span><span class="i">$AtomSymbol</span> =~ <span class="q">/^(H|A|\*)$/i</span><span class="s">)</span> <span class="s">{</span>
3261           <span class="i">$AtomSpecMatched</span> = <span class="n">1</span><span class="sc">;</span>
3262           <span class="k">last</span> <span class="j">ATOMSPEC</span><span class="sc">;</span>
3263         <span class="s">}</span>
3264       <span class="s">}</span>
3265       <span class="k">if</span> <span class="s">(</span>!<span class="i">$AtomSpecMatched</span><span class="s">)</span> <span class="s">{</span>
3266         <span class="k">next</span> <span class="j">NBRATOMSPEC</span><span class="sc">;</span>
3267       <span class="s">}</span>
3268 
3269       <span class="c"># Match neighbor atom bond specification to singal bond...</span>
3270       <span class="k">if</span> <span class="s">(</span><span class="k">defined</span> <span class="i">$NbrBondSpec</span><span class="s">)</span> <span class="s">{</span>
3271         <span class="i">$NbrBondSpec</span> =~ <span class="q">s/ //g</span><span class="sc">;</span>
3272         <span class="k">if</span> <span class="s">(</span><span class="i">$NbrBondSpec</span> !~ <span class="q">/^(-|1|s|Single|\~|\*|Any)/i</span><span class="s">)</span> <span class="s">{</span>
3273           <span class="k">next</span> <span class="j">NBRATOMSPEC</span><span class="sc">;</span>
3274         <span class="s">}</span>
3275       <span class="s">}</span>
3276 
3277       <span class="c"># It&#39;s a match for a neighbor atom specification...</span>
3278       <span class="i">$NbrSpecAlreadyMatchedRef</span>-&gt;{<span class="i">$Index</span>} = <span class="i">$Index</span><span class="sc">;</span>
3279       <span class="i">$NbrSpecMatchCount</span>++<span class="sc">;</span>
3280 
3281       <span class="k">if</span> <span class="s">(</span><span class="i">$NbrSpecMatchCount</span> == <span class="i">$NbrSpecCount</span><span class="s">)</span> <span class="s">{</span>
3282         <span class="c"># It&#39;s match...</span>
3283         <span class="i">$NbrSpecsMatched</span> = <span class="n">1</span><span class="sc">;</span>
3284         <span class="k">last</span> <span class="j">MISSINGHYDROGENNBR</span><span class="sc">;</span>
3285       <span class="s">}</span>
3286       <span class="c"># Match next missing hydrogen neighbor...</span>
3287       <span class="k">next</span> <span class="j">MISSINGHYDROGENNBR</span><span class="sc">;</span>
3288     <span class="s">}</span>
3289   <span class="s">}</span>
3290 
3291   <span class="k">return</span> <span class="s">(</span><span class="i">$NbrSpecsMatched</span><span class="cm">,</span> <span class="i">$NbrSpecMatchCount</span><span class="s">)</span><span class="sc">;</span>
3292 <span class="s">}</span>
3293 
3294 <span class="c"># Sort atom and bond specifications base on neighbor atom specifications going</span>
3295 <span class="c"># from most to least specific atom specifications.</span>
3296 <span class="c">#</span>
3297 <span class="c"># Atom specifications are sorted at the following two levels:</span>
3298 <span class="c">#</span>
3299 <span class="c">#   o By atom specification count with in each specification going from most specific</span>
3300 <span class="c">#      to least specific, where count is determined by the number of &quot;,&quot; in each</span>
3301 <span class="c">#      specification. Wild card containing specifications are considered least specific</span>
3302 <span class="c">#      and end up at the end of the sorted list.</span>
3303 <span class="c">#   o By atomic invariant count with in each sorted list going from most specific to</span>
3304 <span class="c">#      least specific, where count is determined by the number of &quot;.&quot; in each atom</span>
3305 <span class="c">#      specification.</span>
3306 <span class="c">#</span>
3307 <span class="c">#A single atom specification,</span>
3308 <span class="c"># without any commas in atom specification, is is considered most specific...</span>
3309 <span class="c">#</span>
<a name="_SortSpecificationsForAtomNeighborhoodMatch-"></a>3310 <span class="k">sub </span><span class="m">_SortSpecificationsForAtomNeighborhoodMatch</span> <span class="s">{</span>
3311   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NbrAtomSpecsRef</span><span class="cm">,</span> <span class="i">$NbrBondSpecsRef</span><span class="cm">,</span> <span class="i">$NbrOfNbrAtomSpecsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3312   <span class="k">my</span><span class="s">(</span><span class="i">$Index</span><span class="cm">,</span> <span class="i">$NeedToSort</span><span class="cm">,</span> <span class="i">$NumOfNbrAtomSpecs</span><span class="cm">,</span> <span class="i">$NbrAtomSpecCount</span><span class="cm">,</span>  <span class="i">$NbrAtomSpecAtomicInvarintCount</span><span class="cm">,</span> <span class="i">$NbrAtomSpecToMatch</span><span class="cm">,</span> <span class="i">$NbrAtomSpec</span><span class="cm">,</span> <span class="i">$FirstAtomicInvariant</span><span class="cm">,</span> <span class="i">$WildCardInNbrAtomSpec</span><span class="cm">,</span> <span class="i">@NbrAtomSpecs</span><span class="cm">,</span> <span class="i">@NbrAtomSpecAtomicInvariants</span><span class="cm">,</span> <span class="i">@SortedNbrAtomSpecs</span><span class="cm">,</span> <span class="i">@SortedNbrBondSpecs</span><span class="cm">,</span> <span class="i">@SortedNbrOfNbrAtomSpecs</span><span class="cm">,</span> <span class="i">%NbrAtomSpecDataMap</span><span class="s">)</span><span class="sc">;</span>
3313 
3314   <span class="i">$NumOfNbrAtomSpecs</span> = <span class="k">defined</span> <span class="i">$NbrAtomSpecsRef</span> ? <span class="k">scalar</span> <span class="i">@</span>{<span class="i">$NbrAtomSpecsRef</span>} <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3315 
3316   <span class="c"># Figure out whether sorting is necessary...</span>
3317   <span class="i">$NeedToSort</span> = <span class="n">0</span><span class="sc">;</span>
3318   <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfNbrAtomSpecs</span> &gt; <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
3319     <span class="j">ATOMSPEC:</span> <span class="k">for</span> <span class="i">$NbrAtomSpecToMatch</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$NbrAtomSpecsRef</span>}<span class="s">)</span> <span class="s">{</span>
3320       <span class="k">if</span> <span class="s">(</span><span class="i">$NbrAtomSpecToMatch</span> =~ <span class="q">/(,|\.|A|\*)/i</span><span class="s">)</span> <span class="s">{</span>
3321         <span class="i">$NeedToSort</span> = <span class="n">1</span><span class="sc">;</span>
3322         <span class="k">last</span> <span class="j">ATOMSPEC</span><span class="sc">;</span>
3323       <span class="s">}</span>
3324     <span class="s">}</span>
3325   <span class="s">}</span>
3326   <span class="k">if</span> <span class="s">(</span>!<span class="i">$NeedToSort</span><span class="s">)</span> <span class="s">{</span>
3327     <span class="c"># Nothing to do...</span>
3328     <span class="k">return</span> <span class="s">(</span><span class="i">$NbrAtomSpecsRef</span><span class="cm">,</span> <span class="i">$NbrBondSpecsRef</span><span class="cm">,</span> <span class="i">$NbrOfNbrAtomSpecsRef</span><span class="s">)</span><span class="sc">;</span>
3329   <span class="s">}</span>
3330 
3331   <span class="i">%NbrAtomSpecDataMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3332 
3333   <span class="k">for</span> <span class="i">$Index</span> <span class="s">(</span><span class="n">0</span> .. <span class="s">(</span><span class="i">$NumOfNbrAtomSpecs</span> - <span class="n">1</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3334     <span class="i">$NbrAtomSpecToMatch</span> = <span class="i">$NbrAtomSpecsRef</span>-&gt;[<span class="i">$Index</span>]<span class="sc">;</span>
3335     <span class="i">$NbrAtomSpecToMatch</span> =~ <span class="q">s/ //g</span><span class="sc">;</span>
3336 
3337     <span class="i">@NbrAtomSpecs</span> = <span class="k">split</span> <span class="q">/\,/</span><span class="cm">,</span> <span class="i">$NbrAtomSpecToMatch</span><span class="sc">;</span>
3338     <span class="i">$NbrAtomSpecCount</span> = <span class="k">scalar</span> <span class="i">@NbrAtomSpecs</span><span class="sc">;</span>
3339 
3340     <span class="c"># Does neighbor specification contains a wild card in atom symbol specification?</span>
3341     <span class="c">#</span>
3342     <span class="k">if</span> <span class="s">(</span><span class="i">$NbrAtomSpecToMatch</span> =~ <span class="q">/(A|\*)/i</span><span class="s">)</span> <span class="s">{</span>
3343       <span class="i">$WildCardInNbrAtomSpec</span> = <span class="n">0</span><span class="sc">;</span>
3344       <span class="j">NBRATOMSPEC:</span> <span class="k">for</span> <span class="i">$NbrAtomSpec</span> <span class="s">(</span><span class="i">@NbrAtomSpecs</span><span class="s">)</span> <span class="s">{</span>
3345         <span class="s">(</span><span class="i">$FirstAtomicInvariant</span><span class="s">)</span> = <span class="k">split</span> <span class="q">/\./</span><span class="cm">,</span> <span class="i">$NbrAtomSpec</span><span class="sc">;</span>
3346         <span class="k">if</span> <span class="s">(</span><span class="i">$FirstAtomicInvariant</span> =~ <span class="q">/^!/</span><span class="s">)</span> <span class="s">{</span>
3347           <span class="i">$FirstAtomicInvariant</span> =~ <span class="q">s/^!//</span><span class="sc">;</span>
3348         <span class="s">}</span>
3349         <span class="i">$WildCardInNbrAtomSpec</span> = <span class="i">$This</span><span class="i">-&gt;_IsWildCardAtomSymbolAtomicInvariant</span><span class="s">(</span><span class="i">$FirstAtomicInvariant</span><span class="s">)</span><span class="sc">;</span>
3350         <span class="k">if</span> <span class="s">(</span><span class="i">$WildCardInNbrAtomSpec</span><span class="s">)</span> <span class="s">{</span>
3351           <span class="k">last</span> <span class="j">NBRATOMSPEC</span><span class="sc">;</span>
3352         <span class="s">}</span>
3353       <span class="s">}</span>
3354       <span class="k">if</span> <span class="s">(</span><span class="i">$WildCardInNbrAtomSpec</span><span class="s">)</span> <span class="s">{</span>
3355         <span class="c"># Set NbrAtomSpecCount arbitrarily high to make the spec containing wild</span>
3356         <span class="c"># card last on the sorted list while maintaining its original order in the list...</span>
3357         <span class="i">$NbrAtomSpecCount</span> = <span class="n">999</span><span class="sc">;</span>
3358       <span class="s">}</span>
3359     <span class="s">}</span>
3360 
3361     <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$NbrAtomSpecDataMap</span>{<span class="i">$NbrAtomSpecCount</span>}<span class="s">)</span> <span class="s">{</span>
3362       <span class="i">%</span>{<span class="i">$NbrAtomSpecDataMap</span>{<span class="i">$NbrAtomSpecCount</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3363     <span class="s">}</span>
3364 
3365     <span class="c"># Use first NbrAtomSpec available in @NbrAtomSpecs to determine atomic invariant count</span>
3366     <span class="c"># with in each NbrAtomSpecToMatch, as @NbrAtomSpecs derived from $NbrAtomSpecToMatch</span>
3367     <span class="c"># simply corresponds to a list of possible matches...</span>
3368     <span class="c">#</span>
3369     <span class="s">(</span><span class="i">$NbrAtomSpec</span><span class="s">)</span> = <span class="i">@NbrAtomSpecs</span><span class="sc">;</span>
3370     <span class="i">@NbrAtomSpecAtomicInvariants</span> = <span class="k">split</span> <span class="q">/\./</span><span class="cm">,</span> <span class="i">$NbrAtomSpec</span><span class="sc">;</span>
3371     <span class="i">$NbrAtomSpecAtomicInvarintCount</span> = <span class="k">scalar</span> <span class="i">@NbrAtomSpecAtomicInvariants</span><span class="sc">;</span>
3372 
3373     <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$NbrAtomSpecDataMap</span>{<span class="i">$NbrAtomSpecCount</span>}{<span class="i">$NbrAtomSpecAtomicInvarintCount</span>}<span class="s">)</span> <span class="s">{</span>
3374       <span class="i">@</span>{<span class="i">$NbrAtomSpecDataMap</span>{<span class="i">$NbrAtomSpecCount</span>}{<span class="i">$NbrAtomSpecAtomicInvarintCount</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3375     <span class="s">}</span>
3376     <span class="k">push</span> <span class="i">@</span>{<span class="i">$NbrAtomSpecDataMap</span>{<span class="i">$NbrAtomSpecCount</span>}{<span class="i">$NbrAtomSpecAtomicInvarintCount</span>}}<span class="cm">,</span> <span class="i">$Index</span><span class="sc">;</span>
3377 
3378   <span class="s">}</span>
3379 
3380   <span class="i">@SortedNbrAtomSpecs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span> <span class="i">@SortedNbrBondSpecs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3381   <span class="i">@SortedNbrOfNbrAtomSpecs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3382 
3383   <span class="k">for</span> <span class="i">$NbrAtomSpecCount</span> <span class="s">(</span> <span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> &lt;=&gt; <span class="i">$b</span> <span class="s">}</span> <span class="k">keys</span> <span class="i">%NbrAtomSpecDataMap</span><span class="s">)</span> <span class="s">{</span>
3384     <span class="k">for</span> <span class="i">$NbrAtomSpecAtomicInvarintCount</span> <span class="s">(</span> <span class="k">sort</span> <span class="s">{</span> <span class="i">$b</span> &lt;=&gt; <span class="i">$a</span> <span class="s">}</span> <span class="k">keys</span> <span class="i">%</span>{<span class="i">$NbrAtomSpecDataMap</span>{<span class="i">$NbrAtomSpecCount</span>}}<span class="s">)</span> <span class="s">{</span>
3385       <span class="k">for</span> <span class="i">$Index</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$NbrAtomSpecDataMap</span>{<span class="i">$NbrAtomSpecCount</span>}{<span class="i">$NbrAtomSpecAtomicInvarintCount</span>}}<span class="s">)</span> <span class="s">{</span>
3386         <span class="k">push</span> <span class="i">@SortedNbrAtomSpecs</span><span class="cm">,</span> <span class="i">$NbrAtomSpecsRef</span>-&gt;[<span class="i">$Index</span>]<span class="sc">;</span>
3387         <span class="k">if</span> <span class="s">(</span><span class="k">defined</span> <span class="i">$NbrBondSpecsRef</span><span class="s">)</span> <span class="s">{</span>
3388           <span class="k">push</span> <span class="i">@SortedNbrBondSpecs</span><span class="cm">,</span> <span class="i">$NbrBondSpecsRef</span>-&gt;[<span class="i">$Index</span>]<span class="sc">;</span>
3389         <span class="s">}</span>
3390         <span class="k">if</span> <span class="s">(</span><span class="k">defined</span> <span class="i">$NbrOfNbrAtomSpecsRef</span><span class="s">)</span> <span class="s">{</span>
3391           <span class="k">push</span> <span class="i">@SortedNbrOfNbrAtomSpecs</span><span class="cm">,</span> <span class="i">$NbrOfNbrAtomSpecsRef</span>-&gt;[<span class="i">$Index</span>]<span class="sc">;</span>
3392         <span class="s">}</span>
3393       <span class="s">}</span>
3394     <span class="s">}</span>
3395   <span class="s">}</span>
3396 
3397   <span class="k">return</span> <span class="s">(</span>\<span class="i">@SortedNbrAtomSpecs</span><span class="cm">,</span> <span class="k">defined</span> <span class="i">$NbrBondSpecsRef</span> ? \<span class="i">@SortedNbrBondSpecs</span> <span class="co">:</span> <span class="k">undef</span><span class="cm">,</span> <span class="k">defined</span> <span class="i">$NbrOfNbrAtomSpecsRef</span> ? \<span class="i">@SortedNbrOfNbrAtomSpecs</span> <span class="co">:</span> <span class="k">undef</span><span class="s">)</span><span class="sc">;</span>
3398 <span class="s">}</span>
3399 
3400 <span class="c"># Check whether atom matches supported atom specification...</span>
3401 <span class="c">#</span>
<a name="_DoesAtomSpecificationMatch-"></a>3402 <span class="k">sub </span><span class="m">_DoesAtomSpecificationMatch</span> <span class="s">{</span>
3403   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$AtomSpecificationToMatch</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3404   <span class="k">my</span><span class="s">(</span><span class="i">$AtomSpecification</span><span class="cm">,</span> <span class="i">$AtomicInvariant</span><span class="cm">,</span> <span class="i">$AtomSpecificationMatched</span><span class="cm">,</span> <span class="i">$AtomicInvariantMatched</span><span class="cm">,</span> <span class="i">$FirstMatch</span><span class="s">)</span><span class="sc">;</span>
3405 
3406   <span class="c"># Anything to match...</span>
3407   <span class="k">if</span> <span class="s">(</span>!<span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$AtomSpecificationToMatch</span><span class="s">)</span> &amp;&amp; <span class="i">$AtomSpecificationToMatch</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3408     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3409   <span class="s">}</span>
3410 
3411   <span class="c"># Take out any spaces...</span>
3412   <span class="i">$AtomSpecificationToMatch</span> =~ <span class="q">s/ //g</span><span class="sc">;</span>
3413 
3414   <span class="c"># Match specified atom specifications. For multiple atom specifications in a comma delimited string,</span>
3415   <span class="c"># only one atom specification needs to match for a successful match. It&#39;s up to the caller to make</span>
3416   <span class="c"># sure that the specificaton list is ordered from least to most specific atom specification...</span>
3417   <span class="c">#</span>
3418   <span class="k">for</span> <span class="i">$AtomSpecification</span> <span class="s">(</span><span class="k">split</span> <span class="q">/\,/</span><span class="cm">,</span> <span class="i">$AtomSpecificationToMatch</span><span class="s">)</span> <span class="s">{</span>
3419     <span class="i">$AtomSpecificationMatched</span> = <span class="n">1</span><span class="sc">;</span>
3420     <span class="i">$FirstMatch</span> = <span class="n">1</span><span class="sc">;</span>
3421 
3422     <span class="c"># Match all atom symbol atomic invariants...</span>
3423     <span class="j">ATOMICINVARIANT:</span> <span class="k">for</span> <span class="i">$AtomicInvariant</span> <span class="s">(</span><span class="k">split</span> <span class="q">/\./</span><span class="cm">,</span> <span class="i">$AtomSpecification</span><span class="s">)</span> <span class="s">{</span>
3424       <span class="k">if</span> <span class="s">(</span><span class="i">$FirstMatch</span><span class="s">)</span> <span class="s">{</span>
3425         <span class="c"># Match atom symbol atomic invariant...</span>
3426         <span class="i">$FirstMatch</span> = <span class="n">0</span><span class="sc">;</span>
3427         <span class="i">$AtomicInvariantMatched</span> = <span class="i">$This</span><span class="i">-&gt;_MatchAtomSymbolAtomicInvariant</span><span class="s">(</span><span class="i">$AtomicInvariant</span><span class="s">)</span><span class="sc">;</span>
3428       <span class="s">}</span>
3429       <span class="k">else</span> <span class="s">{</span>
3430         <span class="c"># Match non atom symbol atomic invariant...</span>
3431         <span class="i">$AtomicInvariantMatched</span> = <span class="i">$This</span><span class="i">-&gt;_MatchNonAtomSymbolAtomicInvariant</span><span class="s">(</span><span class="i">$AtomicInvariant</span><span class="s">)</span><span class="sc">;</span>
3432       <span class="s">}</span>
3433 
3434       <span class="k">if</span> <span class="s">(</span>!<span class="i">$AtomicInvariantMatched</span><span class="s">)</span> <span class="s">{</span>
3435         <span class="c"># No need to match other atomic invariants...</span>
3436         <span class="i">$AtomSpecificationMatched</span> = <span class="n">0</span><span class="sc">;</span>
3437         <span class="k">last</span> <span class="j">ATOMICINVARIANT</span><span class="sc">;</span>
3438       <span class="s">}</span>
3439     <span class="s">}</span>
3440 
3441     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomSpecificationMatched</span><span class="s">)</span> <span class="s">{</span>
3442       <span class="c"># No need to match other atom specifications...</span>
3443       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3444     <span class="s">}</span>
3445   <span class="s">}</span>
3446 
3447   <span class="c"># Nothing matched...</span>
3448   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3449 <span class="s">}</span>
3450 
3451 <span class="c"># Check whether atom matches atom symbol atomic invariant...</span>
3452 <span class="c">#</span>
<a name="_MatchAtomSymbolAtomicInvariant-"></a>3453 <span class="k">sub </span><span class="m">_MatchAtomSymbolAtomicInvariant</span> <span class="s">{</span>
3454   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$AtomicInvariant</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3455   <span class="k">my</span><span class="s">(</span><span class="i">$NegateMatch</span><span class="cm">,</span> <span class="i">$Status</span><span class="cm">,</span> <span class="i">$AtomicNumber</span><span class="s">)</span><span class="sc">;</span>
3456 
3457   <span class="i">$Status</span> = <span class="n">0</span><span class="sc">;</span>
3458   <span class="i">$NegateMatch</span> = <span class="n">0</span><span class="sc">;</span>
3459 
3460   <span class="c"># Does match needs to be negated?</span>
3461   <span class="k">if</span> <span class="s">(</span><span class="i">$AtomicInvariant</span> =~ <span class="q">/^!/</span><span class="s">)</span> <span class="s">{</span>
3462     <span class="i">$NegateMatch</span> = <span class="n">1</span><span class="sc">;</span>
3463     <span class="i">$AtomicInvariant</span> =~ <span class="q">s/^!//</span><span class="sc">;</span>
3464   <span class="s">}</span>
3465 
3466   <span class="j">ATOMICINVARIANT:</span> <span class="s">{</span>
3467     <span class="c"># Any atom match...</span>
3468     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsWildCardAtomSymbolAtomicInvariant</span><span class="s">(</span><span class="i">$AtomicInvariant</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3469       <span class="i">$Status</span> = <span class="n">1</span><span class="sc">;</span>
3470       <span class="k">last</span> <span class="j">ATOMICINVARIANT</span><span class="sc">;</span>
3471     <span class="s">}</span>
3472 
3473     <span class="c"># Atomic number match...</span>
3474     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomicInvariant</span> =~ <span class="q">/^#/</span><span class="s">)</span> <span class="s">{</span>
3475       <span class="i">$AtomicNumber</span> = <span class="i">$AtomicInvariant</span><span class="sc">;</span> <span class="i">$AtomicNumber</span> =~ <span class="q">s/^#//</span><span class="sc">;</span>
3476       <span class="i">$Status</span> = <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomicNumber</span>} == <span class="i">$AtomicNumber</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3477       <span class="k">last</span> <span class="j">ATOMICINVARIANT</span><span class="sc">;</span>
3478     <span class="s">}</span>
3479 
3480     <span class="c"># Atom symbol match...</span>
3481     <span class="i">$Status</span> = <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomSymbol</span>} =~ <span class="q">/^$AtomicInvariant$/i</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3482   <span class="s">}</span>
3483 
3484   <span class="k">if</span> <span class="s">(</span><span class="i">$NegateMatch</span><span class="s">)</span> <span class="s">{</span>
3485     <span class="i">$Status</span> = <span class="i">$Status</span> ? <span class="n">0</span> <span class="co">:</span> <span class="n">1</span><span class="sc">;</span>
3486   <span class="s">}</span>
3487 
3488   <span class="k">return</span> <span class="i">$Status</span><span class="sc">;</span>
3489 <span class="s">}</span>
3490 
3491 <span class="c"># Is it a wild card atom symbol atomic invariant?</span>
3492 <span class="c">#</span>
<a name="_IsWildCardAtomSymbolAtomicInvariant-"></a>3493 <span class="k">sub </span><span class="m">_IsWildCardAtomSymbolAtomicInvariant</span> <span class="s">{</span>
3494   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$AtomicInvariant</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3495 
3496   <span class="k">return</span> <span class="s">(</span><span class="i">$AtomicInvariant</span> =~ <span class="q">/^(A|\*)$/i</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3497 <span class="s">}</span>
3498 
3499 <span class="c"># Check whether atom matches non atom symbol atomic invariants...</span>
3500 <span class="c">#</span>
<a name="_MatchNonAtomSymbolAtomicInvariant-"></a>3501 <span class="k">sub </span><span class="m">_MatchNonAtomSymbolAtomicInvariant</span> <span class="s">{</span>
3502   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$AtomicInvariant</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3503   <span class="k">my</span><span class="s">(</span><span class="i">$NegateMatch</span><span class="cm">,</span> <span class="i">$Status</span><span class="cm">,</span> <span class="i">$Name</span><span class="cm">,</span> <span class="i">$Value</span><span class="cm">,</span> <span class="i">$UnknownName</span><span class="s">)</span><span class="sc">;</span>
3504 
3505   <span class="s">(</span><span class="i">$Status</span><span class="cm">,</span> <span class="i">$NegateMatch</span><span class="cm">,</span> <span class="i">$UnknownName</span><span class="s">)</span> = <span class="s">(</span><span class="q">&#39;0&#39;</span><span class="s">)</span> x <span class="n">3</span><span class="sc">;</span>
3506 
3507   <span class="c"># Does match needs to be negated?</span>
3508   <span class="k">if</span> <span class="s">(</span><span class="i">$AtomicInvariant</span> =~ <span class="q">/^!/</span><span class="s">)</span> <span class="s">{</span>
3509     <span class="i">$NegateMatch</span> = <span class="n">1</span><span class="sc">;</span>
3510     <span class="i">$AtomicInvariant</span> =~ <span class="q">s/^!//</span><span class="sc">;</span>
3511   <span class="s">}</span>
3512 
3513   <span class="c"># Extract atomic invariant name and any value...</span>
3514   <span class="k">if</span> <span class="s">(</span><span class="i">$AtomicInvariant</span> =~ <span class="q">/[0-9\*]+/</span><span class="s">)</span> <span class="s">{</span>
3515     <span class="s">(</span><span class="i">$Name</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="i">$AtomicInvariant</span> =~ <span class="q">/^([a-zA-Z]+)([0-9\-\+\*\&gt;\&lt;\=]+)$/</span><span class="sc">;</span>
3516   <span class="s">}</span>
3517   <span class="k">else</span> <span class="s">{</span>
3518     <span class="s">(</span><span class="i">$Name</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="s">(</span><span class="i">$AtomicInvariant</span><span class="cm">,</span> <span class="k">undef</span><span class="s">)</span><span class="sc">;</span>
3519   <span class="s">}</span>
3520 
3521   <span class="j">NAME:</span> <span class="s">{</span>
3522     <span class="c"># Match number of non-hydrogen atom neighbors</span>
3523     <span class="k">if</span> <span class="s">(</span><span class="i">$Name</span> =~ <span class="q">/^X$/i</span><span class="s">)</span> <span class="s">{</span>
3524       <span class="i">$Status</span> = <span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span> &amp;&amp; <span class="i">$This</span><span class="i">-&gt;GetNumOfNonHydrogenAtomNeighbors</span><span class="s">(</span><span class="s">)</span> == <span class="i">$Value</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3525       <span class="k">last</span> <span class="j">NAME</span><span class="sc">;</span>
3526     <span class="s">}</span>
3527 
3528     <span class="c"># Match total number of atom neighbors including missing hydrogens...</span>
3529     <span class="k">if</span> <span class="s">(</span><span class="i">$Name</span> =~ <span class="q">/^T$/i</span><span class="s">)</span> <span class="s">{</span>
3530       <span class="i">$Status</span> = <span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span> &amp;&amp; <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetNumOfNonHydrogenAtomNeighbors</span><span class="s">(</span><span class="s">)</span> + <span class="i">$This</span><span class="i">-&gt;GetNumOfHydrogens</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> == <span class="i">$Value</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3531       <span class="k">last</span> <span class="j">NAME</span><span class="sc">;</span>
3532     <span class="s">}</span>
3533 
3534     <span class="c"># Match formal charge...</span>
3535     <span class="k">if</span> <span class="s">(</span><span class="i">$Name</span> =~ <span class="q">/^FC$/i</span><span class="s">)</span> <span class="s">{</span>
3536       <span class="k">my</span> <span class="i">$FormalCharge</span> = <span class="i">$This</span><span class="i">-&gt;GetFormalCharge</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3537       <span class="i">$Status</span> = <span class="i">$This</span><span class="i">-&gt;_MatchNonAtomSymbolAtomicInvariantValue</span><span class="s">(</span><span class="i">$FormalCharge</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span><span class="sc">;</span>
3538       <span class="k">last</span> <span class="j">NAME</span><span class="sc">;</span>
3539     <span class="s">}</span>
3540 
3541     <span class="c"># Match aromatic annotation indicating whether atom is aromatic...</span>
3542     <span class="k">if</span> <span class="s">(</span><span class="i">$Name</span> =~ <span class="q">/^Ar$/i</span><span class="s">)</span> <span class="s">{</span>
3543       <span class="i">$Status</span> = <span class="i">$This</span><span class="i">-&gt;IsAromatic</span><span class="s">(</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3544       <span class="k">last</span> <span class="j">NAME</span><span class="sc">;</span>
3545     <span class="s">}</span>
3546 
3547     <span class="c"># Match number of implicit and explicit hydrogens...</span>
3548     <span class="k">if</span> <span class="s">(</span><span class="i">$Name</span> =~ <span class="q">/^H$/i</span><span class="s">)</span> <span class="s">{</span>
3549       <span class="i">$Status</span> = <span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span> &amp;&amp; <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetNumOfHydrogens</span><span class="s">(</span><span class="s">)</span> == <span class="i">$Value</span><span class="s">)</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3550       <span class="k">last</span> <span class="j">NAME</span><span class="sc">;</span>
3551     <span class="s">}</span>
3552 
3553     <span class="c"># Match ring atom annotation indicating whether atom is in ring...</span>
3554     <span class="k">if</span> <span class="s">(</span><span class="i">$Name</span> =~ <span class="q">/^RA$/i</span><span class="s">)</span> <span class="s">{</span>
3555       <span class="i">$Status</span> = <span class="k">defined</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span> ? <span class="i">$This</span><span class="i">-&gt;IsInRingOfSize</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span> <span class="co">:</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;IsInRing</span><span class="s">(</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="s">)</span><span class="sc">;</span>
3556       <span class="k">last</span> <span class="j">NAME</span><span class="sc">;</span>
3557     <span class="s">}</span>
3558 
3559     <span class="c"># Match number of rings for atom..</span>
3560     <span class="k">if</span> <span class="s">(</span><span class="i">$Name</span> =~ <span class="q">/^TR$/i</span><span class="s">)</span> <span class="s">{</span>
3561       <span class="i">$Status</span> = <span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span> &amp;&amp; <span class="s">(</span><span class="i">$Value</span> == <span class="i">$This</span><span class="i">-&gt;GetNumOfRings</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3562       <span class="k">last</span> <span class="j">NAME</span><span class="sc">;</span>
3563     <span class="s">}</span>
3564 
3565     <span class="c"># Match sum of bond orders to non-hydrogen atom neighbors...</span>
3566     <span class="k">if</span> <span class="s">(</span><span class="i">$Name</span> =~ <span class="q">/^BO$/i</span><span class="s">)</span> <span class="s">{</span>
3567       <span class="i">$Status</span> = <span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span> &amp;&amp; <span class="i">$This</span><span class="i">-&gt;GetSumOfBondOrdersToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span> == <span class="i">$Value</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3568       <span class="k">last</span> <span class="j">NAME</span><span class="sc">;</span>
3569     <span class="s">}</span>
3570 
3571     <span class="c"># Match largest bond order of non-hydrogen atom neighbors...</span>
3572     <span class="k">if</span> <span class="s">(</span><span class="i">$Name</span> =~ <span class="q">/^LBO$/i</span><span class="s">)</span> <span class="s">{</span>
3573       <span class="i">$Status</span> = <span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span> &amp;&amp; <span class="i">$This</span><span class="i">-&gt;GetLargestBondOrderToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span> == <span class="i">$Value</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3574       <span class="k">last</span> <span class="j">NAME</span><span class="sc">;</span>
3575     <span class="s">}</span>
3576 
3577     <span class="c"># Match number of single bonds to non-hydrogen atom neighbors...</span>
3578     <span class="k">if</span> <span class="s">(</span><span class="i">$Name</span> =~ <span class="q">/^SB$/i</span><span class="s">)</span> <span class="s">{</span>
3579       <span class="i">$Status</span> = <span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span> &amp;&amp; <span class="i">$This</span><span class="i">-&gt;GetNumOfSingleBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span> == <span class="i">$Value</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3580       <span class="k">last</span> <span class="j">NAME</span><span class="sc">;</span>
3581     <span class="s">}</span>
3582 
3583     <span class="c"># Match total number of single bonds to atom neighbors including missing and explicit hydrogens...</span>
3584     <span class="k">if</span> <span class="s">(</span><span class="i">$Name</span> =~ <span class="q">/^TSB$/i</span><span class="s">)</span> <span class="s">{</span>
3585       <span class="i">$Status</span> = <span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span> &amp;&amp; <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetNumOfSingleBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span> + <span class="i">$This</span><span class="i">-&gt;GetNumOfHydrogens</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> == <span class="i">$Value</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3586       <span class="k">last</span> <span class="j">NAME</span><span class="sc">;</span>
3587     <span class="s">}</span>
3588 
3589     <span class="c"># Match number of double bonds to non-hydrogen atom neighbors...</span>
3590     <span class="k">if</span> <span class="s">(</span><span class="i">$Name</span> =~ <span class="q">/^DB$/i</span><span class="s">)</span> <span class="s">{</span>
3591       <span class="i">$Status</span> = <span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span> &amp;&amp; <span class="i">$This</span><span class="i">-&gt;GetNumOfDoubleBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span> == <span class="i">$Value</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3592       <span class="k">last</span> <span class="j">NAME</span><span class="sc">;</span>
3593     <span class="s">}</span>
3594 
3595     <span class="c"># Match number of triple bonds to non-hydrogen atom neighbors...</span>
3596     <span class="k">if</span> <span class="s">(</span><span class="i">$Name</span> =~ <span class="q">/^TB$/i</span><span class="s">)</span> <span class="s">{</span>
3597       <span class="i">$Status</span> = <span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span> &amp;&amp; <span class="i">$This</span><span class="i">-&gt;GetNumOfTripleBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span> == <span class="i">$Value</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3598       <span class="k">last</span> <span class="j">NAME</span><span class="sc">;</span>
3599     <span class="s">}</span>
3600 
3601     <span class="c"># Match number of aromatic bonds to non-hydrogen atom neighbors...</span>
3602     <span class="k">if</span> <span class="s">(</span><span class="i">$Name</span> =~ <span class="q">/^AB$/i</span><span class="s">)</span> <span class="s">{</span>
3603       <span class="i">$Status</span> = <span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span> &amp;&amp; <span class="i">$This</span><span class="i">-&gt;GetNumOfAromaticBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span> == <span class="i">$Value</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3604       <span class="k">last</span> <span class="j">NAME</span><span class="sc">;</span>
3605     <span class="s">}</span>
3606 
3607 
3608     <span class="c"># Match mass number indicating isotope other than most abundant isotope...</span>
3609     <span class="k">if</span> <span class="s">(</span><span class="i">$Name</span> =~ <span class="q">/^MN$/i</span><span class="s">)</span> <span class="s">{</span>
3610       <span class="i">$Status</span> = <span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span> &amp;&amp; <span class="i">$This</span><span class="i">-&gt;GetMassNumber</span><span class="s">(</span><span class="s">)</span> == <span class="i">$Value</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3611       <span class="k">last</span> <span class="j">NAME</span><span class="sc">;</span>
3612     <span class="s">}</span>
3613 
3614     <span class="c"># Match spin multiplicity...</span>
3615     <span class="k">if</span> <span class="s">(</span><span class="i">$Name</span> =~ <span class="q">/^SM$/i</span><span class="s">)</span> <span class="s">{</span>
3616       <span class="k">my</span> <span class="i">$SpinMultiplicity</span> = <span class="i">$This</span><span class="i">-&gt;GetSpinMultiplicity</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3617       <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$SpinMultiplicity</span><span class="s">)</span> <span class="s">{</span> <span class="i">$SpinMultiplicity</span> = <span class="n">0</span><span class="sc">;</span> <span class="s">}</span>
3618       <span class="i">$Status</span> = <span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span> &amp;&amp; <span class="k">defined</span><span class="s">(</span><span class="i">$SpinMultiplicity</span><span class="s">)</span> &amp;&amp; <span class="i">$Value</span> == <span class="i">$SpinMultiplicity</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3619       <span class="k">last</span> <span class="j">NAME</span><span class="sc">;</span>
3620     <span class="s">}</span>
3621 
3622     <span class="i">$UnknownName</span> = <span class="n">1</span><span class="sc">;</span>
3623     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_MatchNonAtomSymbolAtomicInvariant: Unknown atomic invariant $AtomicInvariant...&quot;</span><span class="sc">;</span>
3624   <span class="s">}</span>
3625 
3626   <span class="k">if</span> <span class="s">(</span>!<span class="i">$UnknownName</span><span class="s">)</span> <span class="s">{</span>
3627     <span class="k">if</span> <span class="s">(</span><span class="i">$NegateMatch</span><span class="s">)</span> <span class="s">{</span>
3628       <span class="i">$Status</span> = <span class="i">$Status</span> ? <span class="n">0</span> <span class="co">:</span> <span class="n">1</span><span class="sc">;</span>
3629     <span class="s">}</span>
3630   <span class="s">}</span>
3631 
3632   <span class="k">return</span> <span class="i">$Status</span><span class="sc">;</span>
3633 <span class="s">}</span>
3634 
3635 <span class="c"># Match atomic invariant value...</span>
3636 <span class="c">#</span>
3637 <span class="c"># Specified value format:</span>
3638 <span class="c">#   . +* : Any positive value</span>
3639 <span class="c">#   . -* : Any negative value</span>
3640 <span class="c">#   . &gt;ValidNumber or &gt;=ValidNumber</span>
3641 <span class="c">#   . &lt;ValidNumber or &lt;=ValidNumber</span>
3642 <span class="c">#   . Any valid number</span>
3643 <span class="c">#</span>
<a name="_MatchNonAtomSymbolAtomicInvariantValue-"></a>3644 <span class="k">sub </span><span class="m">_MatchNonAtomSymbolAtomicInvariantValue</span> <span class="s">{</span>
3645   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$TargetValue</span><span class="cm">,</span> <span class="i">$SpecifiedValue</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3646   <span class="k">my</span><span class="s">(</span><span class="i">$Status</span><span class="s">)</span><span class="sc">;</span>
3647 
3648   <span class="i">$Status</span> = <span class="n">0</span><span class="sc">;</span>
3649 
3650   <span class="k">if</span> <span class="s">(</span>!<span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$TargetValue</span><span class="s">)</span> &amp;&amp; <span class="k">defined</span><span class="s">(</span><span class="i">$SpecifiedValue</span><span class="s">)</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3651     <span class="k">return</span> <span class="i">$Status</span><span class="sc">;</span>
3652   <span class="s">}</span>
3653 
3654   <span class="j">VALUE:</span> <span class="s">{</span>
3655     <span class="k">if</span> <span class="s">(</span><span class="i">$SpecifiedValue</span> =~ <span class="q">/^\+\*/</span><span class="s">)</span> <span class="s">{</span>
3656       <span class="i">$Status</span> = <span class="s">(</span><span class="i">$TargetValue</span> &gt; <span class="n">0</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3657       <span class="k">last</span> <span class="j">VALUE</span><span class="sc">;</span>
3658     <span class="s">}</span>
3659     <span class="k">if</span> <span class="s">(</span><span class="i">$SpecifiedValue</span> =~ <span class="q">/^\-\*/</span><span class="s">)</span> <span class="s">{</span>
3660       <span class="i">$Status</span> = <span class="s">(</span><span class="i">$TargetValue</span> &lt; <span class="n">0</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3661       <span class="k">last</span> <span class="j">VALUE</span><span class="sc">;</span>
3662     <span class="s">}</span>
3663     <span class="k">if</span> <span class="s">(</span><span class="i">$SpecifiedValue</span> =~ <span class="q">/^&gt;/</span><span class="s">)</span> <span class="s">{</span>
3664       <span class="k">if</span> <span class="s">(</span><span class="i">$SpecifiedValue</span> =~ <span class="q">/^&gt;=/</span><span class="s">)</span> <span class="s">{</span>
3665         <span class="i">$SpecifiedValue</span> =~ <span class="q">s/^&gt;=//</span><span class="sc">;</span>
3666         <span class="i">$Status</span> = <span class="s">(</span><span class="i">$SpecifiedValue</span> &gt;= <span class="i">$TargetValue</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3667       <span class="s">}</span>
3668       <span class="k">else</span> <span class="s">{</span>
3669         <span class="i">$SpecifiedValue</span> =~ <span class="q">s/^&gt;//</span><span class="sc">;</span>
3670         <span class="i">$Status</span> = <span class="s">(</span><span class="i">$SpecifiedValue</span> &gt; <span class="i">$TargetValue</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3671       <span class="s">}</span>
3672       <span class="k">last</span> <span class="j">VALUE</span><span class="sc">;</span>
3673     <span class="s">}</span>
3674     <span class="k">if</span> <span class="s">(</span><span class="i">$SpecifiedValue</span> =~ <span class="q">/^&lt;/</span><span class="s">)</span> <span class="s">{</span>
3675       <span class="k">if</span> <span class="s">(</span><span class="i">$SpecifiedValue</span> =~ <span class="q">/^&lt;=/</span><span class="s">)</span> <span class="s">{</span>
3676         <span class="i">$SpecifiedValue</span> =~ <span class="q">s/^&lt;=//</span><span class="sc">;</span>
3677         <span class="i">$Status</span> = <span class="s">(</span><span class="i">$SpecifiedValue</span> &lt;= <span class="i">$TargetValue</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3678       <span class="s">}</span>
3679       <span class="k">else</span> <span class="s">{</span>
3680         <span class="i">$SpecifiedValue</span> =~ <span class="q">s/^&lt;//</span><span class="sc">;</span>
3681         <span class="i">$Status</span> = <span class="s">(</span><span class="i">$SpecifiedValue</span> &lt; <span class="i">$TargetValue</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3682       <span class="s">}</span>
3683       <span class="k">last</span> <span class="j">VALUE</span><span class="sc">;</span>
3684     <span class="s">}</span>
3685     <span class="c"># Default is do perform an equality match...</span>
3686     <span class="i">$Status</span> = <span class="s">(</span><span class="i">$SpecifiedValue</span> == <span class="i">$TargetValue</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3687   <span class="s">}</span>
3688 
3689   <span class="k">return</span> <span class="i">$Status</span><span class="sc">;</span>
3690 <span class="s">}</span>
3691 
3692 <span class="c"># Check whether atoms match  bond specifications...</span>
3693 <span class="c">#</span>
<a name="_DoesBondSpecificationMatch-"></a>3694 <span class="k">sub </span><span class="m">_DoesBondSpecificationMatch</span> <span class="s">{</span>
3695   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$BondedAtom</span><span class="cm">,</span> <span class="i">$BondSpecificationToMatch</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3696   <span class="k">my</span><span class="s">(</span><span class="i">$BondSpecification</span><span class="cm">,</span> <span class="i">$BondSymbolSpecification</span><span class="cm">,</span> <span class="i">$BondSpecificationMatched</span><span class="s">)</span><span class="sc">;</span>
3697 
3698   <span class="c"># Anything to match...</span>
3699   <span class="k">if</span> <span class="s">(</span>!<span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$BondSpecificationToMatch</span><span class="s">)</span> &amp;&amp; <span class="i">$BondSpecificationToMatch</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3700     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3701   <span class="s">}</span>
3702 
3703   <span class="c"># Take out any spaces...</span>
3704   <span class="i">$BondSpecificationToMatch</span> =~ <span class="q">s/ //g</span><span class="sc">;</span>
3705 
3706   <span class="c"># Match specified bond specifications. For multiple bond specifications in a comma delimited string,</span>
3707   <span class="c"># only one bond specification needs to match for a successful match...</span>
3708   <span class="c">#</span>
3709   <span class="k">for</span> <span class="i">$BondSpecification</span> <span class="s">(</span><span class="k">split</span> <span class="q">/\,/</span><span class="cm">,</span> <span class="i">$BondSpecificationToMatch</span><span class="s">)</span> <span class="s">{</span>
3710     <span class="i">$BondSpecificationMatched</span> = <span class="n">1</span><span class="sc">;</span>
3711 
3712     <span class="c"># Match all specified bond symbol specifications...</span>
3713     <span class="j">BONDSYMBOL:</span> <span class="k">for</span> <span class="i">$BondSymbolSpecification</span> <span class="s">(</span><span class="k">split</span> <span class="q">/\./</span><span class="cm">,</span> <span class="i">$BondSpecification</span><span class="s">)</span> <span class="s">{</span>
3714       <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;_MatchBondSymbolSpecification</span><span class="s">(</span><span class="i">$BondedAtom</span><span class="cm">,</span> <span class="i">$BondSymbolSpecification</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3715         <span class="c"># No need to match other bond symbol specifications...</span>
3716         <span class="i">$BondSpecificationMatched</span> = <span class="n">0</span><span class="sc">;</span>
3717         <span class="k">last</span> <span class="j">BONDSYMBOL</span><span class="sc">;</span>
3718       <span class="s">}</span>
3719     <span class="s">}</span>
3720     <span class="k">if</span> <span class="s">(</span><span class="i">$BondSpecificationMatched</span><span class="s">)</span> <span class="s">{</span>
3721       <span class="c"># No need to try matching other bond specifications...</span>
3722       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3723     <span class="s">}</span>
3724   <span class="s">}</span>
3725 
3726   <span class="c"># Nothing matched...</span>
3727   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3728 <span class="s">}</span>
3729 
3730 <span class="c"># Check whether atoms match  bond symbol specification...</span>
3731 <span class="c">#</span>
<a name="_MatchBondSymbolSpecification-"></a>3732 <span class="k">sub </span><span class="m">_MatchBondSymbolSpecification</span> <span class="s">{</span>
3733   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$BondedAtom</span><span class="cm">,</span> <span class="i">$BondSymbolSpecification</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3734   <span class="k">my</span><span class="s">(</span><span class="i">$NegateMatch</span><span class="cm">,</span> <span class="i">$Status</span><span class="cm">,</span> <span class="i">$Bond</span><span class="cm">,</span> <span class="i">$BondSymbol</span><span class="cm">,</span> <span class="i">$UnknownBondSymbol</span><span class="s">)</span><span class="sc">;</span>
3735 
3736   <span class="s">(</span><span class="i">$Status</span><span class="cm">,</span> <span class="i">$NegateMatch</span><span class="cm">,</span> <span class="i">$UnknownBondSymbol</span><span class="s">)</span> = <span class="s">(</span><span class="q">&#39;0&#39;</span><span class="s">)</span> x <span class="n">3</span><span class="sc">;</span>
3737 
3738   <span class="c"># Does match needs to be negated?</span>
3739   <span class="k">if</span> <span class="s">(</span><span class="i">$BondSymbolSpecification</span> =~ <span class="q">/^!/</span><span class="s">)</span> <span class="s">{</span>
3740     <span class="i">$NegateMatch</span> = <span class="n">1</span><span class="sc">;</span>
3741     <span class="i">$BondSymbolSpecification</span> =~ <span class="q">s/^!//</span><span class="sc">;</span>
3742   <span class="s">}</span>
3743   <span class="i">$BondSymbol</span> = <span class="i">$BondSymbolSpecification</span><span class="sc">;</span>
3744   <span class="i">$Bond</span> = <span class="i">$This</span><span class="i">-&gt;GetBondToAtom</span><span class="s">(</span><span class="i">$BondedAtom</span><span class="s">)</span><span class="sc">;</span>
3745 
3746   <span class="j">BONDSYMBOL:</span> <span class="s">{</span>
3747     <span class="k">if</span> <span class="s">(</span><span class="i">$BondSymbol</span> =~ <span class="q">/^(-|1|s|Single)$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">$Status</span> = <span class="i">$Bond</span><span class="i">-&gt;IsSingle</span><span class="s">(</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span> <span class="k">last</span> <span class="j">BONDSYMBOL</span><span class="sc">;</span> <span class="s">}</span>
3748     <span class="k">if</span> <span class="s">(</span><span class="i">$BondSymbol</span> =~ <span class="q">/^(=|2|d|Double)$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">$Status</span> = <span class="i">$Bond</span><span class="i">-&gt;IsDouble</span><span class="s">(</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span> <span class="k">last</span> <span class="j">BONDSYMBOL</span><span class="sc">;</span> <span class="s">}</span>
3749     <span class="k">if</span> <span class="s">(</span><span class="i">$BondSymbol</span> =~ <span class="q">/^(#|3|t|Triple)$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">$Status</span> = <span class="i">$Bond</span><span class="i">-&gt;IsTriple</span><span class="s">(</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span> <span class="k">last</span> <span class="j">BONDSYMBOL</span><span class="sc">;</span> <span class="s">}</span>
3750     <span class="k">if</span> <span class="s">(</span><span class="i">$BondSymbol</span> =~ <span class="q">/^(:|a|Ar|Aromatic)$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">$Status</span> = <span class="i">$Bond</span><span class="i">-&gt;IsAromatic</span><span class="s">(</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span> <span class="k">last</span> <span class="j">BONDSYMBOL</span><span class="sc">;</span> <span class="s">}</span>
3751 
3752     <span class="k">if</span> <span class="s">(</span><span class="i">$BondSymbol</span> =~ <span class="q">/^(\@|RB|Ring)$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">$Status</span> = <span class="i">$Bond</span><span class="i">-&gt;IsInRing</span><span class="s">(</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span> <span class="k">last</span> <span class="j">BONDSYMBOL</span><span class="sc">;</span> <span class="s">}</span>
3753 
3754     <span class="k">if</span> <span class="s">(</span><span class="i">$BondSymbol</span> =~ <span class="q">/^(\~|\*|Any)$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">$Status</span> = <span class="n">1</span><span class="sc">;</span> <span class="k">last</span> <span class="j">BONDSYMBOL</span><span class="sc">;</span> <span class="s">}</span>
3755 
3756     <span class="i">$UnknownBondSymbol</span> = <span class="n">1</span><span class="sc">;</span>
3757     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_MatchBondSpecification: Unknown bond specification $BondSymbolSpecification...&quot;</span><span class="sc">;</span>
3758   <span class="s">}</span>
3759 
3760   <span class="k">if</span> <span class="s">(</span>!<span class="i">$UnknownBondSymbol</span><span class="s">)</span> <span class="s">{</span>
3761     <span class="k">if</span> <span class="s">(</span><span class="i">$NegateMatch</span><span class="s">)</span> <span class="s">{</span>
3762       <span class="i">$Status</span> = <span class="i">$Status</span> ? <span class="n">0</span> <span class="co">:</span> <span class="n">1</span><span class="sc">;</span>
3763     <span class="s">}</span>
3764   <span class="s">}</span>
3765 
3766   <span class="k">return</span> <span class="i">$Status</span><span class="sc">;</span>
3767 <span class="s">}</span>
3768 
3769 <span class="c"># Is it a saturated atom?</span>
3770 <span class="c">#</span>
<a name="IsSaturated-"></a>3771 <span class="k">sub </span><span class="m">IsSaturated</span> <span class="s">{</span>
3772   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3773 
3774   <span class="k">return</span> !<span class="i">$This</span><span class="i">-&gt;IsUnsaturated</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3775 <span class="s">}</span>
3776 
3777 <span class="c"># Is it an unsaturated atom containing at least one non-single bond?</span>
3778 <span class="c">#</span>
<a name="IsUnsaturated-"></a>3779 <span class="k">sub </span><span class="m">IsUnsaturated</span> <span class="s">{</span>
3780   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3781   <span class="k">my</span><span class="s">(</span><span class="i">$NumOfSingleBonds</span><span class="cm">,</span> <span class="i">$NumOfDoubleBonds</span><span class="cm">,</span> <span class="i">$NumOfTripleBonds</span><span class="cm">,</span> <span class="i">$NumOfAromaticBonds</span><span class="s">)</span><span class="sc">;</span>
3782 
3783   <span class="s">(</span><span class="i">$NumOfSingleBonds</span><span class="cm">,</span> <span class="i">$NumOfDoubleBonds</span><span class="cm">,</span> <span class="i">$NumOfTripleBonds</span><span class="cm">,</span> <span class="i">$NumOfAromaticBonds</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;GetNumOfBondTypesToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3784 
3785   <span class="k">return</span> <span class="s">(</span><span class="i">$NumOfDoubleBonds</span> || <span class="i">$NumOfTripleBonds</span> || <span class="i">$NumOfAromaticBonds</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3786 <span class="s">}</span>
3787 
3788 <span class="c"># Is atom in a ring?</span>
3789 <span class="c">#</span>
<a name="IsInRing-"></a>3790 <span class="k">sub </span><span class="m">IsInRing</span> <span class="s">{</span>
3791   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3792 
3793   <span class="c"># Is this atom in a molecule?</span>
3794   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3795     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
3796   <span class="s">}</span>
3797   <span class="k">my</span><span class="s">(</span><span class="i">$Molecule</span><span class="s">)</span><span class="sc">;</span>
3798   <span class="i">$Molecule</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="sc">;</span>
3799 
3800   <span class="k">return</span> <span class="i">$Molecule</span><span class="i">-&gt;_IsAtomInRing</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span><span class="sc">;</span>
3801 <span class="s">}</span>
3802 
3803 <span class="c"># Is atom not in a ring?</span>
3804 <span class="c">#</span>
<a name="IsNotInRing-"></a>3805 <span class="k">sub </span><span class="m">IsNotInRing</span> <span class="s">{</span>
3806   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3807 
3808   <span class="c"># Is this atom in a molecule?</span>
3809   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3810     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
3811   <span class="s">}</span>
3812   <span class="k">my</span><span class="s">(</span><span class="i">$Molecule</span><span class="s">)</span><span class="sc">;</span>
3813   <span class="i">$Molecule</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="sc">;</span>
3814 
3815   <span class="k">return</span> <span class="i">$Molecule</span><span class="i">-&gt;_IsAtomNotInRing</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span><span class="sc">;</span>
3816 <span class="s">}</span>
3817 
3818 <span class="c"># Is atom only in one ring?</span>
3819 <span class="c">#</span>
<a name="IsOnlyInOneRing-"></a>3820 <span class="k">sub </span><span class="m">IsOnlyInOneRing</span> <span class="s">{</span>
3821   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3822 
3823   <span class="c"># Is this atom in a molecule?</span>
3824   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3825     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
3826   <span class="s">}</span>
3827   <span class="k">my</span><span class="s">(</span><span class="i">$Molecule</span><span class="s">)</span><span class="sc">;</span>
3828   <span class="i">$Molecule</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="sc">;</span>
3829 
3830   <span class="k">return</span> <span class="i">$Molecule</span><span class="i">-&gt;_IsAtomInOnlyOneRing</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span><span class="sc">;</span>
3831 <span class="s">}</span>
3832 
3833 <span class="c"># Is atom in a ring of specific size?</span>
3834 <span class="c">#</span>
<a name="IsInRingOfSize-"></a>3835 <span class="k">sub </span><span class="m">IsInRingOfSize</span> <span class="s">{</span>
3836   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3837 
3838   <span class="c"># Is this atom in a molecule?</span>
3839   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3840     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
3841   <span class="s">}</span>
3842   <span class="k">my</span><span class="s">(</span><span class="i">$Molecule</span><span class="s">)</span><span class="sc">;</span>
3843   <span class="i">$Molecule</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="sc">;</span>
3844 
3845   <span class="k">return</span> <span class="i">$Molecule</span><span class="i">-&gt;_IsAtomInRingOfSize</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span><span class="sc">;</span>
3846 <span class="s">}</span>
3847 
3848 <span class="c"># Get size of smallest ring containing the atom...</span>
3849 <span class="c">#</span>
<a name="GetSizeOfSmallestRing-"></a>3850 <span class="k">sub </span><span class="m">GetSizeOfSmallestRing</span> <span class="s">{</span>
3851   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3852 
3853   <span class="c"># Is this atom in a molecule?</span>
3854   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3855     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
3856   <span class="s">}</span>
3857   <span class="k">my</span><span class="s">(</span><span class="i">$Molecule</span><span class="s">)</span><span class="sc">;</span>
3858   <span class="i">$Molecule</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="sc">;</span>
3859 
3860   <span class="k">return</span> <span class="i">$Molecule</span><span class="i">-&gt;_GetSizeOfSmallestAtomRing</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span><span class="sc">;</span>
3861 <span class="s">}</span>
3862 
3863 <span class="c"># Get size of largest ring containing the atom...</span>
3864 <span class="c">#</span>
<a name="GetSizeOfLargestRing-"></a>3865 <span class="k">sub </span><span class="m">GetSizeOfLargestRing</span> <span class="s">{</span>
3866   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3867 
3868   <span class="c"># Is this atom in a molecule?</span>
3869   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3870     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
3871   <span class="s">}</span>
3872   <span class="k">my</span><span class="s">(</span><span class="i">$Molecule</span><span class="s">)</span><span class="sc">;</span>
3873   <span class="i">$Molecule</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="sc">;</span>
3874 
3875   <span class="k">return</span> <span class="i">$Molecule</span><span class="i">-&gt;_GetSizeOfLargestAtomRing</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span><span class="sc">;</span>
3876 <span class="s">}</span>
3877 
3878 <span class="c"># Get number of  rings containing the atom...</span>
3879 <span class="c">#</span>
<a name="GetNumOfRings-"></a>3880 <span class="k">sub </span><span class="m">GetNumOfRings</span> <span class="s">{</span>
3881   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3882 
3883   <span class="c"># Is this atom in a molecule?</span>
3884   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3885     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
3886   <span class="s">}</span>
3887   <span class="k">my</span><span class="s">(</span><span class="i">$Molecule</span><span class="s">)</span><span class="sc">;</span>
3888   <span class="i">$Molecule</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="sc">;</span>
3889 
3890   <span class="k">return</span> <span class="i">$Molecule</span><span class="i">-&gt;_GetNumOfAtomRings</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span><span class="sc">;</span>
3891 <span class="s">}</span>
3892 
3893 <span class="c"># Get number of  rings with odd size containing the atom...</span>
3894 <span class="c">#</span>
<a name="GetNumOfRingsWithOddSize-"></a>3895 <span class="k">sub </span><span class="m">GetNumOfRingsWithOddSize</span> <span class="s">{</span>
3896   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3897 
3898   <span class="c"># Is this atom in a molecule?</span>
3899   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3900     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
3901   <span class="s">}</span>
3902   <span class="k">my</span><span class="s">(</span><span class="i">$Molecule</span><span class="s">)</span><span class="sc">;</span>
3903   <span class="i">$Molecule</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="sc">;</span>
3904 
3905   <span class="k">return</span> <span class="i">$Molecule</span><span class="i">-&gt;_GetNumOfAtomRingsWithOddSize</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span><span class="sc">;</span>
3906 <span class="s">}</span>
3907 
3908 <span class="c"># Get number of  rings with even size containing the atom...</span>
3909 <span class="c">#</span>
<a name="GetNumOfRingsWithEvenSize-"></a>3910 <span class="k">sub </span><span class="m">GetNumOfRingsWithEvenSize</span> <span class="s">{</span>
3911   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3912 
3913   <span class="c"># Is this atom in a molecule?</span>
3914   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3915     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
3916   <span class="s">}</span>
3917   <span class="k">my</span><span class="s">(</span><span class="i">$Molecule</span><span class="s">)</span><span class="sc">;</span>
3918   <span class="i">$Molecule</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="sc">;</span>
3919 
3920   <span class="k">return</span> <span class="i">$Molecule</span><span class="i">-&gt;_GetNumOfAtomRingsWithEvenSize</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span><span class="sc">;</span>
3921 <span class="s">}</span>
3922 
3923 <span class="c"># Get number of  rings with specified size containing the atom...</span>
3924 <span class="c">#</span>
<a name="GetNumOfRingsWithSize-"></a>3925 <span class="k">sub </span><span class="m">GetNumOfRingsWithSize</span> <span class="s">{</span>
3926   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3927 
3928   <span class="c"># Is this atom in a molecule?</span>
3929   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3930     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
3931   <span class="s">}</span>
3932   <span class="k">my</span><span class="s">(</span><span class="i">$Molecule</span><span class="s">)</span><span class="sc">;</span>
3933   <span class="i">$Molecule</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="sc">;</span>
3934 
3935   <span class="k">return</span> <span class="i">$Molecule</span><span class="i">-&gt;_GetNumOfAtomRingsWithSize</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span><span class="sc">;</span>
3936 
3937 <span class="s">}</span>
3938 
3939 <span class="c"># Get number of  rings with size less than specified containing the atom...</span>
3940 <span class="c">#</span>
<a name="GetNumOfRingsWithSizeLessThan-"></a>3941 <span class="k">sub </span><span class="m">GetNumOfRingsWithSizeLessThan</span> <span class="s">{</span>
3942   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3943 
3944   <span class="c"># Is this atom in a molecule?</span>
3945   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3946     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
3947   <span class="s">}</span>
3948   <span class="k">my</span><span class="s">(</span><span class="i">$Molecule</span><span class="s">)</span><span class="sc">;</span>
3949   <span class="i">$Molecule</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="sc">;</span>
3950 
3951   <span class="k">return</span> <span class="i">$Molecule</span><span class="i">-&gt;_GetNumOfAtomRingsWithSizeLessThan</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span><span class="sc">;</span>
3952 <span class="s">}</span>
3953 
3954 <span class="c"># Get number of  rings with size greater than specified size containing the atom...</span>
3955 <span class="c">#</span>
<a name="GetNumOfRingsWithSizeGreaterThan-"></a>3956 <span class="k">sub </span><span class="m">GetNumOfRingsWithSizeGreaterThan</span> <span class="s">{</span>
3957   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3958 
3959   <span class="c"># Is this atom in a molecule?</span>
3960   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3961     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
3962   <span class="s">}</span>
3963   <span class="k">my</span><span class="s">(</span><span class="i">$Molecule</span><span class="s">)</span><span class="sc">;</span>
3964   <span class="i">$Molecule</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="sc">;</span>
3965 
3966   <span class="k">return</span> <span class="i">$Molecule</span><span class="i">-&gt;_GetNumOfAtomRingsWithSizeGreaterThan</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span><span class="sc">;</span>
3967 <span class="s">}</span>
3968 
3969 <span class="c"># Get all rings an array of references to arrays containing ring atoms...</span>
3970 <span class="c">#</span>
<a name="GetRings-"></a>3971 <span class="k">sub </span><span class="m">GetRings</span> <span class="s">{</span>
3972   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3973 
3974   <span class="c"># Is this atom in a molecule?</span>
3975   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3976     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
3977   <span class="s">}</span>
3978   <span class="k">my</span><span class="s">(</span><span class="i">$Molecule</span><span class="s">)</span><span class="sc">;</span>
3979   <span class="i">$Molecule</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="sc">;</span>
3980 
3981   <span class="k">return</span> <span class="i">$Molecule</span><span class="i">-&gt;_GetAtomRings</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span><span class="sc">;</span>
3982 <span class="s">}</span>
3983 
3984 <span class="c"># Get smallest ring as an array containing ring atoms...</span>
3985 <span class="c">#</span>
<a name="GetSmallestRing-"></a>3986 <span class="k">sub </span><span class="m">GetSmallestRing</span> <span class="s">{</span>
3987   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3988 
3989   <span class="c"># Is this atom in a molecule?</span>
3990   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3991     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
3992   <span class="s">}</span>
3993   <span class="k">my</span><span class="s">(</span><span class="i">$Molecule</span><span class="s">)</span><span class="sc">;</span>
3994   <span class="i">$Molecule</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="sc">;</span>
3995 
3996   <span class="k">return</span> <span class="i">$Molecule</span><span class="i">-&gt;_GetSmallestAtomRing</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span><span class="sc">;</span>
3997 <span class="s">}</span>
3998 
3999 <span class="c"># Get largest ring as an array containing ring atoms...</span>
4000 <span class="c">#</span>
<a name="GetLargestRing-"></a>4001 <span class="k">sub </span><span class="m">GetLargestRing</span> <span class="s">{</span>
4002   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4003 
4004   <span class="c"># Is this atom in a molecule?</span>
4005   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4006     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
4007   <span class="s">}</span>
4008   <span class="k">my</span><span class="s">(</span><span class="i">$Molecule</span><span class="s">)</span><span class="sc">;</span>
4009   <span class="i">$Molecule</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="sc">;</span>
4010 
4011   <span class="k">return</span> <span class="i">$Molecule</span><span class="i">-&gt;_GetLargestAtomRing</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span><span class="sc">;</span>
4012 <span class="s">}</span>
4013 
4014 <span class="c"># Get odd size rings an array of references to arrays containing ring atoms...</span>
4015 <span class="c">#</span>
<a name="GetRingsWithOddSize-"></a>4016 <span class="k">sub </span><span class="m">GetRingsWithOddSize</span> <span class="s">{</span>
4017   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4018 
4019   <span class="c"># Is this atom in a molecule?</span>
4020   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4021     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
4022   <span class="s">}</span>
4023   <span class="k">my</span><span class="s">(</span><span class="i">$Molecule</span><span class="s">)</span><span class="sc">;</span>
4024   <span class="i">$Molecule</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="sc">;</span>
4025 
4026   <span class="k">return</span> <span class="i">$Molecule</span><span class="i">-&gt;_GetAtomRingsWithOddSize</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span><span class="sc">;</span>
4027 <span class="s">}</span>
4028 
4029 <span class="c"># Get even size rings an array of references to arrays containing ring atoms...</span>
4030 <span class="c">#</span>
<a name="GetRingsWithEvenSize-"></a>4031 <span class="k">sub </span><span class="m">GetRingsWithEvenSize</span> <span class="s">{</span>
4032   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4033 
4034   <span class="c"># Is this atom in a molecule?</span>
4035   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4036     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
4037   <span class="s">}</span>
4038   <span class="k">my</span><span class="s">(</span><span class="i">$Molecule</span><span class="s">)</span><span class="sc">;</span>
4039   <span class="i">$Molecule</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="sc">;</span>
4040 
4041   <span class="k">return</span> <span class="i">$Molecule</span><span class="i">-&gt;_GetAtomRingsWithEvenSize</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span><span class="sc">;</span>
4042 <span class="s">}</span>
4043 
4044 <span class="c"># Get rings with specified size as an array of references to arrays containing ring atoms...</span>
4045 <span class="c">#</span>
<a name="GetRingsWithSize-"></a>4046 <span class="k">sub </span><span class="m">GetRingsWithSize</span> <span class="s">{</span>
4047   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4048 
4049   <span class="c"># Is this atom in a molecule?</span>
4050   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4051     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
4052   <span class="s">}</span>
4053   <span class="k">my</span><span class="s">(</span><span class="i">$Molecule</span><span class="s">)</span><span class="sc">;</span>
4054   <span class="i">$Molecule</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="sc">;</span>
4055 
4056   <span class="k">return</span> <span class="i">$Molecule</span><span class="i">-&gt;_GetAtomRingsWithSize</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span><span class="sc">;</span>
4057 <span class="s">}</span>
4058 
4059 <span class="c"># Get rings with size less than specfied size as an array of references to arrays containing ring atoms...</span>
4060 <span class="c">#</span>
<a name="GetRingsWithSizeLessThan-"></a>4061 <span class="k">sub </span><span class="m">GetRingsWithSizeLessThan</span> <span class="s">{</span>
4062   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4063 
4064   <span class="c"># Is this atom in a molecule?</span>
4065   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4066     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
4067   <span class="s">}</span>
4068   <span class="k">my</span><span class="s">(</span><span class="i">$Molecule</span><span class="s">)</span><span class="sc">;</span>
4069   <span class="i">$Molecule</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="sc">;</span>
4070 
4071   <span class="k">return</span> <span class="i">$Molecule</span><span class="i">-&gt;_GetAtomRingsWithSizeLessThan</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span><span class="sc">;</span>
4072 <span class="s">}</span>
4073 
4074 <span class="c"># Get rings with size greater than specfied size as an array of references to arrays containing ring atoms...</span>
4075 <span class="c">#</span>
<a name="GetRingsWithSizeGreaterThan-"></a>4076 <span class="k">sub </span><span class="m">GetRingsWithSizeGreaterThan</span> <span class="s">{</span>
4077   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4078 
4079   <span class="c"># Is this atom in a molecule?</span>
4080   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4081     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
4082   <span class="s">}</span>
4083   <span class="k">my</span><span class="s">(</span><span class="i">$Molecule</span><span class="s">)</span><span class="sc">;</span>
4084   <span class="i">$Molecule</span> = <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="sc">;</span>
4085 
4086   <span class="k">return</span> <span class="i">$Molecule</span><span class="i">-&gt;_GetAtomRingsWithSizeGreaterThan</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span><span class="sc">;</span>
4087 <span class="s">}</span>
4088 
4089 <span class="c"># Get next object ID...</span>
<a name="_GetNewObjectID-"></a>4090 <span class="k">sub </span><span class="m">_GetNewObjectID</span> <span class="s">{</span>
4091   <span class="i">$ObjectID</span>++<span class="sc">;</span>
4092   <span class="k">return</span> <span class="i">$ObjectID</span><span class="sc">;</span>
4093 <span class="s">}</span>
4094 
4095 <span class="c"># Return a string containing vertices, edges and other properties...</span>
<a name="StringifyAtom-"></a>4096 <span class="k">sub </span><span class="m">StringifyAtom</span> <span class="s">{</span>
4097   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4098   <span class="k">my</span><span class="s">(</span><span class="i">$AtomString</span><span class="cm">,</span> <span class="i">$ID</span><span class="cm">,</span> <span class="i">$Name</span><span class="cm">,</span> <span class="i">$AtomSymbol</span><span class="cm">,</span> <span class="i">$AtomicNumber</span><span class="cm">,</span> <span class="i">$XYZVector</span><span class="cm">,</span> <span class="i">$AtomicWeight</span><span class="cm">,</span> <span class="i">$ExactMass</span><span class="cm">,</span> <span class="i">$NumOfNeighbors</span><span class="cm">,</span> <span class="i">$NumOfBonds</span><span class="cm">,</span> <span class="i">$Valence</span><span class="cm">,</span> <span class="i">$MissingHydrogens</span><span class="cm">,</span> <span class="i">$TotalHydrogens</span><span class="cm">,</span> <span class="i">$ImplicitHydrogens</span><span class="cm">,</span> <span class="i">$ExplicitHydrogens</span><span class="cm">,</span> <span class="i">$FormalCharge</span><span class="cm">,</span> <span class="i">$Charge</span><span class="cm">,</span> <span class="i">$SpinMultiplicity</span><span class="cm">,</span> <span class="i">$FreeRadicalElectrons</span><span class="cm">,</span> <span class="i">$StereoCenter</span><span class="cm">,</span> <span class="i">$StereoCenterStatus</span><span class="cm">,</span> <span class="i">$StereoChemistry</span><span class="cm">,</span> <span class="i">$StereochemistryString</span><span class="cm">,</span> <span class="i">$RingAtom</span><span class="cm">,</span> <span class="i">$NumOfRings</span><span class="cm">,</span> <span class="i">$AromaticAtom</span><span class="s">)</span><span class="sc">;</span>
4099 
4100   <span class="i">$ID</span> = <span class="i">$This</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4101   <span class="i">$Name</span> = <span class="i">$This</span><span class="i">-&gt;GetName</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4102   <span class="i">$AtomSymbol</span> = <span class="i">$This</span><span class="i">-&gt;GetAtomSymbol</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4103   <span class="i">$AtomicNumber</span> = <span class="i">$This</span><span class="i">-&gt;GetAtomicNumber</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4104   <span class="i">$XYZVector</span> = <span class="i">$This</span><span class="i">-&gt;GetXYZVector</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4105 
4106   <span class="i">$AtomicWeight</span> = <span class="i">$This</span><span class="i">-&gt;GetAtomicWeight</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4107   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$AtomicWeight</span><span class="s">)</span> <span class="s">{</span>
4108     <span class="i">$AtomicWeight</span> = <span class="q">&#39;undefined&#39;</span><span class="sc">;</span>
4109   <span class="s">}</span>
4110   <span class="i">$ExactMass</span> = <span class="i">$This</span><span class="i">-&gt;GetExactMass</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4111   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$ExactMass</span><span class="s">)</span> <span class="s">{</span>
4112     <span class="i">$ExactMass</span> = <span class="q">&#39;undefined&#39;</span><span class="sc">;</span>
4113   <span class="s">}</span>
4114   <span class="i">$NumOfNeighbors</span> = <span class="i">$This</span><span class="i">-&gt;GetNumOfNeighbors</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4115   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$NumOfNeighbors</span><span class="s">)</span> <span class="s">{</span>
4116     <span class="i">$NumOfNeighbors</span> = <span class="q">&#39;undefined&#39;</span><span class="sc">;</span>
4117   <span class="s">}</span>
4118   <span class="i">$NumOfBonds</span> = <span class="i">$This</span><span class="i">-&gt;GetNumOfBonds</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4119   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$NumOfBonds</span><span class="s">)</span> <span class="s">{</span>
4120     <span class="i">$NumOfBonds</span> = <span class="q">&#39;undefined&#39;</span><span class="sc">;</span>
4121   <span class="s">}</span>
4122   <span class="i">$Valence</span> = <span class="i">$This</span><span class="i">-&gt;GetValence</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4123   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$Valence</span><span class="s">)</span> <span class="s">{</span>
4124     <span class="i">$Valence</span> = <span class="q">&#39;undefined&#39;</span><span class="sc">;</span>
4125   <span class="s">}</span>
4126 
4127   <span class="i">$MissingHydrogens</span> = <span class="i">$This</span><span class="i">-&gt;GetNumOfMissingHydrogens</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4128   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$MissingHydrogens</span><span class="s">)</span> <span class="s">{</span>
4129     <span class="i">$MissingHydrogens</span> = <span class="q">&#39;undefined&#39;</span><span class="sc">;</span>
4130   <span class="s">}</span>
4131   <span class="i">$TotalHydrogens</span> = <span class="i">$This</span><span class="i">-&gt;GetNumOfHydrogens</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4132   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$TotalHydrogens</span><span class="s">)</span> <span class="s">{</span>
4133     <span class="i">$TotalHydrogens</span> = <span class="q">&#39;undefined&#39;</span><span class="sc">;</span>
4134   <span class="s">}</span>
4135   <span class="i">$ImplicitHydrogens</span> = <span class="i">$This</span><span class="i">-&gt;GetNumOfImplicitHydrogens</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4136   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$ImplicitHydrogens</span><span class="s">)</span> <span class="s">{</span>
4137     <span class="i">$ImplicitHydrogens</span> = <span class="q">&#39;undefined&#39;</span><span class="sc">;</span>
4138   <span class="s">}</span>
4139   <span class="i">$ExplicitHydrogens</span> = <span class="i">$This</span><span class="i">-&gt;GetNumOfExplicitHydrogens</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4140   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$ExplicitHydrogens</span><span class="s">)</span> <span class="s">{</span>
4141     <span class="i">$ExplicitHydrogens</span> = <span class="q">&#39;undefined&#39;</span><span class="sc">;</span>
4142   <span class="s">}</span>
4143 
4144   <span class="i">$FormalCharge</span> = <span class="i">$This</span><span class="i">-&gt;GetFormalCharge</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4145   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$FormalCharge</span><span class="s">)</span> <span class="s">{</span>
4146     <span class="i">$FormalCharge</span> = <span class="q">&#39;undefined&#39;</span><span class="sc">;</span>
4147   <span class="s">}</span>
4148   <span class="i">$Charge</span> = <span class="i">$This</span><span class="i">-&gt;GetCharge</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4149   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$Charge</span><span class="s">)</span> <span class="s">{</span>
4150     <span class="i">$Charge</span> = <span class="q">&#39;undefined&#39;</span><span class="sc">;</span>
4151   <span class="s">}</span>
4152 
4153   <span class="i">$SpinMultiplicity</span> = <span class="i">$This</span><span class="i">-&gt;GetSpinMultiplicity</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4154   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$SpinMultiplicity</span><span class="s">)</span> <span class="s">{</span>
4155     <span class="i">$SpinMultiplicity</span> = <span class="q">&#39;undefined&#39;</span><span class="sc">;</span>
4156   <span class="s">}</span>
4157   <span class="i">$FreeRadicalElectrons</span> = <span class="i">$This</span><span class="i">-&gt;GetFreeRadicalElectrons</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4158   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$FreeRadicalElectrons</span><span class="s">)</span> <span class="s">{</span>
4159     <span class="i">$FreeRadicalElectrons</span> = <span class="q">&#39;undefined&#39;</span><span class="sc">;</span>
4160   <span class="s">}</span>
4161 
4162   <span class="i">$RingAtom</span> = <span class="i">$This</span><span class="i">-&gt;IsInRing</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4163   <span class="k">if</span> <span class="s">(</span><span class="k">defined</span> <span class="i">$RingAtom</span><span class="s">)</span> <span class="s">{</span>
4164     <span class="i">$RingAtom</span> = <span class="i">$RingAtom</span>  ? <span class="q">&#39;Yes&#39;</span> <span class="co">:</span> <span class="q">&#39;No&#39;</span><span class="sc">;</span>
4165     <span class="i">$NumOfRings</span> = <span class="i">$This</span><span class="i">-&gt;GetNumOfRings</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4166   <span class="s">}</span>
4167   <span class="k">else</span> <span class="s">{</span>
4168     <span class="i">$RingAtom</span> = <span class="q">&#39;undefined&#39;</span><span class="sc">;</span>
4169     <span class="i">$NumOfRings</span> = <span class="q">&#39;undefined&#39;</span><span class="sc">;</span>
4170   <span class="s">}</span>
4171 
4172   <span class="i">$AromaticAtom</span> = <span class="i">$This</span><span class="i">-&gt;GetAromatic</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4173   <span class="k">if</span> <span class="s">(</span><span class="k">defined</span> <span class="i">$AromaticAtom</span><span class="s">)</span> <span class="s">{</span>
4174     <span class="i">$AromaticAtom</span> = <span class="i">$AromaticAtom</span>  ? <span class="q">&#39;Yes&#39;</span> <span class="co">:</span> <span class="q">&#39;No&#39;</span><span class="sc">;</span>
4175   <span class="s">}</span>
4176   <span class="k">else</span> <span class="s">{</span>
4177     <span class="i">$AromaticAtom</span> = <span class="q">&#39;undefined&#39;</span><span class="sc">;</span>
4178   <span class="s">}</span>
4179 
4180   <span class="i">$StereochemistryString</span> = <span class="q">&#39;&#39;</span><span class="sc">;</span>
4181   <span class="i">$StereoCenter</span> = <span class="i">$This</span><span class="i">-&gt;GetStereoCenter</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4182   <span class="k">if</span> <span class="s">(</span><span class="k">defined</span> <span class="i">$StereoCenter</span><span class="s">)</span> <span class="s">{</span>
4183     <span class="i">$StereoCenterStatus</span> = <span class="i">$This</span><span class="i">-&gt;IsStereoCenter</span><span class="s">(</span><span class="s">)</span> ? <span class="q">&#39;Yes&#39;</span> <span class="co">:</span> <span class="q">&#39;No&#39;</span><span class="sc">;</span>
4184     <span class="i">$StereoChemistry</span> = <span class="i">$This</span><span class="i">-&gt;GetStereochemistry</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4185     <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$StereoChemistry</span><span class="s">)</span> <span class="s">{</span>
4186       <span class="i">$StereoChemistry</span> = <span class="q">&#39;undefined&#39;</span><span class="sc">;</span>
4187     <span class="s">}</span>
4188     <span class="i">$StereochemistryString</span> = <span class="q">&quot;StereoCenter: $StereoCenterStatus; Stereochemistry: $StereoChemistry&quot;</span><span class="sc">;</span>
4189   <span class="s">}</span>
4190 
4191   <span class="i">$AtomString</span> = <span class="q">&quot;Atom: ID: $ID; Name: \&quot;$Name\&quot;; AtomSymbol: \&quot;$AtomSymbol\&quot;; AtomicNumber: $AtomicNumber; XYZ: $XYZVector; AtomicWeight: $AtomicWeight; ExactMass: $ExactMass; NumOfNeighbors: $NumOfNeighbors;  NumOfBonds: $NumOfBonds; Valence: $Valence; MissingHydrogens: $MissingHydrogens; TotalHydrogens: $TotalHydrogens; ImplicitHydrogens: $ImplicitHydrogens; ExplicitHydrogens: $ExplicitHydrogens; FormalCharge: $FormalCharge; Charge: $Charge; SpinMultiplicity: $SpinMultiplicity; FreeRadicalElectrons: $FreeRadicalElectrons; RingAtom: $RingAtom; NumOfAtomRings: $NumOfRings; AromaticAtom: $AromaticAtom&quot;</span><span class="sc">;</span>
4192 
4193   <span class="k">if</span> <span class="s">(</span><span class="i">$StereochemistryString</span><span class="s">)</span> <span class="s">{</span>
4194     <span class="i">$AtomString</span> .= <span class="q">&quot;; $StereochemistryString&quot;</span><span class="sc">;</span>
4195   <span class="s">}</span>
4196 
4197   <span class="k">return</span> <span class="i">$AtomString</span><span class="sc">;</span>
4198 <span class="s">}</span>
4199 
4200 <span class="c"># Load appropriate atom data files from &lt;MayaChemTools&gt;/lib directory used by various</span>
4201 <span class="c"># object methods in the current class...</span>
4202 <span class="c">#</span>
<a name="_LoadAtomClassData-"></a>4203 <span class="k">sub </span><span class="m">_LoadAtomClassData</span> <span class="s">{</span>
4204   <span class="k">my</span><span class="s">(</span><span class="i">$MayaChemToolsLibDir</span><span class="s">)</span><span class="sc">;</span>
4205 
4206   <span class="i">$MayaChemToolsLibDir</span> = <span class="i">GetMayaChemToolsLibDirName</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4207 
4208   <span class="i">_LoadAtomValenceModelData</span><span class="s">(</span><span class="i">$MayaChemToolsLibDir</span><span class="s">)</span><span class="sc">;</span>
4209 
4210 <span class="s">}</span>
4211 
4212 <span class="c">#</span>
4213 <span class="c"># Load data for supported valence models...</span>
4214 <span class="c">#</span>
<a name="_LoadAtomValenceModelData-"></a>4215 <span class="k">sub </span><span class="m">_LoadAtomValenceModelData</span> <span class="s">{</span>
4216   <span class="k">my</span><span class="s">(</span><span class="i">$MayaChemToolsLibDir</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4217   <span class="k">my</span><span class="s">(</span><span class="i">$MDLValenceModelDataFile</span><span class="cm">,</span> <span class="i">$DaylightValenceModelDataFile</span><span class="s">)</span><span class="sc">;</span>
4218 
4219   <span class="i">%MDLValenceModelDataMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4220   <span class="i">%DaylightValenceModelDataMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4221 
4222   <span class="i">$MDLValenceModelDataFile</span> = <span class="i">$MayaChemToolsLibDir</span> . <span class="q">&quot;/data/MDLValenceModelData.csv&quot;</span><span class="sc">;</span>
4223   <span class="i">$DaylightValenceModelDataFile</span> = <span class="i">$MayaChemToolsLibDir</span> . <span class="q">&quot;/data/DaylightValenceModelData.csv&quot;</span><span class="sc">;</span>
4224 
4225   <span class="k">if</span> <span class="s">(</span>! <span class="k">-e</span> <span class="q">&quot;$MDLValenceModelDataFile&quot;</span><span class="s">)</span> <span class="s">{</span>
4226     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}::_LoadAtomValenceModelData: MayaChemTools package file, $MDLValenceModelDataFile, is missing: Possible installation problems...&quot;</span><span class="sc">;</span>
4227   <span class="s">}</span>
4228 
4229   <span class="k">if</span> <span class="s">(</span>! <span class="k">-e</span> <span class="q">&quot;$DaylightValenceModelDataFile&quot;</span><span class="s">)</span> <span class="s">{</span>
4230     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}::_LoadAtomValenceModelData: MayaChemTools package file, $DaylightValenceModelDataFile, is missing: Possible installation problems...&quot;</span><span class="sc">;</span>
4231   <span class="s">}</span>
4232 
4233   <span class="i">_LoadValenceModelDataFile</span><span class="s">(</span><span class="i">$MDLValenceModelDataFile</span><span class="cm">,</span> \<span class="i">%MDLValenceModelDataMap</span><span class="s">)</span><span class="sc">;</span>
4234   <span class="i">_LoadValenceModelDataFile</span><span class="s">(</span><span class="i">$DaylightValenceModelDataFile</span><span class="cm">,</span> \<span class="i">%DaylightValenceModelDataMap</span><span class="s">)</span><span class="sc">;</span>
4235 
4236 <span class="s">}</span>
4237 
4238 <span class="c">#</span>
4239 <span class="c"># Load valence model data file...</span>
4240 <span class="c">#</span>
<a name="_LoadValenceModelDataFile-"></a>4241 <span class="k">sub </span><span class="m">_LoadValenceModelDataFile</span> <span class="s">{</span>
4242   <span class="k">my</span><span class="s">(</span><span class="i">$DataFile</span><span class="cm">,</span> <span class="i">$DataMapRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4243 
4244   <span class="c"># File format:</span>
4245   <span class="c">#</span>
4246   <span class="c"># &quot;AtomicNumber&quot;,&quot;ElementSymbol&quot;,&quot;FormalCharge&quot;,&quot;CommomValences&quot;</span>
4247   <span class="c">#</span>
4248   <span class="k">my</span><span class="s">(</span><span class="i">$InDelim</span><span class="cm">,</span> <span class="i">$Line</span><span class="cm">,</span> <span class="i">$NumOfCols</span><span class="cm">,</span> <span class="i">@ColLabels</span><span class="cm">,</span> <span class="i">@LineWords</span><span class="s">)</span><span class="sc">;</span>
4249 
4250   <span class="i">$InDelim</span> = <span class="q">&quot;\,&quot;</span><span class="sc">;</span>
4251   <span class="k">open</span> <span class="w">DATAFILE</span><span class="cm">,</span> <span class="q">&quot;$DataFile&quot;</span> <span class="k">or</span> <span class="w">croak</span> <span class="q">&quot;Couldn&#39;t open $DataFile: $! ...&quot;</span><span class="sc">;</span>
4252 
4253   <span class="c"># Skip lines up to column labels...</span>
4254   <span class="j">LINE:</span> <span class="k">while</span> <span class="s">(</span><span class="i">$Line</span> = <span class="i">GetTextLine</span><span class="s">(</span>\<span class="i">*DATAFILE</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4255     <span class="k">if</span> <span class="s">(</span><span class="i">$Line</span> !~ <span class="q">/^#/</span><span class="s">)</span> <span class="s">{</span>
4256       <span class="k">last</span> <span class="j">LINE</span><span class="sc">;</span>
4257     <span class="s">}</span>
4258   <span class="s">}</span>
4259   <span class="i">@ColLabels</span>= <span class="i">quotewords</span><span class="s">(</span><span class="i">$InDelim</span><span class="cm">,</span> <span class="n">0</span><span class="cm">,</span> <span class="i">$Line</span><span class="s">)</span><span class="sc">;</span>
4260   <span class="i">$NumOfCols</span> = <span class="i">@ColLabels</span><span class="sc">;</span>
4261 
4262   <span class="k">my</span><span class="s">(</span><span class="i">$AtomicNumber</span><span class="cm">,</span> <span class="i">$ElementSymbol</span><span class="cm">,</span> <span class="i">$FormalCharge</span><span class="cm">,</span> <span class="i">$CommonValences</span><span class="s">)</span><span class="sc">;</span>
4263 
4264   <span class="c"># Process element data...</span>
4265   <span class="j">LINE:</span> <span class="k">while</span> <span class="s">(</span><span class="i">$Line</span> = <span class="i">GetTextLine</span><span class="s">(</span>\<span class="i">*DATAFILE</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4266     <span class="k">if</span> <span class="s">(</span><span class="i">$Line</span> =~ <span class="q">/^#/</span><span class="s">)</span> <span class="s">{</span>
4267       <span class="k">next</span> <span class="j">LINE</span><span class="sc">;</span>
4268     <span class="s">}</span>
4269     <span class="i">@LineWords</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4270     <span class="i">@LineWords</span> = <span class="i">quotewords</span><span class="s">(</span><span class="i">$InDelim</span><span class="cm">,</span> <span class="n">0</span><span class="cm">,</span> <span class="i">$Line</span><span class="s">)</span><span class="sc">;</span>
4271     <span class="k">if</span> <span class="s">(</span><span class="i">@LineWords</span> != <span class="i">$NumOfCols</span><span class="s">)</span> <span class="s">{</span>
4272       <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}::_LoadValenceModelDataFile: The number of data fields, @LineWords, in $DataFile must be $NumOfCols.\nLine: $Line...&quot;</span><span class="sc">;</span>
4273     <span class="s">}</span>
4274 
4275     <span class="s">(</span><span class="i">$AtomicNumber</span><span class="cm">,</span> <span class="i">$ElementSymbol</span><span class="cm">,</span> <span class="i">$FormalCharge</span><span class="cm">,</span> <span class="i">$CommonValences</span><span class="s">)</span> = <span class="i">@LineWords</span><span class="sc">;</span>
4276 
4277     <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$DataMapRef</span>-&gt;{<span class="i">$AtomicNumber</span>}<span class="s">)</span> <span class="s">{</span>
4278       <span class="c"># Additional data for an element...</span>
4279       <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$DataMapRef</span>-&gt;{<span class="i">$AtomicNumber</span>}{<span class="i">$FormalCharge</span>}<span class="s">)</span> <span class="s">{</span>
4280         <span class="c"># Duplicate data entries for an element...</span>
4281         <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}::_LoadValenceModelDataFile: Ignoring valence data for element with atomic number $AtomicNumber and formal charge $FormalCharge in data file $DataFile: It has already been loaded.\nLine: $Line...&quot;</span><span class="sc">;</span>
4282         <span class="k">next</span> <span class="j">LINE</span><span class="sc">;</span>
4283       <span class="s">}</span>
4284     <span class="s">}</span>
4285     <span class="k">else</span> <span class="s">{</span>
4286       <span class="c"># Data for a new element...</span>
4287       <span class="i">%</span>{<span class="i">$DataMapRef</span>-&gt;{<span class="i">$AtomicNumber</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4288     <span class="s">}</span>
4289 
4290     <span class="i">%</span>{<span class="i">$DataMapRef</span>-&gt;{<span class="i">$AtomicNumber</span>}{<span class="i">$FormalCharge</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4291     <span class="i">$DataMapRef</span>-&gt;{<span class="i">$AtomicNumber</span>}{<span class="i">$FormalCharge</span>}{<span class="w">ElementSymbol</span>} = <span class="i">$ElementSymbol</span><span class="sc">;</span>
4292 
4293     <span class="i">@</span>{<span class="i">$DataMapRef</span>-&gt;{<span class="i">$AtomicNumber</span>}{<span class="i">$FormalCharge</span>}{<span class="w">CommonValences</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4294     <span class="i">@</span>{<span class="i">$DataMapRef</span>-&gt;{<span class="i">$AtomicNumber</span>}{<span class="i">$FormalCharge</span>}{<span class="w">CommonValences</span>}} = <span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> &lt;=&gt; <span class="i">$b</span> <span class="s">}</span> <span class="k">split</span> <span class="q">/\,/</span><span class="cm">,</span> <span class="i">$CommonValences</span><span class="sc">;</span>
4295   <span class="s">}</span>
4296   <span class="k">close</span> <span class="w">DATAFILE</span><span class="sc">;</span>
4297 <span class="s">}</span>
4298 
<a name="EOF-"></a></pre>
<p>&nbsp;</p>
<br />
<center>
<img src="../../../images/h2o2.png">
</center>
</body>
</html>
